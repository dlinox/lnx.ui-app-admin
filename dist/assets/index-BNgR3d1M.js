import{r as F}from"./icon.utils-DnuXdNV1.js";import{d as ee,e as te,f as ae,b as le}from"./selectables.services-BEnv0PEh.js";import{aj as h,d as U,e as W,r as d,g as H,a3 as M,a4 as a,ad as ne,a7 as x,a8 as t,ab as $,ac as O,ae as A,h as q,af as ue,ag as L,ah as Z,ai as se,Z as J,a9 as E,aa as oe}from"./index-Bqe-vxMq.js";import{d as re,e as K,a as N,b as ie,c as j,i as Q,_ as de}from"./DataTable.types-C3XSPyHT.js";import{_ as ce,a as pe}from"./FormItem-BBmdDte0.js";import{_ as me}from"./InputNumber-DA_7K28D.js";import{_ as _e,d as ve}from"./debounce.utils-rmPTix7t.js";import{a as X,_ as fe}from"./LnxIcon.vue_vue_type_script_setup_true_lang-tM4SdBca.js";import{u as ge,_ as ye}from"./composables-B9b5AZp0.js";import{_ as Ie}from"./Input-yPERYFUO.js";import"./get-C8gX6CwU.js";import"./Remove-DsEDqNmj.js";import"./Add-DUQ_pCkh.js";import"./use-keyboard-BPlN3GQF.js";import"./Forward-DN8GWHg-.js";const G=()=>({id:null,curriculumId:null,courseId:null,studentTypeId:null,presentialPrice:0,virtualPrice:0,isEnabled:!0}),be=()=>({moduleId:[{required:!0,message:"Obligatório"}],studentTypeId:[{required:!0,message:"Obligatório"}],presentialPrice:[],virtualPrice:[]}),we=async s=>{try{return(await h().post("/course-price/load-data-table",s)).data.data}catch{return re()}},Pe=async s=>{try{return{status:!0,data:(await h().post("/course-price",s)).data.data}}catch(u){return u.response.status===422?{status:!1,data:u.response.data.errors}:{status:!1,data:null}}},Te=async s=>{try{return{status:!0,data:(await h().put("/course-price",s)).data.data}}catch(u){return u.response.status===422?{status:!1,data:u.response.data.errors}:{status:!1,data:null}}},Ce=async s=>{try{return await h().delete("/course-price",{data:{id:s.id}}),!0}catch{return!1}},Y=U({__name:"CoursePriceForm",props:{item:{},modelValue:{type:Boolean},studentTypesItems:{},coursesByCurriculumItems:{},curriculumId:{}},emits:["update:modelValue","success"],setup(s,{emit:u}){const c=u,o=s,f=W({get:()=>o.modelValue,set:p=>c("update:modelValue",p)}),g=d(!1),r=d(null),n=d(G()),l=d(null),y=d({...be()}),V=async()=>{if(l.value=null,r.value){const p=await r.value.validate();let e=null;p?(g.value=!0,n.value.id?e=await Te(n.value):(n.value.curriculumId=o.curriculumId,e=await Pe(n.value)),e.status?(c("success"),f.value=!1):l.value=e.data):console.log("Formulario inválido")}g.value=!1},z=()=>{console.log("Inicializando formulario"),n.value=o.item?{...o.item}:G()};return H(f,p=>{p&&z()}),(p,e)=>{const I=K,b=ce,w=N,S=me,T=_e,B=ie,C=j,R=pe,m=O,P=A,k=ne;return x(),M(k,{show:f.value,"onUpdate:show":e[10]||(e[10]=i=>f.value=i)},{default:a(()=>[t(P,{style:{width:"600px"},title:p.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:a(()=>[t(B,{justify:"end"},{default:a(()=>[t(m,{tertiary:"",size:"large",onClick:e[9]||(e[9]=i=>f.value=!1),disabled:g.value},{default:a(()=>e[11]||(e[11]=[$(" Cancelar ")])),_:1},8,["disabled"]),t(m,{size:"large",type:"primary",onClick:V,loading:g.value},{default:a(()=>e[12]||(e[12]=[$("Guardar")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[t(R,{ref_key:"formRef",ref:r,model:n.value,rules:y.value,size:"large"},{default:a(()=>[t(C,{gutter:16},{default:a(()=>[t(w,{span:"24"},{default:a(()=>{var i;return[t(b,{path:"studentTypeId",label:"Tipo de estudiante",feedback:(i=l.value)==null?void 0:i.studentTypeId},{default:a(()=>{var _;return[t(I,{value:n.value.studentTypeId,"onUpdate:value":e[0]||(e[0]=v=>n.value.studentTypeId=v),options:p.studentTypesItems,status:((_=l.value)==null?void 0:_.studentTypeId)!=null?"error":"",filterable:"","virtual-scroll":!1,clearable:"","onUpdate:modelValue":e[1]||(e[1]=v=>l.value!=null?l.value.studentTypeId=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),t(w,{span:"24"},{default:a(()=>{var i;return[t(b,{path:"courseId",label:"Curso",feedback:(i=l.value)==null?void 0:i.courseId},{default:a(()=>{var _;return[t(I,{value:n.value.courseId,"onUpdate:value":e[2]||(e[2]=v=>n.value.courseId=v),options:p.coursesByCurriculumItems,status:((_=l.value)==null?void 0:_.courseId)!=null?"error":"",filterable:"","virtual-scroll":!1,clearable:"","onUpdate:modelValue":e[3]||(e[3]=v=>l.value!=null?l.value.courseId=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),t(w,{span:"8"},{default:a(()=>{var i;return[t(b,{path:"presentialPrice",label:"Precio presencial",feedback:(i=l.value)==null?void 0:i.presentialPrice},{default:a(()=>{var _;return[t(S,{value:n.value.presentialPrice,"onUpdate:value":e[4]||(e[4]=v=>n.value.presentialPrice=v),status:((_=l.value)==null?void 0:_.presentialPrice)!=null?"error":"","onUpdate:modelValue":e[5]||(e[5]=v=>l.value!=null?l.value.presentialPrice=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1}),t(w,{span:"8"},{default:a(()=>{var i;return[t(b,{path:"virtualPrice",label:"Precio virtual",feedback:(i=l.value)==null?void 0:i.virtualPrice},{default:a(()=>{var _;return[t(S,{value:n.value.virtualPrice,"onUpdate:value":e[6]||(e[6]=v=>n.value.virtualPrice=v),status:((_=l.value)==null?void 0:_.virtualPrice)!=null?"error":"","onUpdate:modelValue":e[7]||(e[7]=v=>l.value!=null?l.value.virtualPrice=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1}),t(w,{span:"24"},{default:a(()=>[t(B,{justify:"end"},{default:a(()=>[t(b,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:a(()=>[t(T,{value:n.value.isEnabled,"onUpdate:value":e[8]||(e[8]=i=>n.value.isEnabled=i)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ke=U({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(s,{emit:u}){const c=ge(),o=u,f=[{label:"Editar",key:"edit",icon:F("edit-2"),props:{onClick:()=>o("edit")}},{label:"Eliminar",key:"delete",icon:F("trash","red"),props:{style:{color:"red"},onClick:()=>{c.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{o("delete")}})}}}];return(g,r)=>{const n=O,l=fe;return x(),M(l,{options:f,placement:"bottom-start"},{default:a(()=>[t(n,null,{default:a(()=>[t(X,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})}}}),xe=(s,u)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(c){const o=c;return q(ke,{onEdit:()=>{s(o)},onDelete:()=>{u(o)},item:o},{default:()=>"Editar"})}},{title:"Tipo de Estudiante",key:"studentType",minWidth:"200px"},{title:"Modulo",key:"course",minWidth:"200px"},{title:"Precio Presencial",key:"presentialPrice",minWidth:"150px"},{title:"Precio Virtual",key:"virtualPrice",minWidth:"150px"},{title:"Habilitado",key:"isEnabled",width:"150px",render:c=>q(de,{type:c.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>c.isEnabled?"	Habilitado":"Deshabilitado"})}],Ve=(s=Q())=>({page:s.page,total:s.total,pageSize:s.pageSize,pageCount:s.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${s.total} registros`}}),ze={style:{"border-bottom":"1px solid #e9e9e9"}},Se=U({__name:"DataTable",props:{curriculumId:{}},setup(s){const u=s,c=W(()=>({curriculumId:u.curriculumId})),o=d(!1),f=d([]),g=d(!1),r=d(null),n=ue({...Q()}),l=d({search:null,page:n.page,pageSize:n.pageSize,filters:{...c.value}}),y=d({}),p=xe(m=>{r.value=m,g.value=!0},async m=>{await Ce(m),await e()}),e=async()=>{l.value.page=1,await I()},I=async()=>{o.value=!0,y.value=await we(l.value),f.value=y.value.data,n.total=y.value.total,n.pageSize=y.value.per_page,n.page=y.value.current_page,n.pageCount=y.value.last_page,o.value=!1},b=ve(()=>{e()},400),w=async m=>{l.value.page=m,await I()},S=async m=>{l.value.page=1,l.value.pageSize=m,await I()},T=d([]),B=d([]),C=d([]),R=async()=>{T.value=await ee(),B.value=await te(u.curriculumId),C.value=await ae(u.curriculumId),await I()};return H(c,async(m,P)=>{l.value.filters=m,await e()},{deep:!0}),R(),(m,P)=>{const k=N,i=Ie,_=j,v=ye;return x(),L(J,null,[Z("div",ze,[t(_,{gutter:12,style:{padding:"12px 16px"}},{default:a(()=>[t(k,{span:12}),t(k,{span:12},{default:a(()=>[t(i,{size:"large",placeholder:"Buscar",value:l.value.search,"onUpdate:value":P[0]||(P[0]=D=>l.value.search=D),onInput:E(b),clearable:""},{suffix:a(()=>[t(X,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),t(_,null,{default:a(()=>[t(k,{span:24},{default:a(()=>[t(v,{key:"id",remote:"","single-line":!1,columns:E(p),data:f.value,pagination:E(Ve)(n),"pagination-show-size-picker":!0,loading:o.value,"onUpdate:page":w,"onUpdate:pageSize":S},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),se(m.$slots,"extra",{reLoadDataTable:e,studentTypesItems:T.value,coursesByCurriculumItems:C.value})]),t(Y,{modelValue:g.value,"onUpdate:modelValue":P[1]||(P[1]=D=>g.value=D),item:r.value,onSuccess:e,studentTypesItems:T.value,coursesByCurriculumItems:C.value,curriculumId:u.curriculumId},null,8,["modelValue","item","studentTypesItems","coursesByCurriculumItems","curriculumId"])],64)}}}),He=U({__name:"index",setup(s){const u=d([]),c=d(!1),o=d({curriculumId:null});return(async()=>{u.value=await le()})(),(g,r)=>{const n=O,l=K,y=N,V=j,z=A;return x(),L(J,null,[t(z,{segmented:{header:!0,content:!0}},{header:a(()=>r[3]||(r[3]=[Z("h6",{style:{color:"#999",margin:"0"}},"Finanzas",-1),$(" Gestión de precios ")])),"header-extra":a(()=>[t(n,{"render-icon":E(F)("additem"),onClick:r[0]||(r[0]=p=>c.value=!0)},{default:a(()=>r[4]||(r[4]=[$(" Agregar ")])),_:1},8,["render-icon"])]),action:a(()=>[t(V,{gutter:"16",style:{display:"flex","justify-content":"center"}},{default:a(()=>[t(y,{span:"10"},{default:a(()=>[t(l,{value:o.value.curriculumId,"onUpdate:value":r[1]||(r[1]=p=>o.value.curriculumId=p),placeholder:"Seleccionar Plan de estudio",filterable:"",options:u.value,clearable:"","virtual-scroll":!1},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),o.value.curriculumId?(x(),M(Se,{key:0,curriculumId:o.value.curriculumId},{extra:a(({reLoadDataTable:p,studentTypesItems:e,coursesByCurriculumItems:I})=>[t(Y,{modelValue:c.value,"onUpdate:modelValue":r[2]||(r[2]=b=>c.value=b),item:null,onSuccess:p,studentTypesItems:e,coursesByCurriculumItems:I,curriculumId:o.value.curriculumId},null,8,["modelValue","onSuccess","studentTypesItems","coursesByCurriculumItems","curriculumId"])]),_:1},8,["curriculumId"])):oe("",!0)],64)}}});export{He as default};
