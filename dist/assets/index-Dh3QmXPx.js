import{r as $}from"./icon.utils-cRmYwSlx.js";import{d as T,a3 as N,a9 as S,ad as F,ae as f,aa as w,ab as a,ac as t,ag as A,aH as Z,h as D,az as Q,e as X,r as _,j as ee,aB as G,aA as z,aI as te,aJ as ae,a8 as oe,aG as L,_ as q,aK as ne,af as H,a6 as le,aM as se}from"./index-6z36WRcE.js";import{i as J,a as re}from"./DataTable.types-BEg5m_To.js";import{_ as ue,a as ie}from"./FormItem-BvN8UC3U.js";import{_ as j,a as W}from"./Col-CEDpi3Xj.js";import{_ as pe}from"./InputNumber-DTEkrGoR.js";import{_ as de}from"./Select-DSgE7mEA.js";import{_ as me}from"./Space-lHYrJ06g.js";import{u as ce}from"./composables-gXBD4-Ya.js";import{_ as _e}from"./Dropdown-DpfSlplF.js";import{d as ge}from"./debounce.utils-DqPPCsFD.js";import{_ as fe}from"./Input-vFOnlVfg.js";import{_ as ve}from"./DataTable-CQ2RoWIa.js";import"./selectables.services-5V7ejfMy.js";import"./get-0VFF1deq.js";import"./Suffix-C4lbaI3m.js";import"./use-merged-state-BxC9HY5Y.js";import"./Popover-CeeZccJ1.js";import"./Tag-DPGp3eOp.js";import"./Tooltip-BTE7BLBl.js";const be=T({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(s,{emit:o}){const{hasPermission:u}=N(),l=ce(),p=o,e=[{show:u(["period.edit"]),label:"Editar",key:"edit",icon:$("edit-2"),props:{onClick:()=>p("edit")}},{show:u(["period.delete"]),label:"Eliminar",key:"delete",icon:$("trash","red"),props:{style:{color:"red"},onClick:()=>{l.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{p("delete")}})}}}];return(i,r)=>{const d=A,v=_e;return f(u)(["period.edit","period.delete"])?(w(),S(v,{key:0,options:e,placement:"bottom-start"},{default:a(()=>[t(d,null,{default:a(()=>[t(Z,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})):F("",!0)}}}),Y=[{value:1,label:"ENERO"},{value:2,label:"FEBRERO"},{value:3,label:"MARZO"},{value:4,label:"ABRIL"},{value:5,label:"MAYO"},{value:6,label:"JUNIO"},{value:7,label:"JULIO"},{value:8,label:"AGOSTO"},{value:9,label:"SEPTIEMBRE"},{value:10,label:"OCTUBRE"},{value:11,label:"NOVIEMBRE"},{value:12,label:"DICIEMBRE"}],ye=(s,o)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(u){const l=u;return D(be,{onEdit:()=>{s(l)},onDelete:()=>{o(l)},item:l},{default:()=>"Editar"})}},{title:"Año",key:"year",minWidth:"150px"},{title:"Mes",key:"month",minWidth:"150px",render:u=>{const l=Y.find(p=>p.value===u.month);return D("span",l==null?void 0:l.label)}}],we=(s=J())=>({page:s.page,total:s.total,pageSize:s.pageSize,pageCount:s.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${s.total} registros`}}),U=()=>({id:null,year:new Date().getFullYear(),month:new Date().getMonth()+1}),Ie=()=>({year:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}],month:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),V=Q(),ke=async s=>{try{return(await V.post("/period/load-data-table",s)).data.data}catch{return re()}},xe=async s=>{try{return{status:!0,data:(await V.post("/period",s)).data.data}}catch(o){return o.response.status===422?{status:!1,data:o.response.data.errors}:{status:!1,data:null}}},he=async s=>{try{return{status:!0,data:(await V.put("/period",s)).data.data}}catch(o){return o.response.status===422?{status:!1,data:o.response.data.errors}:{status:!1,data:null}}},ze=async s=>{try{return await V.delete("/period",{data:{id:s.id}}),!0}catch{return!1}},K=T({__name:"PeriodForm",props:{item:{},modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(s,{emit:o}){const u=o,l=s,p=X({get:()=>l.modelValue,set:m=>u("update:modelValue",m)}),e=_(!1),i=_(null),r=_(U()),d=_(null),v=_({...Ie()}),I=async()=>{if(i.value){const m=await i.value.validate();let n=null;m?(e.value=!0,r.value.id?n=await he(r.value):n=await xe(r.value),n.status?(u("success"),p.value=!1):d.value=n.data):console.log("Formulario inválido")}e.value=!1},b=()=>{console.log("Inicializando formulario"),r.value=l.item?{...l.item}:U()};return ee(p,m=>{m&&b()}),(m,n)=>{const O=pe,E=ie,B=W,g=de,y=j,k=ue,C=A,P=me,R=G,M=te;return w(),S(M,{show:p.value,"onUpdate:show":n[5]||(n[5]=c=>p.value=c)},{default:a(()=>[t(R,{style:{width:"500px"},title:m.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:a(()=>[t(P,{justify:"end"},{default:a(()=>[t(C,{tertiary:"",size:"large",onClick:n[4]||(n[4]=c=>p.value=!1),disabled:e.value},{default:a(()=>n[6]||(n[6]=[z(" Cancelar ")])),_:1},8,["disabled"]),t(C,{size:"large",type:"primary",onClick:I,loading:e.value},{default:a(()=>n[7]||(n[7]=[z("Guardar")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[t(k,{ref_key:"formRef",ref:i,model:r.value,rules:v.value,size:"large"},{default:a(()=>[t(y,{gutter:16},{default:a(()=>[t(B,{span:"12"},{default:a(()=>{var c;return[t(E,{path:"year",label:"Año",feedback:(c=d.value)==null?void 0:c.year},{default:a(()=>{var x;return[t(O,{clearable:"",maxlength:"4",status:((x=d.value)==null?void 0:x.year)!=null?"error":"",value:r.value.year,"onUpdate:value":n[0]||(n[0]=h=>r.value.year=h),valueModifiers:{number:!0},onInput:n[1]||(n[1]=h=>d.value!=null?d.value.year=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),t(B,{span:"12"},{default:a(()=>{var c;return[t(E,{path:"month",label:"Mes",feedback:(c=d.value)==null?void 0:c.month},{default:a(()=>{var x;return[t(g,{clearable:"",value:r.value.month,"onUpdate:value":n[2]||(n[2]=h=>r.value.month=h),options:f(Y),"virtual-scroll":!1,status:((x=d.value)==null?void 0:x.month)!=null?"error":"",onInput:n[3]||(n[3]=h=>d.value!=null?d.value.month=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ee={style:{"border-bottom":"1px solid #e9e9e9"}},Ce=T({__name:"DataTable",setup(s){const o=_(!1),u=_([]),l=_(!1),p=_(null),e=ae({...J()}),i=_({search:null,page:e.page,pageSize:e.pageSize}),r=_({}),I=ye(g=>{p.value=g,l.value=!0},async g=>{await ze(g),await b()}),b=async()=>{i.value.page=1,await m()},m=async()=>{o.value=!0,r.value=await ke(i.value),u.value=r.value.data,e.total=r.value.total,e.pageSize=r.value.per_page,e.page=r.value.current_page,e.pageCount=r.value.last_page,o.value=!1},n=ge(()=>{b()},400),O=async g=>{i.value.page=g,await m()},E=async g=>{i.value.page=1,i.value.pageSize=g,await m()};return(async()=>{await m()})(),(g,y)=>{const k=W,C=oe("LnxIcon"),P=fe,R=j,M=ve;return w(),L(q,null,[ne(g.$slots,"extra",{reLoadDataTable:b}),H("div",Ee,[t(R,{gutter:12,style:{padding:"12px 16px"}},{default:a(()=>[t(k,{span:12}),t(k,{span:12},{default:a(()=>[t(P,{size:"large",placeholder:"Buscar",value:i.value.search,"onUpdate:value":y[0]||(y[0]=c=>i.value.search=c),onInput:f(n),clearable:""},{suffix:a(()=>[t(C,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),t(R,null,{default:a(()=>[t(k,{span:24},{default:a(()=>[t(M,{key:"id",remote:"",size:"small","single-line":!1,columns:f(I),data:u.value,pagination:f(we)(e),"pagination-show-size-picker":!0,loading:o.value,"onUpdate:page":O,"onUpdate:pageSize":E},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1})]),t(K,{modelValue:l.value,"onUpdate:modelValue":y[1]||(y[1]=c=>l.value=c),item:p.value,onSuccess:b},null,8,["modelValue","item"])],64)}}}),We=T({__name:"index",setup(s){const{hasPermission:o}=N(),u=le(),l=_(!1);return(p,e)=>{const i=A,r=G,d=se;return f(o)(["period.create","period.edit","period.delete"])?(w(),L(q,{key:0},[t(r,{segmented:{header:!0,content:!0,footer:!0}},{header:a(()=>e[3]||(e[3]=[H("h6",{style:{"font-size":"14px",color:"#999",margin:"0"}}," Gestión Periodos Académicos ",-1),z(" Periodos Académicos ")])),"header-extra":a(()=>[f(o)(["period.create"])?(w(),S(i,{key:0,size:"large",type:"primary","render-icon":f($)("additem"),onClick:e[0]||(e[0]=v=>l.value=!0)},{default:a(()=>e[4]||(e[4]=[z(" Agregar ")])),_:1},8,["render-icon"])):F("",!0)]),_:1}),t(Ce,null,{extra:a(({reLoadDataTable:v})=>[t(K,{modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=I=>l.value=I),item:null,onSuccess:v},null,8,["modelValue","onSuccess"])]),_:1})],64)):(w(),S(d,{key:1,status:"403",title:"403 No Autorizado",description:"Algunas puertas siempre están cerradas para ti."},{footer:a(()=>[t(i,{onClick:e[2]||(e[2]=v=>f(u).push("/"))},{default:a(()=>e[5]||(e[5]=[z(" Ir a casa ")])),_:1})]),_:1}))}}});export{We as default};
