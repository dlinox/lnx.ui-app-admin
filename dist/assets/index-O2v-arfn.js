import{r as R}from"./icon.utils-6fJ-3dCS.js";import{c as Z,d as ee,_ as te}from"./selectables.services-BQd8Oz6S.js";import{ay as ae,d as $,e as W,r as _,j,a8 as F,a9 as V,aH as le,aa as l,ab as t,af as O,az as D,aA as A,aG as J,h as H,aI as ne,aF as L,_ as K,ae as M,aJ as ue,ad as E,ac as oe}from"./index-DRqPu8js.js";import{a as se,i as Q}from"./DataTable.types-BEg5m_To.js";import{_ as re,a as ie}from"./FormItem-B0e_KJJq.js";import{_ as q,a as G}from"./Col-CNgfr2Vq.js";import{_ as X}from"./Select-Bhk-Lp7D.js";import{_ as de}from"./InputNumber-C01XPZNl.js";import{_ as pe}from"./Space-DpUkt9IF.js";import{_ as ce}from"./Switch-C8iQr2Sc.js";import{u as me}from"./composables-CNUmupj0.js";import{_ as _e}from"./Dropdown-hwViG8Gw.js";import{_ as ve}from"./Tag-DIW11yL8.js";import{d as fe}from"./debounce.utils-DqPPCsFD.js";import{_ as ge}from"./Input-PHuG5EIV.js";import{_ as ye}from"./DataTable-B0gpVXZr.js";import"./get-CdE2f0gc.js";import"./Popover-DfaujfXt.js";import"./use-merged-state-dfDog2av.js";import"./Suffix-DbP13eKO.js";import"./Tooltip-lejxWDdy.js";const N=()=>({id:null,curriculumId:null,moduleId:null,studentTypeId:null,enrollmentPrice:0,presentialPrice:0,virtualPrice:0,isEnabled:!0}),Ie=()=>({moduleId:[{required:!0,message:"Obligatório"}],studentTypeId:[{required:!0,message:"Obligatório"}],enrollmentPrice:[{required:!0,message:"Obligatório"}],presentialPrice:[],virtualPrice:[]}),U=ae(),be=async s=>{try{return(await U.post("/module-price/load-data-table",s)).data.data}catch{return se()}},Pe=async s=>{try{return{status:!0,data:(await U.post("/price",s)).data.data}}catch(u){return u.response.status===422?{status:!1,data:u.response.data.errors}:{status:!1,data:null}}},we=async s=>{try{return{status:!0,data:(await U.put("/price",s)).data.data}}catch(u){return u.response.status===422?{status:!1,data:u.response.data.errors}:{status:!1,data:null}}},ke=async s=>{try{return await U.delete("/price",{data:{id:s.id}}),!0}catch{return!1}},Y=$({__name:"PriceForm",props:{item:{},modelValue:{type:Boolean},studentTypesItems:{},modulesByCurriculumItems:{},curriculumId:{}},emits:["update:modelValue","success"],setup(s,{emit:u}){const p=u,r=s,f=W({get:()=>r.modelValue,set:c=>p("update:modelValue",c)}),g=_(!1),i=_(null),n=_(N()),a=_(null),y=_({...Ie()}),z=async()=>{if(a.value=null,i.value){const c=await i.value.validate();let e=null;c?(g.value=!0,n.value.id?e=await we(n.value):(n.value.curriculumId=r.curriculumId,e=await Pe(n.value)),e.status?(p("success"),f.value=!1):a.value=e.data):console.log("Formulario inválido")}g.value=!1},S=()=>{console.log("Inicializando formulario"),n.value=r.item?{...r.item}:N()};return j(f,c=>{c&&S()}),(c,e)=>{const b=X,I=ie,P=G,T=de,x=ce,k=pe,B=q,v=re,w=O,C=A,h=le;return V(),F(h,{show:f.value,"onUpdate:show":e[12]||(e[12]=o=>f.value=o)},{default:l(()=>[t(C,{style:{width:"600px"},title:c.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:l(()=>[t(k,{justify:"end"},{default:l(()=>[t(w,{tertiary:"",size:"large",onClick:e[11]||(e[11]=o=>f.value=!1),disabled:g.value},{default:l(()=>e[13]||(e[13]=[D(" Cancelar ")])),_:1},8,["disabled"]),t(w,{size:"large",type:"primary",onClick:z,loading:g.value},{default:l(()=>e[14]||(e[14]=[D("Guardar")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[t(v,{ref_key:"formRef",ref:i,model:n.value,rules:y.value,size:"large"},{default:l(()=>[t(B,{gutter:16},{default:l(()=>[t(P,{span:"24"},{default:l(()=>{var o;return[t(I,{path:"studentTypeId",label:"Tipo de estudiante",feedback:(o=a.value)==null?void 0:o.studentTypeId},{default:l(()=>{var m;return[t(b,{value:n.value.studentTypeId,"onUpdate:value":e[0]||(e[0]=d=>n.value.studentTypeId=d),options:c.studentTypesItems,status:((m=a.value)==null?void 0:m.studentTypeId)!=null?"error":"",filterable:"","virtual-scroll":!1,clearable:"","onUpdate:modelValue":e[1]||(e[1]=d=>a.value!=null?a.value.studentTypeId=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),t(P,{span:"24"},{default:l(()=>{var o;return[t(I,{path:"moduleId",label:"Módulo",feedback:(o=a.value)==null?void 0:o.moduleId},{default:l(()=>{var m;return[t(b,{value:n.value.moduleId,"onUpdate:value":e[2]||(e[2]=d=>n.value.moduleId=d),options:c.modulesByCurriculumItems,status:((m=a.value)==null?void 0:m.moduleId)!=null?"error":"",filterable:"","virtual-scroll":!1,clearable:"","onUpdate:modelValue":e[3]||(e[3]=d=>a.value!=null?a.value.moduleId=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),t(P,{span:"8"},{default:l(()=>{var o;return[t(I,{path:"enrollmentPrice",label:"Precio de matrícula",feedback:(o=a.value)==null?void 0:o.enrollmentPrice},{default:l(()=>{var m;return[t(T,{value:n.value.enrollmentPrice,"onUpdate:value":e[4]||(e[4]=d=>n.value.enrollmentPrice=d),status:((m=a.value)==null?void 0:m.enrollmentPrice)!=null?"error":"","onUpdate:modelValue":e[5]||(e[5]=d=>a.value!=null?a.value.enrollmentPrice=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1}),t(P,{span:"8"},{default:l(()=>{var o;return[t(I,{path:"presentialPrice",label:"Precio presencial",feedback:(o=a.value)==null?void 0:o.presentialPrice},{default:l(()=>{var m;return[t(T,{value:n.value.presentialPrice,"onUpdate:value":e[6]||(e[6]=d=>n.value.presentialPrice=d),status:((m=a.value)==null?void 0:m.presentialPrice)!=null?"error":"","onUpdate:modelValue":e[7]||(e[7]=d=>a.value!=null?a.value.presentialPrice=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1}),t(P,{span:"8"},{default:l(()=>{var o;return[t(I,{path:"virtualPrice",label:"Precio virtual",feedback:(o=a.value)==null?void 0:o.virtualPrice},{default:l(()=>{var m;return[t(T,{value:n.value.virtualPrice,"onUpdate:value":e[8]||(e[8]=d=>n.value.virtualPrice=d),status:((m=a.value)==null?void 0:m.virtualPrice)!=null?"error":"","onUpdate:modelValue":e[9]||(e[9]=d=>a.value!=null?a.value.virtualPrice=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1}),t(P,{span:"24"},{default:l(()=>[t(k,{justify:"end"},{default:l(()=>[t(I,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:l(()=>[t(x,{value:n.value.isEnabled,"onUpdate:value":e[10]||(e[10]=o=>n.value.isEnabled=o)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Te=$({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(s,{emit:u}){const p=me(),r=u,f=[{label:"Editar",key:"edit",icon:R("edit-2"),props:{onClick:()=>r("edit")}},{label:"Eliminar",key:"delete",icon:R("trash","red"),props:{style:{color:"red"},onClick:()=>{p.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{r("delete")}})}}}];return(g,i)=>{const n=O,a=_e;return V(),F(a,{options:f,placement:"bottom-start"},{default:l(()=>[t(n,null,{default:l(()=>[t(J,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})}}}),xe=(s,u)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(p){const r=p;return H(Te,{onEdit:()=>{s(r)},onDelete:()=>{u(r)},item:r},{default:()=>"Editar"})}},{title:"Tipo de Estudiante",key:"studentType",minWidth:"200px"},{title:"Modulo",key:"module",minWidth:"200px"},{title:"Precio de Matricula",key:"enrollmentPrice",minWidth:"150px"},{title:"Precio Presencial",key:"presentialPrice",minWidth:"150px"},{title:"Precio Virtual",key:"virtualPrice",minWidth:"150px"},{title:"Habilitado",key:"isEnabled",width:"150px",render:p=>H(ve,{type:p.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>p.isEnabled?"	Habilitado":"Deshabilitado"})}],Ce=(s=Q())=>({page:s.page,total:s.total,pageSize:s.pageSize,pageCount:s.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${s.total} registros`}}),Ve={style:{"border-bottom":"1px solid #e9e9e9"}},ze=$({__name:"DataTable",props:{curriculumId:{}},setup(s){const u=s,p=W(()=>({curriculumId:u.curriculumId})),r=_(!1),f=_([]),g=_(!1),i=_(null),n=ne({...Q()}),a=_({search:null,page:n.page,pageSize:n.pageSize,filters:{...p.value}}),y=_({}),c=xe(v=>{i.value=v,g.value=!0},async v=>{await ke(v),await e()}),e=async()=>{a.value.page=1,await b()},b=async()=>{r.value=!0,y.value=await be(a.value),f.value=y.value.data,n.total=y.value.total,n.pageSize=y.value.per_page,n.page=y.value.current_page,n.pageCount=y.value.last_page,r.value=!1},I=fe(()=>{e()},400),P=async v=>{a.value.page=v,await b()},T=async v=>{a.value.page=1,a.value.pageSize=v,await b()},x=_([]),k=_([]),B=async()=>{x.value=await Z(),k.value=await ee(u.curriculumId),await b()};return j(p,async(v,w)=>{a.value.filters=v,await e()},{deep:!0}),B(),(v,w)=>{const C=G,h=ge,o=q,m=ye;return V(),L(K,null,[M("div",Ve,[t(o,{gutter:12,style:{padding:"12px 16px"}},{default:l(()=>[t(C,{span:12}),t(C,{span:12},{default:l(()=>[t(h,{size:"large",placeholder:"Buscar",value:a.value.search,"onUpdate:value":w[0]||(w[0]=d=>a.value.search=d),onInput:E(I),clearable:""},{suffix:l(()=>[t(J,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),t(o,null,{default:l(()=>[t(C,{span:24},{default:l(()=>[t(m,{key:"id",remote:"","single-line":!1,columns:E(c),data:f.value,pagination:E(Ce)(n),"pagination-show-size-picker":!0,loading:r.value,"onUpdate:page":P,"onUpdate:pageSize":T},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),ue(v.$slots,"extra",{reLoadDataTable:e,studentTypesItems:x.value,modulesByCurriculumItems:k.value})]),t(Y,{modelValue:g.value,"onUpdate:modelValue":w[1]||(w[1]=d=>g.value=d),item:i.value,onSuccess:e,studentTypesItems:x.value,modulesByCurriculumItems:k.value,curriculumId:u.curriculumId},null,8,["modelValue","item","studentTypesItems","modulesByCurriculumItems","curriculumId"])],64)}}}),Qe=$({__name:"index",setup(s){const u=_([]),p=_(!1),r=_({curriculumId:null});return(async()=>{u.value=await te()})(),(g,i)=>{const n=O,a=X,y=G,z=q,S=A;return V(),L(K,null,[t(S,{segmented:{header:!0,content:!0}},{header:l(()=>i[3]||(i[3]=[M("span",{class:"text-sm text-slate-500"}," Costos ",-1),M("h5",{class:"text-lg font-bold text-slate-800"},"Gestión de precios",-1)])),"header-extra":l(()=>[t(n,{"render-icon":E(R)("additem"),onClick:i[0]||(i[0]=c=>p.value=!0)},{default:l(()=>i[4]||(i[4]=[D(" Agregar ")])),_:1},8,["render-icon"])]),action:l(()=>[t(z,{gutter:"16",style:{display:"flex","justify-content":"center"}},{default:l(()=>[t(y,{span:"10"},{default:l(()=>[t(a,{value:r.value.curriculumId,"onUpdate:value":i[1]||(i[1]=c=>r.value.curriculumId=c),placeholder:"Seleccionar Plan de estudio",filterable:"",options:u.value,clearable:"","virtual-scroll":!1},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),r.value.curriculumId?(V(),F(ze,{key:0,curriculumId:r.value.curriculumId},{extra:l(({reLoadDataTable:c,studentTypesItems:e,modulesByCurriculumItems:b})=>[t(Y,{modelValue:p.value,"onUpdate:modelValue":i[2]||(i[2]=I=>p.value=I),item:null,onSuccess:c,studentTypesItems:e,modulesByCurriculumItems:b,curriculumId:r.value.curriculumId},null,8,["modelValue","onSuccess","studentTypesItems","modulesByCurriculumItems","curriculumId"])]),_:1},8,["curriculumId"])):oe("",!0)],64)}}});export{Qe as default};
