import{r as M}from"./icon.utils-CZVSX6Io.js";import{d as S,a7 as C,a3 as A,a4 as t,a8 as e,ac as P,h as B,aj as T,e as K,r as m,g as Q,ad as X,ab as R,a9 as x,ae as N,af as ee,ag as F,ah as G,ai as ae,Z as q}from"./index-Cti78UEY.js";import{i as H,a as te,_ as ne,d as oe}from"./debounce.utils-DKUvuUDF.js";import{_ as le}from"./InputNumber-Cq1NKXMT.js";import{_ as se,a as re}from"./FormItem-DiU6Q1eD.js";import{_ as ue,a as j,d as ie,b as de,c as L}from"./Col-TH0PNmS4.js";import{a as J,_ as pe}from"./LnxIcon.vue_vue_type_script_setup_true_lang-FI2dAlHU.js";import{u as ce,_ as me}from"./composables-waTp4ftF.js";import{_ as _e}from"./Input-Baz27Fir.js";import"./get-DsH9SH5X.js";import"./Remove-DATnHdQ3.js";import"./Add-BzRfrQNe.js";import"./use-keyboard-CYS5I1Kx.js";import"./Forward-Dn520yCc.js";const fe=S({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(s,{emit:o}){const r=ce(),a=o,d=[{label:"Editar",key:"edit",icon:M("edit-2"),props:{onClick:()=>a("edit")}},{label:"Eliminar",key:"delete",icon:M("trash","red"),props:{style:{color:"red"},onClick:()=>{r.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{a("delete")}})}}}];return(u,i)=>{const l=P,p=pe;return C(),A(p,{options:d,placement:"bottom-start"},{default:t(()=>[e(l,null,{default:t(()=>[e(J,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})}}}),W=[{value:1,label:"ENERO"},{value:2,label:"FEBRERO"},{value:3,label:"MARZO"},{value:4,label:"ABRIL"},{value:5,label:"MAYO"},{value:6,label:"JUNIO"},{value:7,label:"JULIO"},{value:8,label:"AGOSTO"},{value:9,label:"SEPTIEMBRE"},{value:10,label:"OCTUBRE"},{value:11,label:"NOVIEMBRE"},{value:12,label:"DICIEMBRE"}],ge=(s,o)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(r){const a=r;return B(fe,{onEdit:()=>{s(a)},onDelete:()=>{o(a)},item:a},{default:()=>"Editar"})}},{title:"Año",key:"year",minWidth:"150px"},{title:"Mes",key:"month",minWidth:"150px",render:r=>{const a=W.find(d=>d.value===r.month);return B("span",a==null?void 0:a.label)}},{title:"Habilitado",key:"isEnabled",width:"150px",render:r=>B(ue,{type:r.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>r.isEnabled?"	Habilitado":"Deshabilitado"})}],ve=(s=H())=>({page:s.page,total:s.total,pageSize:s.pageSize,pageCount:s.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${s.total} registros`}}),U=()=>({id:null,year:new Date().getFullYear(),month:null,isEnabled:!1}),be=()=>({year:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}],month:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),ye=async s=>{try{return(await T().post("/period/load-data-table",s)).data.data}catch{return te()}},we=async s=>{try{return{status:!0,data:(await T().post("/period",s)).data.data}}catch(o){return o.response.status===422?{status:!1,data:o.response.data.errors}:{status:!1,data:null}}},Ee=async s=>{try{return{status:!0,data:(await T().put("/period",s)).data.data}}catch(o){return o.response.status===422?{status:!1,data:o.response.data.errors}:{status:!1,data:null}}},he=async s=>{try{return await T().delete("/period",{data:{id:s.id}}),!0}catch{return!1}},Y=S({__name:"PeriodForm",props:{item:{},modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(s,{emit:o}){const r=o,a=s,d=K({get:()=>a.modelValue,set:c=>r("update:modelValue",c)}),u=m(!1),i=m(null),l=m(U()),p=m(null),D=m({...be()}),O=async()=>{if(i.value){const c=await i.value.validate();let n=null;c?(u.value=!0,l.value.id?n=await Ee(l.value):n=await we(l.value),n.status?(r("success"),d.value=!1):p.value=n.data):console.log("Formulario inválido")}u.value=!1},g=()=>{console.log("Inicializando formulario"),l.value=a.item?{...a.item}:U()};return Q(d,c=>{c&&g()}),(c,n)=>{const V=le,y=se,I=j,_=ie,v=ne,b=de,$=L,k=re,z=P,w=N,Z=X;return C(),A(Z,{show:d.value,"onUpdate:show":n[6]||(n[6]=f=>d.value=f)},{default:t(()=>[e(w,{style:{width:"500px"},title:c.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:t(()=>[e(b,{justify:"end"},{default:t(()=>[e(z,{tertiary:"",size:"large",onClick:n[5]||(n[5]=f=>d.value=!1),disabled:u.value},{default:t(()=>n[7]||(n[7]=[R(" Cancelar ")])),_:1},8,["disabled"]),e(z,{size:"large",type:"primary",onClick:O,loading:u.value},{default:t(()=>n[8]||(n[8]=[R("Guardar")])),_:1},8,["loading"])]),_:1})]),default:t(()=>[e(k,{ref_key:"formRef",ref:i,model:l.value,rules:D.value,size:"large"},{default:t(()=>[e($,{gutter:16},{default:t(()=>[e(I,{span:"12"},{default:t(()=>{var f;return[e(y,{path:"year",label:"Año",feedback:(f=p.value)==null?void 0:f.year},{default:t(()=>{var E;return[e(V,{clearable:"",maxlength:"4",status:((E=p.value)==null?void 0:E.year)!=null?"error":"",value:l.value.year,"onUpdate:value":n[0]||(n[0]=h=>l.value.year=h),valueModifiers:{number:!0},onInput:n[1]||(n[1]=h=>p.value!=null?p.value.year=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),e(I,{span:"12"},{default:t(()=>{var f;return[e(y,{path:"month",label:"Mes",feedback:(f=p.value)==null?void 0:f.month},{default:t(()=>{var E;return[e(_,{clearable:"",value:l.value.month,"onUpdate:value":n[2]||(n[2]=h=>l.value.month=h),options:x(W),"virtual-scroll":!1,status:((E=p.value)==null?void 0:E.month)!=null?"error":"",onInput:n[3]||(n[3]=h=>p.value!=null?p.value.month=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),e(I,{span:"24"},{default:t(()=>[e(b,{justify:"end"},{default:t(()=>[e(y,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:t(()=>[e(v,{value:l.value.isEnabled,"onUpdate:value":n[4]||(n[4]=f=>l.value.isEnabled=f)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),xe={style:{"border-bottom":"1px solid #e9e9e9"}},Ie=S({__name:"DataTable",setup(s){const o=m(!1),r=m([]),a=m(!1),d=m(null),u=ee({...H()}),i=m({search:null,page:u.page,pageSize:u.pageSize}),l=m({}),O=ge(_=>{d.value=_,a.value=!0},async _=>{await he(_),await g()}),g=async()=>{i.value.page=1,await c()},c=async()=>{o.value=!0,l.value=await ye(i.value),r.value=l.value.data,u.total=l.value.total,u.pageSize=l.value.per_page,u.page=l.value.current_page,u.pageCount=l.value.last_page,o.value=!1},n=oe(()=>{g()},400),V=async _=>{i.value.page=_,await c()},y=async _=>{i.value.page=1,i.value.pageSize=_,await c()};return(async()=>{await c()})(),(_,v)=>{const b=j,$=_e,k=L,z=me;return C(),F(q,null,[G("div",xe,[e(k,{gutter:12,style:{padding:"12px 16px"}},{default:t(()=>[e(b,{span:12}),e(b,{span:12},{default:t(()=>[e($,{size:"large",placeholder:"Buscar",value:i.value.search,"onUpdate:value":v[0]||(v[0]=w=>i.value.search=w),onInput:x(n),clearable:""},{suffix:t(()=>[e(J,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),e(k,null,{default:t(()=>[e(b,{span:24},{default:t(()=>[e(z,{key:"id",remote:"","single-line":!1,columns:x(O),data:r.value,pagination:x(ve)(u),"pagination-show-size-picker":!0,loading:o.value,"onUpdate:page":V,"onUpdate:pageSize":y},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),ae(_.$slots,"extra",{reLoadDataTable:g})]),e(Y,{modelValue:a.value,"onUpdate:modelValue":v[1]||(v[1]=w=>a.value=w),item:d.value,onSuccess:g},null,8,["modelValue","item"])],64)}}}),Ae=S({__name:"index",setup(s){const o=m(!1);return(r,a)=>{const d=P,u=N;return C(),F(q,null,[e(u,{segmented:{header:!0,content:!0}},{header:t(()=>a[2]||(a[2]=[G("h6",{style:{color:"#999",margin:"0"}},"Gestión Periodos Académicos",-1),R(" Periodos Académicos ")])),"header-extra":t(()=>[e(d,{"render-icon":x(M)("additem"),onClick:a[0]||(a[0]=i=>o.value=!0)},{default:t(()=>a[3]||(a[3]=[R(" Agregar ")])),_:1},8,["render-icon"])]),_:1}),e(Ie,null,{extra:t(({reLoadDataTable:i})=>[e(Y,{modelValue:o.value,"onUpdate:modelValue":a[1]||(a[1]=l=>o.value=l),item:null,onSuccess:i},null,8,["modelValue","onSuccess"])]),_:1})],64)}}});export{Ae as default};
