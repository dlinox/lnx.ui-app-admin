import{d as se,e as ne,r as c,j as ge,a7 as be,aF as k,a9 as _,_ as A,ab as l,aa as e,aA as re,ae as t,aT as H,a8 as C,b1 as X,b2 as ye,az as f,ag as s,af as de,ad as y,aH as Ie,a4 as xe,aC as he,ac as j}from"./index-C2oNslvg.js";import{r as oe}from"./icon.utils-upfZx_ME.js";import{u as we}from"./useBreakpoints-BUIf66wm.js";import{_ as ke,a as Se,b as Ee,c as Ce,d as Me,e as $e,f as Ne,g as Ve}from"./EditEnrollmentGroup.vue_vue_type_script_setup_true_lang-C2r0l8bY.js";import"./studentType.services-uJsfgdk-.js";import{i as Re}from"./student.services-BmoiBj5R.js";import"./documentType.services-BFMfudxq.js";import{_ as ze}from"./selectables.services-BXwSu-ds.js";import{u as Fe}from"./period.stores-C34Xmii9.js";import{i as Pe}from"./course.services-Bo_wy6B8.js";import{_ as Be,a as Ue}from"./FormItem-DXyfdPQq.js";import{_ as ie,a as ce}from"./Col-BtUCTmqt.js";import{_ as me}from"./Select-DaUiqjpd.js";import{a as pe,_ as _e}from"./ListItem-zuJlRfEN.js";import{_ as ve}from"./Thing-4HTnZE94.js";import{_ as fe}from"./Tag-Dwx6Rgco.js";import{_ as Ae}from"./Statistic-1uLJkjbe.js";import{_ as Oe,a as Te}from"./CollapseItem-BotbDLi2.js";import{_ as Ge}from"./Spin-CdACqLxD.js";import{_ as Le}from"./Space-G3ZiPI5e.js";import{_ as qe}from"./Table-Bn7Wyvyt.js";import"./Alert-DOocvq-e.js";import"./Input-BQ3poveX.js";import"./Suffix-DF6h_xjA.js";import"./use-merged-state-CDxsXcm8.js";import"./DataTable.types-BEg5m_To.js";import"./composables-CkauXcFl.js";import"./Dropdown-tA5u1ub_.js";import"./Popover-C-qVBvl0.js";import"./get-2__u8Ul3.js";const ue=()=>({studentId:null,curriculumId:null,moduleId:null,courseId:null,groupId:null,payments:[]}),De=()=>({studentId:[],curriculumId:[],moduleId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}],courseId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}],groupId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),je={class:"wrapper-list-groups"},He={class:"table-auto w-full"},We={class:"px-4 py-2 flex items-center"},Je={class:"ms-2"},Ke={class:"text-end px-4 py-2"},Qe={class:"border-b-2 border-gray-500"},Xe={class:"px-4 py-2 font-bold text-lg text-end"},Ye={class:"px-4 py-2 font-bold text-lg text-end"},Ze={class:"text-red-500 text-sm text-end text-sm"},et=se({__name:"EnrollmentModuleForm",props:{modelValue:{type:Boolean},studentId:{},curriculumId:{}},emits:["update:modelValue","success"],setup(ae,{emit:W}){const G=W,g=ae,M=ne({get:()=>g.modelValue,set:o=>G("update:modelValue",o)}),z=c(!1),I=c(!1),O=c([]),$=c([]),x=c([]),m=c(null),J=ne(()=>De()),d=c(ue()),S=c([]),L=c(0),T=c(0),N=c(0),V=o=>{console.log("Pago validado",o),d.value.payments.push(o.token),S.value.push({token:o.token,amount:o.payment.amount,sequenceNumber:o.payment.sequenceNumber})},q=o=>{const n=S.value.splice(o,1)[0],E=n==null?void 0:n.token;if(!E)return;const B=d.value.payments.indexOf(E);B!==-1&&d.value.payments.splice(B,1)},Y=async o=>{d.value.payments=[],d.value.courseId=null,d.value.groupId=null,$.value=[],x.value=[],$.value=await Pe(o),O.value.forEach(n=>{n.value==o&&(L.value=parseFloat(n.price))})},h=async o=>{d.value.courseId=o,await R(o)},u=o=>{console.log("Grupo seleccionado",o),T.value=parseFloat(o.price),d.value.groupId&&d.value.groupId!=o.id?(d.value.groupId=o.id,N.value=T.value):d.value.groupId==o.id?(d.value.groupId=null,N.value=0):(d.value.groupId=o.id,N.value=T.value)},R=async o=>{const n=await Se({studentId:g.studentId,curriculumId:g.curriculumId,courseId:o});x.value=n.data},F=async()=>{const o=await Ce(g.studentId,g.curriculumId);O.value=o.data},b=ne(()=>S.value.reduce((o,n)=>o+Number(n.amount),0)>=N.value),P=async()=>{if(d.value.studentId=g.studentId,d.value.curriculumId=g.curriculumId,m.value){if(!await m.value.validate())return;z.value=!0,(await Ee(d.value)).status&&(G("success"),M.value=!1),z.value=!1}console.log("Guardando matricula",d.value)},Z=()=>{F(),console.log("Inicializando formulario")};return ge(M,o=>{o&&(d.value=Object.assign({},{...ue()}),S.value=[],O.value=[],$.value=[],x.value=[],L.value=0,T.value=0,N.value=0,Z())}),(o,n)=>{const E=me,B=Ue,U=ce,K=fe,D=de,ee=ve,te=_e,le=pe,r=be("LnxIcon"),v=ie,i=Be,p=re,Q=Ie;return _(),k(A,null,[l(Q,{show:M.value,"onUpdate:show":n[3]||(n[3]=a=>M.value=a)},{default:e(()=>[l(p,{style:{width:"600px"},title:"MATRICULA EN MODULO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:e(()=>[l(i,{ref_key:"formRef",ref:m,model:d.value,rules:J.value,size:"large"},{default:e(()=>[l(v,{gutter:[16,16]},{default:e(()=>[l(U,{span:"24"},{default:e(()=>[l(B,{path:"moduleId",label:"Modulo"},{default:e(()=>[l(E,{value:d.value.moduleId,"onUpdate:value":[n[0]||(n[0]=a=>d.value.moduleId=a),Y],placeholder:"Seleccionar modulo",options:O.value,"virtual-scroll":!1,clearable:"",filterable:""},null,8,["value","options"])]),_:1})]),_:1}),l(U,{span:"24"},{default:e(()=>[l(B,{path:"courseId",label:"Curso"},{default:e(()=>[l(E,{value:d.value.courseId,"onUpdate:value":[n[1]||(n[1]=a=>d.value.courseId=a),h],placeholder:"Seeleccione un curso",options:$.value,"virtual-scroll":!1,clearable:"",filterable:""},null,8,["value","options"])]),_:1})]),_:1}),l(U,{span:"24"},{default:e(()=>[t("div",je,[l(le,{hoverable:"",clickable:""},{header:e(()=>{var a;return[f(" Grupos aperturados ("+s((a=x.value)!=null&&a.length?x.value.length:0)+") ",1)]}),default:e(()=>[(_(!0),k(A,null,H(x.value,a=>(_(),C(te,{key:a.id,class:X({"item-selected":d.value.groupId==a.id}),extra:a.price},{default:e(()=>[l(ee,{onClick:w=>u(a)},ye({header:e(()=>[l(K,{bordered:!1,type:"info",size:"small"},{default:e(()=>[f(s(a.modality),1)]),_:2},1024),f(" "+s(`${a.group} - S/. ${a.price}`),1)]),default:e(()=>[n[5]||(n[5]=f(" Min.: ")),t("b",null,s(a.minStudents),1),n[6]||(n[6]=f(" | Matriculados: ")),t("b",null,s(a.enrolledStudents),1),n[7]||(n[7]=f(" | Reservados: ")),t("b",null,s(a.reservedStudents),1),n[8]||(n[8]=t("br",null,null,-1)),l(K,{bordered:!1,type:"info",size:"small"},{default:e(()=>[t("strong",null,s(a.schedules.days)+" - "+s(a.schedules.startHour)+" a "+s(a.schedules.endHour),1)]),_:2},1024)]),_:2},[d.value.groupId==a.id?{name:"header-extra",fn:e(()=>[l(D,{circle:"",type:"warning","render-icon":y(oe)("verify")},null,8,["render-icon"])]),key:"0"}:void 0]),1032,["onClick"])]),_:2},1032,["class","extra"]))),128))]),_:1})])]),_:1}),l(U,{span:"24"},{default:e(()=>[t("span",{role:"button",onClick:n[2]||(n[2]=a=>I.value=!0),class:"border border-dashed border-gray-300 p-4 rounded-sm flex items-center justify-center cursor-pointer text-gray-400 hover:bg-gray-50 font-bold hover:text-gray-500 mb-4"},[l(r,{class:"me-3","icon-name":"money-add",size:"20"}),n[9]||(n[9]=f(" Agregar pago "))]),t("table",He,[t("tbody",null,[(_(!0),k(A,null,H(S.value,(a,w)=>(_(),k("tr",{key:w,class:"border-b border-gray-300 border-dashed px-4 py-2"},[t("td",We,[l(D,{type:"error",size:"small",secondary:"",onClick:at=>q(w),"render-icon":y(oe)("trash")},null,8,["onClick","render-icon"]),t("i",Je,s(a.sequenceNumber),1)]),t("td",Ke,"S/. "+s(a.amount),1)]))),128)),t("tr",Qe,[n[10]||(n[10]=t("td",{class:"px-4 py-2"},"Total pagado",-1)),t("td",Xe," S/. "+s(S.value.reduce((a,w)=>a+parseInt(w.amount),0)),1)]),t("tr",null,[n[11]||(n[11]=t("td",{class:"px-4 py-2"},"Total a pagar",-1)),t("td",Ye," S/. "+s(N.value),1)])])]),t("div",Ze,s(b.value?"":"El monto pagado no cubre el total requerido."),1)]),_:1}),l(U,{span:"24"},{default:e(()=>[l(D,{size:"large",type:"primary",onClick:P,block:"",loading:z.value},{default:e(()=>n[12]||(n[12]=[f(" Realizar matricula ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"]),l(ke,{modelValue:I.value,"onUpdate:modelValue":n[4]||(n[4]=a=>I.value=a),studentId:g.studentId,onSuccess:V},null,8,["modelValue","studentId"])],64)}}}),tt={class:"p-4"},lt={class:"flex justify-end bg-gray-100 p-4 -mx-6 -mt-6 mb-4"},nt={class:"text-lg font-semibold w-full text-blue-800 p-2"},ot={key:1},Bt=se({__name:"EnrollmentStudentView",setup(ae){const{screenSize:W}=we(),G=xe(),g=Fe(),M=c(!1),z=c(!1),I=c(null),O=c(null),$=c([]),x=c(!0),m=c({}),J=c(!0),d=c(null),S=c(null),L=c(null),T=async h=>{let u=await Ne({id:h}),R=new Blob([u],{type:"application/pdf"}),F=window.URL.createObjectURL(R),b=document.getElementById("printFrame");b.src=F,b.onload=function(){var P;(P=b.contentWindow)==null||P.print()}},N=async()=>{const h=G.params.id;x.value=!0,m.value=await Re(h),x.value=!1},V=async()=>{var R;const h=G.params.id,u=(R=O.value)==null?void 0:R.id;J.value=!0,d.value=await Ve(h,I.value,u),J.value=!1},q=(h,u=null)=>{S.value=h,L.value=u,z.value=!0},Y=async()=>{$.value=await ze(),I.value=$.value[0].value,N(),V()};return he(()=>{Y()}),(h,u)=>{const R=me,F=re,b=Ae,P=Le,Z=Ge,o=ce,n=fe,E=de,B=qe,U=ve,K=_e,D=pe,ee=Te,te=Oe,le=ie;return _(),k(A,null,[l(F,{segmented:{header:!0,footer:!0,content:!0}},{header:e(()=>u[4]||(u[4]=[t("h6",{class:"text-sm text-gray-500"},"Matricular estudiante",-1),f(" Matricula regular ")])),"header-extra":e(()=>[l(R,{value:I.value,"onUpdate:value":[u[0]||(u[0]=r=>I.value=r),V],placeholder:"Seleccionar Plan de estudio",filterable:"",options:$.value,"virtual-scroll":!1,"default-value":1},null,8,["value","options"])]),action:e(()=>u[5]||(u[5]=[])),_:1}),t("div",tt,[l(le,{gutter:16},{default:e(()=>[l(o,{span:y(W)=="lg"?6:24},{default:e(()=>[l(F,{segmented:{header:!0,content:!0},title:"InformaciÃ³n Personal",subtitle:"Datos del estudiante"},{default:e(()=>[l(Z,{show:x.value},{default:e(()=>[l(P,{vertical:""},{default:e(()=>[l(b,{class:"small",label:"Tipo de estudiante"},{default:e(()=>{var r;return[f(s((r=m.value)==null?void 0:r.studentType),1)]}),_:1}),l(b,{class:"small",label:"Documento"},{default:e(()=>{var r,v,i;return[t("span",{class:X((r=m.value)!=null&&r.documentNumber?"":"text-stone-400")},s((v=m.value)!=null&&v.documentNumber?(i=m.value)==null?void 0:i.documentNumber:"No registra"),3)]}),_:1}),l(b,{class:"small",label:"Nombres"},{default:e(()=>{var r;return[f(s((r=m.value)==null?void 0:r.fullName),1)]}),_:1}),l(b,{class:"small",label:"Correo electronico"},{default:e(()=>{var r,v,i;return[t("span",{class:X((r=m.value)!=null&&r.email?"":"text-stone-400")},s((v=m.value)!=null&&v.email?(i=m.value)==null?void 0:i.email:"No registra"),3)]}),_:1}),l(b,{class:"small",label:"Telefono"},{default:e(()=>{var r,v,i;return[t("span",{class:X((r=m.value)!=null&&r.phone?"":"text-stone-400")},s((v=m.value)!=null&&v.phone?(i=m.value)==null?void 0:i.phone:"No registra"),3)]}),_:1})]),_:1})]),_:1},8,["show"])]),_:1})]),_:1},8,["span"]),l(o,{span:y(W)=="lg"?18:24},{default:e(()=>[l(F,{segmented:{header:!0,content:!0},title:"Matricula"},{"header-extra":e(()=>[l(n,{bordered:!1,type:y(g).enrollment?"info":"error"},{default:e(()=>{var r;return[t("strong",null,s(y(g).enrollment?(r=y(g).enrollment)==null?void 0:r.period:"No habilitado"),1)]}),_:1},8,["type"])]),default:e(()=>[t("div",lt,[l(E,{type:"primary",onClick:u[1]||(u[1]=r=>M.value=!0),disabled:!y(g).enrollment},{default:e(()=>u[6]||(u[6]=[f(" Nuevo Modulo ")])),_:1},8,["disabled"])]),l(te,null,{default:e(()=>{var r;return[(_(!0),k(A,null,H((r=d.value)==null?void 0:r.enrollments,v=>(_(),C(ee,{key:v.moduleId,name:v.moduleId},{header:e(()=>[t("h2",nt,s(v.moduleName)+" "+s(v.isExtracurricular?"(Extracurricular)":""),1)]),default:e(()=>[l(D,{hoverable:"",clickable:""},{default:e(()=>[(_(!0),k(A,null,H(v.courses,i=>(_(),C(K,{key:i.id},{default:e(()=>[l(U,{title:`${i.code} - ${i.name}`},{"header-extra":e(()=>[i.enrollmentGroups.length==0||Math.max(...i.enrollmentGroups.map(p=>p.grade))<11&&i.enrollmentGroups.filter(p=>p.groupStatus=="ABIERTO").length==0?(_(),C(E,{key:0,type:"primary",onClick:p=>q(i.id)},{default:e(()=>u[7]||(u[7]=[f(" Matricular ")])),_:2},1032,["onClick"])):j("",!0)]),description:e(()=>[l(P,{size:"small"},{default:e(()=>[l(n,{bordered:!1,size:"small"},{default:e(()=>[f(" Area: "+s(i.area),1)]),_:2},1024)]),_:2},1024)]),default:e(()=>[i.enrollmentGroups.length>0?(_(),C(B,{key:0,"single-line":!1},{default:e(()=>[u[9]||(u[9]=t("thead",null,[t("tr",null,[t("th",{colspan:"2"},"Matricula"),t("th",{colspan:"3"},"Grupo"),t("th",{colspan:"2"})]),t("tr",null,[t("th",null,"Periodo"),t("th",null,"Estado"),t("th",null,"Grupo"),t("th",null,"Modalidad"),t("th",null,"Estado"),t("th",{rowspan:"2"},"Nota"),t("th",null,"Acciones")])],-1)),t("tbody",null,[(_(!0),k(A,null,H(i.enrollmentGroups,p=>{var Q,a;return _(),k("tr",null,[t("td",null,[((Q=y(g).enrollment)==null?void 0:Q.period)==p.period?(_(),C(n,{key:0,type:"info"},{default:e(()=>[f(s(p.period),1)]),_:2},1024)):(_(),k("span",ot,s(p.period),1))]),t("td",null,s(p.enrollmentStatus),1),t("td",null,s(p.groupName),1),t("td",null,s(p.groupModality),1),t("td",null,s(p.groupStatus),1),t("td",null,s(p.grade),1),t("td",null,[((a=y(g).enrollment)==null?void 0:a.period)==p.period?(_(),C(Me,{key:0,item:p,onResetEnrollment:w=>q(i.id,w),onChangeGroup:w=>q(i.id,w),onReserveEnrollment:V,onCancelEnrollment:V},null,8,["item","onResetEnrollment","onChangeGroup"])):j("",!0),p.enrollmentStatus==="MATRICULADO"?(_(),C(E,{key:1,"render-icon":y(oe)("printer"),onClick:w=>T(p.id)},{default:e(()=>u[8]||(u[8]=[f(" Ficha ")])),_:2},1032,["render-icon","onClick"])):j("",!0)])])}),256))])]),_:2},1024)):j("",!0)]),_:2},1032,["title"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["name"]))),128))]}),_:1})]),_:1})]),_:1},8,["span"])]),_:1})]),u[10]||(u[10]=t("iframe",{id:"printFrame",style:{display:"none"}},null,-1)),m.value?(_(),C(et,{key:0,modelValue:M.value,"onUpdate:modelValue":u[2]||(u[2]=r=>M.value=r),studentId:m.value.id,curriculumId:I.value,onSuccess:V},null,8,["modelValue","studentId","curriculumId"])):j("",!0),l($e,{modelValue:z.value,"onUpdate:modelValue":u[3]||(u[3]=r=>z.value=r),studentId:m.value.id,curriculumId:I.value,courseId:S.value,enrollmetGroup:L.value,isSpecial:!1,onSuccess:V},null,8,["modelValue","studentId","curriculumId","courseId","enrollmetGroup"])],64)}}});export{Bt as default};
