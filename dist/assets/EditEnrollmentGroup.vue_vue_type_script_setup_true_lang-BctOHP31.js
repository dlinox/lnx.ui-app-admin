import{r as R}from"./icon.utils-Cdau1lmo.js";import{ay as H,d as L,r as x,e as A,j as K,a7 as J,a8 as U,a9 as C,aH as Q,aa as n,ab as e,aA as W,az as I,bb as oe,bc as re,af as F,ad as N,aF as T,_ as B,ae as c,b2 as j,b3 as le,b4 as se,ag as v}from"./index--Fiy2I4t.js";import{_ as ue}from"./Alert-DGEqS-V6.js";import{_ as de,a as ie}from"./FormItem-64Oo6hS7.js";import{_ as X,a as Y}from"./Col-Bhohzmu6.js";import{_ as pe}from"./Input-CfWAw0Qs.js";import{_ as ce}from"./Select-JHMV7BBf.js";import{a as me,_ as _e}from"./ListItem-Bx3-mArE.js";import{_ as ge}from"./Thing-2BjOqH8k.js";import{_ as fe}from"./Tag-CmlrV2vM.js";import{_ as ve}from"./Space-CHReEK5D.js";import{a as ye}from"./DataTable.types-BEg5m_To.js";import{u as be}from"./composables-CN96FFP-.js";import{_ as we}from"./Dropdown-B9vn1Rts.js";const b=H(),at=async t=>{try{return(await b.post("/enrollment/load-data-table",t)).data.data}catch{return ye()}},ot=async t=>{try{return{status:!0,data:(await b.post("/enrollment/module-store",{...t})).data.data}}catch{return{status:!1,data:null}}},Ie=async t=>{try{return{status:!0,data:(await b.post("/enrollment/group-store",{...t})).data.data}}catch{return{status:!1,data:null}}},he=async t=>{try{return{status:!0,data:(await b.post("/enrollment/group-update",{...t})).data.data}}catch{return{status:!1,data:null}}},ke=async t=>{try{return{status:!0,data:(await b.post("/enrollment/group-reserved",{...t})).data.data}}catch{return{status:!1,data:null}}},xe=async t=>{try{return{status:!0,data:(await b.post("/enrollment/group-cancel",{...t})).data.data}}catch{return{status:!1,data:null}}},Ee=async t=>{try{return{status:!0,data:(await b.post("/enrollment/enabled-groups",t)).data.data}}catch{return{status:!1,data:null}}},rt=async(t,o,d)=>{try{return(await b.post("/enrollment/student-enrollment-avaliable",{studentId:t,curriculumId:o,periodId:d})).data.data}catch{return null}},lt=async(t,o)=>{try{return{status:!0,data:(await b.post(`/enrollment/${t}/student/${o}/curriculum`)).data.data}}catch{return{status:!1,data:[]}}},st=async t=>{try{return(await b.post("/enrollment/download-enrollment-pdf",{...t},{responseType:"blob"})).data}catch{return null}},Se=async t=>{try{return(await b.post("/enrollment/get-enrollment-group-payments",{...t})).data.data}catch{return[]}},ut=async(t,o,d)=>{try{return(await b.post("/enrollment/student-enrollment-avaliable-special",{studentId:t,curriculumId:o,periodId:d})).data.data}catch{return null}},Ce=()=>({id:null,studentId:null,groupId:null,payments:[]}),Pe=H(),Ve=async t=>{try{return(await Pe.post("/payment/validate",t)).data.data}catch{return{token:null}}},Ge=()=>({studentId:null,amount:null,date:null,sequenceNumber:null,paymentTypeId:7}),$e=t=>({studentId:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],amount:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:"Debe ser un número",trigger:["blur","input"],validator:(o,d)=>{if(d){if(!/^\d*\.?\d*$/.test(d))return new Error("Debe ser un número")}else return new Error("Obligatorio");return!0}}],date:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],sequenceNumber:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:t===7?"Debe tener 7 digitos":"Debe tener 6 digitos",trigger:["blur","input"],validator:(o,d)=>{if(d)if(/^\d*$/.test(d)){if(t===7&&d.length!==7)return new Error("Debe tener 7 digitos");if(t===9&&d.length!==6)return new Error("Debe tener 6 digitos")}else return new Error("Debe ser un número");else return new Error("Obligatorio");return!0}}],paymentTypeId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),ze=L({__name:"PaymentForm",props:{modelValue:{type:Boolean},studentId:{}},emits:["update:modelValue","success"],setup(t,{emit:o}){const d=o,i=t,p=x(!1),y=A({get:()=>i.modelValue,set:f=>d("update:modelValue",f)}),h=x(null),u=x({}),m=A(()=>$e(u.value.paymentTypeId)),g=async()=>{if(h.value&&!await h.value.validate())return;u.value.studentId=i.studentId,p.value=!0;const f=await Ve(u.value);f.token!==null&&(y.value=!1,d("success",{token:f.token,payment:u.value})),p.value=!1,console.log("Validando pago",f)},l=()=>{console.log("Inicializando formulario"),u.value=Object.assign({},Ge())};return K(y,f=>{f&&l()}),(f,_)=>{const O=J("LnxIcon"),D=oe,M=ue,V=pe,P=ie,E=Y,a=ce,r=F,k=X,S=de,G=W,$=Q;return C(),U($,{show:y.value,"onUpdate:show":_[4]||(_[4]=w=>y.value=w)},{default:n(()=>[e(G,{style:{width:"500px"},title:"REGISTRAR PAGO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:n(()=>[e(M,{title:"¡Importante!",type:"default",class:"mb-4"},{icon:n(()=>[e(D,null,{default:n(()=>[e(O,{"icon-name":"information",size:"20"})]),_:1})]),default:n(()=>[_[5]||(_[5]=I(" Solo se validan pagos realizados, con un día de anticipación. "))]),_:1}),e(S,{ref_key:"formRef",ref:h,model:u.value,rules:m.value,size:"large",onKeydown:re(g,["enter"])},{default:n(()=>[e(k,{gutter:[16,16]},{default:n(()=>[e(E,{span:"12"},{default:n(()=>[e(P,{path:"amount",label:"Monto"},{default:n(()=>[e(V,{value:u.value.amount,"onUpdate:value":_[0]||(_[0]=w=>u.value.amount=w)},null,8,["value"])]),_:1})]),_:1}),e(E,{span:"12"},{default:n(()=>[e(P,{path:"date",label:"Fecha de pago"},{default:n(()=>[e(V,{placeholder:"",type:"date",value:u.value.date,"onUpdate:value":_[1]||(_[1]=w=>u.value.date=w)},null,8,["value"])]),_:1})]),_:1}),e(E,{span:"12"},{default:n(()=>[e(P,{path:"sequenceNumber",label:"Secuencia"},{default:n(()=>[e(V,{value:u.value.sequenceNumber,"onUpdate:value":_[2]||(_[2]=w=>u.value.sequenceNumber=w)},null,8,["value"])]),_:1})]),_:1}),e(E,{span:"12"},{default:n(()=>[e(P,{path:"paymentTypeId",label:"Metodo de pago"},{default:n(()=>[e(a,{"virtual-scroll":!1,value:u.value.paymentTypeId,"onUpdate:value":_[3]||(_[3]=w=>u.value.paymentTypeId=w),placeholder:"Metodo de pago",options:[{label:"BN - VENTANILLA",value:7},{label:"BN - PAGALO.PE",value:9}]},null,8,["value"])]),_:1})]),_:1}),e(E,{span:"24"},{default:n(()=>[e(r,{loading:p.value,secondary:"",type:"primary",onClick:g,block:"","render-icon":N(R)("money-tick")},{default:n(()=>_[6]||(_[6]=[I(" Validar Pago ")])),_:1},8,["loading","render-icon"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"])}}}),Te={class:"wrapper-list-groups"},Re={class:"table-auto w-full"},Ae={class:"px-4 py-2 flex items-center"},Ne={class:"ms-2"},Oe={class:"text-end px-4 py-2"},De={class:"border-b-2 border-gray-500"},Me={class:"px-4 py-2 font-bold text-lg text-end"},qe={class:"px-4 py-2 font-bold text-lg text-end"},Be={class:"text-red-500 text-sm text-end text-sm"},dt=L({__name:"EnrollmentGroupForm",props:{modelValue:{type:Boolean},studentId:{},curriculumId:{},courseId:{},enrollmetGroup:{}},emits:["update:modelValue","success"],setup(t,{emit:o}){const d=o,i=t,p=x(!1),y=A({get:()=>i.modelValue,set:a=>d("update:modelValue",a)}),h=x(!1),u=x([]),m=x([]),g=x(0),l=x(Object.assign({},{...Ce()})),f=a=>{console.log("Pago validado",a),l.value.payments.push(a.token),m.value.push({token:a.token,amount:a.payment.amount,sequenceNumber:a.payment.sequenceNumber})},_=a=>{l.value.groupId&&l.value.groupId!=a.id?(l.value.groupId=a.id,g.value=a.price):l.value.groupId==a.id?(l.value.groupId=null,g.value=0):(l.value.groupId=a.id,g.value=a.price)},O=async()=>{const a=await Ee({studentId:i.studentId,curriculumId:i.curriculumId,courseId:i.courseId});u.value=a.data},D=a=>{let k=m.value[a].token;m.value.splice(a,1);let S=l.value.payments.find($=>$.token==k);if(!S)return;let G=l.value.payments.indexOf(S);l.value.payments.splice(G,1)},M=()=>m.value.reduce((r,k)=>r+parseInt(k.amount),0)>=g.value?null:"El monto pagado es menor al total",V=async()=>{var a;if(l.value.studentId=i.studentId,p.value=!0,(a=i.enrollmetGroup)!=null&&a.id){(await he(l.value)).status&&(d("success"),y.value=!1),p.value=!1;return}else(await Ie(l.value)).status&&(d("success"),y.value=!1),p.value=!1},P=async a=>{m.value=await Se({id:a})},E=async()=>{if(m.value=[],l.value.payments=[],l.value.groupId=null,g.value=0,await O(),i.enrollmetGroup){let a=u.value.find(r=>r.id==i.enrollmetGroup.groupId);a&&(l.value.groupId=a.id,g.value=a.price),l.value.id=i.enrollmetGroup.id,await P(i.enrollmetGroup.id),m.value.length>0&&m.value.forEach(r=>{l.value.payments.push(r.token)})}console.log("Inicializando formulario")};return K(y,a=>{a&&E()}),(a,r)=>{const k=F,S=fe,G=ve,$=ge,w=_e,Z=me,q=Y,ee=J("LnxIcon"),te=X,ne=W,ae=Q;return C(),T(B,null,[e(ae,{show:y.value,"onUpdate:show":r[1]||(r[1]=s=>y.value=s)},{default:n(()=>[e(ne,{style:{width:"500px"},title:"MATRICULA EN GRUPO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:n(()=>[e(te,{gutter:[16,16]},{default:n(()=>[e(q,{span:"24"},{default:n(()=>[c("div",Te,[e(Z,{hoverable:"",clickable:""},{header:n(()=>{var s;return[I(" Grupos aperturados ("+v((s=u.value)!=null&&s.length?u.value.length:0)+") ",1)]}),default:n(()=>[(C(!0),T(B,null,j(u.value,s=>(C(),U(w,{key:s.id,class:le({"item-selected":l.value.groupId==s.id}),extra:s.price},{default:n(()=>[e($,{title:`${s.group} - S/. ${s.price}`,onClick:z=>_(s)},se({description:n(()=>[e(G,{size:"small"},{default:n(()=>[e(S,{bordered:!1,type:"info",size:"small"},{default:n(()=>[I(v(s.modality),1)]),_:2},1024)]),_:2},1024)]),default:n(()=>[r[3]||(r[3]=I(" Min.: ")),c("b",null,v(s.minStudents),1),r[4]||(r[4]=I(" | Matriculados: ")),c("b",null,v(s.enrolledStudents),1),r[5]||(r[5]=I(" | Reservados: ")),c("b",null,v(s.reservedStudents),1),r[6]||(r[6]=c("br",null,null,-1)),e(S,{bordered:!1,type:"info",size:"small"},{default:n(()=>[c("strong",null,v(s.schedules.days)+" - "+v(s.schedules.startHour)+" a "+v(s.schedules.endHour),1)]),_:2},1024)]),_:2},[l.value.groupId==s.id?{name:"header-extra",fn:n(()=>[e(k,{circle:"",type:"warning","render-icon":N(R)("verify")},null,8,["render-icon"])]),key:"0"}:void 0]),1032,["title","onClick"])]),_:2},1032,["class","extra"]))),128))]),_:1})])]),_:1}),e(q,{span:"24"},{default:n(()=>[c("span",{role:"button",onClick:r[0]||(r[0]=s=>h.value=!0),class:"border border-dashed border-gray-300 p-4 rounded-sm flex items-center justify-center cursor-pointer text-gray-400 hover:bg-gray-50 font-bold hover:text-gray-500 mb-4"},[e(ee,{class:"me-3","icon-name":"money-add",size:"20"}),r[7]||(r[7]=I(" Agregar pago "))]),c("table",Re,[c("tbody",null,[(C(!0),T(B,null,j(m.value,(s,z)=>(C(),T("tr",{key:z,class:"border-b border-gray-300 border-dashed px-4 py-2"},[c("td",Ae,[e(k,{type:"error",size:"small",secondary:"",onClick:Le=>D(z),"render-icon":N(R)("trash")},null,8,["onClick","render-icon"]),c("i",Ne,v(s.sequenceNumber),1)]),c("td",Oe,"S/. "+v(s.amount),1)]))),128)),c("tr",De,[r[8]||(r[8]=c("td",{class:"px-4 py-2"},"Total pagado",-1)),c("td",Me," S/. "+v(m.value.reduce((s,z)=>s+parseInt(z.amount),0)),1)]),c("tr",null,[r[9]||(r[9]=c("td",{class:"px-4 py-2"},"Total a pagar",-1)),c("td",qe," S/. "+v(g.value),1)])])]),c("div",Be,v(M()),1)]),_:1}),e(q,{span:"24"},{default:n(()=>[e(k,{size:"large",type:"primary",onClick:V,block:"",loading:p.value},{default:n(()=>r[10]||(r[10]=[I(" Realizar Matricula ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),e(ze,{modelValue:h.value,"onUpdate:modelValue":r[2]||(r[2]=s=>h.value=s),studentId:i.studentId,onSuccess:f},null,8,["modelValue","studentId"])],64)}}}),it=L({__name:"EditEnrollmentGroup",props:{item:{}},emits:["changeGroup","reserveEnrollment","cancelEnrollment","resetEnrollment"],setup(t,{emit:o}){const d=be(),i=o,p=t,y=async u=>{switch(u){case"change-group":i("changeGroup",p.item);break;case"reserve-enrollment":d.warning({title:"Confirmar",content:"¿Está seguro de realizar la reserva de la matrícula?",positiveText:"Reservar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"primary"},bordered:!0,onPositiveClick:async()=>{await ke(p.item),i("reserveEnrollment",p.item)}});break;case"cancel-enrollment":d.warning({title:"Confirmar",content:"¿Está seguro de cancelar la matrícula?",positiveText:"Cancelar matrícula",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:async()=>{await xe(p.item),i("cancelEnrollment",p.item)}});break;case"reset-enrollment":i("resetEnrollment",p.item);break}},h=A(()=>{var u,m,g,l,f;return[{label:"Cambiar grupo",key:"change-group",disabled:((u=p.item)==null?void 0:u.enrollmentStatus)!=="MATRICULADO"},{label:"Reservar matrícula",key:"reserve-enrollment",disabled:((m=p.item)==null?void 0:m.enrollmentStatus)!=="MATRICULADO"},{label:"Cancelar matrícula",key:"cancel-enrollment",disabled:((g=p.item)==null?void 0:g.enrollmentStatus)=="CANCELADO"},{label:"Reestablecer matrícula",key:"reset-enrollment",disabled:((l=p.item)==null?void 0:l.enrollmentStatus)!=="CANCELADO"&&((f=p.item)==null?void 0:f.enrollmentStatus)!=="RESERVADO"}]});return(u,m)=>{const g=F,l=we;return C(),U(l,{trigger:"click",options:h.value,"show-arrow":!0,onSelect:y},{default:n(()=>[e(g,{"render-icon":N(R)("magicpen")},{default:n(()=>m[0]||(m[0]=[I(" Opt. ")])),_:1},8,["render-icon"])]),_:1},8,["options"])}}});export{ze as _,Ee as a,ot as b,lt as c,it as d,dt as e,st as f,rt as g,ut as h,at as i};
