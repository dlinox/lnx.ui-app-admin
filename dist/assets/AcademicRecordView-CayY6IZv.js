import{az as ae,d as B,a3 as q,r as c,a8 as G,aG as U,ad as P,ae as k,aa as m,a9 as x,ac as a,ab as t,aA as b,ag as oe,aB as M,af as p,_ as A,aU as ne,ah as L,aI as le,h as re,aJ as se,aK as ie,aH as de}from"./index-DwV6zJCX.js";import{a as ue,i as F}from"./DataTable.types-BEg5m_To.js";import{_ as pe}from"./ButtonGroup-DmyPp4n9.js";import{_ as ce}from"./Table-D7pkiY2q.js";import{_ as me}from"./Space-DEwGxh3N.js";import{_ as _e,a as ge}from"./FormItem-CNNyqOT9.js";import{_ as H,a as J}from"./Col-BkVWW8vc.js";import{_ as K}from"./Input-DldL4MyO.js";import{d as fe}from"./debounce.utils-DqPPCsFD.js";import{_ as ve}from"./DataTable-DqW2qosf.js";import"./get-slot-Bk_rJcZu.js";import"./get-CqIzH_zz.js";import"./Suffix-B52V2l9z.js";import"./use-merged-state-B_X6BK0G.js";import"./Tooltip-B687EG_W.js";import"./Popover-BpepRpqO.js";import"./Dropdown-CxNUQKFj.js";import"./Select-B-XafpkT.js";import"./Tag-tDmUe03M.js";const D=ae(),I="/academic-records",we=async s=>{try{return(await D.post(`${I}/load-data-table`,s)).data.data}catch{return ue()}},W=async s=>{try{const i=await D.post(`${I}/get-record-pdf/${s}`,{},{responseType:"blob"}),d=new Blob([i.data],{type:"application/pdf"}),n=window.URL.createObjectURL(d),o=document.createElement("a"),r=new Date().getTime();return o.href=n,o.download=`reporte-academico-${s}-${r}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(n),!0}catch{return null}},ye=async s=>{try{const i=await D.post(`${I}/print-record-pdf`,s,{responseType:"blob"}),d=new Blob([i.data],{type:"application/pdf"}),n=window.URL.createObjectURL(d),o=document.createElement("a"),r=new Date().getTime();return o.href=n,o.download=`reporte-academico-${r}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(n),!0}catch{return null}},be=B({__name:"DataTableOp",props:{item:{}},emits:["edit","delete","success"],setup(s,{emit:i}){const{hasPermission:d}=q(),n=i,r=c(s.item.records),g=c(!1),v=c(!1),u=c(!1),$=c(null),w=c({id:null,code:null}),z=c(null),V=c({code:{required:!0,trigger:["input","blur"],message:"Campo requerido"}}),y=f=>{g.value=!g.value,w.value.id=f.id,w.value.code=f.code},S=async()=>{$.value&&await $.value.validate()&&(await ye(w.value),g.value=!1,v.value=!1,n("success")),u.value=!1},h=async(f,e)=>{if(e===null){u.value=!0,await W(f),u.value=!1;return}r.value[e].loading=!0,await W(f),r.value[e].loading=!1};return(f,e)=>{const C=G("LnxIcon"),_=oe,E=pe,Q=ce,j=me,N=M,O=le,X=K,Y=ge,Z=J,ee=H,te=_e;return k(d)(["academic-record.view","academic-record.print"])?(m(),U(A,{key:0},[r.value.length>1?(m(),x(_,{key:0,onClick:e[0]||(e[0]=l=>v.value=!0)},{icon:t(()=>[a(C,{"icon-name":"task",size:"20"})]),default:t(()=>[e[9]||(e[9]=b(" Registros "))]),_:1})):(m(),x(E,{key:1},{default:t(()=>[k(d)(["academic-record.view"])?(m(),x(_,{key:0,onClick:e[1]||(e[1]=l=>h(r.value[0].id,null)),loading:u.value},{icon:t(()=>[a(C,{"icon-name":"document-download",size:"20"})]),default:t(()=>[e[10]||(e[10]=b(" Ver "))]),_:1},8,["loading"])):P("",!0),k(d)(["academic-record.print"])?(m(),x(_,{key:1,onClick:e[2]||(e[2]=l=>y(r.value[0])),loading:u.value},{icon:t(()=>[a(C,{"icon-name":"printer",size:"20"})]),default:t(()=>[e[11]||(e[11]=b(" Imprimir "))]),_:1},8,["loading"])):P("",!0)]),_:1})),a(O,{show:v.value,"onUpdate:show":e[4]||(e[4]=l=>v.value=l)},{default:t(()=>[a(N,{style:{width:"600px"},role:"dialog","aria-modal":"true",segmented:{content:!0,footer:!0},size:"small"},{footer:t(()=>[a(j,{justify:"end"},{default:t(()=>[a(_,{class:"",onClick:e[3]||(e[3]=l=>v.value=!1)},{default:t(()=>e[15]||(e[15]=[b(" Cerrar ")])),_:1})]),_:1})]),default:t(()=>[a(Q,{bordered:!1,"single-line":!1,size:"small"},{default:t(()=>[e[14]||(e[14]=p("thead",null,[p("tr",null,[p("th",{width:"160px"},"Fecha del registro"),p("th",{width:"160px"},"Código"),p("th",null,"Observaciones"),p("th",{width:"120px"})])],-1)),p("tbody",null,[(m(!0),U(A,null,ne(r.value,(l,R)=>(m(),U("tr",{key:R},[p("td",null,L(l.createdAt),1),p("td",null,L(l.code),1),p("td",null,L(l.observations),1),p("td",null,[a(E,null,{default:t(()=>[k(d)(["academic-record.view"])?(m(),x(_,{key:0,onClick:T=>h(l.id,R),loading:l.loading},{icon:t(()=>[a(C,{"icon-name":"document-download",size:"20"})]),default:t(()=>[e[12]||(e[12]=b(" Ver "))]),_:2},1032,["onClick","loading"])):P("",!0),l.isEnabled&&k(d)(["academic-record.print"])?(m(),x(_,{key:1,onClick:T=>y(l),loading:l.loading},{icon:t(()=>[a(C,{"icon-name":"printer",size:"20"})]),default:t(()=>[e[13]||(e[13]=b(" Imprimir "))]),_:2},1032,["onClick","loading"])):P("",!0)]),_:2},1024)])]))),128))])]),_:1})]),_:1})]),_:1},8,["show"]),a(O,{show:g.value,"onUpdate:show":e[8]||(e[8]=l=>g.value=l)},{default:t(()=>[a(N,{style:{width:"400px"},role:"dialog","aria-modal":"true",segmented:{content:!0,footer:!0},size:"small",title:"Imprimir Acta"},{footer:t(()=>[a(j,{justify:"end"},{default:t(()=>[a(_,{tertiary:"",size:"large",onClick:e[7]||(e[7]=l=>g.value=!1),disabled:u.value},{default:t(()=>e[16]||(e[16]=[b(" Cancelar ")])),_:1},8,["disabled"]),a(_,{size:"large",type:"primary",onClick:S,loading:u.value},{default:t(()=>e[17]||(e[17]=[b(" Guardar ")])),_:1},8,["loading"])]),_:1})]),default:t(()=>[a(te,{ref_key:"formPrintRef",ref:$,model:w.value,rules:V.value,size:"large"},{default:t(()=>[a(ee,{gutter:16},{default:t(()=>[a(Z,{span:"24"},{default:t(()=>{var l;return[a(Y,{path:"code",label:"Codigo",feedback:(l=z.value)==null?void 0:l.code},{default:t(()=>{var R;return[a(X,{type:"text",value:w.value.code,"onUpdate:value":[e[5]||(e[5]=T=>w.value.code=T),e[6]||(e[6]=()=>z.value!=null?z.value.code=null:()=>{})],status:((R=z.value)==null?void 0:R.code)!=null?"error":"",clearable:"",placeholder:"Ingrese observaciones"},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"])],64)):P("",!0)}}}),ke=s=>[{title:"Registros",key:"records",fixed:"left",width:"120px",render(i){return re(be,{item:i,onSuccess:()=>{s()}},{default:()=>"Editar"})}},{title:"Grupo",key:"group",minWidth:"50px"},{title:"Curso",key:"course",minWidth:"120px"},{title:"Docente",key:"teacher",minWidth:"120px"},{title:"Periodo",key:"period",minWidth:"120px"},{title:"Cod. Acta",key:"recordCodes",minWidth:"80px"},{title:"Ultimo registro",key:"lastCreatedAt",minWidth:"140px"}],Ce=(s=F())=>({page:s.page,total:s.total,pageSize:s.pageSize,pageCount:s.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${s.total} registros`}}),xe={style:{"border-bottom":"1px solid #e9e9e9"}},ze=B({__name:"DataTable",setup(s){const i=c(!1),d=c([]),n=se({...F()}),o=c({search:null,page:n.page,pageSize:n.pageSize}),r=c({}),g=c([]),v=async()=>{o.value.page=1,await u()},u=async()=>{i.value=!0,r.value=await we(o.value),d.value=r.value.data,n.total=r.value.total,n.pageSize=r.value.per_page,n.page=r.value.current_page,n.pageCount=r.value.last_page,i.value=!1},$=fe(()=>{v()},400),w=async y=>{o.value.page=y,await u()},z=async y=>{o.value.page=1,o.value.pageSize=y,await u()};return(async()=>{g.value=ke(u),await u()})(),(y,S)=>{const h=J,f=K,e=H,C=ve;return m(),U("div",xe,[a(e,{gutter:12,style:{padding:"12px 16px"}},{default:t(()=>[a(h,{span:12}),a(h,{span:12},{default:t(()=>[a(f,{size:"large",placeholder:"Buscar",value:o.value.search,"onUpdate:value":S[0]||(S[0]=_=>o.value.search=_),onInput:k($),clearable:""},{suffix:t(()=>[a(de,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),a(e,null,{default:t(()=>[a(h,{span:24},{default:t(()=>[a(C,{key:"id",remote:"",size:"small","single-line":!1,columns:g.value,data:d.value,pagination:k(Ce)(n),"pagination-show-size-picker":!0,loading:i.value,"onUpdate:page":w,"onUpdate:pageSize":z},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),ie(y.$slots,"extra",{reLoadDataTable:v})])}}}),Ge=B({__name:"AcademicRecordView",setup(s){const{hasPermission:i}=q();return(d,n)=>{const o=M,r=G("AppNotAuthorization");return k(i)(["academic-record.view","academic-record.print"])?(m(),U(A,{key:0},[a(o,{segmented:{header:!0,content:!0}},{header:t(()=>n[0]||(n[0]=[p("span",{class:"text-sm text-slate-500"}," Registro de actas académicas ",-1),p("h5",{class:"text-lg font-bold text-slate-800"},"Actas académicas",-1)])),"header-extra":t(()=>n[1]||(n[1]=[])),_:1}),a(ze)],64)):(m(),x(r,{key:1}))}}});export{Ge as default};
