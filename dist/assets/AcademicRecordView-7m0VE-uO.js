import{r as ae}from"./icon.utils-DDsaHdGI.js";import{ay as oe,d as A,r as d,aF as C,a9 as b,a8 as U,ab as e,aa as t,az as w,aG as T,af as L,aA as B,ae as _,_ as V,b2 as ne,ag as E,aH as j,h as le,e as P,j as se,a7 as re,bb as ue,aI as ie,aJ as pe,ad as I}from"./index-C9c7JGRw.js";import{a as de,i as q}from"./DataTable.types-BEg5m_To.js";import{_ as F,a as ce,b as me,c as _e}from"./academicSupervision.services-0smcYSwa.js";import{_ as ge,a as fe}from"./FormItem-BhYV6jh0.js";import{_ as G,a as W}from"./Col-DDZ8Pssk.js";import{_ as ve}from"./Alert-CjX6nSE_.js";import{_ as be}from"./Select-Bv507AmW.js";import{_ as M}from"./Input-MpWbaTbN.js";import{_ as H}from"./Space-B7YONKnB.js";import{_ as we}from"./Table-Bk7BNr-y.js";import{d as ye}from"./debounce.utils-DqPPCsFD.js";import{_ as ke}from"./DataTable-3NU7cn1U.js";import"./get-DMitJf1L.js";import"./Popover-U50KL7Ta.js";import"./use-merged-state-BO0aND_o.js";import"./Suffix-BAJCskMY.js";import"./Tag-CIenDrrK.js";import"./get-slot-Bk_rJcZu.js";import"./Tooltip-BbKh1Nso.js";import"./Dropdown-CKOP4Jno.js";const J=oe(),K="/academic-records",xe=async r=>{try{return(await J.post(`${K}/load-data-table`,r)).data.data}catch{return de()}},N=async r=>{try{const i=await J.post(`${K}/get-record-pdf/${r}`,{},{responseType:"blob"}),g=new Blob([i.data],{type:"application/pdf"}),n=window.URL.createObjectURL(g),l=document.createElement("a"),s=new Date().getTime();return l.href=n,l.download=`reporte-academico-${r}-${s}.pdf`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(n),!0}catch{return null}},ze=A({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(r,{emit:i}){const n=d(r.item.records),l=d(!1),s=d(!1),c=async(u,a)=>{if(a===null){s.value=!0,await N(u),s.value=!1;return}n.value[a].loading=!0,await N(u),n.value[a].loading=!1};return(u,a)=>{const f=L,y=we,x=H,S=B,p=j;return b(),C(V,null,[n.value.length>1?(b(),U(f,{key:0,onClick:a[0]||(a[0]=o=>l.value=!0)},{icon:t(()=>[e(T,{"icon-name":"task",size:"20"})]),default:t(()=>[a[4]||(a[4]=w(" Registros "))]),_:1})):(b(),U(f,{key:1,onClick:a[1]||(a[1]=o=>c(n.value[0].id,null)),loading:s.value},{icon:t(()=>[e(T,{"icon-name":"document-download",size:"20"})]),default:t(()=>[a[5]||(a[5]=w(" Descargar "))]),_:1},8,["loading"])),e(p,{show:l.value,"onUpdate:show":a[3]||(a[3]=o=>l.value=o)},{default:t(()=>[e(S,{style:{width:"600px"},role:"dialog","aria-modal":"true",segmented:{content:!0,footer:!0},size:"small"},{footer:t(()=>[e(x,{justify:"end"},{default:t(()=>[e(f,{class:"",onClick:a[2]||(a[2]=o=>l.value=!1)},{default:t(()=>a[8]||(a[8]=[w(" Cerrar ")])),_:1})]),_:1})]),default:t(()=>[e(y,{bordered:!1,"single-line":!1,size:"small"},{default:t(()=>[a[7]||(a[7]=_("thead",null,[_("tr",null,[_("th",{width:"160px"},"Fecha del registro"),_("th",null,"Observaciones"),_("th",{width:"120px"})])],-1)),_("tbody",null,[(b(!0),C(V,null,ne(n.value,(o,v)=>(b(),C("tr",{key:v},[_("td",null,E(o.createdAt),1),_("td",null,E(o.observations),1),_("td",null,[e(f,{onClick:R=>c(o.id,v),loading:o.loading},{icon:t(()=>[e(T,{"icon-name":"document-download",size:"20"})]),default:t(()=>[a[6]||(a[6]=w(" Descargar "))]),_:2},1032,["onClick","loading"])])]))),128))])]),_:1})]),_:1})]),_:1},8,["show"])],64)}}}),Ce=()=>[{title:"Registros",key:"records",fixed:"left",width:"120px",render(r){return le(ze,{item:r},{default:()=>"Editar"})}},{title:"Grupo",key:"group",minWidth:"50px"},{title:"Curso",key:"course",minWidth:"120px"},{title:"Docente",key:"teacher",minWidth:"120px"},{title:"Periodo",key:"period",minWidth:"120px"},{title:"Ultimo registro",key:"lastCreatedAt",minWidth:"140px"}],Se=(r=q())=>({page:r.page,total:r.total,pageSize:r.pageSize,pageCount:r.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${r.total} registros`}}),Re=A({__name:"Form",props:{item:{},modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(r,{emit:i}){const g=i,n=r,l=P({get:()=>n.modelValue,set:p=>g("update:modelValue",p)}),s=d(!1),c=d(null),u=d(F()),a=d(null),f=P(()=>({...ce()})),y=d([]),x=async()=>{if(c.value){const p=await c.value.validate();let o=null;p&&(s.value=!0,o=await me(u.value),o.status?(g("success"),l.value=!1):a.value=o.data)}s.value=!1},S=async()=>{u.value=n.item?{...n.item,groupId:n.item.groupId}:F(),y.value=await _e()};return se(l,p=>{p&&(a.value=null,S())}),(p,o)=>{const v=re("LnxIcon"),R=ue,$=ve,k=W,h=be,D=fe,Q=M,X=G,Y=ge,O=L,Z=H,ee=B,te=j;return b(),U(te,{show:l.value,"onUpdate:show":o[4]||(o[4]=m=>l.value=m)},{default:t(()=>[e(ee,{style:{width:"500px"},title:p.item?"Editar registro":"Nuevo registro",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:t(()=>[e(Z,{justify:"end"},{default:t(()=>[e(O,{tertiary:"",size:"large",onClick:o[3]||(o[3]=m=>l.value=!1),disabled:s.value},{default:t(()=>o[6]||(o[6]=[w(" Cancelar ")])),_:1},8,["disabled"]),e(O,{size:"large",type:"primary",onClick:x,loading:s.value},{default:t(()=>o[7]||(o[7]=[w(" Guardar ")])),_:1},8,["loading"])]),_:1})]),default:t(()=>[e(Y,{ref_key:"formRef",ref:c,model:u.value,rules:f.value,size:"large"},{default:t(()=>[e(X,{gutter:16},{default:t(()=>[e(k,{span:24},{default:t(()=>[e($,{stype:"default",closable:"",class:"mb-2"},{icon:t(()=>[e(R,null,{default:t(()=>[e(v,{iconName:"info-circle"})]),_:1})]),default:t(()=>[o[5]||(o[5]=w(" Solo se listan los grupos que todavía están activos o disponibles para matrícula. "))]),_:1})]),_:1}),e(k,{span:24},{default:t(()=>{var m;return[e(D,{path:"groupId",label:"Grupo - Docente","show-require-mark":!0,feedback:(m=a.value)==null?void 0:m.groupId},{default:t(()=>[e(h,{value:u.value.groupId,"onUpdate:value":o[0]||(o[0]=z=>u.value.groupId=z),options:y.value,placeholder:"Seleccione un grupo",clearable:!0,loading:s.value,disabled:s.value},null,8,["value","options","loading","disabled"])]),_:1},8,["feedback"])]}),_:1}),e(k,{span:24},{default:t(()=>{var m;return[e(D,{path:"type",label:"Tipo","show-require-mark":!0,feedback:(m=a.value)==null?void 0:m.type},{default:t(()=>[e(h,{value:u.value.type,"onUpdate:value":o[1]||(o[1]=z=>u.value.type=z),options:[{label:"TARDE",value:"TARDE"},{label:"FALTA",value:"FALTA"},{label:"OTROS",value:"OTROS"}],placeholder:"Seleccione el tipo",clearable:!0},null,8,["value"])]),_:1},8,["feedback"])]}),_:1}),e(k,{span:24},{default:t(()=>{var m;return[e(D,{path:"observations",label:"Observaciones","show-require-mark":!0,feedback:(m=a.value)==null?void 0:m.observations},{default:t(()=>[e(Q,{value:u.value.observations,"onUpdate:value":o[2]||(o[2]=z=>u.value.observations=z),type:"textarea",placeholder:"Ingrese las observaciones",disabled:s.value},null,8,["value","disabled"])]),_:1},8,["feedback"])]}),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),$e={style:{"border-bottom":"1px solid #e9e9e9"}},he=A({__name:"DataTable",setup(r){const i=d(!1),g=d([]),n=ie({...q()}),l=d({search:null,page:n.page,pageSize:n.pageSize}),s=d({}),c=Ce(),u=async()=>{l.value.page=1,await a()},a=async()=>{i.value=!0,s.value=await xe(l.value),g.value=s.value.data,n.total=s.value.total,n.pageSize=s.value.per_page,n.page=s.value.current_page,n.pageCount=s.value.last_page,i.value=!1},f=ye(()=>{u()},400),y=async p=>{l.value.page=p,await a()},x=async p=>{l.value.page=1,l.value.pageSize=p,await a()};return(async()=>{await a()})(),(p,o)=>{const v=W,R=M,$=G,k=ke;return b(),C("div",$e,[e($,{gutter:12,style:{padding:"12px 16px"}},{default:t(()=>[e(v,{span:12}),e(v,{span:12},{default:t(()=>[e(R,{size:"large",placeholder:"Buscar",value:l.value.search,"onUpdate:value":o[0]||(o[0]=h=>l.value.search=h),onInput:I(f),clearable:""},{suffix:t(()=>[e(T,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),e($,null,{default:t(()=>[e(v,{span:24},{default:t(()=>[e(k,{key:"id",remote:"","single-line":!1,columns:I(c),data:g.value,pagination:I(Se)(n),"pagination-show-size-picker":!0,loading:i.value,"onUpdate:page":y,"onUpdate:pageSize":x},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),pe(p.$slots,"extra",{reLoadDataTable:u})])}}}),Qe=A({__name:"AcademicRecordView",setup(r){const i=d(!1);return(g,n)=>{const l=L,s=B;return b(),C(V,null,[e(s,{segmented:{header:!0,content:!0}},{header:t(()=>n[2]||(n[2]=[_("span",{class:"text-sm text-slate-500"}," Registro de actas académicas ",-1),_("h5",{class:"text-lg font-bold text-slate-800"},"Actas académicas",-1)])),"header-extra":t(()=>[e(l,{"render-icon":I(ae)("additem"),onClick:n[0]||(n[0]=c=>i.value=!0)},{default:t(()=>n[3]||(n[3]=[w(" Agregar ")])),_:1},8,["render-icon"])]),_:1}),e(he,null,{extra:t(({reLoadDataTable:c})=>[e(Re,{modelValue:i.value,"onUpdate:modelValue":n[1]||(n[1]=u=>i.value=u),item:null,onSuccess:c},null,8,["modelValue","onSuccess"])]),_:1})],64)}}});export{Qe as default};
