import{d as ve,e as de,r as d,j as Ee,a8 as fe,aG as E,aa as c,_ as R,ac as o,ab as t,aB as ge,af as l,aL as H,a9 as S,aY as Q,aZ as Ce,aA as _,ah as u,ag as Ie,ae as I,aI as Ne,a3 as Me,a5 as $e,aD as Ve,aN as Pe,ad as j,w as ze}from"./index-B4HM4eEq.js";import{r as ie}from"./icon.utils-_VQD1LzU.js";import{u as Ae}from"./useBreakpoints-ElCxPKgB.js";import{_ as Re,a as Fe,b as Ue,c as Be,d as De,e as Le,f as Oe,g as Te}from"./EditEnrollmentGroup.vue_vue_type_script_setup_true_lang-DEG1tlGn.js";import"./studentType.services-WXtKtk_7.js";import{j as qe}from"./student.services-K4dUhqj1.js";import"./documentType.services-etavtVqQ.js";import{_ as Ge,a as je}from"./selectables.services-BpH96F3l.js";import{u as He}from"./period.stores-CG0wpbNx.js";import{i as We}from"./course.services-BAqWII3a.js";import{_ as Ye,a as Ze}from"./FormItem-cRsh-SHk.js";import{_ as ye,a as be}from"./Col-CBFn7CGp.js";import{_ as he}from"./Select-lU1ug5AA.js";import{a as xe,_ as we}from"./ListItem-Byr2yILK.js";import{_ as Se}from"./Thing-BA-dOlKf.js";import{N as ke}from"./Tag-C7q16pA0.js";import{d as Je}from"./debounce.utils-DqPPCsFD.js";import{_ as Ke}from"./Statistic-XyXTvwhR.js";import{_ as Qe,a as Xe}from"./CollapseItem-BLfVbs2U.js";import{_ as et}from"./Spin-D-u68XbS.js";import{_ as tt}from"./Space-DsuPZ34i.js";import{_ as lt}from"./Table-DCUtoYPD.js";import"./Alert-C2YmU2PH.js";import"./Input-Blyfr7bU.js";import"./Suffix-CO3cYY28.js";import"./use-merged-state-D3q23DVU.js";import"./Switch-BouS8iVV.js";import"./DataTable.types-BEg5m_To.js";import"./composables-CnPINYM7.js";import"./Dropdown-CtyOND1F.js";import"./Popover-V6QhFDvP.js";import"./get-ClpdtJHT.js";const _e=()=>({studentId:null,curriculumId:null,moduleId:null,courseId:null,groupId:null,payments:[]}),ot=()=>({studentId:[],curriculumId:[],moduleId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}],courseId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}],groupId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),nt={class:"wrapper-list-groups"},at={class:"table-auto w-full"},ut={class:"px-4 py-2 flex items-center"},st={class:"ms-2"},rt={class:"text-end px-4 py-2"},dt={class:"border-b-2 border-gray-500"},it={class:"px-4 py-2 font-bold text-lg text-end"},ct={class:"px-4 py-2 font-bold text-lg text-end"},pt={class:"text-red-500 text-sm text-end text-sm"},mt=ve({__name:"EnrollmentModuleForm",props:{modelValue:{type:Boolean},studentId:{},curriculumId:{},periodId:{}},emits:["update:modelValue","success"],setup(ce,{emit:X}){const B=X,y=ce,b=de({get:()=>y.modelValue,set:e=>B("update:modelValue",e)}),V=d(!1),P=d(!1),x=d([]),F=d([]),k=d([]),U=d(null),D=de(()=>ot()),r=d(_e()),i=d([]),L=d(0),z=d(0),C=d(0),W=e=>{r.value.payments.push(e.token),i.value.push({token:e.token,amount:e.payment.amount,sequenceNumber:e.payment.sequenceNumber})},N=e=>{const n=i.value.splice(e,1)[0],w=n==null?void 0:n.token;if(!w)return;const v=r.value.payments.indexOf(w);v!==-1&&r.value.payments.splice(v,1)},ee=async e=>{r.value.payments=[],r.value.courseId=null,r.value.groupId=null,F.value=[],k.value=[],F.value=await We(e),x.value.forEach(n=>{n.value==e&&(L.value=parseFloat(n.price))})},Y=async e=>{r.value.courseId=e,await le(e)},te=e=>{console.log("Grupo seleccionado",e),z.value=parseFloat(e.price),r.value.groupId&&r.value.groupId!=e.id?(r.value.groupId=e.id,C.value=z.value):r.value.groupId==e.id?(r.value.groupId=null,C.value=0):(r.value.groupId=e.id,C.value=z.value)},le=async e=>{const n=await Fe({studentId:y.studentId,curriculumId:y.curriculumId,courseId:e,periodId:y.periodId});k.value=n.data},M=async()=>{const e=await Be(y.studentId,y.curriculumId);x.value=e.data},O=de(()=>i.value.reduce((e,n)=>e+Number(n.amount),0)>=C.value),oe=async()=>{if(r.value.studentId=y.studentId,r.value.curriculumId=y.curriculumId,U.value){if(!await U.value.validate())return;V.value=!0,(await Ue({periodId:y.periodId,...r.value})).status&&(B("success"),b.value=!1),V.value=!1}},f=()=>{M(),console.log("Inicializando formulario")};return Ee(b,e=>{e&&(r.value=Object.assign({},{..._e()}),i.value=[],x.value=[],F.value=[],k.value=[],L.value=0,z.value=0,C.value=0,f())}),(e,n)=>{const w=he,v=Ze,h=be,Z=ke,$=Ie,T=Se,q=we,J=xe,ne=fe("LnxIcon"),ae=ye,ue=Ye,se=ge,re=Ne;return c(),E(R,null,[o(re,{show:b.value,"onUpdate:show":n[3]||(n[3]=a=>b.value=a)},{default:t(()=>[o(se,{style:{width:"600px"},title:"MATRICULA EN MODULO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:t(()=>[o(ue,{ref_key:"formRef",ref:U,model:r.value,rules:D.value,size:"large"},{default:t(()=>[o(ae,{gutter:[16,16]},{default:t(()=>[o(h,{span:"24"},{default:t(()=>[o(v,{path:"moduleId",label:"Modulo"},{default:t(()=>[o(w,{value:r.value.moduleId,"onUpdate:value":[n[0]||(n[0]=a=>r.value.moduleId=a),ee],placeholder:"Seleccionar modulo",options:x.value,"virtual-scroll":!1,clearable:"",filterable:""},null,8,["value","options"])]),_:1})]),_:1}),o(h,{span:"24"},{default:t(()=>[o(v,{path:"courseId",label:"Curso"},{default:t(()=>[o(w,{value:r.value.courseId,"onUpdate:value":[n[1]||(n[1]=a=>r.value.courseId=a),Y],placeholder:"Seeleccione un curso",options:F.value,"virtual-scroll":!1,clearable:"",filterable:""},null,8,["value","options"])]),_:1})]),_:1}),o(h,{span:"24"},{default:t(()=>[l("div",nt,[o(J,{hoverable:"",clickable:""},{header:t(()=>{var a;return[_(" Grupos aperturados ("+u((a=k.value)!=null&&a.length?k.value.length:0)+") ",1)]}),default:t(()=>[(c(!0),E(R,null,H(k.value,a=>(c(),S(q,{key:a.id,class:Q({"item-selected":r.value.groupId==a.id}),extra:a.price},{default:t(()=>[o(T,{onClick:A=>te(a)},Ce({header:t(()=>[o(Z,{bordered:!1,type:"info",size:"small"},{default:t(()=>[_(u(a.modality),1)]),_:2},1024),_(" "+u(`${a.group} - S/. ${a.price}`),1)]),default:t(()=>[n[5]||(n[5]=_(" Min.: ")),l("b",null,u(a.minStudents),1),n[6]||(n[6]=_(" | Matriculados: ")),l("b",null,u(a.enrolledStudents),1),n[7]||(n[7]=_(" | Reservados: ")),l("b",null,u(a.reservedStudents),1),n[8]||(n[8]=l("br",null,null,-1)),o(Z,{bordered:!1,type:"info",size:"small"},{default:t(()=>[l("strong",null,u(a.schedules.days)+" - "+u(a.schedules.startHour)+" a "+u(a.schedules.endHour),1)]),_:2},1024)]),_:2},[r.value.groupId==a.id?{name:"header-extra",fn:t(()=>[o($,{circle:"",type:"warning","render-icon":I(ie)("verify")},null,8,["render-icon"])]),key:"0"}:void 0]),1032,["onClick"])]),_:2},1032,["class","extra"]))),128))]),_:1})])]),_:1}),o(h,{span:"24"},{default:t(()=>[l("span",{role:"button",onClick:n[2]||(n[2]=a=>P.value=!0),class:"border border-dashed border-gray-300 p-4 rounded-sm flex items-center justify-center cursor-pointer text-gray-400 hover:bg-gray-50 font-bold hover:text-gray-500 mb-4"},[o(ne,{class:"me-3","icon-name":"money-add",size:"20"}),n[9]||(n[9]=_(" Agregar pago "))]),l("table",at,[l("tbody",null,[(c(!0),E(R,null,H(i.value,(a,A)=>(c(),E("tr",{key:A,class:"border-b border-gray-300 border-dashed px-4 py-2"},[l("td",ut,[o($,{type:"error",size:"small",secondary:"",onClick:pe=>N(A),"render-icon":I(ie)("trash")},null,8,["onClick","render-icon"]),l("i",st,u(a.sequenceNumber),1)]),l("td",rt,"S/. "+u(a.amount),1)]))),128)),l("tr",dt,[n[10]||(n[10]=l("td",{class:"px-4 py-2"},"Total pagado",-1)),l("td",it," S/. "+u(i.value.reduce((a,A)=>a+parseInt(A.amount),0)),1)]),l("tr",null,[n[11]||(n[11]=l("td",{class:"px-4 py-2"},"Total a pagar",-1)),l("td",ct," S/. "+u(C.value),1)])])]),l("div",pt,u(O.value?"":"El monto pagado no cubre el total requerido."),1)]),_:1}),o(h,{span:"24"},{default:t(()=>[o($,{size:"large",type:"primary",onClick:oe,block:"",loading:V.value},{default:t(()=>n[12]||(n[12]=[_(" Realizar matricula ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"]),o(Re,{modelValue:P.value,"onUpdate:modelValue":n[4]||(n[4]=a=>P.value=a),studentId:y.studentId,onSuccess:W},null,8,["modelValue","studentId"])],64)}}}),_t={class:"p-4"},vt={class:"flex bg-gray-100 p-4 -mx-6 -mt-6 mb-4"},ft={class:"text-lg font-semibold w-full text-blue-800 p-2"},gt={key:1},Jt=ve({__name:"EnrollmentStudentView",setup(ce){const{hasPermission:X}=Me(),{screenSize:B}=Ae(),y=$e(),b=He(),V=d(!1),P=d(!1),x=d(null),F=d(null),k=d([]),U=d([]),D=d(!1),r=d(!0),i=d({}),L=d(!0),z=d(null),C=d(null),W=d(null),N=d(null),ee=Je(f=>{Y(f)},400),Y=async f=>{D.value=!0,U.value=await je(f),D.value=!1},te=async f=>{let e=await Oe({id:f}),n=new Blob([e],{type:"application/pdf"}),w=window.URL.createObjectURL(n),v=document.getElementById("printFrame");v.src=w,v.onload=function(){var h;(h=v.contentWindow)==null||h.print()}},le=async()=>{const f=y.params.id;r.value=!0,i.value=await qe(f),r.value=!1},M=async()=>{var n;const f=y.params.id,e=(n=F.value)==null?void 0:n.id;L.value=!0,z.value=await Te(f,x.value,e),L.value=!1},O=(f,e=null)=>{C.value=f,W.value=e,P.value=!0},oe=async()=>{k.value=await Ge(),x.value=k.value[0].value,await Y(""),le(),M()};return Ve(()=>{oe()}),(f,e)=>{const n=he,w=ge,v=Ke,h=tt,Z=et,$=be,T=ke,q=Ie,J=ye,ne=lt,ae=Se,ue=we,se=xe,re=Xe,a=Qe,A=fe("AppNotAuthorization"),pe=Pe("permission");return I(X)(["enrollment.create"])?(c(),E(R,{key:0},[o(w,{segmented:{header:!0,footer:!0,content:!0}},{header:t(()=>e[5]||(e[5]=[l("h6",{class:"text-sm text-gray-500"},"Matricular estudiante",-1),_(" Matricula regular ")])),"header-extra":t(()=>[o(n,{value:x.value,"onUpdate:value":[e[0]||(e[0]=s=>x.value=s),M],placeholder:"Seleccionar Plan de estudio",filterable:"",options:k.value,"virtual-scroll":!1,"default-value":1},null,8,["value","options"])]),action:t(()=>e[6]||(e[6]=[])),_:1}),l("div",_t,[o(J,{gutter:16},{default:t(()=>[o($,{span:I(B)=="lg"?6:24},{default:t(()=>[o(w,{segmented:{header:!0,content:!0},title:"Información Personal",subtitle:"Datos del estudiante"},{default:t(()=>[o(Z,{show:r.value},{default:t(()=>[o(h,{vertical:""},{default:t(()=>[o(v,{class:"small",label:"Tipo de estudiante"},{default:t(()=>{var s;return[_(u((s=i.value)==null?void 0:s.studentType),1)]}),_:1}),o(v,{class:"small",label:"Documento"},{default:t(()=>{var s,g,p;return[l("span",{class:Q((s=i.value)!=null&&s.documentNumber?"":"text-stone-400")},u((g=i.value)!=null&&g.documentNumber?(p=i.value)==null?void 0:p.documentNumber:"No registra"),3)]}),_:1}),o(v,{class:"small",label:"Nombres"},{default:t(()=>{var s;return[_(u((s=i.value)==null?void 0:s.fullName),1)]}),_:1}),o(v,{class:"small",label:"Correo electronico"},{default:t(()=>{var s,g,p;return[l("span",{class:Q((s=i.value)!=null&&s.email?"":"text-stone-400")},u((g=i.value)!=null&&g.email?(p=i.value)==null?void 0:p.email:"No registra"),3)]}),_:1}),o(v,{class:"small",label:"Telefono"},{default:t(()=>{var s,g,p;return[l("span",{class:Q((s=i.value)!=null&&s.phone?"":"text-stone-400")},u((g=i.value)!=null&&g.phone?(p=i.value)==null?void 0:p.phone:"No registra"),3)]}),_:1})]),_:1})]),_:1},8,["show"])]),_:1})]),_:1},8,["span"]),o($,{span:I(B)=="lg"?18:24},{default:t(()=>[o(w,{segmented:{header:!0,content:!0},title:"Matricula"},{"header-extra":t(()=>[o(h,null,{default:t(()=>[o(T,{bordered:!1,type:I(b).enrollment?"info":"error"},{default:t(()=>{var s;return[l("strong",null,u(I(b).enrollment?(s=I(b).enrollment)==null?void 0:s.period:"No habilitado"),1)]}),_:1},8,["type"])]),_:1})]),default:t(()=>[l("div",vt,[o(J,null,{default:t(()=>[o($,{span:"12"},{default:t(()=>[o(q,{type:"primary",onClick:e[1]||(e[1]=s=>V.value=!0),disabled:!I(b).enrollment&&!N.value},{default:t(()=>e[7]||(e[7]=[_(" Nuevo Modulo ")])),_:1},8,["disabled"])]),_:1}),ze((c(),S($,{span:"12"},{default:t(()=>[o(n,{value:N.value,"onUpdate:value":e[2]||(e[2]=s=>N.value=s),placeholder:"Seleccionar Periodo Académico",filterable:"",options:U.value,loading:D.value,clearable:"",remote:"",size:"large","virtual-scroll":!1,onSearch:I(ee)},null,8,["value","options","loading","onSearch"])]),_:1})),[[pe,["enrollment.extraordinary"]]])]),_:1})]),o(a,null,{default:t(()=>{var s;return[(c(!0),E(R,null,H((s=z.value)==null?void 0:s.enrollments,g=>(c(),S(re,{key:g.moduleId,name:g.moduleId},{header:t(()=>[l("h2",ft,u(g.moduleName)+" "+u(g.isExtracurricular?"(Extracurricular)":""),1)]),default:t(()=>[o(se,{hoverable:"",clickable:""},{default:t(()=>[(c(!0),E(R,null,H(g.courses,p=>(c(),S(ue,{key:p.id},{default:t(()=>[o(ae,{title:`${p.code} - ${p.name}`},{"header-extra":t(()=>[p.enrollmentGroups.length==0||p.enrollmentGroups.filter(m=>{var G;return m.period==((G=I(b).enrollment)==null?void 0:G.period)}).length==0?(c(),S(q,{key:0,type:"primary",onClick:m=>O(p.id)},{default:t(()=>e[8]||(e[8]=[_(" Matricular ")])),_:2},1032,["onClick"])):j("",!0)]),description:t(()=>[o(h,{size:"small"},{default:t(()=>[o(T,{bordered:!1,size:"small"},{default:t(()=>[_(" Area: "+u(p.area),1)]),_:2},1024)]),_:2},1024)]),default:t(()=>[p.enrollmentGroups.length>0?(c(),S(ne,{key:0,"single-line":!1},{default:t(()=>[e[10]||(e[10]=l("thead",null,[l("tr",null,[l("th",{colspan:"2"},"Matricula"),l("th",{colspan:"3"},"Grupo"),l("th",{colspan:"2"})]),l("tr",null,[l("th",null,"Periodo"),l("th",null,"Estado"),l("th",null,"Grupo"),l("th",null,"Modalidad"),l("th",null,"Estado"),l("th",{rowspan:"2"},"Nota"),l("th",null,"Acciones")])],-1)),l("tbody",null,[(c(!0),E(R,null,H(p.enrollmentGroups,m=>{var G,me;return c(),E("tr",null,[l("td",null,[((G=I(b).enrollment)==null?void 0:G.period)==m.period?(c(),S(T,{key:0,type:"info"},{default:t(()=>[_(u(m.period),1)]),_:2},1024)):(c(),E("span",gt,u(m.period),1))]),l("td",null,u(m.enrollmentStatus),1),l("td",null,u(m.groupName),1),l("td",null,u(m.groupModality),1),l("td",null,u(m.groupStatus),1),l("td",null,u(m.grade),1),l("td",null,[((me=I(b).enrollment)==null?void 0:me.period)==m.period||m.periodId==N.value?(c(),S(De,{key:0,item:m,onResetEnrollment:K=>O(p.id,K),onChangeGroup:K=>O(p.id,K),onReserveEnrollment:M,onCancelEnrollment:M},null,8,["item","onResetEnrollment","onChangeGroup"])):j("",!0),m.enrollmentStatus==="MATRICULADO"?(c(),S(q,{key:1,"render-icon":I(ie)("printer"),onClick:K=>te(m.id)},{default:t(()=>e[9]||(e[9]=[_(" Ficha ")])),_:2},1032,["render-icon","onClick"])):j("",!0)])])}),256))])]),_:2},1024)):j("",!0)]),_:2},1032,["title"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["name"]))),128))]}),_:1})]),_:1})]),_:1},8,["span"])]),_:1})]),e[11]||(e[11]=l("iframe",{id:"printFrame",style:{display:"none"}},null,-1)),i.value?(c(),S(mt,{key:0,modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=s=>V.value=s),studentId:i.value.id,curriculumId:x.value,periodId:N.value,onSuccess:M},null,8,["modelValue","studentId","curriculumId","periodId"])):j("",!0),o(Le,{modelValue:P.value,"onUpdate:modelValue":e[4]||(e[4]=s=>P.value=s),studentId:i.value.id,curriculumId:x.value,periodId:N.value,courseId:C.value,enrollmetGroup:W.value,isSpecial:!1,onSuccess:M},null,8,["modelValue","studentId","curriculumId","periodId","courseId","enrollmetGroup"])],64)):(c(),S(A,{key:1}))}}});export{Jt as default};
