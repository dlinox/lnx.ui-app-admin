import{r as D}from"./icon.utils-CEl5GGKX.js";import{c as ee,_ as te}from"./selectables.services-CvgwHXzV.js";import{ay as ae,d as $,e as W,r as p,j as A,a8 as O,a9 as V,aH as le,aa as a,ab as t,af as M,az as B,aA as J,aG as L,h as N,aI as ne,aF as K,_ as Q,ae as F,aJ as oe,ad as E,ac as se}from"./index-_mj8JziO.js";import{a as ue,i as X}from"./DataTable.types-BEg5m_To.js";import{_ as re,a as ie}from"./FormItem-D4BZJS-H.js";import{_ as G,a as H}from"./Col-BWn1KlK_.js";import{_ as Y}from"./Select-DeSggoPP.js";import{_ as de}from"./InputNumber-DULpwz3F.js";import{_ as ce}from"./Space-BK4_Iwmx.js";import{_ as pe}from"./Switch-nKV2adfa.js";import{u as me}from"./composables-C6PPJC54.js";import{_ as _e}from"./Dropdown-DRixFdwA.js";import{_ as ve}from"./Tag-NEVBcrFK.js";import{d as fe}from"./debounce.utils-DqPPCsFD.js";import{d as j}from"./course.services-DuKDoBTL.js";import{_ as ge}from"./Input-BRl-dZ-f.js";import{_ as Ie}from"./DataTable-JlekKhdF.js";import"./get-CAv4nNBB.js";import"./Popover-BLfkiz4u.js";import"./use-merged-state-CgbaMofk.js";import"./Suffix-TU7kyu7U.js";import"./get-slot-Bk_rJcZu.js";import"./Tooltip-TvvvwlfV.js";const q=()=>({id:null,curriculumId:null,courseId:null,studentTypeId:null,presentialPrice:0,virtualPrice:0,isEnabled:!0}),ye=()=>({moduleId:[{required:!0,message:"Obligatório"}],studentTypeId:[{required:!0,message:"Obligatório"}],presentialPrice:[],virtualPrice:[]}),U=ae(),be=async s=>{try{return(await U.post("/course-price/load-data-table",s)).data.data}catch{return ue()}},we=async s=>{try{return{status:!0,data:(await U.post("/course-price",s)).data.data}}catch(o){return o.response.status===422?{status:!1,data:o.response.data.errors}:{status:!1,data:null}}},Pe=async s=>{try{return{status:!0,data:(await U.put("/course-price",s)).data.data}}catch(o){return o.response.status===422?{status:!1,data:o.response.data.errors}:{status:!1,data:null}}},Te=async s=>{try{return await U.delete("/course-price",{data:{id:s.id}}),!0}catch{return!1}},Z=$({__name:"CoursePriceForm",props:{item:{},modelValue:{type:Boolean},studentTypesItems:{},coursesItems:{},curriculumId:{}},emits:["update:modelValue","success"],setup(s,{emit:o}){const d=o,u=s,f=W({get:()=>u.modelValue,set:c=>d("update:modelValue",c)}),g=p(!1),i=p(null),n=p(q()),l=p(null),I=p({...ye()}),C=async()=>{if(l.value=null,i.value){const c=await i.value.validate();let e=null;c?(g.value=!0,n.value.id?e=await Pe(n.value):(n.value.curriculumId=u.curriculumId,e=await we(n.value)),e.status?(d("success"),f.value=!1):l.value=e.data):console.log("Formulario inválido")}g.value=!1},z=()=>{console.log("Inicializando formulario"),n.value=u.item?{...u.item}:q()};return A(f,c=>{c&&z()}),(c,e)=>{const y=Y,b=ie,P=H,S=de,k=pe,T=ce,h=G,_=re,w=M,x=J,R=le;return V(),O(R,{show:f.value,"onUpdate:show":e[10]||(e[10]=r=>f.value=r)},{default:a(()=>[t(x,{style:{width:"600px"},title:c.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:a(()=>[t(T,{justify:"end"},{default:a(()=>[t(w,{tertiary:"",size:"large",onClick:e[9]||(e[9]=r=>f.value=!1),disabled:g.value},{default:a(()=>e[11]||(e[11]=[B(" Cancelar ")])),_:1},8,["disabled"]),t(w,{size:"large",type:"primary",onClick:C,loading:g.value},{default:a(()=>e[12]||(e[12]=[B("Guardar")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[t(_,{ref_key:"formRef",ref:i,model:n.value,rules:I.value,size:"large"},{default:a(()=>[t(h,{gutter:16},{default:a(()=>[t(P,{span:"24"},{default:a(()=>{var r;return[t(b,{path:"studentTypeId",label:"Tipo de estudiante",feedback:(r=l.value)==null?void 0:r.studentTypeId},{default:a(()=>{var v;return[t(y,{value:n.value.studentTypeId,"onUpdate:value":e[0]||(e[0]=m=>n.value.studentTypeId=m),options:c.studentTypesItems,status:((v=l.value)==null?void 0:v.studentTypeId)!=null?"error":"",filterable:"","virtual-scroll":!1,clearable:"","onUpdate:modelValue":e[1]||(e[1]=m=>l.value!=null?l.value.studentTypeId=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),t(P,{span:"24"},{default:a(()=>{var r;return[t(b,{path:"courseId",label:"Curso",feedback:(r=l.value)==null?void 0:r.courseId},{default:a(()=>{var v;return[t(y,{value:n.value.courseId,"onUpdate:value":e[2]||(e[2]=m=>n.value.courseId=m),options:c.coursesItems,status:((v=l.value)==null?void 0:v.courseId)!=null?"error":"",filterable:"","virtual-scroll":!1,clearable:"","onUpdate:modelValue":e[3]||(e[3]=m=>l.value!=null?l.value.courseId=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),t(P,{span:"8"},{default:a(()=>{var r;return[t(b,{path:"presentialPrice",label:"Precio presencial",feedback:(r=l.value)==null?void 0:r.presentialPrice},{default:a(()=>{var v;return[t(S,{value:n.value.presentialPrice,"onUpdate:value":e[4]||(e[4]=m=>n.value.presentialPrice=m),status:((v=l.value)==null?void 0:v.presentialPrice)!=null?"error":"","onUpdate:modelValue":e[5]||(e[5]=m=>l.value!=null?l.value.presentialPrice=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1}),t(P,{span:"8"},{default:a(()=>{var r;return[t(b,{path:"virtualPrice",label:"Precio virtual",feedback:(r=l.value)==null?void 0:r.virtualPrice},{default:a(()=>{var v;return[t(S,{value:n.value.virtualPrice,"onUpdate:value":e[6]||(e[6]=m=>n.value.virtualPrice=m),status:((v=l.value)==null?void 0:v.virtualPrice)!=null?"error":"","onUpdate:modelValue":e[7]||(e[7]=m=>l.value!=null?l.value.virtualPrice=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1}),t(P,{span:"24"},{default:a(()=>[t(T,{justify:"end"},{default:a(()=>[t(b,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:a(()=>[t(k,{value:n.value.isEnabled,"onUpdate:value":e[8]||(e[8]=r=>n.value.isEnabled=r)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ke=$({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(s,{emit:o}){const d=me(),u=o,f=[{label:"Editar",key:"edit",icon:D("edit-2"),props:{onClick:()=>u("edit")}},{label:"Eliminar",key:"delete",icon:D("trash","red"),props:{style:{color:"red"},onClick:()=>{d.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{u("delete")}})}}}];return(g,i)=>{const n=M,l=_e;return V(),O(l,{options:f,placement:"bottom-start"},{default:a(()=>[t(n,null,{default:a(()=>[t(L,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})}}}),xe=(s,o)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(d){const u=d;return N(ke,{onEdit:()=>{s(u)},onDelete:()=>{o(u)},item:u},{default:()=>"Editar"})}},{title:"Tipo de Estudiante",key:"studentType",minWidth:"200px"},{title:"Modulo",key:"course",minWidth:"200px"},{title:"Precio Presencial",key:"presentialPrice",minWidth:"150px"},{title:"Precio Virtual",key:"virtualPrice",minWidth:"150px"},{title:"Habilitado",key:"isEnabled",width:"150px",render:d=>N(ve,{type:d.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>d.isEnabled?"	Habilitado":"Deshabilitado"})}],Ve=(s=X())=>({page:s.page,total:s.total,pageSize:s.pageSize,pageCount:s.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${s.total} registros`}}),Ce={style:{"border-bottom":"1px solid #e9e9e9"}},ze=$({__name:"DataTable",props:{curriculumId:{}},setup(s){const o=s,d=W(()=>({curriculumId:o.curriculumId})),u=p(!1),f=p([]),g=p(!1),i=p(null),n=ne({...X()}),l=p({search:null,page:n.page,pageSize:n.pageSize,filters:{...d.value}}),I=p({}),c=xe(_=>{i.value=_,g.value=!0},async _=>{await Te(_),await e()}),e=async()=>{l.value.page=1,await y()},y=async()=>{u.value=!0,I.value=await be(l.value),f.value=I.value.data,n.total=I.value.total,n.pageSize=I.value.per_page,n.page=I.value.current_page,n.pageCount=I.value.last_page,u.value=!1},b=fe(()=>{e()},400),P=async _=>{l.value.page=_,await y()},S=async _=>{l.value.page=1,l.value.pageSize=_,await y()},k=p([]),T=p([]),h=async()=>{k.value=await ee(),T.value=await j({curriculumId:o.curriculumId}),await y()};return A(d,async(_,w)=>{l.value.filters=_,T.value=await j({curriculumId:l.value.filters.curriculumId}),await e()},{deep:!0}),h(),(_,w)=>{const x=H,R=ge,r=G,v=Ie;return V(),K(Q,null,[F("div",Ce,[t(r,{gutter:12,style:{padding:"12px 16px"}},{default:a(()=>[t(x,{span:12}),t(x,{span:12},{default:a(()=>[t(R,{size:"large",placeholder:"Buscar",value:l.value.search,"onUpdate:value":w[0]||(w[0]=m=>l.value.search=m),onInput:E(b),clearable:""},{suffix:a(()=>[t(L,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),t(r,null,{default:a(()=>[t(x,{span:24},{default:a(()=>[t(v,{key:"id",remote:"","single-line":!1,columns:E(c),data:f.value,pagination:E(Ve)(n),"pagination-show-size-picker":!0,loading:u.value,"onUpdate:page":P,"onUpdate:pageSize":S},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),oe(_.$slots,"extra",{reLoadDataTable:e,studentTypesItems:k.value,coursesItems:T.value})]),t(Z,{modelValue:g.value,"onUpdate:modelValue":w[1]||(w[1]=m=>g.value=m),item:i.value,onSuccess:e,studentTypesItems:k.value,coursesItems:T.value,curriculumId:o.curriculumId},null,8,["modelValue","item","studentTypesItems","coursesItems","curriculumId"])],64)}}}),Ye=$({__name:"index",setup(s){const o=p([]),d=p(!1),u=p({curriculumId:null});return(async()=>{o.value=await te()})(),(g,i)=>{const n=M,l=Y,I=H,C=G,z=J;return V(),K(Q,null,[t(z,{segmented:{header:!0,content:!0}},{header:a(()=>i[3]||(i[3]=[F("span",{class:"text-sm text-slate-500"}," Gestión de precios ",-1),F("h5",{class:"text-lg font-bold text-slate-800"}," Mensualidades ",-1)])),"header-extra":a(()=>[t(n,{"render-icon":E(D)("additem"),onClick:i[0]||(i[0]=c=>d.value=!0)},{default:a(()=>i[4]||(i[4]=[B(" Agregar ")])),_:1},8,["render-icon"])]),action:a(()=>[t(C,{gutter:"16",style:{display:"flex","justify-content":"center"}},{default:a(()=>[t(I,{span:"10"},{default:a(()=>[t(l,{value:u.value.curriculumId,"onUpdate:value":i[1]||(i[1]=c=>u.value.curriculumId=c),placeholder:"Seleccionar Plan de estudio",filterable:"",options:o.value,clearable:"","virtual-scroll":!1},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),u.value.curriculumId?(V(),O(ze,{key:0,curriculumId:u.value.curriculumId},{extra:a(({reLoadDataTable:c,studentTypesItems:e,coursesItems:y})=>[t(Z,{modelValue:d.value,"onUpdate:modelValue":i[2]||(i[2]=b=>d.value=b),item:null,onSuccess:c,studentTypesItems:e,coursesItems:y,curriculumId:u.value.curriculumId},null,8,["modelValue","onSuccess","studentTypesItems","coursesItems","curriculumId"])]),_:1},8,["curriculumId"])):se("",!0)],64)}}});export{Ye as default};
