import{r as O}from"./icon.utils-BzaQiRL0.js";import{an as b,d as F,r as S,e as A,g as K,a8 as J,a9 as h,a4 as D,a6 as a,aa as t,ae as f,aR as oe,ab as $,aS as re,ag as j,al as Q,am as W,aj as N,ac as p,ao as y,_ as R,az as U,aT as le,aU as se}from"./index-BDy3jz-R.js";import{_ as ue}from"./Alert-BTRVvkM7.js";import{_ as de,a as ie,b as pe}from"./FormItem-DAU9UqDA.js";import{_ as X,c as ce,a as Y,N as me,b as _e}from"./Col-C2AyWxkb.js";import{_ as ge,a as ye,b as ve}from"./Thing-Db17URGU.js";import{a as fe}from"./DataTable.types-DKc2i3jV.js";import{u as be}from"./composables-D20BIpNr.js";import{_ as we}from"./Dropdown-DschnT-y.js";const We=async n=>{try{return(await b().post("/enrollment/load-data-table",n)).data.data}catch{return fe()}},Xe=async n=>{try{return{status:!0,data:(await b().post("/enrollment/module-store",{...n})).data.data}}catch{return{status:!1,data:null}}},Ie=async n=>{try{return{status:!0,data:(await b().post("/enrollment/group-store",{...n})).data.data}}catch{return{status:!1,data:null}}},ke=async n=>{try{return{status:!0,data:(await b().post("/enrollment/group-update",{...n})).data.data}}catch{return{status:!1,data:null}}},xe=async n=>{try{return{status:!0,data:(await b().post("/enrollment/group-reserved",{...n})).data.data}}catch{return{status:!1,data:null}}},Ee=async n=>{try{return{status:!0,data:(await b().post("/enrollment/group-cancel",{...n})).data.data}}catch{return{status:!1,data:null}}},he=async n=>{try{return{status:!0,data:(await b().post("/enrollment/enabled-groups",n)).data.data}}catch{return{status:!1,data:null}}},Ye=async(n,r,d)=>{try{return(await b().post("/enrollment/student-enrollment-avaliable",{studentId:n,curriculumId:r,periodId:d})).data.data}catch{return null}},Ze=async(n,r)=>{try{return{status:!0,data:(await b().post(`/enrollment/${n}/student/${r}/curriculum`)).data.data}}catch{return{status:!1,data:[]}}},et=async n=>{try{return(await b().post("/enrollment/download-enrollment-pdf",{...n},{responseType:"blob"})).data}catch{return null}},Se=async n=>{try{return(await b().post("/enrollment/get-enrollment-group-payments",{...n})).data.data}catch{return[]}},tt=async(n,r,d)=>{try{return(await b().post("/enrollment/student-enrollment-avaliable-special",{studentId:n,curriculumId:r,periodId:d})).data.data}catch{return null}},Ce=()=>({id:null,studentId:null,groupId:null,payments:[]}),Pe=async n=>{try{return(await b().post("/payment/validate",n)).data.data}catch{return{token:null}}},Ve=()=>({studentId:null,amount:null,date:null,sequenceNumber:null,paymentTypeId:7}),Ge=n=>({studentId:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],amount:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:"Debe ser un número",trigger:["blur","input"],validator:(r,d)=>{if(d){if(!/^\d*\.?\d*$/.test(d))return new Error("Debe ser un número")}else return new Error("Obligatorio");return!0}}],date:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],sequenceNumber:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:n===7?"Debe tener 7 digitos":"Debe tener 6 digitos",trigger:["blur","input"],validator:(r,d)=>{if(d)if(/^\d*$/.test(d)){if(n===7&&d.length!==7)return new Error("Debe tener 7 digitos");if(n===9&&d.length!==6)return new Error("Debe tener 6 digitos")}else return new Error("Debe ser un número");else return new Error("Obligatorio");return!0}}],paymentTypeId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),Te=F({__name:"PaymentForm",props:{modelValue:{type:Boolean},studentId:{}},emits:["update:modelValue","success"],setup(n,{emit:r}){const d=r,i=n,c=S(!1),w=A({get:()=>i.modelValue,set:v=>d("update:modelValue",v)}),k=S(null),s=S({}),m=A(()=>Ge(s.value.paymentTypeId)),g=async()=>{if(k.value&&!await k.value.validate())return;s.value.studentId=i.studentId,c.value=!0;const v=await Pe(s.value);v.token!==null&&(w.value=!1,d("success",{token:v.token,payment:s.value})),c.value=!1,console.log("Validando pago",v)},l=()=>{console.log("Inicializando formulario"),s.value=Object.assign({},Ve())};return K(w,v=>{v&&l()}),(v,_)=>{const L=J("LnxIcon"),M=re,q=ue,G=de,V=ie,C=X,o=ce,e=j,x=Y,P=pe,T=Q,z=W;return h(),D(z,{show:w.value,"onUpdate:show":_[4]||(_[4]=I=>w.value=I)},{default:a(()=>[t(T,{style:{width:"500px"},title:"REGISTRAR PAGO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:a(()=>[t(q,{title:"¡Importante!",type:"default",class:"mb-4"},{icon:a(()=>[t(M,null,{default:a(()=>[t(L,{"icon-name":"information",size:"20"})]),_:1})]),default:a(()=>[_[5]||(_[5]=f(" Solo se validan pagos realizados, con un día de anticipación. "))]),_:1}),t(P,{ref_key:"formRef",ref:k,model:s.value,rules:m.value,size:"large",onKeydown:oe(g,["enter"])},{default:a(()=>[t(x,{gutter:[16,16]},{default:a(()=>[t(C,{span:"12"},{default:a(()=>[t(V,{path:"amount",label:"Monto"},{default:a(()=>[t(G,{value:s.value.amount,"onUpdate:value":_[0]||(_[0]=I=>s.value.amount=I)},null,8,["value"])]),_:1})]),_:1}),t(C,{span:"12"},{default:a(()=>[t(V,{path:"date",label:"Fecha de pago"},{default:a(()=>[t(G,{placeholder:"",type:"date",value:s.value.date,"onUpdate:value":_[1]||(_[1]=I=>s.value.date=I)},null,8,["value"])]),_:1})]),_:1}),t(C,{span:"12"},{default:a(()=>[t(V,{path:"sequenceNumber",label:"Secuencia"},{default:a(()=>[t(G,{value:s.value.sequenceNumber,"onUpdate:value":_[2]||(_[2]=I=>s.value.sequenceNumber=I)},null,8,["value"])]),_:1})]),_:1}),t(C,{span:"12"},{default:a(()=>[t(V,{path:"paymentTypeId",label:"Metodo de pago"},{default:a(()=>[t(o,{"virtual-scroll":!1,value:s.value.paymentTypeId,"onUpdate:value":_[3]||(_[3]=I=>s.value.paymentTypeId=I),placeholder:"Metodo de pago",options:[{label:"BN - VENTANILLA",value:7},{label:"BN - PAGALO.PE",value:9}]},null,8,["value"])]),_:1})]),_:1}),t(C,{span:"24"},{default:a(()=>[t(e,{loading:c.value,secondary:"",type:"primary",onClick:g,block:"","render-icon":$(O)("money-tick")},{default:a(()=>_[6]||(_[6]=[f(" Validar Pago ")])),_:1},8,["loading","render-icon"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"])}}}),ze={class:"wrapper-list-groups"},Ne={class:"table-auto w-full"},Re={class:"px-4 py-2 flex items-center"},Oe={class:"ms-2"},Ae={class:"text-end px-4 py-2"},De={class:"border-b-2 border-gray-500"},$e={class:"px-4 py-2 font-bold text-lg text-end"},Le={class:"px-4 py-2 font-bold text-lg text-end"},Me={class:"text-red-500 text-sm text-end text-sm"},nt=F({__name:"EnrollmentGroupForm",props:{modelValue:{type:Boolean},studentId:{},curriculumId:{},courseId:{},enrollmetGroup:{}},emits:["update:modelValue","success"],setup(n,{emit:r}){const d=r,i=n,c=S(!1),w=A({get:()=>i.modelValue,set:o=>d("update:modelValue",o)}),k=S(!1),s=S([]),m=S([]),g=S(0),l=S(Object.assign({},{...Ce()})),v=o=>{console.log("Pago validado",o),l.value.payments.push(o.token),m.value.push({token:o.token,amount:o.payment.amount,sequenceNumber:o.payment.sequenceNumber})},_=o=>{l.value.groupId&&l.value.groupId!=o.id?(l.value.groupId=o.id,g.value=o.price):l.value.groupId==o.id?(l.value.groupId=null,g.value=0):(l.value.groupId=o.id,g.value=o.price)},L=async()=>{const o=await he({studentId:i.studentId,curriculumId:i.curriculumId,courseId:i.courseId});s.value=o.data},M=o=>{let x=m.value[o].token;m.value.splice(o,1);let P=l.value.payments.find(z=>z.token==x);if(!P)return;let T=l.value.payments.indexOf(P);l.value.payments.splice(T,1)},q=()=>m.value.reduce((e,x)=>e+parseInt(x.amount),0)>=g.value?null:"El monto pagado es menor al total",G=async()=>{var o;if(l.value.studentId=i.studentId,c.value=!0,(o=i.enrollmetGroup)!=null&&o.id){(await ke(l.value)).status&&(d("success"),w.value=!1),c.value=!1;return}else(await Ie(l.value)).status&&(d("success"),w.value=!1),c.value=!1},V=async o=>{m.value=await Se({id:o})},C=async()=>{if(m.value=[],l.value.payments=[],l.value.groupId=null,g.value=0,await L(),i.enrollmetGroup){let o=s.value.find(e=>e.id==i.enrollmetGroup.groupId);o&&(l.value.groupId=o.id,g.value=o.price),l.value.id=i.enrollmetGroup.id,await V(i.enrollmetGroup.id),m.value.length>0&&m.value.forEach(e=>{l.value.payments.push(e.token)})}console.log("Inicializando formulario")};return K(w,o=>{o&&C()}),(o,e)=>{const x=j,P=me,T=_e,z=ye,I=ve,Z=ge,B=X,ee=J("LnxIcon"),te=Y,ne=Q,ae=W;return h(),N(R,null,[t(ae,{show:w.value,"onUpdate:show":e[1]||(e[1]=u=>w.value=u)},{default:a(()=>[t(ne,{style:{width:"500px"},title:"MATRICULA EN GRUPO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:a(()=>[t(te,{gutter:[16,16]},{default:a(()=>[t(B,{span:"24"},{default:a(()=>[p("div",ze,[t(Z,{hoverable:"",clickable:""},{header:a(()=>[f(" Grupos aperturados ("+y(s.value.length)+") ",1)]),default:a(()=>[(h(!0),N(R,null,U(s.value,u=>(h(),D(I,{key:u.id,class:le({"item-selected":l.value.groupId==u.id}),extra:u.price},{default:a(()=>[t(z,{title:`${u.group} - S/. ${u.price}`,onClick:E=>_(u)},se({description:a(()=>[t(T,{size:"small",style:{"margin-top":"4px"}},{default:a(()=>[t(P,{bordered:!1,type:"info",size:"small"},{default:a(()=>[f(y(u.modality),1)]),_:2},1024)]),_:2},1024)]),default:a(()=>[e[3]||(e[3]=f(" Minimo : ")),p("b",null,y(u.minStudents),1),e[4]||(e[4]=f(" | Matriculados: ")),p("b",null,y(u.enrolledStudents),1),e[5]||(e[5]=f(" | Reservados: ")),p("b",null,y(u.reservedStudents),1),e[6]||(e[6]=p("br",null,null,-1)),e[7]||(e[7]=f(" Docente: ")),p("b",null,y(u.teacher),1),e[8]||(e[8]=p("br",null,null,-1)),e[9]||(e[9]=f(" Laboratorio: ")),p("b",null,y(u.laboratory),1),e[10]||(e[10]=p("br",null,null,-1)),(h(!0),N(R,null,U(u.schedules,(E,H)=>(h(),D(P,{key:H,bordered:!1,type:"info",size:"small"},{default:a(()=>[f(y(E.day)+" - "+y(E.startHour)+" - "+y(E.endHour),1)]),_:2},1024))),128))]),_:2},[l.value.groupId==u.id?{name:"header-extra",fn:a(()=>[t(x,{circle:"",type:"warning","render-icon":$(O)("verify")},null,8,["render-icon"])]),key:"0"}:void 0]),1032,["title","onClick"])]),_:2},1032,["class","extra"]))),128))]),_:1})])]),_:1}),t(B,{span:"24"},{default:a(()=>[p("span",{role:"button",onClick:e[0]||(e[0]=u=>k.value=!0),class:"border border-dashed border-gray-300 p-4 rounded-sm flex items-center justify-center cursor-pointer text-gray-400 hover:bg-gray-50 font-bold hover:text-gray-500 mb-4"},[t(ee,{class:"me-3","icon-name":"money-add",size:"20"}),e[11]||(e[11]=f(" Agregar pago "))]),p("table",Ne,[p("tbody",null,[(h(!0),N(R,null,U(m.value,(u,E)=>(h(),N("tr",{key:E,class:"border-b border-gray-300 border-dashed px-4 py-2"},[p("td",Re,[t(x,{type:"error",size:"small",secondary:"",onClick:H=>M(E),"render-icon":$(O)("trash")},null,8,["onClick","render-icon"]),p("i",Oe,y(u.sequenceNumber),1)]),p("td",Ae,"S/. "+y(u.amount),1)]))),128)),p("tr",De,[e[12]||(e[12]=p("td",{class:"px-4 py-2"},"Total pagado",-1)),p("td",$e," S/. "+y(m.value.reduce((u,E)=>u+parseInt(E.amount),0)),1)]),p("tr",null,[e[13]||(e[13]=p("td",{class:"px-4 py-2"},"Total a pagar",-1)),p("td",Le," S/. "+y(g.value),1)])])]),p("div",Me,y(q()),1)]),_:1}),t(B,{span:"24"},{default:a(()=>[t(x,{size:"large",type:"primary",onClick:G,block:"",loading:c.value},{default:a(()=>e[14]||(e[14]=[f(" Realizar Matricula ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),t(Te,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=u=>k.value=u),studentId:i.studentId,onSuccess:v},null,8,["modelValue","studentId"])],64)}}}),at=F({__name:"EditEnrollmentGroup",props:{item:{}},emits:["changeGroup","reserveEnrollment","cancelEnrollment","resetEnrollment"],setup(n,{emit:r}){const d=be(),i=r,c=n,w=async s=>{switch(s){case"change-group":i("changeGroup",c.item);break;case"reserve-enrollment":d.warning({title:"Confirmar",content:"¿Está seguro de realizar la reserva de la matrícula?",positiveText:"Reservar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"primary"},bordered:!0,onPositiveClick:async()=>{await xe(c.item),i("reserveEnrollment",c.item)}});break;case"cancel-enrollment":d.warning({title:"Confirmar",content:"¿Está seguro de cancelar la matrícula?",positiveText:"Cancelar matrícula",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:async()=>{await Ee(c.item),i("cancelEnrollment",c.item)}});break;case"reset-enrollment":i("resetEnrollment",c.item);break}console.log(s)},k=A(()=>{var s,m,g,l,v;return[{label:"Cambiar grupo",key:"change-group",disabled:((s=c.item)==null?void 0:s.enrollmentStatus)!=="MATRICULADO"},{label:"Reservar matrícula",key:"reserve-enrollment",disabled:((m=c.item)==null?void 0:m.enrollmentStatus)!=="MATRICULADO"},{label:"Cancelar matrícula",key:"cancel-enrollment",disabled:((g=c.item)==null?void 0:g.enrollmentStatus)=="CANCELADO"},{label:"Reestablecer matrícula",key:"reset-enrollment",disabled:((l=c.item)==null?void 0:l.enrollmentStatus)!=="CANCELADO"&&((v=c.item)==null?void 0:v.enrollmentStatus)!=="RESERVADO"}]});return(s,m)=>{const g=j,l=we;return h(),D(l,{trigger:"click",options:k.value,"show-arrow":!0,onSelect:w},{default:a(()=>[t(g,{"render-icon":$(O)("magicpen")},{default:a(()=>m[0]||(m[0]=[f(" Opt. ")])),_:1},8,["render-icon"])]),_:1},8,["options"])}}});export{nt as _,Ye as a,at as b,et as c,tt as d,Te as e,Xe as f,Ze as g,We as h};
