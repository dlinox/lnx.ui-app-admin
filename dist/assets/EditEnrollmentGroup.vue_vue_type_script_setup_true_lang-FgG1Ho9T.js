import{r as V}from"./icon.utils-CmxuJXeQ.js";import{az as Z,d as F,r as E,e as T,j as J,a8 as Q,a9 as j,aa as x,aI as W,ab as r,ac as a,aB as X,aA as w,b2 as ue,b3 as ie,ag as H,ae as z,aG as N,_ as U,af as p,aU as K,aY as de,aZ as ce,ah as f,ad as pe}from"./index-CHKdQ-q5.js";import{_ as me}from"./Alert-D_4vezL4.js";import{_ as _e,a as ge}from"./FormItem-BobmnhmY.js";import{_ as ee,a as te}from"./Col-G0czzw1d.js";import{_ as ve}from"./Input-C-7cIp0X.js";import{_ as fe}from"./Select-CjOGNBL7.js";import{a as ye,_ as be}from"./ListItem-BsQdMXx1.js";import{_ as we}from"./Thing-c7LYiMsI.js";import{N as Ie}from"./Tag-Cy27tpc_.js";import{_ as Ee}from"./Switch-Cam2dNBn.js";import{a as Pe}from"./DataTable.types-BEg5m_To.js";import{u as he}from"./composables-CsGV-aUD.js";import{_ as xe}from"./Dropdown-CRs7219k.js";const I=Z(),dt=async l=>{try{return(await I.post("/enrollment/load-data-table",l)).data.data}catch{return Pe()}},ct=async l=>{try{return{status:!0,data:(await I.post("/enrollment/module-store",{...l})).data.data}}catch{return{status:!1,data:null}}},ke=async l=>{try{return{status:!0,data:(await I.post("/enrollment/group-store",{...l})).data.data}}catch{return{status:!1,data:null}}},Se=async l=>{try{return{status:!0,data:(await I.post("/enrollment/group-update",{...l})).data.data}}catch{return{status:!1,data:null}}},Ce=async l=>{try{return{status:!0,data:(await I.post("/enrollment/group-reserved",{...l})).data.data}}catch{return{status:!1,data:null}}},Ge=async l=>{try{return{status:!0,data:(await I.post("/enrollment/group-cancel",{...l})).data.data}}catch{return{status:!1,data:null}}},Ne=async l=>{try{return{status:!0,data:(await I.post("/enrollment/enabled-groups",l)).data.data}}catch{return{status:!1,data:null}}},pt=async(l,o,d)=>{try{return(await I.post("/enrollment/student-enrollment-avaliable",{studentId:l,curriculumId:o,periodId:d})).data.data}catch{return null}},mt=async(l,o)=>{try{return{status:!0,data:(await I.post(`/enrollment/${l}/student/${o}/curriculum`)).data.data}}catch{return{status:!1,data:[]}}},_t=async l=>{try{return(await I.post("/enrollment/download-enrollment-pdf",{...l},{responseType:"blob"})).data}catch{return null}},Ve=async l=>{try{return(await I.post("/enrollment/get-enrollment-group-payments",{...l})).data.data}catch{return[]}},gt=async(l,o,d)=>{try{return(await I.post("/enrollment/student-enrollment-avaliable-special",{studentId:l,curriculumId:o,periodId:d})).data.data}catch{return null}},Y=()=>({id:null,studentId:null,groupId:null,payments:[],includeEnrollmentPrice:!1}),Te=Z(),ze=async l=>{try{return(await Te.post("/payment/validate",l)).data.data}catch{return{token:null}}},Re=()=>({studentId:null,amount:null,date:null,sequenceNumber:null,paymentTypeId:7}),$e=l=>({studentId:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],amount:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:"Debe ser un número",trigger:["blur","input"],validator:(o,d)=>{if(d){if(!/^\d*\.?\d*$/.test(d))return new Error("Debe ser un número")}else return new Error("Obligatorio");return!0}}],date:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],sequenceNumber:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:l===7?"Debe tener 7 digitos":"Debe tener 6 digitos",trigger:["blur","input"],validator:(o,d)=>{if(d)if(/^\d*$/.test(d)){if(l===7&&d.length!==7)return new Error("Debe tener 7 digitos");if(l===9&&d.length!==6)return new Error("Debe tener 6 digitos")}else return new Error("Debe ser un número");else return new Error("Obligatorio");return!0}}],paymentTypeId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),Ae=F({__name:"PaymentForm",props:{modelValue:{type:Boolean},studentId:{}},emits:["update:modelValue","success"],setup(l,{emit:o}){const d=o,s=l,m=E(!1),b=T({get:()=>s.modelValue,set:g=>d("update:modelValue",g)}),P=E(null),i=E({}),_=T(()=>$e(i.value.paymentTypeId)),c=async()=>{if(P.value&&!await P.value.validate())return;i.value.studentId=s.studentId,m.value=!0;const g=await ze(i.value);g.token!==null&&(b.value=!1,d("success",{token:g.token,payment:i.value})),m.value=!1},y=()=>{console.log("Inicializando formulario"),i.value=Object.assign({},Re())};return J(b,g=>{g&&y()}),(g,t)=>{const R=Q("LnxIcon"),$=ue,A=me,C=ve,S=ge,k=te,O=fe,D=H,q=ee,e=_e,n=X,h=W;return x(),j(h,{show:b.value,"onUpdate:show":t[4]||(t[4]=v=>b.value=v)},{default:r(()=>[a(n,{style:{width:"500px"},title:"REGISTRAR PAGO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:r(()=>[a(A,{title:"¡Importante!",type:"default",class:"mb-4"},{icon:r(()=>[a($,null,{default:r(()=>[a(R,{"icon-name":"information",size:"20"})]),_:1})]),default:r(()=>[t[5]||(t[5]=w(" Solo se validan pagos realizados, con un día de anticipación. "))]),_:1}),a(e,{ref_key:"formRef",ref:P,model:i.value,rules:_.value,size:"large",onKeydown:ie(c,["enter"])},{default:r(()=>[a(q,{gutter:[16,16]},{default:r(()=>[a(k,{span:"12"},{default:r(()=>[a(S,{path:"amount",label:"Monto"},{default:r(()=>[a(C,{value:i.value.amount,"onUpdate:value":t[0]||(t[0]=v=>i.value.amount=v)},null,8,["value"])]),_:1})]),_:1}),a(k,{span:"12"},{default:r(()=>[a(S,{path:"date",label:"Fecha de pago"},{default:r(()=>[a(C,{placeholder:"",type:"date",value:i.value.date,"onUpdate:value":t[1]||(t[1]=v=>i.value.date=v)},null,8,["value"])]),_:1})]),_:1}),a(k,{span:"12"},{default:r(()=>[a(S,{path:"sequenceNumber",label:"Secuencia"},{default:r(()=>[a(C,{value:i.value.sequenceNumber,"onUpdate:value":t[2]||(t[2]=v=>i.value.sequenceNumber=v)},null,8,["value"])]),_:1})]),_:1}),a(k,{span:"12"},{default:r(()=>[a(S,{path:"paymentTypeId",label:"Metodo de pago"},{default:r(()=>[a(O,{"virtual-scroll":!1,value:i.value.paymentTypeId,"onUpdate:value":t[3]||(t[3]=v=>i.value.paymentTypeId=v),placeholder:"Metodo de pago",options:[{label:"BN - VENTANILLA",value:7},{label:"BN - PAGALO.PE",value:9}]},null,8,["value"])]),_:1})]),_:1}),a(k,{span:"24"},{default:r(()=>[a(D,{loading:m.value,secondary:"",type:"primary",onClick:c,block:"","render-icon":z(V)("money-tick")},{default:r(()=>t[6]||(t[6]=[w(" Validar Pago ")])),_:1},8,["loading","render-icon"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"])}}}),Oe={class:"wrapper-list-groups"},De={class:"table-auto w-full"},qe={class:"px-4 py-2 flex items-center"},Be={class:"ms-2"},Me={class:"text-end px-4 py-2"},Le={class:"border-b-2 border-gray-500"},Ue={class:"px-4 py-2 font-bold text-lg text-end"},Fe={class:"px-4 py-2 font-bold text-lg text-end"},je={key:0,class:"bg-gray-100"},He={class:"px-4 py-2"},Ke={class:"px-4 py-2 font-bold text-lg text-end"},Ye={class:"text-red-500 text-sm text-end text-sm"},vt=F({__name:"EnrollmentGroupForm",props:{modelValue:{type:Boolean},isSpecial:{type:Boolean},studentId:{},curriculumId:{},courseId:{},enrollmetGroup:{}},emits:["update:modelValue","success"],setup(l,{emit:o}){const d=o,s=l,m=E(!1),b=T({get:()=>s.modelValue,set:e=>d("update:modelValue",e)}),P=E(!1),i=E([]),_=E([]),c=E(0),y=E(0),g=E(0),t=E(Object.assign({},{...Y()})),R=e=>{e?c.value=Number(g.value)+Number(y.value):c.value=Number(g.value)},$=e=>{t.value.payments.push(e.token),_.value.push({token:e.token,amount:e.payment.amount,sequenceNumber:e.payment.sequenceNumber})},A=e=>{t.value.groupId&&t.value.groupId!=e.id?(t.value.groupId=e.id,y.value=e.enrollmentPrice,g.value=e.groupPrice,s.enrollmetGroup?s.enrollmetGroup.withEnrollment?(t.value.includeEnrollmentPrice=!0,c.value=e.groupPrice+e.enrollmentPrice):(t.value.includeEnrollmentPrice=!1,c.value=e.groupPrice):(t.value.includeEnrollmentPrice=e.requireEnrollmentPrice,c.value=e.price)):t.value.groupId==e.id?(t.value.groupId=null,c.value=0,y.value=0,g.value=0,t.value.includeEnrollmentPrice=!1):(t.value.groupId=e.id,y.value=e.enrollmentPrice,g.value=e.groupPrice,s.enrollmetGroup?s.enrollmetGroup.withEnrollment?(t.value.includeEnrollmentPrice=!0,c.value=e.groupPrice+e.enrollmentPrice):(t.value.includeEnrollmentPrice=!1,c.value=e.groupPrice):(t.value.includeEnrollmentPrice=e.requireEnrollmentPrice,c.value=e.price))},C=async()=>{const e=await Ne({studentId:s.studentId,curriculumId:s.curriculumId,courseId:s.courseId,isSpecial:s.isSpecial});i.value=e.data},S=e=>{let h=_.value[e].token;_.value.splice(e,1);let v=t.value.payments.find(M=>M===h);if(!v)return;let B=t.value.payments.indexOf(v);t.value.payments.splice(B,1)},k=()=>_.value.reduce((n,h)=>n+parseFloat(h.amount),0)>=c.value?null:"El monto pagado es menor al total",O=async()=>{var e;if(t.value.studentId=s.studentId,m.value=!0,(e=s.enrollmetGroup)!=null&&e.id){(await Se({...t.value,isSpecial:s.isSpecial})).status&&(d("success"),b.value=!1),m.value=!1;return}else(await ke({...t.value,isSpecial:s.isSpecial})).status&&(d("success"),b.value=!1),m.value=!1},D=async e=>{_.value=await Ve({id:e})},q=async()=>{if(_.value=[],t.value=Y(),t.value.payments=[],t.value.groupId=null,c.value=0,await C(),s.enrollmetGroup){let e=i.value.find(n=>n.id==s.enrollmetGroup.groupId);e&&(t.value.groupId=e.id,c.value=e.price,y.value=e.enrollmentPrice,g.value=e.groupPrice,t.value.includeEnrollmentPrice=s.enrollmetGroup.withEnrollment,t.value.includeEnrollmentPrice||(c.value=Number(g.value))),t.value.id=s.enrollmetGroup.id,await D(s.enrollmetGroup.id),_.value.length>0&&_.value.forEach(n=>{t.value.payments.push(n.token)})}console.log("Inicializando formulario")};return J(b,e=>{e&&q()}),(e,n)=>{const h=Ie,v=H,B=we,M=be,ne=ye,L=te,ae=Q("LnxIcon"),le=Ee,re=ee,oe=X,se=W;return x(),N(U,null,[a(se,{show:b.value,"onUpdate:show":n[2]||(n[2]=u=>b.value=u)},{default:r(()=>[a(oe,{style:{width:"500px"},title:e.isSpecial?"Matricula Especial":"Matricula Regular",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:r(()=>[a(re,{gutter:[16,16]},{default:r(()=>[a(L,{span:"24"},{default:r(()=>[p("div",Oe,[a(ne,{hoverable:"",clickable:""},{header:r(()=>{var u;return[w(" Grupos aperturados ("+f((u=i.value)!=null&&u.length?i.value.length:0)+") ",1)]}),default:r(()=>[(x(!0),N(U,null,K(i.value,u=>(x(),j(M,{key:u.id,class:de({"item-selected":t.value.groupId==u.id}),extra:u.price},{default:r(()=>[a(B,{onClick:G=>A(u)},ce({header:r(()=>[a(h,{bordered:!1,type:u.modality=="VIRTUAL"?"info":"success",size:"small"},{default:r(()=>[w(f(u.modality),1)]),_:2},1032,["type"]),w(" "+f(`${u.group} - S/. ${u.price}`),1)]),default:r(()=>[n[4]||(n[4]=w(" Min.: ")),p("b",null,f(u.minStudents),1),n[5]||(n[5]=w(" | Matriculados: ")),p("b",null,f(u.enrolledStudents),1),n[6]||(n[6]=w(" | Reservados: ")),p("b",null,f(u.reservedStudents),1),n[7]||(n[7]=p("br",null,null,-1)),a(h,{bordered:!1,type:"info",size:"small"},{default:r(()=>[p("strong",null,f(u.schedules.days)+" - "+f(u.schedules.startHour)+" a "+f(u.schedules.endHour),1)]),_:2},1024)]),_:2},[t.value.groupId==u.id?{name:"header-extra",fn:r(()=>[a(v,{circle:"",type:"warning","render-icon":z(V)("verify")},null,8,["render-icon"])]),key:"0"}:void 0]),1032,["onClick"])]),_:2},1032,["class","extra"]))),128))]),_:1})])]),_:1}),a(L,{span:"24"},{default:r(()=>[p("span",{role:"button",onClick:n[0]||(n[0]=u=>P.value=!0),class:"border border-dashed border-gray-300 p-4 rounded-sm flex items-center justify-center cursor-pointer text-gray-400 hover:bg-gray-50 font-bold hover:text-gray-500 mb-4"},[a(ae,{class:"me-3","icon-name":"money-add",size:"20"}),n[8]||(n[8]=w(" Agregar pago "))]),p("table",De,[p("tbody",null,[(x(!0),N(U,null,K(_.value,(u,G)=>(x(),N("tr",{key:G,class:"border-b border-gray-300 border-dashed px-4 py-2"},[p("td",qe,[a(v,{type:"error",size:"small",secondary:"",onClick:Ze=>S(G),"render-icon":z(V)("trash")},null,8,["onClick","render-icon"]),p("i",Be,f(u.sequenceNumber),1)]),p("td",Me,"S/. "+f(u.amount),1)]))),128)),p("tr",Le,[n[9]||(n[9]=p("td",{class:"px-4 py-2"},"Total importe",-1)),p("td",Ue," S/. "+f(_.value.reduce((u,G)=>u+parseFloat(G.amount),0)),1)]),p("tr",null,[n[10]||(n[10]=p("td",{class:"px-4 py-2"},"Total a pagar",-1)),p("td",Fe," S/. "+f(c.value),1)]),y.value>0?(x(),N("tr",je,[p("td",He,[n[11]||(n[11]=w(" ¿Incluye matrícula? ")),p("strong",null," S/. "+f(y.value),1)]),p("td",Ke,[a(le,{disabled:!t.value.groupId,value:t.value.includeEnrollmentPrice,"onUpdate:value":[n[1]||(n[1]=u=>t.value.includeEnrollmentPrice=u),R]},null,8,["disabled","value"])])])):pe("",!0)])]),p("div",Ye,f(k()),1)]),_:1}),a(L,{span:"24"},{default:r(()=>[a(v,{size:"large",type:"primary",onClick:O,block:"",loading:m.value},{default:r(()=>n[12]||(n[12]=[w(" Realizar Matricula ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["show"]),a(Ae,{modelValue:P.value,"onUpdate:modelValue":n[3]||(n[3]=u=>P.value=u),studentId:s.studentId,onSuccess:$},null,8,["modelValue","studentId"])],64)}}}),ft=F({__name:"EditEnrollmentGroup",props:{item:{}},emits:["changeGroup","reserveEnrollment","cancelEnrollment","resetEnrollment"],setup(l,{emit:o}){const d=he(),s=o,m=l,b=async i=>{switch(i){case"change-group":s("changeGroup",m.item);break;case"reserve-enrollment":d.warning({title:"Confirmar",content:"¿Está seguro de realizar la reserva de la matrícula?",positiveText:"Reservar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"primary"},bordered:!0,onPositiveClick:async()=>{await Ce(m.item),s("reserveEnrollment",m.item)}});break;case"cancel-enrollment":d.warning({title:"Confirmar",content:"¿Está seguro de cancelar la matrícula?",positiveText:"Cancelar matrícula",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:async()=>{await Ge(m.item),s("cancelEnrollment",m.item)}});break;case"reset-enrollment":s("resetEnrollment",m.item);break}},P=T(()=>{var i,_,c,y,g;return[{label:"Cambiar grupo",key:"change-group",disabled:((i=m.item)==null?void 0:i.enrollmentStatus)!=="MATRICULADO"},{label:"Reservar matrícula",key:"reserve-enrollment",disabled:((_=m.item)==null?void 0:_.enrollmentStatus)!=="MATRICULADO"},{label:"Cancelar matrícula",key:"cancel-enrollment",disabled:((c=m.item)==null?void 0:c.enrollmentStatus)=="CANCELADO"},{label:"Reestablecer matrícula",key:"reset-enrollment",disabled:((y=m.item)==null?void 0:y.enrollmentStatus)!=="CANCELADO"&&((g=m.item)==null?void 0:g.enrollmentStatus)!=="RESERVADO"}]});return(i,_)=>{const c=H,y=xe;return x(),j(y,{trigger:"click",options:P.value,"show-arrow":!0,onSelect:b},{default:r(()=>[a(c,{"render-icon":z(V)("magicpen")},{default:r(()=>_[0]||(_[0]=[w(" Opt. ")])),_:1},8,["render-icon"])]),_:1},8,["options"])}}});export{Ae as _,Ne as a,ct as b,mt as c,ft as d,vt as e,_t as f,pt as g,gt as h,dt as i};
