import{r as A}from"./icon.utils-cRmYwSlx.js";import{az as W,d as U,r as E,e as D,j as Y,a8 as Z,a9 as j,aa as C,aI as Q,ab as r,ac as t,aB as X,aA as w,b9 as ue,ba as ie,af as c,ag as H,ae as $,aG as z,_ as L,aL as K,aY as de,aZ as pe,ah as f,ad as ce}from"./index-6z36WRcE.js";import{_ as me}from"./Alert-Bhn5U2Oz.js";import{_ as _e,a as ge}from"./FormItem-BvN8UC3U.js";import{_ as ee,a as te}from"./Col-CEDpi3Xj.js";import{_ as ve}from"./Input-vFOnlVfg.js";import{_ as fe}from"./Select-DSgE7mEA.js";import{a as ye,_ as be}from"./ListItem-CM5Pa46u.js";import{_ as Ie}from"./Thing-B9fkWCst.js";import{N as we}from"./Tag-DPGp3eOp.js";import{_ as Ee}from"./Switch-v_o_tLa3.js";import{a as he}from"./DataTable.types-BEg5m_To.js";import{u as Pe}from"./composables-gXBD4-Ya.js";import{_ as xe}from"./Dropdown-DpfSlplF.js";const h=W(),dt=async o=>{try{return(await h.post("/enrollment/load-data-table",o)).data.data}catch{return he()}},pt=async o=>{try{return{status:!0,data:(await h.post("/enrollment/module-store",{...o})).data.data}}catch{return{status:!1,data:null}}},ke=async o=>{try{return{status:!0,data:(await h.post("/enrollment/group-store",{...o})).data.data}}catch{return{status:!1,data:null}}},Se=async o=>{try{return{status:!0,data:(await h.post("/enrollment/group-update",{...o})).data.data}}catch{return{status:!1,data:null}}},Ge=async o=>{try{return{status:!0,data:(await h.post("/enrollment/group-reserved",{...o})).data.data}}catch{return{status:!1,data:null}}},Ce=async o=>{try{return{status:!0,data:(await h.post("/enrollment/group-cancel",{...o})).data.data}}catch{return{status:!1,data:null}}},Ne=async o=>{try{return{status:!0,data:(await h.post("/enrollment/enabled-groups",o)).data.data}}catch{return{status:!1,data:null}}},ct=async(o,n,d)=>{try{return(await h.post("/enrollment/student-enrollment-avaliable",{studentId:o,curriculumId:n,periodId:d})).data.data}catch{return null}},mt=async(o,n)=>{try{return{status:!0,data:(await h.post(`/enrollment/${o}/student/${n}/curriculum`)).data.data}}catch{return{status:!1,data:[]}}},_t=async o=>{try{return(await h.post("/enrollment/download-enrollment-pdf",{...o},{responseType:"blob"})).data}catch{return null}},Ve=async o=>{try{return(await h.post("/enrollment/get-enrollment-group-payments",{...o})).data.data}catch{return[]}},gt=async(o,n,d)=>{try{return(await h.post("/enrollment/student-enrollment-avaliable-special",{studentId:o,curriculumId:n,periodId:d})).data.data}catch{return null}},J=()=>({id:null,studentId:null,groupId:null,payments:[],includeEnrollmentPrice:!1}),Fe=W(),Re=async o=>{try{const n={...o};return n.paymentFile&&(n.paymentFile=await new Promise((l,m)=>{const v=new FileReader;v.readAsDataURL(n.paymentFile),v.onload=()=>l(v.result),v.onerror=m})),(await Fe.post("/payment/validate",n)).data.data}catch{return{token:null}}},Te=()=>({studentId:null,amount:null,date:null,sequenceNumber:null,paymentTypeId:7,paymentFile:null}),ze=o=>({studentId:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],amount:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:"Debe ser un número",trigger:["blur","input"],validator:(n,d)=>{if(d){if(!/^\d*\.?\d*$/.test(d))return new Error("Debe ser un número")}else return new Error("Obligatorio");return!0}}],date:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],sequenceNumber:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:o===7?"Debe tener 7 digitos":"Debe tener 6 digitos",trigger:["blur","input"],validator:(n,d)=>{if(d)if(/^\d*$/.test(d)){if(o===7&&d.length!==7)return new Error("Debe tener 7 digitos");if(o===9&&d.length!==6)return new Error("Debe tener 6 digitos")}else return new Error("Debe ser un número");else return new Error("Obligatorio");return!0}}],paymentTypeId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),Ae=U({__name:"PaymentForm",props:{modelValue:{type:Boolean},studentId:{}},emits:["update:modelValue","success"],setup(o,{emit:n}){const d=n,l=o,m=E(!1),v=D({get:()=>l.modelValue,set:P=>d("update:modelValue",P)}),x=E(null),u=E({}),g=D(()=>ze(u.value.paymentTypeId)),_=E(null),y=P=>{const p=P.target;if(!p.files||p.files.length===0){u.value.paymentFile=null;return}const N=p.files[0];if(!["image/jpeg","image/gif","image/jpg","image/png","image/webp","application/pdf"].includes(N.type)){alert("El archivo debe ser una imagen válida (JPEG, PNG, WEBP o PDF)."),u.value.paymentFile=null,p.value="";return}if(N.size>5*1024*1024){alert("El archivo no debe superar los 5 MB."),u.value.paymentFile=null,p.value="";return}u.value.paymentFile=N},b=async()=>{if(x.value&&!await x.value.validate())return;u.value.studentId=l.studentId,m.value=!0;const P=await Re(u.value);P.token!==null&&(v.value=!1,d("success",{token:P.token,payment:u.value})),m.value=!1},s=()=>{console.log("Inicializando formulario"),u.value=Object.assign({},Te())};return Y(v,P=>{P&&s()}),(P,p)=>{const N=Z("LnxIcon"),O=ue,B=me,F=ve,V=ge,k=te,M=fe,e=H,a=ee,S=_e,G=X,R=Q;return C(),j(R,{show:v.value,"onUpdate:show":p[4]||(p[4]=I=>v.value=I)},{default:r(()=>[t(G,{style:{width:"500px"},title:"REGISTRAR PAGO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:r(()=>[t(B,{title:"¡Importante!",type:"default",class:"mb-4"},{icon:r(()=>[t(O,null,{default:r(()=>[t(N,{"icon-name":"information",size:"20"})]),_:1})]),default:r(()=>[p[5]||(p[5]=w(" Solo se validan pagos realizados, con un día de anticipación. "))]),_:1}),t(S,{ref_key:"formRef",ref:x,model:u.value,rules:g.value,size:"large",onKeydown:ie(b,["enter"])},{default:r(()=>[t(a,{gutter:[16,16]},{default:r(()=>[t(k,{span:"12"},{default:r(()=>[t(V,{path:"amount",label:"Monto"},{default:r(()=>[t(F,{value:u.value.amount,"onUpdate:value":p[0]||(p[0]=I=>u.value.amount=I)},null,8,["value"])]),_:1})]),_:1}),t(k,{span:"12"},{default:r(()=>[t(V,{path:"date",label:"Fecha de pago"},{default:r(()=>[t(F,{placeholder:"",type:"date",value:u.value.date,"onUpdate:value":p[1]||(p[1]=I=>u.value.date=I)},null,8,["value"])]),_:1})]),_:1}),t(k,{span:"12"},{default:r(()=>[t(V,{path:"sequenceNumber",label:"Secuencia"},{default:r(()=>[t(F,{value:u.value.sequenceNumber,"onUpdate:value":p[2]||(p[2]=I=>u.value.sequenceNumber=I)},null,8,["value"])]),_:1})]),_:1}),t(k,{span:"12"},{default:r(()=>[t(V,{path:"paymentTypeId",label:"Metodo de pago"},{default:r(()=>[t(M,{"virtual-scroll":!1,value:u.value.paymentTypeId,"onUpdate:value":p[3]||(p[3]=I=>u.value.paymentTypeId=I),placeholder:"Metodo de pago",options:[{label:"BN - VENTANILLA",value:7},{label:"BN - PAGALO.PE",value:9}]},null,8,["value"])]),_:1})]),_:1}),t(k,{span:"24"},{default:r(()=>[t(V,{path:"paymentFile",label:"Archivo de pago"},{default:r(()=>[c("input",{class:"border w-full p-2 rounded",ref_key:"fileInput",ref:_,onChange:y,"show-button":!1,accept:"image/*,application/pdf",type:"file",placeholder:""},null,544)]),_:1})]),_:1}),t(k,{span:"24"},{default:r(()=>[t(e,{loading:m.value,secondary:"",type:"primary",onClick:b,block:"","render-icon":$(A)("money-tick")},{default:r(()=>p[6]||(p[6]=[w(" Validar Pago ")])),_:1},8,["loading","render-icon"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"])}}}),De={class:"wrapper-list-groups"},$e={class:"table-auto w-full"},Oe={class:"px-4 py-2 flex items-center"},Be={class:"ms-2"},Me={class:"text-end px-4 py-2"},qe={class:"border-b-2 border-gray-500"},Le={class:"px-4 py-2 font-bold text-lg text-end"},Ue={class:"px-4 py-2 font-bold text-lg text-end"},je={key:0,class:"bg-gray-100"},He={class:"px-4 py-2"},Ke={class:"px-4 py-2 font-bold text-lg text-end"},Je={class:"text-red-500 text-sm text-end text-sm"},vt=U({__name:"EnrollmentGroupForm",props:{modelValue:{type:Boolean},isSpecial:{type:Boolean},studentId:{},curriculumId:{},periodId:{},courseId:{},enrollmetGroup:{}},emits:["update:modelValue","success"],setup(o,{emit:n}){const d=n,l=o,m=E(!1),v=D({get:()=>l.modelValue,set:e=>d("update:modelValue",e)}),x=E(!1),u=E([]),g=E([]),_=E(0),y=E(0),b=E(0),s=E(Object.assign({},{...J()})),P=e=>{e?_.value=Number(b.value)+Number(y.value):_.value=Number(b.value)},p=e=>{s.value.payments.push(e.token),g.value.push({token:e.token,amount:e.payment.amount,sequenceNumber:e.payment.sequenceNumber})},N=e=>{s.value.groupId&&s.value.groupId!=e.id?(s.value.groupId=e.id,y.value=e.enrollmentPrice,b.value=e.groupPrice,l.enrollmetGroup?l.enrollmetGroup.withEnrollment?(s.value.includeEnrollmentPrice=!0,_.value=e.groupPrice+e.enrollmentPrice):(s.value.includeEnrollmentPrice=!1,_.value=e.groupPrice):(s.value.includeEnrollmentPrice=e.requireEnrollmentPrice,_.value=e.price)):s.value.groupId==e.id?(s.value.groupId=null,_.value=0,y.value=0,b.value=0,s.value.includeEnrollmentPrice=!1):(s.value.groupId=e.id,y.value=e.enrollmentPrice,b.value=e.groupPrice,l.enrollmetGroup?l.enrollmetGroup.withEnrollment?(s.value.includeEnrollmentPrice=!0,_.value=e.groupPrice+e.enrollmentPrice):(s.value.includeEnrollmentPrice=!1,_.value=e.groupPrice):(s.value.includeEnrollmentPrice=e.requireEnrollmentPrice,_.value=e.price))},O=async()=>{const e=await Ne({studentId:l.studentId,curriculumId:l.curriculumId,courseId:l.courseId,isSpecial:l.isSpecial,periodId:l.periodId});u.value=e.data},B=e=>{let S=g.value[e].token;g.value.splice(e,1);let G=s.value.payments.find(I=>I===S);if(!G)return;let R=s.value.payments.indexOf(G);s.value.payments.splice(R,1)},F=()=>g.value.reduce((a,S)=>a+parseFloat(S.amount),0)>=_.value?null:"El monto pagado es menor al total",V=async()=>{var e;if(s.value.studentId=l.studentId,m.value=!0,(e=l.enrollmetGroup)!=null&&e.id){(await Se({...s.value,isSpecial:l.isSpecial,periodId:l.periodId})).status&&(d("success"),v.value=!1),m.value=!1;return}else(await ke({...s.value,isSpecial:l.isSpecial,periodId:l.periodId})).status&&(d("success"),v.value=!1),m.value=!1},k=async e=>{g.value=await Ve({id:e})},M=async()=>{if(g.value=[],s.value=J(),s.value.payments=[],s.value.groupId=null,_.value=0,await O(),l.enrollmetGroup){let e=u.value.find(a=>a.id==l.enrollmetGroup.groupId);e&&(s.value.groupId=e.id,_.value=e.price,y.value=e.enrollmentPrice,b.value=e.groupPrice,s.value.includeEnrollmentPrice=l.enrollmetGroup.withEnrollment,s.value.includeEnrollmentPrice||(_.value=Number(b.value))),s.value.id=l.enrollmetGroup.id,await k(l.enrollmetGroup.id),g.value.length>0&&g.value.forEach(a=>{s.value.payments.push(a.token)})}console.log("Inicializando formulario")};return Y(v,e=>{e&&M()}),(e,a)=>{const S=we,G=H,R=Ie,I=be,ne=ye,q=te,ae=Z("LnxIcon"),le=Ee,re=ee,oe=X,se=Q;return C(),z(L,null,[t(se,{show:v.value,"onUpdate:show":a[2]||(a[2]=i=>v.value=i)},{default:r(()=>[t(oe,{style:{width:"500px"},title:e.isSpecial?"Matricula Especial":"Matricula Regular",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:r(()=>[t(re,{gutter:[16,16]},{default:r(()=>[t(q,{span:"24"},{default:r(()=>[c("div",De,[t(ne,{hoverable:"",clickable:""},{header:r(()=>{var i;return[w(" Grupos aperturados ("+f((i=u.value)!=null&&i.length?u.value.length:0)+") ",1)]}),default:r(()=>[(C(!0),z(L,null,K(u.value,i=>(C(),j(I,{key:i.id,class:de({"item-selected":s.value.groupId==i.id}),extra:i.price},{default:r(()=>[t(R,{onClick:T=>N(i)},pe({header:r(()=>[t(S,{bordered:!1,type:i.modality=="VIRTUAL"?"info":"success",size:"small"},{default:r(()=>[w(f(i.modality),1)]),_:2},1032,["type"]),w(" "+f(`${i.group} - S/. ${i.price}`),1)]),default:r(()=>[a[4]||(a[4]=w(" Min.: ")),c("b",null,f(i.minStudents),1),a[5]||(a[5]=w(" | Matriculados: ")),c("b",null,f(i.enrolledStudents),1),a[6]||(a[6]=w(" | Reservados: ")),c("b",null,f(i.reservedStudents),1),a[7]||(a[7]=c("br",null,null,-1)),t(S,{bordered:!1,type:"info",size:"small"},{default:r(()=>[c("strong",null,f(i.schedules.days)+" - "+f(i.schedules.startHour)+" a "+f(i.schedules.endHour),1)]),_:2},1024)]),_:2},[s.value.groupId==i.id?{name:"header-extra",fn:r(()=>[t(G,{circle:"",type:"warning","render-icon":$(A)("verify")},null,8,["render-icon"])]),key:"0"}:void 0]),1032,["onClick"])]),_:2},1032,["class","extra"]))),128))]),_:1})])]),_:1}),t(q,{span:"24"},{default:r(()=>[c("span",{role:"button",onClick:a[0]||(a[0]=i=>x.value=!0),class:"border border-dashed border-gray-300 p-4 rounded-sm flex items-center justify-center cursor-pointer text-gray-400 hover:bg-gray-50 font-bold hover:text-gray-500 mb-4"},[t(ae,{class:"me-3","icon-name":"money-add",size:"20"}),a[8]||(a[8]=w(" Agregar pago "))]),c("table",$e,[c("tbody",null,[(C(!0),z(L,null,K(g.value,(i,T)=>(C(),z("tr",{key:T,class:"border-b border-gray-300 border-dashed px-4 py-2"},[c("td",Oe,[t(G,{type:"error",size:"small",secondary:"",onClick:We=>B(T),"render-icon":$(A)("trash")},null,8,["onClick","render-icon"]),c("i",Be,f(i.sequenceNumber),1)]),c("td",Me,"S/. "+f(i.amount),1)]))),128)),c("tr",qe,[a[9]||(a[9]=c("td",{class:"px-4 py-2"},"Total importe",-1)),c("td",Le," S/. "+f(g.value.reduce((i,T)=>i+parseFloat(T.amount),0)),1)]),c("tr",null,[a[10]||(a[10]=c("td",{class:"px-4 py-2"},"Total a pagar",-1)),c("td",Ue," S/. "+f(_.value),1)]),y.value>0?(C(),z("tr",je,[c("td",He,[a[11]||(a[11]=w(" ¿Incluye matrícula? ")),c("strong",null," S/. "+f(y.value),1)]),c("td",Ke,[t(le,{disabled:!s.value.groupId,value:s.value.includeEnrollmentPrice,"onUpdate:value":[a[1]||(a[1]=i=>s.value.includeEnrollmentPrice=i),P]},null,8,["disabled","value"])])])):ce("",!0)])]),c("div",Je,f(F()),1)]),_:1}),t(q,{span:"24"},{default:r(()=>[t(G,{size:"large",type:"primary",onClick:V,block:"",loading:m.value},{default:r(()=>a[12]||(a[12]=[w(" Realizar Matricula ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["show"]),t(Ae,{modelValue:x.value,"onUpdate:modelValue":a[3]||(a[3]=i=>x.value=i),studentId:l.studentId,onSuccess:p},null,8,["modelValue","studentId"])],64)}}}),ft=U({__name:"EditEnrollmentGroup",props:{item:{}},emits:["changeGroup","reserveEnrollment","cancelEnrollment","resetEnrollment"],setup(o,{emit:n}){const d=Pe(),l=n,m=o,v=async u=>{switch(u){case"change-group":l("changeGroup",m.item);break;case"reserve-enrollment":d.warning({title:"Confirmar",content:"¿Está seguro de realizar la reserva de la matrícula?",positiveText:"Reservar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"primary"},bordered:!0,onPositiveClick:async()=>{await Ge(m.item),l("reserveEnrollment",m.item)}});break;case"cancel-enrollment":d.warning({title:"Confirmar",content:"¿Está seguro de cancelar la matrícula?",positiveText:"Cancelar matrícula",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:async()=>{await Ce(m.item),l("cancelEnrollment",m.item)}});break;case"reset-enrollment":l("resetEnrollment",m.item);break}},x=D(()=>{var u,g,_,y,b;return[{label:"Cambiar grupo",key:"change-group",disabled:((u=m.item)==null?void 0:u.enrollmentStatus)!=="MATRICULADO"},{label:"Reservar matrícula",key:"reserve-enrollment",disabled:((g=m.item)==null?void 0:g.enrollmentStatus)!=="MATRICULADO"},{label:"Cancelar matrícula",key:"cancel-enrollment",disabled:((_=m.item)==null?void 0:_.enrollmentStatus)=="CANCELADO"},{label:"Reestablecer matrícula",key:"reset-enrollment",disabled:((y=m.item)==null?void 0:y.enrollmentStatus)!=="CANCELADO"&&((b=m.item)==null?void 0:b.enrollmentStatus)!=="RESERVADO"}]});return(u,g)=>{const _=H,y=xe;return C(),j(y,{trigger:"click",options:x.value,"show-arrow":!0,onSelect:v},{default:r(()=>[t(_,{"render-icon":$(A)("magicpen")},{default:r(()=>g[0]||(g[0]=[w(" Opt. ")])),_:1},8,["render-icon"])]),_:1},8,["options"])}}});export{Ae as _,Ne as a,pt as b,mt as c,ft as d,vt as e,_t as f,ct as g,gt as h,dt as i};
