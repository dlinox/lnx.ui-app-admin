import{ay as Y,d as D,r as p,a7 as Z,aF as $,a9 as y,a8 as T,ab as a,aa as t,az as w,af as ee,aA as W,ae as d,_ as L,aT as te,ag as S,ac as ae,aH as oe,h as ne,aI as le,aJ as se,ad as j,aG as re}from"./index-Mm-w-23V.js";import{a as ie,i as N}from"./DataTable.types-BEg5m_To.js";import{_ as ue}from"./ButtonGroup-Df2NGmyL.js";import{_ as de}from"./Table-D8_vIWlF.js";import{_ as pe}from"./Space-aSEcdxs0.js";import{_ as ce,a as me}from"./FormItem-Ck8B0f5W.js";import{_ as q,a as F}from"./Col-DSV9bJWa.js";import{_ as G}from"./Input-Dcwlxepe.js";import{d as _e}from"./debounce.utils-DqPPCsFD.js";import{_ as ge}from"./DataTable-D0CufK-E.js";import"./get-CmkOQxkd.js";import"./Suffix-CqsLXtUP.js";import"./use-merged-state-BlrC8VEx.js";import"./Tooltip-EMVPpn5m.js";import"./Popover-DJdlSI1t.js";import"./Dropdown-DhS2jsXU.js";import"./Select-BgP3DZgt.js";import"./Tag-hxCWo2xn.js";const I=Y(),B="/academic-records",fe=async l=>{try{return(await I.post(`${B}/load-data-table`,l)).data.data}catch{return ie()}},O=async l=>{try{const r=await I.post(`${B}/get-record-pdf/${l}`,{},{responseType:"blob"}),u=new Blob([r.data],{type:"application/pdf"}),i=window.URL.createObjectURL(u),o=document.createElement("a"),s=new Date().getTime();return o.href=i,o.download=`reporte-academico-${l}-${s}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(i),!0}catch{return null}},ve=async l=>{try{const r=await I.post(`${B}/print-record-pdf`,l,{responseType:"blob"}),u=new Blob([r.data],{type:"application/pdf"}),i=window.URL.createObjectURL(u),o=document.createElement("a"),s=new Date().getTime();return o.href=i,o.download=`reporte-academico-${s}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(i),!0}catch{return null}},be=D({__name:"DataTableOp",props:{item:{}},emits:["edit","delete","success"],setup(l,{emit:r}){const u=r,o=p(l.item.records),s=p(!1),f=p(!1),m=p(!1),g=p(null),v=p({id:null,code:null}),C=p(null),h=p({code:{required:!0,trigger:["input","blur"],message:"Campo requerido"}}),P=c=>{s.value=!s.value,v.value.id=c.id,v.value.code=c.code},k=async()=>{g.value&&await g.value.validate()&&(await ve(v.value),s.value=!1,f.value=!1,u("success")),m.value=!1},x=async(c,e)=>{if(e===null){m.value=!0,await O(c),m.value=!1;return}o.value[e].loading=!0,await O(c),o.value[e].loading=!1};return(c,e)=>{const b=Z("LnxIcon"),_=ee,R=ue,M=de,V=pe,A=W,E=oe,H=G,J=me,K=F,Q=q,X=ce;return y(),$(L,null,[o.value.length>1?(y(),T(_,{key:0,onClick:e[0]||(e[0]=n=>f.value=!0)},{icon:t(()=>[a(b,{"icon-name":"task",size:"20"})]),default:t(()=>[e[9]||(e[9]=w(" Registros "))]),_:1})):(y(),T(R,{key:1},{default:t(()=>[a(_,{onClick:e[1]||(e[1]=n=>x(o.value[0].id,null)),loading:m.value},{icon:t(()=>[a(b,{"icon-name":"document-download",size:"20"})]),default:t(()=>[e[10]||(e[10]=w(" Ver "))]),_:1},8,["loading"]),a(_,{onClick:e[2]||(e[2]=n=>P(o.value[0])),loading:m.value},{icon:t(()=>[a(b,{"icon-name":"printer",size:"20"})]),default:t(()=>[e[11]||(e[11]=w(" Imprimir "))]),_:1},8,["loading"])]),_:1})),a(E,{show:f.value,"onUpdate:show":e[4]||(e[4]=n=>f.value=n)},{default:t(()=>[a(A,{style:{width:"600px"},role:"dialog","aria-modal":"true",segmented:{content:!0,footer:!0},size:"small"},{footer:t(()=>[a(V,{justify:"end"},{default:t(()=>[a(_,{class:"",onClick:e[3]||(e[3]=n=>f.value=!1)},{default:t(()=>e[15]||(e[15]=[w(" Cerrar ")])),_:1})]),_:1})]),default:t(()=>[a(M,{bordered:!1,"single-line":!1,size:"small"},{default:t(()=>[e[14]||(e[14]=d("thead",null,[d("tr",null,[d("th",{width:"160px"},"Fecha del registro"),d("th",{width:"160px"},"Código"),d("th",null,"Observaciones"),d("th",{width:"120px"})])],-1)),d("tbody",null,[(y(!0),$(L,null,te(o.value,(n,z)=>(y(),$("tr",{key:z},[d("td",null,S(n.createdAt),1),d("td",null,S(n.code),1),d("td",null,S(n.observations),1),d("td",null,[a(R,null,{default:t(()=>[a(_,{onClick:U=>x(n.id,z),loading:n.loading},{icon:t(()=>[a(b,{"icon-name":"document-download",size:"20"})]),default:t(()=>[e[12]||(e[12]=w(" Ver "))]),_:2},1032,["onClick","loading"]),n.isEnabled?(y(),T(_,{key:0,onClick:U=>P(n),loading:n.loading},{icon:t(()=>[a(b,{"icon-name":"printer",size:"20"})]),default:t(()=>[e[13]||(e[13]=w(" Imprimir "))]),_:2},1032,["onClick","loading"])):ae("",!0)]),_:2},1024)])]))),128))])]),_:1})]),_:1})]),_:1},8,["show"]),a(E,{show:s.value,"onUpdate:show":e[8]||(e[8]=n=>s.value=n)},{default:t(()=>[a(A,{style:{width:"400px"},role:"dialog","aria-modal":"true",segmented:{content:!0,footer:!0},size:"small",title:"Imprimir Acta"},{footer:t(()=>[a(V,{justify:"end"},{default:t(()=>[a(_,{tertiary:"",size:"large",onClick:e[7]||(e[7]=n=>s.value=!1),disabled:m.value},{default:t(()=>e[16]||(e[16]=[w(" Cancelar ")])),_:1},8,["disabled"]),a(_,{size:"large",type:"primary",onClick:k,loading:m.value},{default:t(()=>e[17]||(e[17]=[w(" Guardar ")])),_:1},8,["loading"])]),_:1})]),default:t(()=>[a(X,{ref_key:"formPrintRef",ref:g,model:v.value,rules:h.value,size:"large"},{default:t(()=>[a(Q,{gutter:16},{default:t(()=>[a(K,{span:"24"},{default:t(()=>{var n;return[a(J,{path:"code",label:"Codigo",feedback:(n=C.value)==null?void 0:n.code},{default:t(()=>{var z;return[a(H,{type:"text",value:v.value.code,"onUpdate:value":[e[5]||(e[5]=U=>v.value.code=U),e[6]||(e[6]=()=>C.value!=null?C.value.code=null:()=>{})],status:((z=C.value)==null?void 0:z.code)!=null?"error":"",clearable:"",placeholder:"Ingrese observaciones"},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"])],64)}}}),we=l=>[{title:"Registros",key:"records",fixed:"left",width:"120px",render(r){return ne(be,{item:r,onSuccess:()=>{l()}},{default:()=>"Editar"})}},{title:"Grupo",key:"group",minWidth:"50px"},{title:"Curso",key:"course",minWidth:"120px"},{title:"Docente",key:"teacher",minWidth:"120px"},{title:"Periodo",key:"period",minWidth:"120px"},{title:"Cod. Acta",key:"recordCodes",minWidth:"80px"},{title:"Ultimo registro",key:"lastCreatedAt",minWidth:"140px"}],ye=(l=N())=>({page:l.page,total:l.total,pageSize:l.pageSize,pageCount:l.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${l.total} registros`}}),ke={style:{"border-bottom":"1px solid #e9e9e9"}},Ce=D({__name:"DataTable",setup(l){const r=p(!1),u=p([]),i=le({...N()}),o=p({search:null,page:i.page,pageSize:i.pageSize}),s=p({}),f=p([]),m=async()=>{o.value.page=1,await g()},g=async()=>{r.value=!0,s.value=await fe(o.value),u.value=s.value.data,i.total=s.value.total,i.pageSize=s.value.per_page,i.page=s.value.current_page,i.pageCount=s.value.last_page,r.value=!1},v=_e(()=>{m()},400),C=async k=>{o.value.page=k,await g()},h=async k=>{o.value.page=1,o.value.pageSize=k,await g()};return(async()=>{f.value=we(g),await g()})(),(k,x)=>{const c=F,e=G,b=q,_=ge;return y(),$("div",ke,[a(b,{gutter:12,style:{padding:"12px 16px"}},{default:t(()=>[a(c,{span:12}),a(c,{span:12},{default:t(()=>[a(e,{size:"large",placeholder:"Buscar",value:o.value.search,"onUpdate:value":x[0]||(x[0]=R=>o.value.search=R),onInput:j(v),clearable:""},{suffix:t(()=>[a(re,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),a(b,null,{default:t(()=>[a(c,{span:24},{default:t(()=>[a(_,{key:"id",remote:"","single-line":!1,columns:f.value,data:u.value,pagination:j(ye)(i),"pagination-show-size-picker":!0,loading:r.value,"onUpdate:page":C,"onUpdate:pageSize":h},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),se(k.$slots,"extra",{reLoadDataTable:m})])}}}),We=D({__name:"AcademicRecordView",setup(l){return(r,u)=>{const i=W;return y(),$(L,null,[a(i,{segmented:{header:!0,content:!0}},{header:t(()=>u[0]||(u[0]=[d("span",{class:"text-sm text-slate-500"}," Registro de actas académicas ",-1),d("h5",{class:"text-lg font-bold text-slate-800"},"Actas académicas",-1)])),"header-extra":t(()=>u[1]||(u[1]=[])),_:1}),a(Ce)],64)}}});export{We as default};
