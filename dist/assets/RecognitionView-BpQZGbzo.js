import{r as N}from"./icon.utils-DutMd2qr.js";import{d as q}from"./debounce.utils-DqPPCsFD.js";import{j as ne}from"./student.services-CbdSJW83.js";import{az as le,d as E,e as se,r as u,j as re,a9 as $,aa as S,ab as t,ac as e,aB as G,ae as b,ag as P,aA as B,aI as ue,a3 as W,ad as j,aH as H,h as ie,a5 as ce,aJ as de,aG as J,_ as K,af as F,aK as pe,a8 as me}from"./index-DwV6zJCX.js";import{a as _e,i as L}from"./DataTable.types-BEg5m_To.js";import"./course.services-C1VsE4cb.js";import{_ as ge,a as ve}from"./FormItem-CNNyqOT9.js";import{_ as Q,a as X}from"./Col-BkVWW8vc.js";import{_ as fe}from"./Select-B-XafpkT.js";import{_ as ye}from"./Space-DEwGxh3N.js";import{u as be}from"./composables-OPWM5oN5.js";import{_ as Ie}from"./Dropdown-CxNUQKFj.js";import{_ as we}from"./Input-DldL4MyO.js";import{_ as he}from"./DataTable-DqW2qosf.js";import"./get-CqIzH_zz.js";import"./Popover-BpepRpqO.js";import"./use-merged-state-B_X6BK0G.js";import"./Suffix-B52V2l9z.js";import"./Tag-tDmUe03M.js";import"./get-slot-Bk_rJcZu.js";import"./Tooltip-B687EG_W.js";const C=le(),z="recognition",xe=async n=>{try{return(await C.post(`${z}/load-data-table`,n)).data.data}catch{return _e()}},Se=async n=>{try{return{status:!0,data:(await C.post(`${z}`,n)).data.data}}catch(l){return l.response.status===422?{status:!1,data:l.response.data.errors}:{status:!1,data:null}}},Ce=async n=>{try{return await C.delete(`${z}`,{data:n}),!0}catch{return!1}},ze=async n=>{try{return(await C.get(`${z}/module-enrollments/items/for-select/${n}`)).data.data}catch{return[]}},ke=async n=>{try{return(await C.post(`${z}/courses-by-module/items/for-select`,n)).data.data}catch{return[]}},Re=async n=>{try{return(await C.get(`${z}/course-extracurriculars-by-student/items/for-select/${n}`)).data.data}catch{return[]}},A=()=>({id:null,moduleId:null,studentId:null,courseId:null,courseRecognitionId:null,observation:null}),Ve=()=>({moduleId:[{type:"number",required:!0,message:"Obligatório"}],studentId:[{type:"number",required:!0,message:"Obligatório"}],courseId:[{type:"number",required:!0,message:"Obligatório"}],courseRecognitionId:[{type:"number",required:!0,message:"Obligatório"}],observation:[]}),Y=E({__name:"Form",props:{item:{},modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(n,{emit:l}){const i=l,I=n,m=se({get:()=>I.modelValue,set:r=>i("update:modelValue",r)}),s=u(!1),d=u(null),a=u({...A()}),c=u(null),p=u({...Ve()}),w=u([]),k=u([]),f=u([]),g=u([]),O=async r=>{if(console.log(r),r){const o=await ne({search:r});w.value=o}else w.value=[]},T=async r=>{f.value=await Re(r)},U=async()=>{if(a.value.moduleId=null,a.value.courseRecognitionId=null,a.value.courseId=null,!a.value.studentId){k.value=[],f.value=[],g.value=[];return}k.value=await ze(a.value.studentId),await T(a.value.studentId)},D=async()=>{if(!a.value.moduleId){g.value=[];return}g.value=await ke({moduleId:a.value.moduleId,studentId:a.value.studentId})},v=q(r=>{O(r)},400),h=async()=>{if(c.value=null,d.value){const r=await d.value.validate();let o=null;r?(s.value=!0,o=await Se(a.value),o.status?(i("success"),m.value=!1):c.value=o.data):console.log("Formulario inválido")}s.value=!1},R=async()=>{console.log("Inicializando formulario"),a.value={...A()}};return re(m,r=>{r&&R()}),(r,o)=>{const x=fe,y=ve,V=X,Z=Q,ee=ge,M=P,te=ye,ae=G,oe=ue;return S(),$(oe,{show:m.value,"onUpdate:show":o[5]||(o[5]=_=>m.value=_)},{default:t(()=>[e(ae,{style:{width:"600px"},title:r.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:t(()=>[e(te,{justify:"end"},{default:t(()=>[e(M,{tertiary:"",size:"large",onClick:o[4]||(o[4]=_=>m.value=!1),disabled:s.value},{default:t(()=>o[6]||(o[6]=[B(" Cancelar ")])),_:1},8,["disabled"]),e(M,{size:"large",type:"primary",onClick:h,loading:s.value},{default:t(()=>o[7]||(o[7]=[B("Guardar")])),_:1},8,["loading"])]),_:1})]),default:t(()=>[e(ee,{ref_key:"formRef",ref:d,model:a.value,rules:p.value,size:"large"},{default:t(()=>[e(Z,{gutter:16},{default:t(()=>[e(V,{span:"24"},{default:t(()=>[e(y,{path:"studentId",label:"Estudiante"},{default:t(()=>[e(x,{placeholder:"Seleccione un estudiante",value:a.value.studentId,"onUpdate:value":[o[0]||(o[0]=_=>a.value.studentId=_),U],options:w.value,"virtual-scroll":!1,onSearch:b(v),remote:"",filterable:"",clearable:""},null,8,["value","options","onSearch"])]),_:1})]),_:1}),e(V,{span:"24"},{default:t(()=>[e(y,{path:"moduleId",label:"Módulo"},{default:t(()=>[e(x,{placeholder:"Seleccione un módulo",value:a.value.moduleId,"onUpdate:value":[o[1]||(o[1]=_=>a.value.moduleId=_),D],options:k.value,"virtual-scroll":!1,clearable:"",filterable:""},null,8,["value","options"])]),_:1})]),_:1}),e(V,{span:"24"},{default:t(()=>[e(y,{path:"courseRecognitionId",label:"Curso origen"},{default:t(()=>[e(x,{placeholder:"Seleccione un curso",value:a.value.courseRecognitionId,"onUpdate:value":o[2]||(o[2]=_=>a.value.courseRecognitionId=_),options:g.value,"virtual-scroll":!1,clearable:"","onUpdate:modelValue":()=>{}},null,8,["value","options"])]),_:1})]),_:1}),e(V,{span:"24"},{default:t(()=>[e(y,{path:"courseId",label:"	Curso convalidado -  Especial / Extracurricular"},{default:t(()=>[e(x,{placeholder:"Seleccione un curso",value:a.value.courseId,"onUpdate:value":o[3]||(o[3]=_=>a.value.courseId=_),options:f.value,"virtual-scroll":!1,clearable:"","onUpdate:modelValue":()=>{}},null,8,["value","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),$e=E({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(n,{emit:l}){const{hasPermission:i}=W(),I=be(),m=l,s=[{label:"Eliminar",key:"delete",icon:N("trash","red"),show:i(["recognition.delete"]),props:{style:{color:"red"},onClick:()=>{I.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{m("delete")}})}}}];return(d,a)=>{const c=P,p=Ie;return b(i)(["recognition.delete"])?(S(),$(p,{key:0,options:s,placement:"bottom-start"},{default:t(()=>[e(c,null,{default:t(()=>[e(H,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})):j("",!0)}}}),Ee=n=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(l){const i=l;return ie($e,{onDelete:()=>{n(i)},item:i},{default:()=>"Editar"})}},{title:"Estudiante",key:"student",minWidth:"200px"},{title:"Módulo",key:"module",minWidth:"200px"},{title:"Curso origen",key:"courseRecognition",minWidth:"200px"},{title:"Curso convalidado",key:"course",minWidth:"200px"},{title:"Observación",key:"observation",minWidth:"300px"}],Oe=(n=L())=>({page:n.page,total:n.total,pageSize:n.pageSize,pageCount:n.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${n.total} registros`}}),Te={style:{"border-bottom":"1px solid #e9e9e9"}},Ue=E({__name:"DataTable",setup(n){const l=ce(),i=u(!1),I=u([]),m=u(!1),s=u(null),d=de({...L()}),a=u(""),c=u({search:null,page:d.page,pageSize:d.pageSize}),p=u({}),k=Ee(async v=>{await Ce(v),await f()}),f=async()=>{c.value.page=1,await g()},g=async()=>{i.value=!0,c.value.filters={curriculumId:a.value},p.value=await xe(c.value),I.value=p.value.data,d.total=p.value.total,d.pageSize=p.value.per_page,d.page=p.value.current_page,d.pageCount=p.value.last_page,i.value=!1},O=q(()=>{f()},400),T=async v=>{c.value.page=v,await g()},U=async v=>{c.value.page=1,c.value.pageSize=v,await g()};return(async()=>{a.value=l.params.id??"",await g()})(),(v,h)=>{const R=X,r=we,o=Q,x=he;return S(),J(K,null,[F("div",Te,[e(o,{gutter:12,style:{padding:"12px 16px"}},{default:t(()=>[e(R,{span:12}),e(R,{span:12},{default:t(()=>[e(r,{size:"large",placeholder:"Buscar",value:c.value.search,"onUpdate:value":h[0]||(h[0]=y=>c.value.search=y),onInput:b(O),clearable:""},{suffix:t(()=>[e(H,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),e(o,null,{default:t(()=>[e(R,{span:24},{default:t(()=>[e(x,{key:"id",remote:"",size:"small","single-line":!1,columns:b(k),data:I.value,pagination:b(Oe)(d),"pagination-show-size-picker":!0,loading:i.value,"onUpdate:page":T,"onUpdate:pageSize":U},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),pe(v.$slots,"extra",{reLoadDataTable:f})]),e(Y,{modelValue:m.value,"onUpdate:modelValue":h[1]||(h[1]=y=>m.value=y),item:s.value,onSuccess:f},null,8,["modelValue","item"])],64)}}}),at=E({__name:"RecognitionView",setup(n){const{hasPermission:l}=W(),i=u(!1);return(async()=>{})(),(m,s)=>{const d=P,a=G,c=me("AppNotAuthorization");return b(l)(["recognition.create","recognition.delete"])?(S(),J(K,{key:0},[e(a,{segmented:{header:!0,content:!0}},{header:t(()=>s[2]||(s[2]=[F("span",{class:"text-sm text-slate-500"},"Gestión de convalidaciones ",-1),F("h5",{class:"text-lg font-bold text-slate-800"},"Convalidaciones",-1)])),"header-extra":t(()=>[b(l)(["recognition.create"])?(S(),$(d,{key:0,type:"primary",size:"small","render-icon":b(N)("additem"),onClick:s[0]||(s[0]=p=>i.value=!0)},{default:t(()=>s[3]||(s[3]=[B(" Agregar ")])),_:1},8,["render-icon"])):j("",!0)]),_:1}),e(Ue,null,{extra:t(({reLoadDataTable:p})=>[e(Y,{modelValue:i.value,"onUpdate:modelValue":s[1]||(s[1]=w=>i.value=w),item:null,onSuccess:p},null,8,["modelValue","onSuccess"])]),_:1})],64)):(S(),$(c,{key:1}))}}});export{at as default};
