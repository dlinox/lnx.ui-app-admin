import{i as ae,a as ve}from"./DataTable.types-BEg5m_To.js";import{d as H,a3 as fe,e as N,a9 as T,ad as P,ae as k,aa as O,ab as o,ac as l,ag as L,aH as te,h as Z,az as _e,r as f,j as le,aB as oe,aA as G,aI as ne,aJ as ge,aG as be,_ as we,af as ye,aK as Ie}from"./index-CTX32WvQ.js";import{r as ee}from"./icon.utils-72mRZSRr.js";import{u as he}from"./composables-D1Wne75x.js";import{_ as ke}from"./Dropdown-BaTvtVNI.js";import{_ as Se}from"./Tag-vB_kF6B0.js";import{d as q}from"./debounce.utils-DqPPCsFD.js";import{e as se,f as ue}from"./selectables.services-C8JJYSBR.js";import{_ as re,a as ie}from"./FormItem-TvXBxsfn.js";import{_ as Q,a as X}from"./Col-BZe6vIUY.js";import{_ as de}from"./Select-DwwM8esp.js";import{_ as Y}from"./Input-BFgcVtgn.js";import{_ as me}from"./Space-Cg-Z5G16.js";import{_ as pe}from"./Switch-CA1UdJhI.js";import{f as Ee}from"./role.services-BE-o7lwv.js";import{_ as Ue}from"./DataTable-5d21Xmwy.js";const ze=H({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(r,{emit:d}){const{hasPermission:m}=fe(),u=he(),_=d,g=r,I=N(()=>[{label:"Editar",key:"edit",icon:ee("edit-2"),show:g.item.roleName==="docente"?m(["user-teacher.edit"]):g.item.roleName==="estudiante"?m(["user-student.edit"]):m(["user-admin.edit"]),props:{onClick:()=>_("edit")}},{label:"Eliminar",key:"delete",icon:ee("trash","red"),show:g.item.roleName==="docente"?m(["user-teacher.delete"]):g.item.roleName==="estudiante"?m(["user-student.delete"]):m(["user-admin.delete"]),props:{style:{color:"red"},onClick:()=>{u.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{_("delete")}})}}}]);return(t,n)=>{const y=L,b=ke;return(t.item.roleName==="docente"?k(m)(["user-teacher.edit","user-teacher.delete"]):t.item.roleName==="estudiante"?k(m)(["user-student.edit","user-student.delete"]):k(m)(["user-admin.edit","user-admin.delete"]))?(O(),T(b,{key:0,options:I.value,placement:"bottom-start"},{default:o(()=>[l(y,null,{default:o(()=>[l(te,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1},8,["options"])):P("",!0)}}}),Oe=(r,d)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(m){const u=m;return Z(ze,{onEdit:()=>{r(u)},onDelete:()=>{d(u)},item:u},{default:()=>"Editar"})}},{title:"Nombre",key:"name",minWidth:"180px"},{title:"Email",key:"email",minWidth:"150px"},{title:"Usuario",key:"username",minWidth:"100px"},{title:"Rol",key:"roleName",minWidth:"100px"},{title:"Habilitado",key:"isEnabled",width:"120px",render:m=>Z(Se,{type:m.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>m.isEnabled?"	Habilitado":"Deshabilitado"})}],Ce=(r=ae())=>({page:r.page,total:r.total,pageSize:r.pageSize,pageCount:r.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${r.total} registros`}}),M=r=>({id:null,name:null,username:null,email:null,role:null,password:null,level:r,isEnabled:!0,modelId:null}),ce=(r=null)=>({modelId:[{type:"number",required:!0,trigger:["blur","change"],message:"Obligatorio"}],name:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],username:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],email:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],role:[{type:"number",required:!0,trigger:["blur","change"],message:"Obligatorio"}],password:[{required:r===null,trigger:["blur","input"],message:"Obligatorio"},{min:6,message:"Mínimo 6 caracteres",trigger:["blur","input"]}]}),R=_e(),Te=async r=>{try{return(await R.post("/user/load-data-table",r)).data.data}catch{return ve()}},Re=async r=>{try{return{status:!0,data:(await R.post("/user",r)).data.data}}catch(d){return d.response.status===422?{status:!1,data:d.response.data.errors}:{status:!1,data:null}}},Ve=async r=>{try{return await R.post("/user/account",r),!0}catch{return!1}},De=async r=>{try{return await R.put("/user/account",r),!0}catch{return!1}},$e=async r=>{try{return{status:!0,data:(await R.put("/user",r)).data.data}}catch(d){return d.response.status===422?{status:!1,data:d.response.data.errors}:{status:!1,data:null}}},xe=async r=>{try{return await R.delete("/user",{data:{id:r.id}}),!0}catch{return!1}},Be=H({__name:"UserForm",props:{item:{},level:{},modelValue:{type:Boolean},roleOptions:{}},emits:["update:modelValue","success"],setup(r,{emit:d}){const m=d,u=r,_=N({get:()=>u.modelValue,set:a=>m("update:modelValue",a)}),g=f(!1),I=f(null),t=f(M(u.level)),n=f(null),y=N(()=>({...ce(t.value.id)})),b=f([]),U=f([]),F=a=>{var v;n.value&&(n.value.modelId=null),t.value.modelId=a;let e=(v=b.value.find(p=>p.value===a))==null?void 0:v.label;e&&(t.value.name=e)},V=a=>{var v;n.value&&(n.value.modelId=null),t.value.modelId=a;let e=(v=U.value.find(p=>p.value===a))==null?void 0:v.label;e&&(t.value.name=e)},S=async()=>{if(I.value){const a=await I.value.validate();let e=null;a?(g.value=!0,t.value.id?e=await $e(t.value):e=await Re(t.value),e.status?(m("success"),_.value=!1):n.value=e.data):console.log("Formulario inválido")}g.value=!1},h=async({search:a=null,id:e=null})=>{b.value=await se({search:a,id:e})},C=async({search:a=null,id:e=null})=>{U.value=await ue({search:a,id:e})},D=q(async a=>{await h({search:a})},400),$=q(async a=>{await C({search:a})},400),A=()=>{if(console.log("Inicializando formulario"),t.value=u.item?{...u.item}:M(u.level),u.item&&u.level=="teacher"){const a=u.item.modelId;h({id:a})}if(u.item&&u.level=="student"){const a=u.item.modelId;C({id:a})}};return le(_,a=>{a&&(n.value=null,A())}),(a,e)=>{const v=de,p=ie,w=X,z=Y,E=pe,x=me,j=Q,W=re,B=L,J=oe,K=ne;return O(),T(K,{show:_.value,"onUpdate:show":e[14]||(e[14]=s=>_.value=s)},{default:o(()=>[l(J,{style:{width:"500px"},title:a.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",User:"dialog","aria-modal":"true"},{footer:o(()=>[l(x,{justify:"end"},{default:o(()=>[l(B,{tertiary:"",size:"large",onClick:e[13]||(e[13]=s=>_.value=!1),disabled:g.value},{default:o(()=>e[15]||(e[15]=[G(" Cancelar ")])),_:1},8,["disabled"]),l(B,{size:"large",type:"primary",onClick:S,loading:g.value},{default:o(()=>e[16]||(e[16]=[G("Guardar")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[l(W,{ref_key:"formRef",ref:I,model:t.value,rules:y.value,size:"large"},{default:o(()=>[l(j,null,{default:o(()=>[a.level==="teacher"?(O(),T(w,{key:0,span:"24"},{default:o(()=>{var s;return[l(p,{label:"Docente",path:"modelId",feedback:(s=n.value)==null?void 0:s.modelId},{default:o(()=>{var i;return[l(v,{value:t.value.modelId,"onUpdate:value":[e[0]||(e[0]=c=>t.value.modelId=c),F],options:b.value,filterable:"",placeholder:"Buscar docente",clearable:"",remote:"","virtual-scroll":!1,onSearch:k(D),status:((i=n.value)==null?void 0:i.modelId)!=null?"error":""},null,8,["value","options","onSearch","status"])]}),_:1},8,["feedback"])]}),_:1})):P("",!0),a.level==="student"?(O(),T(w,{key:1,span:"24"},{default:o(()=>{var s;return[l(p,{label:"Estudiante",path:"modelId",feedback:(s=n.value)==null?void 0:s.modelId},{default:o(()=>{var i;return[l(v,{value:t.value.modelId,"onUpdate:value":[e[1]||(e[1]=c=>t.value.modelId=c),V],options:U.value,filterable:"",placeholder:"Buscar estudiante",clearable:"",remote:"","virtual-scroll":!1,onSearch:k($),status:((i=n.value)==null?void 0:i.modelId)!=null?"error":""},null,8,["value","options","onSearch","status"])]}),_:1},8,["feedback"])]}),_:1})):P("",!0),l(w,{span:"24"},{default:o(()=>{var s;return[l(p,{path:"name",label:"Nombre",feedback:(s=n.value)==null?void 0:s.name},{default:o(()=>{var i;return[l(z,{status:((i=n.value)==null?void 0:i.name)!=null?"error":"",value:t.value.name,"onUpdate:value":e[2]||(e[2]=c=>t.value.name=c),onInput:e[3]||(e[3]=c=>n.value!=null?n.value.name=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),l(w,{span:"24"},{default:o(()=>{var s;return[l(p,{path:"username",label:"Usuario",feedback:(s=n.value)==null?void 0:s.username},{default:o(()=>{var i;return[l(z,{status:((i=n.value)==null?void 0:i.username)!=null?"error":"",value:t.value.username,"onUpdate:value":e[4]||(e[4]=c=>t.value.username=c),onInput:e[5]||(e[5]=c=>n.value!=null?n.value.username=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),l(w,{span:"24"},{default:o(()=>{var s;return[l(p,{path:"email",label:"Correo",feedback:(s=n.value)==null?void 0:s.email},{default:o(()=>{var i;return[l(z,{status:((i=n.value)==null?void 0:i.email)!=null?"error":"",value:t.value.email,"onUpdate:value":e[6]||(e[6]=c=>t.value.email=c),onInput:e[7]||(e[7]=c=>n.value!=null?n.value.email=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),l(w,{span:"24"},{default:o(()=>{var s;return[l(p,{path:"password",label:"Contraseña",feedback:(s=n.value)==null?void 0:s.password},{default:o(()=>{var i;return[l(z,{type:"password","show-password-on":"click",placeholder:"Contraseña",minlength:6,status:((i=n.value)==null?void 0:i.password)!=null?"error":"",value:t.value.password,"onUpdate:value":e[8]||(e[8]=c=>t.value.password=c),onInput:e[9]||(e[9]=()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),l(w,{span:"24"},{default:o(()=>{var s;return[l(p,{path:"role",label:"Rol",feedback:(s=n.value)==null?void 0:s.role},{default:o(()=>{var i;return[l(v,{status:((i=n.value)==null?void 0:i.role)!=null?"error":"",value:t.value.role,"onUpdate:value":[e[10]||(e[10]=c=>t.value.role=c),e[11]||(e[11]=c=>n.value!=null?n.value.role=null:()=>{})],placeholder:"Seleccione un rol",clearable:"",options:a.roleOptions},null,8,["status","value","options"])]}),_:1},8,["feedback"])]}),_:1}),l(w,{span:"24"},{default:o(()=>[l(x,{justify:"end"},{default:o(()=>[l(p,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:o(()=>[l(E,{value:t.value.isEnabled,"onUpdate:value":e[12]||(e[12]=s=>t.value.isEnabled=s)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ne=H({__name:"AccountUserForm",props:{item:{},level:{},modelValue:{type:Boolean},roleOptions:{}},emits:["update:modelValue","success"],setup(r,{emit:d}){const m=d,u=r,_=N({get:()=>u.modelValue,set:a=>m("update:modelValue",a)}),g=f(!1),I=f(null),t=f(M(u.level)),n=f(null),y=N(()=>({...ce(t.value.id)})),b=f([]),U=f([]),F=a=>{var v;n.value&&(n.value.modelId=null),t.value.modelId=a;let e=(v=b.value.find(p=>p.value===a))==null?void 0:v.label;e&&(t.value.name=e)},V=a=>{var v;n.value&&(n.value.modelId=null),t.value.modelId=a;let e=(v=U.value.find(p=>p.value===a))==null?void 0:v.label;e&&(t.value.name=e)},S=async()=>{if(t.value.role=u.level=="teacher"?"docente":"estudiante",t.value.level=u.level,I.value){const a=await I.value.validate();let e=null;a?(g.value=!0,t.value.id?e=await De(t.value):e=await Ve(t.value),e&&(m("success"),_.value=!1)):console.log("Formulario inválido")}g.value=!1},h=async({search:a=null,id:e=null})=>{b.value=await se({search:a,id:e})},C=async({search:a=null,id:e=null})=>{U.value=await ue({search:a,id:e})},D=q(async a=>{await h({search:a})},400),$=q(async a=>{await C({search:a})},400),A=()=>{if(console.log("Inicializando formulario"),t.value=u.item?{...u.item}:M(u.level),u.item&&u.level=="teacher"){const a=u.item.modelId;h({id:a})}if(u.item&&u.level=="student"){const a=u.item.modelId;C({id:a})}};return le(_,a=>{a&&(n.value=null,A())}),(a,e)=>{const v=de,p=ie,w=X,z=Y,E=pe,x=me,j=Q,W=re,B=L,J=oe,K=ne;return O(),T(K,{show:_.value,"onUpdate:show":e[5]||(e[5]=s=>_.value=s)},{default:o(()=>[l(J,{style:{width:"500px"},title:a.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",User:"dialog","aria-modal":"true"},{footer:o(()=>[l(x,{justify:"end"},{default:o(()=>[l(B,{tertiary:"",size:"large",onClick:e[4]||(e[4]=s=>_.value=!1),disabled:g.value},{default:o(()=>e[6]||(e[6]=[G(" Cancelar ")])),_:1},8,["disabled"]),l(B,{size:"large",type:"primary",onClick:S,loading:g.value},{default:o(()=>e[7]||(e[7]=[G("Guardar")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[l(W,{ref_key:"formRef",ref:I,model:t.value,rules:y.value,size:"large"},{default:o(()=>[l(j,null,{default:o(()=>[a.level==="teacher"?(O(),T(w,{key:0,span:"24"},{default:o(()=>{var s;return[l(p,{label:"Docente",path:"modelId",feedback:(s=n.value)==null?void 0:s.modelId},{default:o(()=>{var i;return[l(v,{disabled:!!t.value.id,value:t.value.modelId,"onUpdate:value":[e[0]||(e[0]=c=>t.value.modelId=c),F],options:b.value,filterable:"",placeholder:"Buscar docente",clearable:"",remote:"","virtual-scroll":!1,onSearch:k(D),status:((i=n.value)==null?void 0:i.modelId)!=null?"error":""},null,8,["disabled","value","options","onSearch","status"])]}),_:1},8,["feedback"])]}),_:1})):P("",!0),a.level==="student"?(O(),T(w,{key:1,span:"24"},{default:o(()=>{var s;return[l(p,{label:"Estudiante",path:"modelId",feedback:(s=n.value)==null?void 0:s.modelId},{default:o(()=>{var i;return[l(v,{value:t.value.modelId,"onUpdate:value":[e[1]||(e[1]=c=>t.value.modelId=c),V],options:U.value,filterable:"",placeholder:"Buscar estudiante",clearable:"",remote:"","virtual-scroll":!1,onSearch:k($),status:((i=n.value)==null?void 0:i.modelId)!=null?"error":""},null,8,["value","options","onSearch","status"])]}),_:1},8,["feedback"])]}),_:1})):P("",!0),l(w,{span:"24"},{default:o(()=>{var s;return[l(p,{path:"password",label:"Contraseña",feedback:(s=n.value)==null?void 0:s.password},{default:o(()=>{var i;return[l(z,{type:"password","show-password-on":"click",placeholder:"Contraseña",minlength:6,status:((i=n.value)==null?void 0:i.password)!=null?"error":"",value:t.value.password,"onUpdate:value":e[2]||(e[2]=c=>t.value.password=c)},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),l(w,{span:"24"},{default:o(()=>[l(x,{justify:"end"},{default:o(()=>[l(p,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:o(()=>[l(E,{value:t.value.isEnabled,"onUpdate:value":e[3]||(e[3]=s=>t.value.isEnabled=s)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Pe={style:{"border-bottom":"1px solid #e9e9e9"}},aa=H({__name:"DataTable",props:{level:{}},setup(r){const d=r,m=f(!1),u=f([]),_=f(!1),g=f(!1),I=f(null),t=ge({...ae()}),n=f([]),y=f({search:null,page:t.page,pageSize:t.pageSize}),b=f({}),V=Oe(a=>{I.value=a,d.level==="student"||d.level==="teacher"?_.value=!0:g.value=!0},async a=>{await xe(a),await S()}),S=async()=>{y.value.page=1,await h()},h=async()=>{m.value=!0,b.value=await Te(y.value),u.value=b.value.data,t.total=b.value.total,t.pageSize=b.value.per_page,t.page=b.value.current_page,t.pageCount=b.value.last_page,m.value=!1},C=q(()=>{S()},400),D=async a=>{y.value.page=a,await h()},$=async a=>{y.value.page=1,y.value.pageSize=a,await h()};return(async()=>{y.value.filters={level:d.level},n.value=await Ee(d.level),await h()})(),(a,e)=>{const v=X,p=Y,w=Q,z=Ue;return O(),be(we,null,[ye("div",Pe,[l(w,{gutter:12,style:{padding:"12px 16px"}},{default:o(()=>[l(v,{span:12}),l(v,{span:12},{default:o(()=>[l(p,{size:"large",placeholder:"Buscar",value:y.value.search,"onUpdate:value":e[0]||(e[0]=E=>y.value.search=E),onInput:k(C),clearable:""},{suffix:o(()=>[l(te,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),l(w,null,{default:o(()=>[l(v,{span:24},{default:o(()=>[l(z,{key:"id",remote:"",size:"small","single-line":!1,columns:k(V),data:u.value,pagination:k(Ce)(t),"pagination-show-size-picker":!0,loading:m.value,"onUpdate:page":D,"onUpdate:pageSize":$},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),Ie(a.$slots,"extra",{reLoadDataTable:S,roleOptions:n.value})]),l(Be,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=E=>g.value=E),item:I.value,level:d.level,roleOptions:n.value,onSuccess:S},null,8,["modelValue","item","level","roleOptions"]),l(Ne,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=E=>_.value=E),item:I.value,level:d.level,roleOptions:n.value,onSuccess:S},null,8,["modelValue","item","level","roleOptions"])],64)}}});export{Be as _,aa as a,Ne as b};
