import{d as de,e as ae,r as c,j as Ie,a8 as ie,aG as S,aa as p,_ as L,ac as n,ab as e,aB as ce,af as t,aL as W,a9 as w,aY as J,aZ as xe,aA as v,ah as s,ag as pe,ae as f,aI as he,a3 as ke,a5 as we,aD as Se,ad as H}from"./index-VnlbSWoD.js";import{r as ue}from"./icon.utils-D7BmKQQ8.js";import{u as Ee}from"./useBreakpoints-BH0TdeY-.js";import{_ as Ce,a as Me,b as Ne,c as $e,d as Ve,e as ze,f as Pe,g as Re}from"./EditEnrollmentGroup.vue_vue_type_script_setup_true_lang-Bndp10u3.js";import"./studentType.services-Dqx7mIxW.js";import{j as Ae}from"./student.services-CsYUJyEb.js";import"./documentType.services-CKkynVC2.js";import{_ as Fe}from"./selectables.services-BWztZSf7.js";import{u as Be}from"./period.stores-DAayIYQf.js";import{i as Ue}from"./course.services-DzKT3GWV.js";import{_ as Le,a as Oe}from"./FormItem-wbeg7Rmc.js";import{_ as me,a as _e}from"./Col-D62vBcWk.js";import{_ as ve}from"./Select-Df7rPK9_.js";import{a as fe,_ as ge}from"./ListItem-CMLNF079.js";import{_ as ye}from"./Thing-DAg0qjqL.js";import{N as be}from"./Tag-D-Mvyznn.js";import{_ as Te}from"./Statistic-BqRbOeQv.js";import{_ as De,a as qe}from"./CollapseItem-CJd05HNU.js";import{_ as Ge}from"./Spin-DAxT37N1.js";import{_ as je}from"./Space-BYw6XnFF.js";import{_ as He}from"./Table-B2H9w22E.js";import"./Alert-hJa_Wfyo.js";import"./Input-BjvMqLmR.js";import"./Suffix-DHkxWb8H.js";import"./use-merged-state-DLxtUdHo.js";import"./Switch-DcbwJYPH.js";import"./DataTable.types-BEg5m_To.js";import"./composables-bTB8ALIv.js";import"./Dropdown-FcmlDduf.js";import"./Popover-CxKYmMF9.js";import"./get-C6YDaK3p.js";const re=()=>({studentId:null,curriculumId:null,moduleId:null,courseId:null,groupId:null,payments:[]}),We=()=>({studentId:[],curriculumId:[],moduleId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}],courseId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}],groupId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),Ye={class:"wrapper-list-groups"},Ze={class:"table-auto w-full"},Je={class:"px-4 py-2 flex items-center"},Ke={class:"ms-2"},Qe={class:"text-end px-4 py-2"},Xe={class:"border-b-2 border-gray-500"},et={class:"px-4 py-2 font-bold text-lg text-end"},tt={class:"px-4 py-2 font-bold text-lg text-end"},lt={class:"text-red-500 text-sm text-end text-sm"},nt=de({__name:"EnrollmentModuleForm",props:{modelValue:{type:Boolean},studentId:{},curriculumId:{}},emits:["update:modelValue","success"],setup(se,{emit:K}){const D=K,y=se,g=ae({get:()=>y.modelValue,set:a=>D("update:modelValue",a)}),z=c(!1),P=c(!1),b=c([]),O=c([]),h=c([]),R=c(null),m=ae(()=>We()),d=c(re()),E=c([]),q=c(0),A=c(0),N=c(0),Q=a=>{d.value.payments.push(a.token),E.value.push({token:a.token,amount:a.payment.amount,sequenceNumber:a.payment.sequenceNumber})},$=a=>{const o=E.value.splice(a,1)[0],C=o==null?void 0:o.token;if(!C)return;const M=d.value.payments.indexOf(C);M!==-1&&d.value.payments.splice(M,1)},G=async a=>{d.value.payments=[],d.value.courseId=null,d.value.groupId=null,O.value=[],h.value=[],O.value=await Ue(a),b.value.forEach(o=>{o.value==a&&(q.value=parseFloat(o.price))})},X=async a=>{d.value.courseId=a,await u(a)},k=a=>{console.log("Grupo seleccionado",a),A.value=parseFloat(a.price),d.value.groupId&&d.value.groupId!=a.id?(d.value.groupId=a.id,N.value=A.value):d.value.groupId==a.id?(d.value.groupId=null,N.value=0):(d.value.groupId=a.id,N.value=A.value)},u=async a=>{const o=await Me({studentId:y.studentId,curriculumId:y.curriculumId,courseId:a});h.value=o.data},V=async()=>{const a=await $e(y.studentId,y.curriculumId);b.value=a.data},F=ae(()=>E.value.reduce((a,o)=>a+Number(o.amount),0)>=N.value),I=async()=>{if(d.value.studentId=y.studentId,d.value.curriculumId=y.curriculumId,R.value){if(!await R.value.validate())return;z.value=!0,(await Ne(d.value)).status&&(D("success"),g.value=!1),z.value=!1}},B=()=>{V(),console.log("Inicializando formulario")};return Ie(g,a=>{a&&(d.value=Object.assign({},{...re()}),E.value=[],b.value=[],O.value=[],h.value=[],q.value=0,A.value=0,N.value=0,B())}),(a,o)=>{const C=ve,M=Oe,U=_e,Y=be,j=pe,ee=ye,te=ge,le=fe,ne=ie("LnxIcon"),oe=me,r=Le,_=ce,i=he;return p(),S(L,null,[n(i,{show:g.value,"onUpdate:show":o[3]||(o[3]=l=>g.value=l)},{default:e(()=>[n(_,{style:{width:"600px"},title:"MATRICULA EN MODULO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:e(()=>[n(r,{ref_key:"formRef",ref:R,model:d.value,rules:m.value,size:"large"},{default:e(()=>[n(oe,{gutter:[16,16]},{default:e(()=>[n(U,{span:"24"},{default:e(()=>[n(M,{path:"moduleId",label:"Modulo"},{default:e(()=>[n(C,{value:d.value.moduleId,"onUpdate:value":[o[0]||(o[0]=l=>d.value.moduleId=l),G],placeholder:"Seleccionar modulo",options:b.value,"virtual-scroll":!1,clearable:"",filterable:""},null,8,["value","options"])]),_:1})]),_:1}),n(U,{span:"24"},{default:e(()=>[n(M,{path:"courseId",label:"Curso"},{default:e(()=>[n(C,{value:d.value.courseId,"onUpdate:value":[o[1]||(o[1]=l=>d.value.courseId=l),X],placeholder:"Seeleccione un curso",options:O.value,"virtual-scroll":!1,clearable:"",filterable:""},null,8,["value","options"])]),_:1})]),_:1}),n(U,{span:"24"},{default:e(()=>[t("div",Ye,[n(le,{hoverable:"",clickable:""},{header:e(()=>{var l;return[v(" Grupos aperturados ("+s((l=h.value)!=null&&l.length?h.value.length:0)+") ",1)]}),default:e(()=>[(p(!0),S(L,null,W(h.value,l=>(p(),w(te,{key:l.id,class:J({"item-selected":d.value.groupId==l.id}),extra:l.price},{default:e(()=>[n(ee,{onClick:x=>k(l)},xe({header:e(()=>[n(Y,{bordered:!1,type:"info",size:"small"},{default:e(()=>[v(s(l.modality),1)]),_:2},1024),v(" "+s(`${l.group} - S/. ${l.price}`),1)]),default:e(()=>[o[5]||(o[5]=v(" Min.: ")),t("b",null,s(l.minStudents),1),o[6]||(o[6]=v(" | Matriculados: ")),t("b",null,s(l.enrolledStudents),1),o[7]||(o[7]=v(" | Reservados: ")),t("b",null,s(l.reservedStudents),1),o[8]||(o[8]=t("br",null,null,-1)),n(Y,{bordered:!1,type:"info",size:"small"},{default:e(()=>[t("strong",null,s(l.schedules.days)+" - "+s(l.schedules.startHour)+" a "+s(l.schedules.endHour),1)]),_:2},1024)]),_:2},[d.value.groupId==l.id?{name:"header-extra",fn:e(()=>[n(j,{circle:"",type:"warning","render-icon":f(ue)("verify")},null,8,["render-icon"])]),key:"0"}:void 0]),1032,["onClick"])]),_:2},1032,["class","extra"]))),128))]),_:1})])]),_:1}),n(U,{span:"24"},{default:e(()=>[t("span",{role:"button",onClick:o[2]||(o[2]=l=>P.value=!0),class:"border border-dashed border-gray-300 p-4 rounded-sm flex items-center justify-center cursor-pointer text-gray-400 hover:bg-gray-50 font-bold hover:text-gray-500 mb-4"},[n(ne,{class:"me-3","icon-name":"money-add",size:"20"}),o[9]||(o[9]=v(" Agregar pago "))]),t("table",Ze,[t("tbody",null,[(p(!0),S(L,null,W(E.value,(l,x)=>(p(),S("tr",{key:x,class:"border-b border-gray-300 border-dashed px-4 py-2"},[t("td",Je,[n(j,{type:"error",size:"small",secondary:"",onClick:T=>$(x),"render-icon":f(ue)("trash")},null,8,["onClick","render-icon"]),t("i",Ke,s(l.sequenceNumber),1)]),t("td",Qe,"S/. "+s(l.amount),1)]))),128)),t("tr",Xe,[o[10]||(o[10]=t("td",{class:"px-4 py-2"},"Total pagado",-1)),t("td",et," S/. "+s(E.value.reduce((l,x)=>l+parseInt(x.amount),0)),1)]),t("tr",null,[o[11]||(o[11]=t("td",{class:"px-4 py-2"},"Total a pagar",-1)),t("td",tt," S/. "+s(N.value),1)])])]),t("div",lt,s(F.value?"":"El monto pagado no cubre el total requerido."),1)]),_:1}),n(U,{span:"24"},{default:e(()=>[n(j,{size:"large",type:"primary",onClick:I,block:"",loading:z.value},{default:e(()=>o[12]||(o[12]=[v(" Realizar matricula ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"]),n(Ce,{modelValue:P.value,"onUpdate:modelValue":o[4]||(o[4]=l=>P.value=l),studentId:y.studentId,onSuccess:Q},null,8,["modelValue","studentId"])],64)}}}),ot={class:"p-4"},at={class:"flex justify-end bg-gray-100 p-4 -mx-6 -mt-6 mb-4"},ut={class:"text-lg font-semibold w-full text-blue-800 p-2"},st={key:1},Lt=de({__name:"EnrollmentStudentView",setup(se){const{hasPermission:K}=ke(),{screenSize:D}=Ee(),y=we(),g=Be(),z=c(!1),P=c(!1),b=c(null),O=c(null),h=c([]),R=c(!0),m=c({}),d=c(!0),E=c(null),q=c(null),A=c(null),N=async k=>{let u=await Pe({id:k}),V=new Blob([u],{type:"application/pdf"}),F=window.URL.createObjectURL(V),I=document.getElementById("printFrame");I.src=F,I.onload=function(){var B;(B=I.contentWindow)==null||B.print()}},Q=async()=>{const k=y.params.id;R.value=!0,m.value=await Ae(k),R.value=!1},$=async()=>{var V;const k=y.params.id,u=(V=O.value)==null?void 0:V.id;d.value=!0,E.value=await Re(k,b.value,u),d.value=!1},G=(k,u=null)=>{q.value=k,A.value=u,P.value=!0},X=async()=>{h.value=await Fe(),b.value=h.value[0].value,Q(),$()};return Se(()=>{X()}),(k,u)=>{const V=ve,F=ce,I=Te,B=je,a=Ge,o=_e,C=be,M=pe,U=He,Y=ye,j=ge,ee=fe,te=qe,le=De,ne=me,oe=ie("AppNotAuthorization");return f(K)(["enrollment.create"])?(p(),S(L,{key:0},[n(F,{segmented:{header:!0,footer:!0,content:!0}},{header:e(()=>u[4]||(u[4]=[t("h6",{class:"text-sm text-gray-500"},"Matricular estudiante",-1),v(" Matricula regular ")])),"header-extra":e(()=>[n(V,{value:b.value,"onUpdate:value":[u[0]||(u[0]=r=>b.value=r),$],placeholder:"Seleccionar Plan de estudio",filterable:"",options:h.value,"virtual-scroll":!1,"default-value":1},null,8,["value","options"])]),action:e(()=>u[5]||(u[5]=[])),_:1}),t("div",ot,[n(ne,{gutter:16},{default:e(()=>[n(o,{span:f(D)=="lg"?6:24},{default:e(()=>[n(F,{segmented:{header:!0,content:!0},title:"InformaciÃ³n Personal",subtitle:"Datos del estudiante"},{default:e(()=>[n(a,{show:R.value},{default:e(()=>[n(B,{vertical:""},{default:e(()=>[n(I,{class:"small",label:"Tipo de estudiante"},{default:e(()=>{var r;return[v(s((r=m.value)==null?void 0:r.studentType),1)]}),_:1}),n(I,{class:"small",label:"Documento"},{default:e(()=>{var r,_,i;return[t("span",{class:J((r=m.value)!=null&&r.documentNumber?"":"text-stone-400")},s((_=m.value)!=null&&_.documentNumber?(i=m.value)==null?void 0:i.documentNumber:"No registra"),3)]}),_:1}),n(I,{class:"small",label:"Nombres"},{default:e(()=>{var r;return[v(s((r=m.value)==null?void 0:r.fullName),1)]}),_:1}),n(I,{class:"small",label:"Correo electronico"},{default:e(()=>{var r,_,i;return[t("span",{class:J((r=m.value)!=null&&r.email?"":"text-stone-400")},s((_=m.value)!=null&&_.email?(i=m.value)==null?void 0:i.email:"No registra"),3)]}),_:1}),n(I,{class:"small",label:"Telefono"},{default:e(()=>{var r,_,i;return[t("span",{class:J((r=m.value)!=null&&r.phone?"":"text-stone-400")},s((_=m.value)!=null&&_.phone?(i=m.value)==null?void 0:i.phone:"No registra"),3)]}),_:1})]),_:1})]),_:1},8,["show"])]),_:1})]),_:1},8,["span"]),n(o,{span:f(D)=="lg"?18:24},{default:e(()=>[n(F,{segmented:{header:!0,content:!0},title:"Matricula"},{"header-extra":e(()=>[n(C,{bordered:!1,type:f(g).enrollment?"info":"error"},{default:e(()=>{var r;return[t("strong",null,s(f(g).enrollment?(r=f(g).enrollment)==null?void 0:r.period:"No habilitado"),1)]}),_:1},8,["type"])]),default:e(()=>[t("div",at,[n(M,{type:"primary",onClick:u[1]||(u[1]=r=>z.value=!0),disabled:!f(g).enrollment},{default:e(()=>u[6]||(u[6]=[v(" Nuevo Modulo ")])),_:1},8,["disabled"])]),n(le,null,{default:e(()=>{var r;return[(p(!0),S(L,null,W((r=E.value)==null?void 0:r.enrollments,_=>(p(),w(te,{key:_.moduleId,name:_.moduleId},{header:e(()=>[t("h2",ut,s(_.moduleName)+" "+s(_.isExtracurricular?"(Extracurricular)":""),1)]),default:e(()=>[n(ee,{hoverable:"",clickable:""},{default:e(()=>[(p(!0),S(L,null,W(_.courses,i=>(p(),w(j,{key:i.id},{default:e(()=>[n(Y,{title:`${i.code} - ${i.name}`},{"header-extra":e(()=>{var l;return[(l=f(g).enrollment)!=null&&l.period&&(i.enrollmentGroups.length==0||i.enrollmentGroups.filter(x=>{var T;return x.period==((T=f(g).enrollment)==null?void 0:T.period)}).length==0)?(p(),w(M,{key:0,type:"primary",onClick:x=>G(i.id)},{default:e(()=>u[7]||(u[7]=[v(" Matricular ")])),_:2},1032,["onClick"])):H("",!0)]}),description:e(()=>[n(B,{size:"small"},{default:e(()=>[n(C,{bordered:!1,size:"small"},{default:e(()=>[v(" Area: "+s(i.area),1)]),_:2},1024)]),_:2},1024)]),default:e(()=>[i.enrollmentGroups.length>0?(p(),w(U,{key:0,"single-line":!1},{default:e(()=>[u[9]||(u[9]=t("thead",null,[t("tr",null,[t("th",{colspan:"2"},"Matricula"),t("th",{colspan:"3"},"Grupo"),t("th",{colspan:"2"})]),t("tr",null,[t("th",null,"Periodo"),t("th",null,"Estado"),t("th",null,"Grupo"),t("th",null,"Modalidad"),t("th",null,"Estado"),t("th",{rowspan:"2"},"Nota"),t("th",null,"Acciones")])],-1)),t("tbody",null,[(p(!0),S(L,null,W(i.enrollmentGroups,l=>{var x,T;return p(),S("tr",null,[t("td",null,[((x=f(g).enrollment)==null?void 0:x.period)==l.period?(p(),w(C,{key:0,type:"info"},{default:e(()=>[v(s(l.period),1)]),_:2},1024)):(p(),S("span",st,s(l.period),1))]),t("td",null,s(l.enrollmentStatus),1),t("td",null,s(l.groupName),1),t("td",null,s(l.groupModality),1),t("td",null,s(l.groupStatus),1),t("td",null,s(l.grade),1),t("td",null,[((T=f(g).enrollment)==null?void 0:T.period)==l.period?(p(),w(Ve,{key:0,item:l,onResetEnrollment:Z=>G(i.id,Z),onChangeGroup:Z=>G(i.id,Z),onReserveEnrollment:$,onCancelEnrollment:$},null,8,["item","onResetEnrollment","onChangeGroup"])):H("",!0),l.enrollmentStatus==="MATRICULADO"?(p(),w(M,{key:1,"render-icon":f(ue)("printer"),onClick:Z=>N(l.id)},{default:e(()=>u[8]||(u[8]=[v(" Ficha ")])),_:2},1032,["render-icon","onClick"])):H("",!0)])])}),256))])]),_:2},1024)):H("",!0)]),_:2},1032,["title"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["name"]))),128))]}),_:1})]),_:1})]),_:1},8,["span"])]),_:1})]),u[10]||(u[10]=t("iframe",{id:"printFrame",style:{display:"none"}},null,-1)),m.value?(p(),w(nt,{key:0,modelValue:z.value,"onUpdate:modelValue":u[2]||(u[2]=r=>z.value=r),studentId:m.value.id,curriculumId:b.value,onSuccess:$},null,8,["modelValue","studentId","curriculumId"])):H("",!0),n(ze,{modelValue:P.value,"onUpdate:modelValue":u[3]||(u[3]=r=>P.value=r),studentId:m.value.id,curriculumId:b.value,courseId:q.value,enrollmetGroup:A.value,isSpecial:!1,onSuccess:$},null,8,["modelValue","studentId","curriculumId","courseId","enrollmetGroup"])],64)):(p(),w(oe,{key:1}))}}});export{Lt as default};
