import{i as H,a as te}from"./DataTable.types-BIkVFYV7.js";import{d as N,aa as z,a5 as E,a8 as o,ab as t,ag as A,af as L,h as M,e as le,r as c,g as ne,ah as W,ac as T,ae as D,ai as oe,aj as se,ak as ue,al as re,ad as ie,am as de,_ as pe}from"./index-B1moMmGf.js";import{r as j}from"./icon.utils-CvbdSYhW.js";import{u as me}from"./composables-Dzo7p1MU.js";import{_ as ce}from"./Dropdown-56SzW5B2.js";import{N as ve,_ as _e}from"./Select-CFNlPL_t.js";import{h as R}from"./index-Z2j9nM23.js";import{d as B}from"./debounce.utils-DqPPCsFD.js";import{a as fe,f as ge}from"./selectables.services-B5hlRUEK.js";import{_ as be,a as ye}from"./FormItem-Dinphbxr.js";import{_ as J,a as K}from"./Col-Jp9hAiy_.js";import{_ as Q}from"./Input-CnTYTM92.js";import{_ as we}from"./Switch-BmkbJoFt.js";import{_ as Ie}from"./Space-DLhth_1u.js";import{d as ke}from"./role.services-DshkhSe7.js";import{_ as he}from"./DataTable-CmGk2gV6.js";const Se=N({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(u,{emit:i}){const v=me(),r=i,f=[{label:"Editar",key:"edit",icon:j("edit-2"),props:{onClick:()=>r("edit")}},{label:"Eliminar",key:"delete",icon:j("trash","red"),props:{style:{color:"red"},onClick:()=>{v.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{r("delete")}})}}}];return(w,_)=>{const n=L,a=ce;return z(),E(a,{options:f,placement:"bottom-start"},{default:o(()=>[t(n,null,{default:o(()=>[t(A,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})}}}),ze=(u,i)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(v){const r=v;return M(Se,{onEdit:()=>{u(r)},onDelete:()=>{i(r)},item:r},{default:()=>"Editar"})}},{title:"Nombre",key:"name",minWidth:"180px"},{title:"Email",key:"email",minWidth:"150px"},{title:"Usuario",key:"username",minWidth:"100px"},{title:"Rol",key:"roleName",minWidth:"100px"},{title:"Habilitado",key:"isEnabled",width:"120px",render:v=>M(ve,{type:v.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>v.isEnabled?"	Habilitado":"Deshabilitado"})}],Ee=(u=H())=>({page:u.page,total:u.total,pageSize:u.pageSize,pageCount:u.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${u.total} registros`}}),G=u=>({id:null,name:null,username:null,email:null,role:null,password:null,level:u,isEnabled:!0,modelId:null}),Te=()=>({modelId:[{type:"number",required:!0,trigger:["blur","change"],message:"Obligatorio"}],name:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],username:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],email:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],role:[{type:"number",required:!0,trigger:["blur","change"],message:"Obligatorio"}],password:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{min:6,message:"Mínimo 6 caracteres",trigger:["blur","input"]}]}),Ce=async u=>{try{return(await R().post("/user/load-data-table",u)).data.data}catch{return te()}},Ue=async u=>{try{return{status:!0,data:(await R().post("/user",u)).data.data}}catch(i){return i.response.status===422?{status:!1,data:i.response.data.errors}:{status:!1,data:null}}},xe=async u=>{try{return{status:!0,data:(await R().put("/user",u)).data.data}}catch(i){return i.response.status===422?{status:!1,data:i.response.data.errors}:{status:!1,data:null}}},Oe=async u=>{try{return await R().delete("/user",{data:{id:u.id}}),!0}catch{return!1}},Re=N({__name:"UserForm",props:{item:{},level:{},modelValue:{type:Boolean},roleOptions:{}},emits:["update:modelValue","success"],setup(u,{emit:i}){const v=i,r=u,f=le({get:()=>r.modelValue,set:l=>v("update:modelValue",l)}),w=c(!1),_=c(null),n=c(G(r.level)),a=c(null),I=c({...Te()}),C=c([]),U=c([]),V=l=>{var b;a.value&&(a.value.modelId=null),n.value.modelId=l;let e=(b=C.value.find(m=>m.value===l))==null?void 0:b.label;e&&(n.value.name=e)},h=l=>{var b;a.value&&(a.value.modelId=null),n.value.modelId=l;let e=(b=U.value.find(m=>m.value===l))==null?void 0:b.label;e&&(n.value.name=e)},S=async()=>{if(_.value){const l=await _.value.validate();let e=null;l?(w.value=!0,n.value.id?e=await xe(n.value):e=await Ue(n.value),e.status?(v("success"),f.value=!1):a.value=e.data):console.log("Formulario inválido")}w.value=!1},x=async({search:l=null,id:e=null})=>{C.value=await fe({search:l,id:e})},O=async({search:l=null,id:e=null})=>{U.value=await ge({search:l,id:e})},$=B(async l=>{await x({search:l})},400),P=B(async l=>{await O({search:l})},400),g=()=>{if(console.log("Inicializando formulario"),n.value=r.item?{...r.item}:G(r.level),console.log("props.item",r.item),r.item&&r.level=="teacher"){const l=r.item.modelId;x({id:l})}if(r.item&&r.level=="student"){const l=r.item.modelId;O({id:l})}};return ne(f,l=>{l&&(a.value=null,g())}),(l,e)=>{const b=_e,m=be,y=J,k=Q,X=we,q=Ie,Y=K,Z=ye,F=L,ee=oe,ae=se;return z(),E(ae,{show:f.value,"onUpdate:show":e[14]||(e[14]=s=>f.value=s)},{default:o(()=>[t(ee,{style:{width:"500px"},title:l.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",User:"dialog","aria-modal":"true"},{footer:o(()=>[t(q,{justify:"end"},{default:o(()=>[t(F,{tertiary:"",size:"large",onClick:e[13]||(e[13]=s=>f.value=!1),disabled:w.value},{default:o(()=>e[15]||(e[15]=[W(" Cancelar ")])),_:1},8,["disabled"]),t(F,{size:"large",type:"primary",onClick:S,loading:w.value},{default:o(()=>e[16]||(e[16]=[W("Guardar")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[t(Z,{ref_key:"formRef",ref:_,model:n.value,rules:I.value,size:"large"},{default:o(()=>[t(Y,null,{default:o(()=>[l.level==="teacher"?(z(),E(y,{key:0,span:"24"},{default:o(()=>{var s;return[t(m,{label:"Docente",path:"modelId",feedback:(s=a.value)==null?void 0:s.modelId},{default:o(()=>{var d;return[t(b,{value:n.value.modelId,"onUpdate:value":[e[0]||(e[0]=p=>n.value.modelId=p),V],options:C.value,filterable:"",placeholder:"Buscar docente",clearable:"",remote:"","virtual-scroll":!1,onSearch:T($),status:((d=a.value)==null?void 0:d.modelId)!=null?"error":""},null,8,["value","options","onSearch","status"])]}),_:1},8,["feedback"])]}),_:1})):D("",!0),l.level==="student"?(z(),E(y,{key:1,span:"24"},{default:o(()=>{var s;return[t(m,{label:"Estudiante",path:"modelId",feedback:(s=a.value)==null?void 0:s.modelId},{default:o(()=>{var d;return[t(b,{value:n.value.modelId,"onUpdate:value":[e[1]||(e[1]=p=>n.value.modelId=p),h],options:U.value,filterable:"",placeholder:"Buscar estudiante",clearable:"",remote:"","virtual-scroll":!1,onSearch:T(P),status:((d=a.value)==null?void 0:d.modelId)!=null?"error":""},null,8,["value","options","onSearch","status"])]}),_:1},8,["feedback"])]}),_:1})):D("",!0),t(y,{span:"24"},{default:o(()=>{var s;return[t(m,{path:"name",label:"Nombre",feedback:(s=a.value)==null?void 0:s.name},{default:o(()=>{var d;return[t(k,{status:((d=a.value)==null?void 0:d.name)!=null?"error":"",value:n.value.name,"onUpdate:value":e[2]||(e[2]=p=>n.value.name=p),onInput:e[3]||(e[3]=p=>a.value!=null?a.value.name=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),t(y,{span:"24"},{default:o(()=>{var s;return[t(m,{path:"username",label:"Usuario",feedback:(s=a.value)==null?void 0:s.username},{default:o(()=>{var d;return[t(k,{status:((d=a.value)==null?void 0:d.username)!=null?"error":"",value:n.value.username,"onUpdate:value":e[4]||(e[4]=p=>n.value.username=p),onInput:e[5]||(e[5]=p=>a.value!=null?a.value.username=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),t(y,{span:"24"},{default:o(()=>{var s;return[t(m,{path:"email",label:"Correo",feedback:(s=a.value)==null?void 0:s.email},{default:o(()=>{var d;return[t(k,{status:((d=a.value)==null?void 0:d.email)!=null?"error":"",value:n.value.email,"onUpdate:value":e[6]||(e[6]=p=>n.value.email=p),onInput:e[7]||(e[7]=p=>a.value!=null?a.value.email=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),n.value.id?D("",!0):(z(),E(y,{key:2,span:"24"},{default:o(()=>{var s;return[t(m,{path:"password",label:"Contraseña",feedback:(s=a.value)==null?void 0:s.password},{default:o(()=>{var d;return[t(k,{type:"password","show-password-on":"click",placeholder:"Custom Password Toggle Icon",minlength:6,status:((d=a.value)==null?void 0:d.password)!=null?"error":"",value:n.value.password,"onUpdate:value":e[8]||(e[8]=p=>n.value.password=p),onInput:e[9]||(e[9]=()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1})),t(y,{span:"24"},{default:o(()=>{var s;return[t(m,{path:"role",label:"Rol",feedback:(s=a.value)==null?void 0:s.role},{default:o(()=>{var d;return[t(b,{status:((d=a.value)==null?void 0:d.role)!=null?"error":"",value:n.value.role,"onUpdate:value":[e[10]||(e[10]=p=>n.value.role=p),e[11]||(e[11]=p=>a.value!=null?a.value.role=null:()=>{})],placeholder:"Seleccione un rol",clearable:"",options:l.roleOptions},null,8,["status","value","options"])]}),_:1},8,["feedback"])]}),_:1}),t(y,{span:"24"},{default:o(()=>[t(q,{justify:"end"},{default:o(()=>[t(m,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:o(()=>[t(X,{value:n.value.isEnabled,"onUpdate:value":e[12]||(e[12]=s=>n.value.isEnabled=s)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ve={style:{"border-bottom":"1px solid #e9e9e9"}},Qe=N({__name:"DataTable",props:{level:{}},setup(u){const i=u,v=c(!1),r=c([]),f=c(!1),w=c(null),_=ue({...H()}),n=c([]),a=c({search:null,page:_.page,pageSize:_.pageSize}),I=c({}),V=ze(g=>{w.value=g,f.value=!0},async g=>{await Oe(g),await h()}),h=async()=>{a.value.page=1,await S()},S=async()=>{v.value=!0,I.value=await Ce(a.value),r.value=I.value.data,_.total=I.value.total,_.pageSize=I.value.per_page,_.page=I.value.current_page,_.pageCount=I.value.last_page,v.value=!1},x=B(()=>{h()},400),O=async g=>{a.value.page=g,await S()},$=async g=>{a.value.page=1,a.value.pageSize=g,await S()};return(async()=>{a.value.filters={level:i.level},n.value=await ke(i.level),await S()})(),(g,l)=>{const e=J,b=Q,m=K,y=he;return z(),re(pe,null,[ie("div",Ve,[t(m,{gutter:12,style:{padding:"12px 16px"}},{default:o(()=>[t(e,{span:12}),t(e,{span:12},{default:o(()=>[t(b,{size:"large",placeholder:"Buscar",value:a.value.search,"onUpdate:value":l[0]||(l[0]=k=>a.value.search=k),onInput:T(x),clearable:""},{suffix:o(()=>[t(A,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),t(m,null,{default:o(()=>[t(e,{span:24},{default:o(()=>[t(y,{key:"id",remote:"","single-line":!1,columns:T(V),data:r.value,pagination:T(Ee)(_),"pagination-show-size-picker":!0,loading:v.value,"onUpdate:page":O,"onUpdate:pageSize":$},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),de(g.$slots,"extra",{reLoadDataTable:h,roleOptions:n.value})]),t(Re,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=k=>f.value=k),item:w.value,level:i.level,roleOptions:n.value,onSuccess:h},null,8,["modelValue","item","level","roleOptions"])],64)}}});export{Re as _,Qe as a};
