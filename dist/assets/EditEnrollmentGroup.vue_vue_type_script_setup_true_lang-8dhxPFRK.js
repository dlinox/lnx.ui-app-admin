import{r as $}from"./icon.utils-DutMd2qr.js";import{az as K,d as L,r as k,e as A,j as J,a8 as Q,a9 as U,aa as C,aI as W,ab as a,ac as e,aB as X,aA as w,b7 as oe,b8 as re,ag as F,ae as N,aG as R,_ as q,af as c,aU as j,b2 as le,b3 as se,ah as v}from"./index-DwV6zJCX.js";import{_ as ue}from"./Alert-ByHfwsqL.js";import{_ as de,a as ie}from"./FormItem-CNNyqOT9.js";import{_ as Y,a as Z}from"./Col-BkVWW8vc.js";import{_ as pe}from"./Input-DldL4MyO.js";import{_ as ce}from"./Select-B-XafpkT.js";import{a as me,_ as _e}from"./ListItem-Ch3wxL4j.js";import{_ as ge}from"./Thing-9qserMdX.js";import{_ as ve}from"./Tag-tDmUe03M.js";import{a as ye}from"./DataTable.types-BEg5m_To.js";import{u as fe}from"./composables-OPWM5oN5.js";import{_ as be}from"./Dropdown-CxNUQKFj.js";const b=K(),et=async t=>{try{return(await b.post("/enrollment/load-data-table",t)).data.data}catch{return ye()}},tt=async t=>{try{return{status:!0,data:(await b.post("/enrollment/module-store",{...t})).data.data}}catch{return{status:!1,data:null}}},Ie=async t=>{try{return{status:!0,data:(await b.post("/enrollment/group-store",{...t})).data.data}}catch{return{status:!1,data:null}}},we=async t=>{try{return{status:!0,data:(await b.post("/enrollment/group-update",{...t})).data.data}}catch{return{status:!1,data:null}}},he=async t=>{try{return{status:!0,data:(await b.post("/enrollment/group-reserved",{...t})).data.data}}catch{return{status:!1,data:null}}},ke=async t=>{try{return{status:!0,data:(await b.post("/enrollment/group-cancel",{...t})).data.data}}catch{return{status:!1,data:null}}},xe=async t=>{try{return{status:!0,data:(await b.post("/enrollment/enabled-groups",t)).data.data}}catch{return{status:!1,data:null}}},nt=async(t,o,i)=>{try{return(await b.post("/enrollment/student-enrollment-avaliable",{studentId:t,curriculumId:o,periodId:i})).data.data}catch{return null}},at=async(t,o)=>{try{return{status:!0,data:(await b.post(`/enrollment/${t}/student/${o}/curriculum`)).data.data}}catch{return{status:!1,data:[]}}},ot=async t=>{try{return(await b.post("/enrollment/download-enrollment-pdf",{...t},{responseType:"blob"})).data}catch{return null}},Ee=async t=>{try{return(await b.post("/enrollment/get-enrollment-group-payments",{...t})).data.data}catch{return[]}},rt=async(t,o,i)=>{try{return(await b.post("/enrollment/student-enrollment-avaliable-special",{studentId:t,curriculumId:o,periodId:i})).data.data}catch{return null}},H=()=>({id:null,studentId:null,groupId:null,payments:[]}),Se=K(),Ce=async t=>{try{return(await Se.post("/payment/validate",t)).data.data}catch{return{token:null}}},Ve=()=>({studentId:null,amount:null,date:null,sequenceNumber:null,paymentTypeId:7}),Ge=t=>({studentId:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],amount:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:"Debe ser un número",trigger:["blur","input"],validator:(o,i)=>{if(i){if(!/^\d*\.?\d*$/.test(i))return new Error("Debe ser un número")}else return new Error("Obligatorio");return!0}}],date:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],sequenceNumber:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:t===7?"Debe tener 7 digitos":"Debe tener 6 digitos",trigger:["blur","input"],validator:(o,i)=>{if(i)if(/^\d*$/.test(i)){if(t===7&&i.length!==7)return new Error("Debe tener 7 digitos");if(t===9&&i.length!==6)return new Error("Debe tener 6 digitos")}else return new Error("Debe ser un número");else return new Error("Obligatorio");return!0}}],paymentTypeId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),Pe=L({__name:"PaymentForm",props:{modelValue:{type:Boolean},studentId:{}},emits:["update:modelValue","success"],setup(t,{emit:o}){const i=o,u=t,p=k(!1),y=A({get:()=>u.modelValue,set:f=>i("update:modelValue",f)}),h=k(null),d=k({}),m=A(()=>Ge(d.value.paymentTypeId)),g=async()=>{if(h.value&&!await h.value.validate())return;d.value.studentId=u.studentId,p.value=!0;const f=await Ce(d.value);f.token!==null&&(y.value=!1,i("success",{token:f.token,payment:d.value})),p.value=!1},l=()=>{console.log("Inicializando formulario"),d.value=Object.assign({},Ve())};return J(y,f=>{f&&l()}),(f,_)=>{const O=Q("LnxIcon"),D=oe,B=ue,G=pe,V=ie,S=Z,n=ce,r=F,x=Y,E=de,P=X,T=W;return C(),U(T,{show:y.value,"onUpdate:show":_[4]||(_[4]=I=>y.value=I)},{default:a(()=>[e(P,{style:{width:"500px"},title:"REGISTRAR PAGO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:a(()=>[e(B,{title:"¡Importante!",type:"default",class:"mb-4"},{icon:a(()=>[e(D,null,{default:a(()=>[e(O,{"icon-name":"information",size:"20"})]),_:1})]),default:a(()=>[_[5]||(_[5]=w(" Solo se validan pagos realizados, con un día de anticipación. "))]),_:1}),e(E,{ref_key:"formRef",ref:h,model:d.value,rules:m.value,size:"large",onKeydown:re(g,["enter"])},{default:a(()=>[e(x,{gutter:[16,16]},{default:a(()=>[e(S,{span:"12"},{default:a(()=>[e(V,{path:"amount",label:"Monto"},{default:a(()=>[e(G,{value:d.value.amount,"onUpdate:value":_[0]||(_[0]=I=>d.value.amount=I)},null,8,["value"])]),_:1})]),_:1}),e(S,{span:"12"},{default:a(()=>[e(V,{path:"date",label:"Fecha de pago"},{default:a(()=>[e(G,{placeholder:"",type:"date",value:d.value.date,"onUpdate:value":_[1]||(_[1]=I=>d.value.date=I)},null,8,["value"])]),_:1})]),_:1}),e(S,{span:"12"},{default:a(()=>[e(V,{path:"sequenceNumber",label:"Secuencia"},{default:a(()=>[e(G,{value:d.value.sequenceNumber,"onUpdate:value":_[2]||(_[2]=I=>d.value.sequenceNumber=I)},null,8,["value"])]),_:1})]),_:1}),e(S,{span:"12"},{default:a(()=>[e(V,{path:"paymentTypeId",label:"Metodo de pago"},{default:a(()=>[e(n,{"virtual-scroll":!1,value:d.value.paymentTypeId,"onUpdate:value":_[3]||(_[3]=I=>d.value.paymentTypeId=I),placeholder:"Metodo de pago",options:[{label:"BN - VENTANILLA",value:7},{label:"BN - PAGALO.PE",value:9}]},null,8,["value"])]),_:1})]),_:1}),e(S,{span:"24"},{default:a(()=>[e(r,{loading:p.value,secondary:"",type:"primary",onClick:g,block:"","render-icon":N($)("money-tick")},{default:a(()=>_[6]||(_[6]=[w(" Validar Pago ")])),_:1},8,["loading","render-icon"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"])}}}),Te={class:"wrapper-list-groups"},ze={class:"table-auto w-full"},Re={class:"px-4 py-2 flex items-center"},$e={class:"ms-2"},Ae={class:"text-end px-4 py-2"},Ne={class:"border-b-2 border-gray-500"},Oe={class:"px-4 py-2 font-bold text-lg text-end"},De={class:"px-4 py-2 font-bold text-lg text-end"},Be={class:"text-red-500 text-sm text-end text-sm"},lt=L({__name:"EnrollmentGroupForm",props:{modelValue:{type:Boolean},isSpecial:{type:Boolean},studentId:{},curriculumId:{},courseId:{},enrollmetGroup:{}},emits:["update:modelValue","success"],setup(t,{emit:o}){const i=o,u=t,p=k(!1),y=A({get:()=>u.modelValue,set:n=>i("update:modelValue",n)}),h=k(!1),d=k([]),m=k([]),g=k(0),l=k(Object.assign({},{...H()})),f=n=>{l.value.payments.push(n.token),m.value.push({token:n.token,amount:n.payment.amount,sequenceNumber:n.payment.sequenceNumber})},_=n=>{l.value.groupId&&l.value.groupId!=n.id?(l.value.groupId=n.id,g.value=n.price):l.value.groupId==n.id?(l.value.groupId=null,g.value=0):(l.value.groupId=n.id,g.value=n.price)},O=async()=>{const n=await xe({studentId:u.studentId,curriculumId:u.curriculumId,courseId:u.courseId,isSpecial:u.isSpecial});d.value=n.data},D=n=>{let x=m.value[n].token;m.value.splice(n,1);let E=l.value.payments.find(T=>T===x);if(!E)return;let P=l.value.payments.indexOf(E);l.value.payments.splice(P,1)},B=()=>m.value.reduce((r,x)=>r+parseInt(x.amount),0)>=g.value?null:"El monto pagado es menor al total",G=async()=>{var n;if(l.value.studentId=u.studentId,p.value=!0,(n=u.enrollmetGroup)!=null&&n.id){(await we({...l.value,isSpecial:u.isSpecial})).status&&(i("success"),y.value=!1),p.value=!1;return}else(await Ie({...l.value,isSpecial:u.isSpecial})).status&&(i("success"),y.value=!1),p.value=!1},V=async n=>{m.value=await Ee({id:n})},S=async()=>{if(m.value=[],l.value=H(),l.value.payments=[],l.value.groupId=null,g.value=0,await O(),u.enrollmetGroup){let n=d.value.find(r=>r.id==u.enrollmetGroup.groupId);n&&(l.value.groupId=n.id,g.value=n.price),l.value.id=u.enrollmetGroup.id,await V(u.enrollmetGroup.id),m.value.length>0&&m.value.forEach(r=>{l.value.payments.push(r.token)})}console.log("Inicializando formulario")};return J(y,n=>{n&&S()}),(n,r)=>{const x=ve,E=F,P=ge,T=_e,I=me,M=Z,ee=Q("LnxIcon"),te=Y,ne=X,ae=W;return C(),R(q,null,[e(ae,{show:y.value,"onUpdate:show":r[1]||(r[1]=s=>y.value=s)},{default:a(()=>[e(ne,{style:{width:"500px"},title:n.isSpecial?"Matricula Especial":"Matricula Regular",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:a(()=>[e(te,{gutter:[16,16]},{default:a(()=>[e(M,{span:"24"},{default:a(()=>[c("div",Te,[e(I,{hoverable:"",clickable:""},{header:a(()=>{var s;return[w(" Grupos aperturados ("+v((s=d.value)!=null&&s.length?d.value.length:0)+") ",1)]}),default:a(()=>[(C(!0),R(q,null,j(d.value,s=>(C(),U(T,{key:s.id,class:le({"item-selected":l.value.groupId==s.id}),extra:s.price},{default:a(()=>[e(P,{onClick:z=>_(s)},se({header:a(()=>[e(x,{bordered:!1,type:s.modality=="VIRTUAL"?"info":"success",size:"small"},{default:a(()=>[w(v(s.modality),1)]),_:2},1032,["type"]),w(" "+v(`${s.group} - S/. ${s.price}`),1)]),default:a(()=>[r[3]||(r[3]=w(" Min.: ")),c("b",null,v(s.minStudents),1),r[4]||(r[4]=w(" | Matriculados: ")),c("b",null,v(s.enrolledStudents),1),r[5]||(r[5]=w(" | Reservados: ")),c("b",null,v(s.reservedStudents),1),r[6]||(r[6]=c("br",null,null,-1)),e(x,{bordered:!1,type:"info",size:"small"},{default:a(()=>[c("strong",null,v(s.schedules.days)+" - "+v(s.schedules.startHour)+" a "+v(s.schedules.endHour),1)]),_:2},1024)]),_:2},[l.value.groupId==s.id?{name:"header-extra",fn:a(()=>[e(E,{circle:"",type:"warning","render-icon":N($)("verify")},null,8,["render-icon"])]),key:"0"}:void 0]),1032,["onClick"])]),_:2},1032,["class","extra"]))),128))]),_:1})])]),_:1}),e(M,{span:"24"},{default:a(()=>[c("span",{role:"button",onClick:r[0]||(r[0]=s=>h.value=!0),class:"border border-dashed border-gray-300 p-4 rounded-sm flex items-center justify-center cursor-pointer text-gray-400 hover:bg-gray-50 font-bold hover:text-gray-500 mb-4"},[e(ee,{class:"me-3","icon-name":"money-add",size:"20"}),r[7]||(r[7]=w(" Agregar pago "))]),c("table",ze,[c("tbody",null,[(C(!0),R(q,null,j(m.value,(s,z)=>(C(),R("tr",{key:z,class:"border-b border-gray-300 border-dashed px-4 py-2"},[c("td",Re,[e(E,{type:"error",size:"small",secondary:"",onClick:Me=>D(z),"render-icon":N($)("trash")},null,8,["onClick","render-icon"]),c("i",$e,v(s.sequenceNumber),1)]),c("td",Ae,"S/. "+v(s.amount),1)]))),128)),c("tr",Ne,[r[8]||(r[8]=c("td",{class:"px-4 py-2"},"Total pagado",-1)),c("td",Oe," S/. "+v(m.value.reduce((s,z)=>s+parseInt(z.amount),0)),1)]),c("tr",null,[r[9]||(r[9]=c("td",{class:"px-4 py-2"},"Total a pagar",-1)),c("td",De," S/. "+v(g.value),1)])])]),c("div",Be,v(B()),1)]),_:1}),e(M,{span:"24"},{default:a(()=>[e(E,{size:"large",type:"primary",onClick:G,block:"",loading:p.value},{default:a(()=>r[10]||(r[10]=[w(" Realizar Matricula ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["show"]),e(Pe,{modelValue:h.value,"onUpdate:modelValue":r[2]||(r[2]=s=>h.value=s),studentId:u.studentId,onSuccess:f},null,8,["modelValue","studentId"])],64)}}}),st=L({__name:"EditEnrollmentGroup",props:{item:{}},emits:["changeGroup","reserveEnrollment","cancelEnrollment","resetEnrollment"],setup(t,{emit:o}){const i=fe(),u=o,p=t,y=async d=>{switch(d){case"change-group":u("changeGroup",p.item);break;case"reserve-enrollment":i.warning({title:"Confirmar",content:"¿Está seguro de realizar la reserva de la matrícula?",positiveText:"Reservar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"primary"},bordered:!0,onPositiveClick:async()=>{await he(p.item),u("reserveEnrollment",p.item)}});break;case"cancel-enrollment":i.warning({title:"Confirmar",content:"¿Está seguro de cancelar la matrícula?",positiveText:"Cancelar matrícula",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:async()=>{await ke(p.item),u("cancelEnrollment",p.item)}});break;case"reset-enrollment":u("resetEnrollment",p.item);break}},h=A(()=>{var d,m,g,l,f;return[{label:"Cambiar grupo",key:"change-group",disabled:((d=p.item)==null?void 0:d.enrollmentStatus)!=="MATRICULADO"},{label:"Reservar matrícula",key:"reserve-enrollment",disabled:((m=p.item)==null?void 0:m.enrollmentStatus)!=="MATRICULADO"},{label:"Cancelar matrícula",key:"cancel-enrollment",disabled:((g=p.item)==null?void 0:g.enrollmentStatus)=="CANCELADO"},{label:"Reestablecer matrícula",key:"reset-enrollment",disabled:((l=p.item)==null?void 0:l.enrollmentStatus)!=="CANCELADO"&&((f=p.item)==null?void 0:f.enrollmentStatus)!=="RESERVADO"}]});return(d,m)=>{const g=F,l=be;return C(),U(l,{trigger:"click",options:h.value,"show-arrow":!0,onSelect:y},{default:a(()=>[e(g,{"render-icon":N($)("magicpen")},{default:a(()=>m[0]||(m[0]=[w(" Opt. ")])),_:1},8,["render-icon"])]),_:1},8,["options"])}}});export{Pe as _,xe as a,tt as b,at as c,st as d,lt as e,ot as f,nt as g,rt as h,et as i};
