import{r as M}from"./icon.utils-ZuDWVKKn.js";import{d as V,a3 as j,e as L,a9 as $,aa as T,ab as a,ac as e,ag as q,aH as J,h as R,az as le,r as g,j as oe,aN as se,aB as K,ae as c,w as A,aA as S,aI as re,aJ as ue,aG as Q,_ as X,af as G,aK as ie,a6 as de,ad as pe,aM as me}from"./index-D8WIehE5.js";import{G as ce}from"./genders.constans-BK559Fh_.js";import{u as _e}from"./useBreakpoints-F9M6aIk0.js";import{i as Y,a as ve}from"./DataTable.types-BEg5m_To.js";import{_ as fe,a as ge}from"./FormItem-CrbM01Rr.js";import{_ as Z,a as ee}from"./Col-C343CxWW.js";import{_ as be}from"./Select-ZkZqEDm9.js";import{_ as te}from"./Input-BkREKv3h.js";import{_ as ye}from"./Space-CUL6VHzT.js";import{_ as he}from"./Switch-BsL8RFLa.js";import{d as Ne}from"./debounce.utils-DqPPCsFD.js";import{u as we}from"./composables-C6BCauEF.js";import{_ as ke}from"./Dropdown-CoPYcF5I.js";import{N as H}from"./Tag-C5AHKgys.js";import{c as Ie}from"./documentType.services-WNe4m3xp.js";import{_ as xe}from"./DataTable-B2ZzQ56f.js";import"./get-Bq4s3pE6.js";import"./Popover-CfAzCWMV.js";import"./use-merged-state-5TB2v_D7.js";import"./Suffix-DFjECoaW.js";import"./Tooltip-MMzbohNy.js";const Te=V({__name:"DataTableOp",props:{item:{}},emits:["edit","delete","createUser"],setup(r,{emit:o}){const v=o,d=we(),{hasPermission:i}=j(),l=r,m=L(()=>[{show:l.item.userId==null&&i(["teacher.create-account"]),label:"Crear cuenta de usuario",id:"create-user",key:"create-user",icon:M("security-user"),props:{onClick:()=>v("createUser")}},{label:"Editar",key:"edit",icon:M("edit-2"),props:{onClick:()=>v("edit")},show:i(["teacher.edit"])},{label:"Eliminar",key:"delete",icon:M("trash","red"),show:i(["teacher.delete"]),props:{style:{color:"red"},onClick:()=>{d.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{v("delete")}})}}}]);return(f,n)=>{const u=q,I=ke;return T(),$(I,{options:m.value,placement:"bottom-start"},{default:a(()=>[e(u,null,{default:a(()=>[e(J,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1},8,["options"])}}}),Ce=(r,o,v)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(d){const i=d;return R(Te,{onEdit:()=>{r(i)},onDelete:()=>{o(i)},onCreateUser:()=>{v(i)},item:i},{default:()=>"Editar"})}},{title:"Codigo",key:"code",minWidth:"120px"},{title:"Número de documento",key:"documentNumber",minWidth:"120px"},{title:"Nombre",key:"name",minWidth:"120px"},{title:"Apellido Paterno",key:"lastNameFather",minWidth:"120px"},{title:"Apellido Materno",key:"lastNameMother",minWidth:"120px"},{title:"Género",key:"gender",minWidth:"150px",render:d=>R(H,{tertiary:!0,bordered:!1,strong:!0},{default:()=>d.gender===1?"MASCULINO":d.gender===2?"FEMENINO":"NO ESPECIFICADO"})},{title:"Email",key:"email",minWidth:"80px"},{title:"Teléfono",key:"phone",minWidth:"100px"},{title:"Habilitado",key:"isEnabled",width:"150px",render:d=>R(H,{type:d.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>d.isEnabled?"	Habilitado":"Deshabilitado"})}],Ee=(r=Y())=>({page:r.page,total:r.total,pageSize:r.pageSize,pageCount:r.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${r.total} registros`}}),W=()=>({id:null,personId:null,code:null,documentTypeId:1,documentNumber:null,name:null,lastNameFather:null,lastNameMother:null,gender:null,email:null,phone:null,address:null,isEnabled:!0}),ze=()=>({code:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],documentNumber:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],name:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],lastNameFather:[],lastNameMother:[],gender:[],email:[],phone:[],address:[],TeacherTypeId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),C=le(),Se=async r=>{try{return(await C.post("/teacher/load-data-table",r)).data.data}catch{return ve()}},Ue=async r=>{try{return(await C.get(`/teacher/item/by-id/${r}`)).data.data}catch{return W()}},De=async r=>{try{return{status:!0,data:(await C.post("/teacher",r)).data.data}}catch(o){return o.response.status===422?{status:!1,data:o.response.data.errors}:{status:!1,data:null}}},Fe=async r=>{try{return{status:!0,data:(await C.put("/teacher",r)).data.data}}catch(o){return o.response.status===422?{status:!1,data:o.response.data.errors}:{status:!1,data:null}}},Me=async r=>{try{return await C.delete("/teacher",{data:{id:r.id}}),!0}catch{return!1}},$e=async r=>{try{return await C.post("/teacher/create-user",r),!0}catch{return!1}},ae=V({__name:"TeacherForm",props:{item:{},modelValue:{type:Boolean},selectables:{}},emits:["update:modelValue","success"],setup(r,{emit:o}){const v=o,d=r,{screenSize:i}=_e(),l=L({get:()=>d.modelValue,set:_=>v("update:modelValue",_)}),m=g(!1),f=g(null),n=g(W()),u=g(null),I=g({...ze()}),E=async()=>{if(f.value){const _=await f.value.validate();let t=null;_?(m.value=!0,n.value.id?t=await Fe(n.value):t=await De(n.value),t.status?(v("success"),l.value=!1):u.value=t.data):console.log("Formulario inválido")}m.value=!1},O=async()=>{var _;return(_=d.item)!=null&&_.id?n.value=await Ue(d.item.id):n.value=W(),n.value},w=async()=>{console.log("Inicializando formulario"),await O()};return oe(l,_=>{_&&w()}),(_,t)=>{const U=be,b=ge,y=ee,p=te,k=he,x=ye,B=Z,D=fe,F=q,z=K,ne=re,P=se("upper-case");return T(),$(ne,{show:l.value,"onUpdate:show":t[15]||(t[15]=s=>l.value=s)},{default:a(()=>[e(z,{style:{width:"1024px"},title:_.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:a(()=>[e(x,{justify:"end"},{default:a(()=>[e(F,{tertiary:"",size:"large",onClick:t[14]||(t[14]=s=>l.value=!1),disabled:m.value},{default:a(()=>t[16]||(t[16]=[S(" Cancelar ")])),_:1},8,["disabled"]),e(F,{size:"large",type:"primary",onClick:E,loading:m.value},{default:a(()=>t[17]||(t[17]=[S("Guardar")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[e(D,{ref_key:"formRef",ref:f,model:n.value,rules:I.value,size:"large",onSubmit:E},{default:a(()=>[e(B,{gutter:16},{default:a(()=>[e(y,{span:c(i)==="sm"?12:8},{default:a(()=>[e(b,{path:"documentTypeId",label:"Tipo de Documento"},{default:a(()=>[e(U,{value:n.value.documentTypeId,"onUpdate:value":t[0]||(t[0]=s=>n.value.documentTypeId=s),clearable:"","virtual-scroll":!1,placeholder:"Seleccione",options:_.selectables.documentTypesItems},null,8,["value","options"])]),_:1})]),_:1},8,["span"]),e(y,{span:c(i)==="sm"?12:8},{default:a(()=>{var s;return[e(b,{path:"documentNumber",label:"Número de Documento",feedback:(s=u.value)==null?void 0:s.documentNumber},{default:a(()=>{var h;return[e(p,{value:n.value.documentNumber,"onUpdate:value":t[1]||(t[1]=N=>n.value.documentNumber=N),status:((h=u.value)==null?void 0:h.documentNumber)!=null?"error":"",onInput:t[2]||(t[2]=N=>u.value!=null?u.value.documentNumber=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),e(y,{span:c(i)==="sm"?24:8},{default:a(()=>{var s;return[e(b,{path:"name",label:"Nombre",feedback:(s=u.value)==null?void 0:s.name},{default:a(()=>{var h;return[A(e(p,{status:((h=u.value)==null?void 0:h.name)!=null?"error":"",value:n.value.name,"onUpdate:value":t[3]||(t[3]=N=>n.value.name=N),onInput:t[4]||(t[4]=N=>u.value!=null?u.value.name=null:()=>{})},null,8,["status","value"]),[[P]])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),e(y,{span:c(i)==="sm"?12:8},{default:a(()=>{var s;return[e(b,{path:"lastNameFather",label:"Apellido Paterno",feedback:(s=u.value)==null?void 0:s.lastNameFather},{default:a(()=>{var h;return[A(e(p,{status:((h=u.value)==null?void 0:h.lastNameFather)!=null?"error":"",value:n.value.lastNameFather,"onUpdate:value":t[5]||(t[5]=N=>n.value.lastNameFather=N),onInput:t[6]||(t[6]=N=>u.value!=null?u.value.lastNameFather=null:()=>{})},null,8,["status","value"]),[[P]])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),e(y,{span:c(i)==="sm"?12:8},{default:a(()=>{var s;return[e(b,{path:"lastNameMother",label:"Apellido Materno",feedback:(s=u.value)==null?void 0:s.lastNameMother},{default:a(()=>{var h;return[A(e(p,{status:((h=u.value)==null?void 0:h.lastNameMother)!=null?"error":"",value:n.value.lastNameMother,"onUpdate:value":t[7]||(t[7]=N=>n.value.lastNameMother=N),onInput:t[8]||(t[8]=N=>u.value!=null?u.value.lastNameMother=null:()=>{})},null,8,["status","value"]),[[P]])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),e(y,{span:c(i)==="sm"?12:8},{default:a(()=>[e(b,{path:"gender",label:"Genero"},{default:a(()=>[e(U,{value:n.value.gender,"onUpdate:value":t[9]||(t[9]=s=>n.value.gender=s),clearable:"",placeholder:"Seleccione","virtual-scroll":!1,options:c(ce)},null,8,["value","options"])]),_:1})]),_:1},8,["span"]),e(y,{span:c(i)==="sm"?12:8},{default:a(()=>[e(b,{path:"birthDate",label:"Fecha de Nacimiento"},{default:a(()=>[e(p,{value:n.value.dateOfBirth,"onUpdate:value":t[10]||(t[10]=s=>n.value.dateOfBirth=s),type:"date",clearable:"",placeholder:""},null,8,["value"])]),_:1})]),_:1},8,["span"]),e(y,{span:c(i)==="sm"?12:8},{default:a(()=>[e(b,{path:"email",label:"Correo Electrónico"},{default:a(()=>[e(p,{value:n.value.email,"onUpdate:value":t[11]||(t[11]=s=>n.value.email=s)},null,8,["value"])]),_:1})]),_:1},8,["span"]),e(y,{span:c(i)==="sm"?12:8},{default:a(()=>[e(b,{path:"phone",label:"Teléfono"},{default:a(()=>[e(p,{value:n.value.phone,"onUpdate:value":t[12]||(t[12]=s=>n.value.phone=s)},null,8,["value"])]),_:1})]),_:1},8,["span"]),e(y,{span:"24"},{default:a(()=>[e(x,{justify:"end"},{default:a(()=>[e(b,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:a(()=>[e(k,{value:n.value.isEnabled,"onUpdate:value":t[13]||(t[13]=s=>n.value.isEnabled=s)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ve={style:{"border-bottom":"1px solid #e9e9e9"}},Oe=V({__name:"DataTable",setup(r){const o=g(!1),v=g([]),d=g(!1),i=g(null),l=ue({...Y()}),m=g({search:null,page:l.page,pageSize:l.pageSize}),f=g({}),n=g({}),O=Ce(p=>{i.value=p,d.value=!0},async p=>{await Me(p),await w()},async p=>{await $e(p)&&await w()}),w=async()=>{m.value.page=1,await _()},_=async()=>{o.value=!0,f.value=await Se(m.value),v.value=f.value.data,l.total=f.value.total,l.pageSize=f.value.per_page,l.page=f.value.current_page,l.pageCount=f.value.last_page,o.value=!1},t=Ne(()=>{w()},400),U=async p=>{m.value.page=p,await _()},b=async p=>{m.value.page=1,m.value.pageSize=p,await _()};return(async()=>{await _(),n.value.documentTypesItems=await Ie()})(),(p,k)=>{const x=ee,B=te,D=Z,F=xe;return T(),Q(X,null,[G("div",Ve,[e(D,{gutter:12,style:{padding:"12px 16px"}},{default:a(()=>[e(x,{span:12}),e(x,{span:12},{default:a(()=>[e(B,{size:"large",placeholder:"Buscar",value:m.value.search,"onUpdate:value":k[0]||(k[0]=z=>m.value.search=z),onInput:c(t),clearable:""},{suffix:a(()=>[e(J,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(x,{span:24},{default:a(()=>[e(F,{key:"id",remote:"",size:"small","single-line":!1,columns:c(O),data:v.value,pagination:c(Ee)(l),"pagination-show-size-picker":!0,loading:o.value,"onUpdate:page":U,"onUpdate:pageSize":b},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),ie(p.$slots,"extra",{reLoadDataTable:w,selectables:n.value})]),e(ae,{modelValue:d.value,"onUpdate:modelValue":k[1]||(k[1]=z=>d.value=z),item:i.value,onSuccess:w,selectables:n.value},null,8,["modelValue","item","selectables"])],64)}}}),st=V({__name:"index",setup(r){const{hasPermission:o}=j(),v=de(),d=g(!1);return(i,l)=>{const m=q,f=K,n=me;return c(o)(["teacher.create","teacher.edit","teacher.delete","teacher.create-account"])?(T(),Q(X,{key:0},[l[5]||(l[5]=S("' ")),e(f,{segmented:{header:!0,content:!0}},{header:a(()=>l[3]||(l[3]=[G("span",{class:"text-sm text-slate-500"}," Gestión de Docentes ",-1),G("h5",{class:"text-lg font-bold text-slate-800"},"Docentes",-1)])),"header-extra":a(()=>[c(o)(["teacher.create"])?(T(),$(m,{key:0,size:"large",type:"primary","render-icon":c(M)("additem"),onClick:l[0]||(l[0]=u=>d.value=!0)},{default:a(()=>l[4]||(l[4]=[S(" Agregar ")])),_:1},8,["render-icon"])):pe("",!0)]),_:1}),e(Oe,null,{extra:a(({reLoadDataTable:u,selectables:I})=>[e(ae,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=E=>d.value=E),item:null,onSuccess:u,selectables:I},null,8,["modelValue","onSuccess","selectables"])]),_:1})],64)):(T(),$(n,{key:1,status:"403",title:"403 No Autorizado",description:"Algunas puertas siempre están cerradas para ti."},{footer:a(()=>[e(m,{onClick:l[2]||(l[2]=u=>c(v).push("/"))},{default:a(()=>l[6]||(l[6]=[S(" Ir a casa ")])),_:1})]),_:1}))}}});export{st as default};
