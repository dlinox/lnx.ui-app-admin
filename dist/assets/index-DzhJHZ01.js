import{r as M}from"./icon.utils-CEl5GGKX.js";import{d as k,a8 as A,a9 as R,aa as o,ab as t,af as $,aG as Y,h as D,ay as Z,e as K,r as _,j as Q,aA as F,ad as I,az as z,aH as X,aI as ee,a7 as te,aF as N,_ as G,aJ as ae,ae as L}from"./index-_mj8JziO.js";import{i as q,a as ne}from"./DataTable.types-BEg5m_To.js";import{_ as oe,a as le}from"./FormItem-D4BZJS-H.js";import{_ as H,a as J}from"./Col-BWn1KlK_.js";import{_ as se}from"./InputNumber-DULpwz3F.js";import{_ as re}from"./Select-DeSggoPP.js";import{_ as ue}from"./Space-BK4_Iwmx.js";import{u as ie}from"./composables-C6PPJC54.js";import{_ as pe}from"./Dropdown-DRixFdwA.js";import{d as de}from"./debounce.utils-DqPPCsFD.js";import{_ as me}from"./Input-BRl-dZ-f.js";import{_ as ce}from"./DataTable-JlekKhdF.js";import"./selectables.services-CvgwHXzV.js";import"./get-CAv4nNBB.js";import"./Suffix-TU7kyu7U.js";import"./use-merged-state-CgbaMofk.js";import"./Popover-BLfkiz4u.js";import"./Tag-NEVBcrFK.js";import"./get-slot-Bk_rJcZu.js";import"./Tooltip-TvvvwlfV.js";const _e=k({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(l,{emit:a}){const p=ie(),e=a,i=[{label:"Editar",key:"edit",icon:M("edit-2"),props:{onClick:()=>e("edit")}},{label:"Eliminar",key:"delete",icon:M("trash","red"),props:{style:{color:"red"},onClick:()=>{p.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{e("delete")}})}}}];return(r,u)=>{const s=$,d=pe;return R(),A(d,{options:i,placement:"bottom-start"},{default:o(()=>[t(s,null,{default:o(()=>[t(Y,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})}}}),j=[{value:1,label:"ENERO"},{value:2,label:"FEBRERO"},{value:3,label:"MARZO"},{value:4,label:"ABRIL"},{value:5,label:"MAYO"},{value:6,label:"JUNIO"},{value:7,label:"JULIO"},{value:8,label:"AGOSTO"},{value:9,label:"SEPTIEMBRE"},{value:10,label:"OCTUBRE"},{value:11,label:"NOVIEMBRE"},{value:12,label:"DICIEMBRE"}],ge=(l,a)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(p){const e=p;return D(_e,{onEdit:()=>{l(e)},onDelete:()=>{a(e)},item:e},{default:()=>"Editar"})}},{title:"Año",key:"year",minWidth:"150px"},{title:"Mes",key:"month",minWidth:"150px",render:p=>{const e=j.find(i=>i.value===p.month);return D("span",e==null?void 0:e.label)}}],ve=(l=q())=>({page:l.page,total:l.total,pageSize:l.pageSize,pageCount:l.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${l.total} registros`}}),U=()=>({id:null,year:new Date().getFullYear(),month:new Date().getMonth()+1}),fe=()=>({year:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}],month:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),C=Z(),be=async l=>{try{return(await C.post("/period/load-data-table",l)).data.data}catch{return ne()}},ye=async l=>{try{return{status:!0,data:(await C.post("/period",l)).data.data}}catch(a){return a.response.status===422?{status:!1,data:a.response.data.errors}:{status:!1,data:null}}},we=async l=>{try{return{status:!0,data:(await C.put("/period",l)).data.data}}catch(a){return a.response.status===422?{status:!1,data:a.response.data.errors}:{status:!1,data:null}}},Ie=async l=>{try{return await C.delete("/period",{data:{id:l.id}}),!0}catch{return!1}},W=k({__name:"PeriodForm",props:{item:{},modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(l,{emit:a}){const p=a,e=l,i=K({get:()=>e.modelValue,set:m=>p("update:modelValue",m)}),r=_(!1),u=_(null),s=_(U()),d=_(null),P=_({...fe()}),S=async()=>{if(u.value){const m=await u.value.validate();let n=null;m?(r.value=!0,s.value.id?n=await we(s.value):n=await ye(s.value),n.status?(p("success"),i.value=!1):d.value=n.data):console.log("Formulario inválido")}r.value=!1},v=()=>{console.log("Inicializando formulario"),s.value=e.item?{...e.item}:U()};return Q(i,m=>{m&&v()}),(m,n)=>{const T=se,x=le,O=J,g=re,f=H,b=oe,h=$,V=ue,E=F,B=X;return R(),A(B,{show:i.value,"onUpdate:show":n[5]||(n[5]=c=>i.value=c)},{default:o(()=>[t(E,{style:{width:"500px"},title:m.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:o(()=>[t(V,{justify:"end"},{default:o(()=>[t(h,{tertiary:"",size:"large",onClick:n[4]||(n[4]=c=>i.value=!1),disabled:r.value},{default:o(()=>n[6]||(n[6]=[z(" Cancelar ")])),_:1},8,["disabled"]),t(h,{size:"large",type:"primary",onClick:S,loading:r.value},{default:o(()=>n[7]||(n[7]=[z("Guardar")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[t(b,{ref_key:"formRef",ref:u,model:s.value,rules:P.value,size:"large"},{default:o(()=>[t(f,{gutter:16},{default:o(()=>[t(O,{span:"12"},{default:o(()=>{var c;return[t(x,{path:"year",label:"Año",feedback:(c=d.value)==null?void 0:c.year},{default:o(()=>{var y;return[t(T,{clearable:"",maxlength:"4",status:((y=d.value)==null?void 0:y.year)!=null?"error":"",value:s.value.year,"onUpdate:value":n[0]||(n[0]=w=>s.value.year=w),valueModifiers:{number:!0},onInput:n[1]||(n[1]=w=>d.value!=null?d.value.year=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),t(O,{span:"12"},{default:o(()=>{var c;return[t(x,{path:"month",label:"Mes",feedback:(c=d.value)==null?void 0:c.month},{default:o(()=>{var y;return[t(g,{clearable:"",value:s.value.month,"onUpdate:value":n[2]||(n[2]=w=>s.value.month=w),options:I(j),"virtual-scroll":!1,status:((y=d.value)==null?void 0:y.month)!=null?"error":"",onInput:n[3]||(n[3]=w=>d.value!=null?d.value.month=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),xe={style:{"border-bottom":"1px solid #e9e9e9"}},he=k({__name:"DataTable",setup(l){const a=_(!1),p=_([]),e=_(!1),i=_(null),r=ee({...q()}),u=_({search:null,page:r.page,pageSize:r.pageSize}),s=_({}),S=ge(g=>{i.value=g,e.value=!0},async g=>{await Ie(g),await v()}),v=async()=>{u.value.page=1,await m()},m=async()=>{a.value=!0,s.value=await be(u.value),p.value=s.value.data,r.total=s.value.total,r.pageSize=s.value.per_page,r.page=s.value.current_page,r.pageCount=s.value.last_page,a.value=!1},n=de(()=>{v()},400),T=async g=>{u.value.page=g,await m()},x=async g=>{u.value.page=1,u.value.pageSize=g,await m()};return(async()=>{await m()})(),(g,f)=>{const b=J,h=te("LnxIcon"),V=me,E=H,B=ce;return R(),N(G,null,[ae(g.$slots,"extra",{reLoadDataTable:v}),L("div",xe,[t(E,{gutter:12,style:{padding:"12px 16px"}},{default:o(()=>[t(b,{span:12}),t(b,{span:12},{default:o(()=>[t(V,{size:"large",placeholder:"Buscar",value:u.value.search,"onUpdate:value":f[0]||(f[0]=c=>u.value.search=c),onInput:I(n),clearable:""},{suffix:o(()=>[t(h,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),t(E,null,{default:o(()=>[t(b,{span:24},{default:o(()=>[t(B,{key:"id",remote:"","single-line":!1,columns:I(S),data:p.value,pagination:I(ve)(r),"pagination-show-size-picker":!0,loading:a.value,"onUpdate:page":T,"onUpdate:pageSize":x},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1})]),t(W,{modelValue:e.value,"onUpdate:modelValue":f[1]||(f[1]=c=>e.value=c),item:i.value,onSuccess:v},null,8,["modelValue","item"])],64)}}}),He=k({__name:"index",setup(l){const a=_(!1);return(p,e)=>{const i=$,r=F;return R(),N(G,null,[t(r,{segmented:{header:!0,content:!0,footer:!0}},{header:o(()=>e[2]||(e[2]=[L("h6",{style:{"font-size":"14px",color:"#999",margin:"0"}}," Gestión Periodos Académicos ",-1),z(" Periodos Académicos ")])),"header-extra":o(()=>[t(i,{"render-icon":I(M)("additem"),onClick:e[0]||(e[0]=u=>a.value=!0)},{default:o(()=>e[3]||(e[3]=[z(" Agregar ")])),_:1},8,["render-icon"])]),_:1}),t(he,null,{extra:o(({reLoadDataTable:u})=>[t(W,{modelValue:a.value,"onUpdate:modelValue":e[1]||(e[1]=s=>a.value=s),item:null,onSuccess:u},null,8,["modelValue","onSuccess"])]),_:1})],64)}}});export{He as default};
