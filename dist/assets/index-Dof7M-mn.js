import{b as W,r as V,_ as ee}from"./LnxIcon.vue_vue_type_script_setup_true_lang-TYfemrMA.js";import{G as te}from"./genders.constans-ZqlXwVVz.js";import{u as ae}from"./useBreakpoints-B0funUYl.js";import{u as le,i as A,N as P,j as E,k as ne,l as oe,a as se,b as G,_ as q,c as ue,d as re,e as j,f as de,g as ie,h as pe}from"./debounce.utils-JXFV_6GD.js";import{d as U,a7 as M,a3 as H,a4 as a,a8 as e,ad as B,h as O,e as me,r as N,g as ce,ae as ve,ab as F,a9 as v,af as L,ag as _e,ah as Z,ai as J,aj as fe,Z as K}from"./index-DJ1jHABu.js";import{d as ge}from"./studentType.services-STNexl36.js";import{d as be}from"./documentType.services-Bm3PqCWV.js";const ye=U({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(s,{emit:o}){const p=o,u=le(),i=[{label:"Editar",key:"edit",icon:V("edit-2"),props:{onClick:()=>p("edit")}},{label:"Eliminar",key:"delete",icon:V("trash","red"),props:{style:{color:"red"},onClick:()=>{u.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{p("delete")}})}}}];return(m,c)=>{const _=B,l=ee;return M(),H(l,{options:i,placement:"bottom-start"},{default:a(()=>[e(_,null,{default:a(()=>[e(W,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})}}}),he=(s,o)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(p){const u=p;return O(ye,{onEdit:()=>{s(u)},onDelete:()=>{o(u)},item:u},{default:()=>"Editar"})}},{title:"Codigo",key:"code",minWidth:"120px"},{title:"Número de documento",key:"documentNumber",minWidth:"120px"},{title:"Nombre",key:"name",minWidth:"120px"},{title:"Apellido Paterno",key:"lastNameFather",minWidth:"120px"},{title:"Apellido Materno",key:"lastNameMother",minWidth:"120px"},{title:"Género",key:"gender",minWidth:"150px",render:p=>O(P,{tertiary:!0,bordered:!1,strong:!0},{default:()=>p.gender===1?"MASCULINO":p.gender===2?"FEMENINO":"NO ESPECIFICADO"})},{title:"Email",key:"email",minWidth:"80px"},{title:"Teléfono",key:"phone",minWidth:"100px"},{title:"Tipo de estudiante",key:"studentType",minWidth:"150px"},{title:"Habilitado",key:"isEnabled",width:"150px",render:p=>O(P,{type:p.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>p.isEnabled?"	Habilitado":"Deshabilitado"})}],Ne=(s=A())=>({page:s.page,total:s.total,pageSize:s.pageSize,pageCount:s.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${s.total} registros`}}),$=()=>({id:null,personId:null,code:null,documentTypeId:1,documentNumber:null,name:null,lastNameFather:null,lastNameMother:null,gender:null,email:null,phone:null,address:null,studentTypeId:null,isEnabled:!0}),Ie=()=>({code:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],documentTypeId:[{type:"number",required:!0,trigger:["blur"],message:"Obligatorio"}],documentNumber:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],name:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],lastNameFather:[],lastNameMother:[],gender:[],email:[],phone:[],address:[],studentTypeId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),ke=async s=>{try{return(await E().post("/student/load-data-table",s)).data.data}catch{return ne()}},Te=async s=>{try{return(await E().get(`/student/item/by-id/${s}`)).data.data}catch{return $()}},we=async s=>{try{return{status:!0,data:(await E().post("/student",s)).data.data}}catch(o){return o.response.status===422?{status:!1,data:o.response.data.errors}:{status:!1,data:null}}},Se=async s=>{try{return{status:!0,data:(await E().put("/student",s)).data.data}}catch(o){return o.response.status===422?{status:!1,data:o.response.data.errors}:{status:!1,data:null}}},Ee=async s=>{try{return await E().delete("/student",{data:{id:s.id}}),!0}catch{return!1}},Q=U({__name:"StudentForm",props:{item:{},modelValue:{type:Boolean},selectables:{}},emits:["update:modelValue","success"],setup(s,{emit:o}){const p=o,u=s,{screenSize:i}=ae(),m=me({get:()=>u.modelValue,set:f=>p("update:modelValue",f)}),c=N(!1),_=N(null),l=N($()),r=N(null),R=N({...Ie()}),x=async()=>{if(console.log("formRef",l.value),_.value){const f=await _.value.validate();let t=null;f?(c.value=!0,l.value.id?t=await Se(l.value):t=await we(l.value),t.status?(p("success"),m.value=!1):r.value=t.data):console.log("Formulario inválido")}c.value=!1},I=async()=>{var f;return(f=u.item)!=null&&f.id?l.value=await Te(u.item.id):l.value=$(),l.value},k=async()=>{console.log("Inicializando formulario"),await I()};return ce(m,f=>{f&&k()}),(f,t)=>{const w=oe,y=se,d=G,h=q,S=ue,C=re,z=j,D=de,T=B,X=L,Y=ve;return M(),H(Y,{show:m.value,"onUpdate:show":t[18]||(t[18]=n=>m.value=n)},{default:a(()=>[e(X,{style:{width:"1024px"},title:f.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:a(()=>[e(C,{justify:"end"},{default:a(()=>[e(T,{tertiary:"",size:"large",onClick:t[17]||(t[17]=n=>m.value=!1),disabled:c.value},{default:a(()=>t[19]||(t[19]=[F(" Cancelar ")])),_:1},8,["disabled"]),e(T,{size:"large",type:"primary",onClick:x,loading:c.value},{default:a(()=>t[20]||(t[20]=[F("Guardar")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[e(D,{ref_key:"formRef",ref:_,model:l.value,rules:R.value,size:"large",onSubmit:x},{default:a(()=>[e(z,{gutter:16},{default:a(()=>[e(d,{span:v(i)==="sm"?12:6},{default:a(()=>[e(y,{path:"studentTypeId",label:"Tipo de Estudiante"},{default:a(()=>[e(w,{value:l.value.studentTypeId,"onUpdate:value":t[0]||(t[0]=n=>l.value.studentTypeId=n),clearable:"",placeholder:"Seleccione","virtual-scroll":!1,options:f.selectables.studentTypesItems},null,8,["value","options"])]),_:1})]),_:1},8,["span"]),e(d,{span:v(i)==="sm"?12:6},{default:a(()=>{var n;return[e(y,{path:"code",label:"Código",feedback:(n=r.value)==null?void 0:n.code},{default:a(()=>{var g;return[e(h,{value:l.value.code,"onUpdate:value":t[1]||(t[1]=b=>l.value.code=b),status:((g=r.value)==null?void 0:g.code)!=null?"error":"",onInput:t[2]||(t[2]=b=>r.value!=null?r.value.code=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),e(d,{span:v(i)==="sm"?12:6},{default:a(()=>[e(y,{path:"documentTypeId",label:"Tipo de Documento"},{default:a(()=>[e(w,{value:l.value.documentTypeId,"onUpdate:value":t[3]||(t[3]=n=>l.value.documentTypeId=n),clearable:"","virtual-scroll":!1,placeholder:"Seleccione",options:f.selectables.documentTypesItems},null,8,["value","options"])]),_:1})]),_:1},8,["span"]),e(d,{span:v(i)==="sm"?12:6},{default:a(()=>{var n;return[e(y,{path:"documentNumber",label:"Número de Documento",feedback:(n=r.value)==null?void 0:n.documentNumber},{default:a(()=>{var g;return[e(h,{value:l.value.documentNumber,"onUpdate:value":t[4]||(t[4]=b=>l.value.documentNumber=b),status:((g=r.value)==null?void 0:g.documentNumber)!=null?"error":"",onInput:t[5]||(t[5]=b=>r.value!=null?r.value.documentNumber=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),e(d,{span:v(i)==="sm"?24:8},{default:a(()=>{var n;return[e(y,{path:"name",label:"Nombre",feedback:(n=r.value)==null?void 0:n.name},{default:a(()=>{var g;return[e(h,{status:((g=r.value)==null?void 0:g.name)!=null?"error":"",value:l.value.name,"onUpdate:value":t[6]||(t[6]=b=>l.value.name=b),onInput:t[7]||(t[7]=b=>r.value!=null?r.value.name=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),e(d,{span:v(i)==="sm"?12:8},{default:a(()=>{var n;return[e(y,{path:"lastNameFather",label:"Apellido Paterno",feedback:(n=r.value)==null?void 0:n.lastNameFather},{default:a(()=>{var g;return[e(h,{status:((g=r.value)==null?void 0:g.lastNameFather)!=null?"error":"",value:l.value.lastNameFather,"onUpdate:value":t[8]||(t[8]=b=>l.value.lastNameFather=b),onInput:t[9]||(t[9]=b=>r.value!=null?r.value.lastNameFather=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),e(d,{span:v(i)==="sm"?12:8},{default:a(()=>{var n;return[e(y,{path:"lastNameMother",label:"Apellido Materno",feedback:(n=r.value)==null?void 0:n.lastNameMother},{default:a(()=>{var g;return[e(h,{status:((g=r.value)==null?void 0:g.lastNameMother)!=null?"error":"",value:l.value.lastNameMother,"onUpdate:value":t[10]||(t[10]=b=>l.value.lastNameMother=b),onInput:t[11]||(t[11]=b=>r.value!=null?r.value.lastNameMother=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),e(d,{span:v(i)==="sm"?12:6},{default:a(()=>[e(y,{path:"gender",label:"Genero"},{default:a(()=>[e(w,{value:l.value.gender,"onUpdate:value":t[12]||(t[12]=n=>l.value.gender=n),clearable:"",placeholder:"Seleccione","virtual-scroll":!1,options:v(te)},null,8,["value","options"])]),_:1})]),_:1},8,["span"]),e(d,{span:v(i)==="sm"?12:6},{default:a(()=>[e(y,{path:"birthDate",label:"Fecha de Nacimiento"},{default:a(()=>[e(h,{value:l.value.dateOfBirth,"onUpdate:value":t[13]||(t[13]=n=>l.value.dateOfBirth=n),type:"date",clearable:"",placeholder:""},null,8,["value"])]),_:1})]),_:1},8,["span"]),e(d,{span:v(i)==="sm"?12:6},{default:a(()=>[e(y,{path:"email",label:"Correo Electrónico"},{default:a(()=>[e(h,{value:l.value.email,"onUpdate:value":t[14]||(t[14]=n=>l.value.email=n)},null,8,["value"])]),_:1})]),_:1},8,["span"]),e(d,{span:v(i)==="sm"?12:6},{default:a(()=>[e(y,{path:"phone",label:"Teléfono"},{default:a(()=>[e(h,{value:l.value.phone,"onUpdate:value":t[15]||(t[15]=n=>l.value.phone=n)},null,8,["value"])]),_:1})]),_:1},8,["span"]),e(d,{span:"24"},{default:a(()=>[e(C,{justify:"end"},{default:a(()=>[e(y,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:a(()=>[e(S,{value:l.value.isEnabled,"onUpdate:value":t[16]||(t[16]=n=>l.value.isEnabled=n)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),xe={style:{"border-bottom":"1px solid #e9e9e9"}},Ce=U({__name:"DataTable",setup(s){const o=N(!1),p=N([]),u=N(!1),i=N(null),m=_e({...A()}),c=N({search:null,page:m.page,pageSize:m.pageSize}),_=N({}),l=N({}),x=he(d=>{i.value=d,u.value=!0},async d=>{await Ee(d),await I()}),I=async()=>{c.value.page=1,await k()},k=async()=>{o.value=!0,_.value=await ke(c.value),p.value=_.value.data,m.total=_.value.total,m.pageSize=_.value.per_page,m.page=_.value.current_page,m.pageCount=_.value.last_page,o.value=!1},f=ie(()=>{I()},400),t=async d=>{c.value.page=d,await k()},w=async d=>{c.value.page=1,c.value.pageSize=d,await k()};return(async()=>{await k(),l.value.studentTypesItems=await ge(),l.value.documentTypesItems=await be()})(),(d,h)=>{const S=G,C=q,z=j,D=pe;return M(),Z(K,null,[J("div",xe,[e(z,{gutter:12,style:{padding:"12px 16px"}},{default:a(()=>[e(S,{span:12}),e(S,{span:12},{default:a(()=>[e(C,{size:"large",placeholder:"Buscar",value:c.value.search,"onUpdate:value":h[0]||(h[0]=T=>c.value.search=T),onInput:v(f),clearable:""},{suffix:a(()=>[e(W,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),e(z,null,{default:a(()=>[e(S,{span:24},{default:a(()=>[e(D,{key:"id",remote:"","single-line":!1,columns:v(x),data:p.value,pagination:v(Ne)(m),"pagination-show-size-picker":!0,loading:o.value,"onUpdate:page":t,"onUpdate:pageSize":w},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),fe(d.$slots,"extra",{reLoadDataTable:I,selectables:l.value})]),e(Q,{modelValue:u.value,"onUpdate:modelValue":h[1]||(h[1]=T=>u.value=T),item:i.value,onSuccess:I,selectables:l.value},null,8,["modelValue","item","selectables"])],64)}}}),$e=U({__name:"index",setup(s){const o=N(!1);return(p,u)=>{const i=B,m=L;return M(),Z(K,null,[e(m,{segmented:{header:!0,content:!0}},{header:a(()=>u[2]||(u[2]=[J("h6",{style:{color:"#999",margin:"0"}},"Gestión de Estudiantes",-1),F(" Estudiantes ")])),"header-extra":a(()=>[e(i,{"render-icon":v(V)("additem"),onClick:u[0]||(u[0]=c=>o.value=!0)},{default:a(()=>u[3]||(u[3]=[F(" Agregar ")])),_:1},8,["render-icon"])]),_:1}),e(Ce,null,{extra:a(({reLoadDataTable:c,selectables:_})=>[e(Q,{modelValue:o.value,"onUpdate:modelValue":u[1]||(u[1]=l=>o.value=l),item:null,onSuccess:c,selectables:_},null,8,["modelValue","onSuccess","selectables"])]),_:1})],64)}}});export{$e as default};
