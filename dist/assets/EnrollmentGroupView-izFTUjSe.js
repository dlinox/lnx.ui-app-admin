import{u as le}from"./period.stores-CdXAXpMt.js";import{a as re,i as J}from"./DataTable.types-BEg5m_To.js";import{a as K,_ as ie}from"./selectables.services-S-WFd6Ss.js";import{e as ue,f as pe,g as de}from"./group.services-BrGjMRyX.js";import{az as ce,d as D,a3 as T,e as Q,r as c,j as X,a9 as L,aa as w,ab as t,ac as e,aB as G,af as b,aG as V,_ as $,aL as me,ah as R,ad as W,ag as j,aA as S,ae as I,aI as Y,a8 as Z,h as M,aJ as _e,aK as ge,aH as fe}from"./index-DJC0BDyi.js";import{r as ve}from"./icon.utils-BskQV8nf.js";import{_ as ye}from"./Table-BpmzSwUW.js";import{_ as ee}from"./Flex-CR3i_gjA.js";import{u as be}from"./composables-Blw5S8Da.js";import{_ as he,a as we}from"./FormItem-hkNBqYHR.js";import{_ as te,a as ae}from"./Col-C21edevQ.js";import{_ as oe}from"./Select-DspmZ1pU.js";import{_ as Ce}from"./Alert-DmCNILB5.js";import{_ as Ie}from"./Space-B52NGJNL.js";import{_ as Se}from"./ButtonGroup-CDsamIN4.js";import{N as F}from"./Tag-Dk2E0f9P.js";import{d as H}from"./debounce.utils-DqPPCsFD.js";import{_ as Ae}from"./Input-DBFrJf3T.js";import{_ as ke}from"./DataTable-gHj0YnuP.js";import"./get-8hg4PRDN.js";import"./Popover-0ZzN24Gj.js";import"./use-merged-state-Cj4Aargr.js";import"./Suffix-DoGO01ad.js";import"./Tooltip-CMwltFrP.js";import"./Dropdown-BOxrGR0y.js";const q=ce(),Ee=async u=>{try{return(await q.post("/enrollment-groups/load-data-table",u)).data.data}catch{return re()}},xe=async u=>{try{return(await q.get("/enrollment-groups/get-students/"+u)).data.data}catch{return[]}},Oe=async u=>{try{return await q.post("/enrollment-groups/send-massive-email/"+u),!0}catch{return!1}},Re=D({__name:"EnrolledStudents",props:{modelValue:{type:Boolean},groupId:{}},emits:["update:modelValue","success"],setup(u,{emit:s}){const{hasPermission:f}=T(),h=s,m=u,d=Q({get:()=>m.modelValue,set:o=>h("update:modelValue",o)}),l=c(!1),n=c([]),r=async()=>{const o=await xe(m.groupId);n.value=o},v=async()=>{l.value=!0;try{await Oe(m.groupId),h("success")}catch(o){console.error(o)}finally{l.value=!1}},g=async()=>{await r()};return X(d,async o=>{o&&await g()}),(o,p)=>{const k=ye,E=j,y=ee,a=G,C=Y;return w(),L(C,{show:d.value,"onUpdate:show":p[1]||(p[1]=i=>d.value=i),class:"content-table"},{default:t(()=>[e(a,{style:{width:"600px"},title:"Estudiantes Matriculados",bordered:!1,size:"small",role:"dialog","aria-modal":"true",segmented:{content:!0,footer:!0}},{footer:t(()=>[e(y,{justify:"end"},{default:t(()=>[e(E,{onClick:p[0]||(p[0]=()=>d.value=!1)},{default:t(()=>p[3]||(p[3]=[S("Cerrar")])),_:1}),I(f)(["group-manager.send-email"])?(w(),L(E,{key:0,type:"primary",loading:l.value,onClick:v},{default:t(()=>p[4]||(p[4]=[S(" Enviar correo de confirmación ")])),_:1},8,["loading"])):W("",!0)]),_:1})]),default:t(()=>[e(k,{bordered:!1,"single-line":!1},{default:t(()=>[p[2]||(p[2]=b("thead",null,[b("tr",null,[b("th",null,"N°"),b("th",null,"Estudiante"),b("th",null,"Celular"),b("th",null,"Correo")])],-1)),b("tbody",null,[(w(!0),V($,null,me(n.value,(i,_)=>(w(),V("tr",{key:_},[b("td",null,R(_+1),1),b("td",null,R(i.student),1),b("td",null,R(i.phone),1),b("td",null,R(i.email),1)]))),128))])]),_:1})]),_:1})]),_:1},8,["show"])}}}),Ve=D({__name:"FormManagerGroup",props:{modelValue:{type:Boolean},item:{}},emits:["update:modelValue","success"],setup(u,{emit:s}){const{hasPermission:f}=T(),h=be(),m=s,d=c([]),l=c([]),n=u,r=Q({get:()=>n.modelValue,set:y=>m("update:modelValue",y)}),v=c(!1),g=c(!1),o=c({id:null,teacherId:null,laboratoryId:null,status:"ABIERTO"}),p=async()=>{h.warning({title:"Confirmar",content:"¿Está seguro que desea CANCELAR este registro?, No podrá revertir esta acción.",positiveText:"Confirmar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{k()}})},k=async()=>{g.value=!0,o.value.id=n.item.id,await ue(o.value)&&(m("success"),r.value=!1),g.value=!1},E=async()=>{console.log("Inicializando formulario"),o.value.teacherId=n.item.teacherId,o.value.laboratoryId=n.item.laboratoryId,o.value.status=n.item.status,d.value=await pe();let y=await de();l.value=y.filter(a=>{const C=a.label.split("-")[0];return n.item.modality==="PRESENCIAL"?C==="LABORATORIO":n.item.modality==="VIRTUAL"?C==="VIRTUAL":!1}).map(a=>({value:a.value,label:a.label.split("-")[1].trim()}))};return X(r,async y=>{y&&await E()}),(y,a)=>{const C=oe,i=we,_=ae,B=Ce,z=te,N=he,x=j,U=Ie,P=ee,ne=G,se=Y;return w(),V($,null,[e(se,{show:r.value,"onUpdate:show":a[6]||(a[6]=O=>r.value=O)},{default:t(()=>{var O;return[e(ne,{style:{width:"600px"},title:`${(O=y.item)==null?void 0:O.modality} - Gestionar grupo`,bordered:!1,size:"small",role:"dialog","aria-modal":"true",segmented:{content:!0,footer:!0}},{footer:t(()=>[e(P,{justify:"end"},{default:t(()=>[e(x,{onClick:a[4]||(a[4]=()=>r.value=!1)},{default:t(()=>a[9]||(a[9]=[S("Cancelar")])),_:1}),I(f)(["group-manager.edit"])?(w(),L(x,{key:0,type:"primary",onClick:a[5]||(a[5]=A=>o.value.status==="CANCELADO"?p():k()),loading:g.value},{default:t(()=>a[10]||(a[10]=[S(" Guardar ")])),_:1},8,["loading"])):W("",!0)]),_:1})]),default:t(()=>[e(N,{ref:"formRef",model:o.value},{default:t(()=>[e(z,{gutter:16},{default:t(()=>[e(_,{span:24},{default:t(()=>[e(i,{label:"Docente",path:"teacherId"},{default:t(()=>[e(C,{value:o.value.teacherId,"onUpdate:value":a[0]||(a[0]=A=>o.value.teacherId=A),placeholder:"Seleccionar Docente",filterable:"",options:d.value,clearable:"",remote:"","virtual-scroll":!1},null,8,["value","options"])]),_:1})]),_:1}),e(_,{span:24},{default:t(()=>[e(i,{label:"Laboratorio",path:"laboratoryId"},{default:t(()=>[e(C,{value:o.value.laboratoryId,"onUpdate:value":a[1]||(a[1]=A=>o.value.laboratoryId=A),placeholder:"Seleccionar Laboratorio",filterable:"",options:l.value,clearable:"",remote:"","virtual-scroll":!1},null,8,["value","options"])]),_:1})]),_:1}),e(_,{span:24},{default:t(()=>[e(i,{label:"Estado",path:"status"},{default:t(()=>[e(C,{value:o.value.status,"onUpdate:value":a[2]||(a[2]=A=>o.value.status=A),placeholder:"Seleccionar Estado",options:[{label:"ABIERTO",value:"ABIERTO"},{label:"CERRADO",value:"CERRADO"},{label:"CANCELADO",value:"CANCELADO"}],"virtual-scroll":!1},null,8,["value"])]),_:1})]),_:1}),e(_,{span:24},{default:t(()=>[e(B,{type:o.value.status==="CANCELADO"?"error":"info","show-icon":"",title:`GRUPO ${o.value.status}`,closable:!1},{default:t(()=>[S(R(o.value.status==="CERRADO"?"Las inscripciones virtuales para este grupo están cerradas, pero aún puede realizarse la matrícula de manera presencial.":o.value.status==="CANCELADO"?"Los estudiantes no podrán realizar la matrícula de manera presencial ni virtual, y los estudiantes que ya están matriculados en el grupo serán desvinculados; su matrícula pasará a un estado de 'RESERVADO'.":"Las inscripciones estan habilitada para todos los estudiantes, tanto virtual como presencialmente."),1)]),_:1},8,["type","title"])]),_:1})]),_:1})]),_:1},8,["model"]),e(U,{justify:"end",class:"p-3"},{default:t(()=>[e(x,{onClick:a[3]||(a[3]=A=>v.value=!0),loading:g.value,"render-icon":I(ve)("people")},{default:t(()=>a[8]||(a[8]=[S(" Estudiantes MATRICULADOS ")])),_:1},8,["loading","render-icon"])]),_:1})]),_:1},8,["title"])]}),_:1},8,["show"]),e(Re,{modelValue:v.value,"onUpdate:modelValue":a[7]||(a[7]=O=>v.value=O),groupId:n.item.id},null,8,["modelValue","groupId"])],64)}}}),ze=D({__name:"GroupStatus",props:{groupId:{},status:{},item:{}},emits:["success"],setup(u,{emit:s}){const{hasPermission:f}=T(),h=s,m=c(!1);return(d,l)=>{const n=j,r=Z("LnxIcon"),v=Se;return w(),V($,null,[e(v,null,{default:t(()=>[e(n,{quaternary:""},{default:t(()=>[S(R(d.status),1)]),_:1}),(d.status=="ABIERTO"||d.status=="CERRADO")&&I(f)(["group-manager.edit","group-manager.send-email"])?(w(),L(n,{key:0,tertiary:"",onClick:l[0]||(l[0]=g=>m.value=!0)},{icon:t(()=>[e(r,{"icon-name":"edit"})]),_:1})):W("",!0)]),_:1}),e(Ve,{modelValue:m.value,"onUpdate:modelValue":l[1]||(l[1]=g=>m.value=g),item:d.item,onSuccess:l[2]||(l[2]=g=>h("success"))},null,8,["modelValue","item"])],64)}}}),Pe=u=>[{title:"Grupo",key:"group-group",children:[{title:"Codigo",key:"group",minWidth:"80px"},{title:"Módulo",key:"module",minWidth:"150px"},{title:"Curso",key:"course",minWidth:"150px"},{title:"Horario",key:"schedules",minWidth:"150px",render:s=>M(F,{},{default:()=>s.schedules})},{title:"Modalidad",key:"modality",minWidth:"120px"}]},{title:"Carga académica",key:"academic-load",children:[{title:"Docente",key:"teacher",minWidth:"120px"},{title:"Laboratorio",key:"laboratory",minWidth:"100px"}]},{title:"Matriculas",key:"enrollment",children:[{title:"Min. Est.",key:"minStudents",width:"60px"},{title:"Mat.",key:"studentEnrolled",width:"60px"},{title:"Res.",key:"studentReserved",width:"60px"},{title:"% Apertura",key:"percentageOpening",render:s=>M(F,{type:s.percentageOpening?s.percentageOpening<60?"error":s.percentageOpening<100?"warning":"success":"default",tertiary:!0,bordered:!1,strong:!0},{default:()=>`${s.percentageOpening}%`})},{title:"Estado",key:"status",width:"150px",fixed:"right",render:s=>M(ze,{item:s,status:s.status,groupId:s.id,onSuccess:u})}]}],Le=(u=J())=>({page:u.page,total:u.total,pageSize:u.pageSize,pageCount:u.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${u.total} registros`}}),De={style:{"border-bottom":"1px solid #e9e9e9"}},Te=D({__name:"EnrollmentGroupDataTable",setup(u){const s=le(),f=c(!1),h=c([]),m=c(!1),d=c([]),l=_e({...J()}),n=c({search:null,page:l.page,pageSize:l.pageSize,filters:{periodId:null}}),r=c({}),v=async i=>{f.value=!0,h.value=await K(i),f.value=!1},g=H(i=>{v(i)},400),o=async()=>{n.value.page=1,await p()},p=async()=>{m.value=!0,r.value=await Ee(n.value),d.value=r.value.data,l.total=r.value.total,l.pageSize=r.value.per_page,l.page=r.value.current_page,l.pageCount=r.value.last_page,m.value=!1},k=H(()=>{o()},400),E=async i=>{n.value.page=i,await p()},y=async i=>{n.value.page=1,n.value.pageSize=i,await p()},a=Pe(p);return(async()=>{var _;await v("");const i=((_=s==null?void 0:s.enrollment)==null?void 0:_.periodId)||"";n.value.filters.periodId=i,await p()})(),(i,_)=>{const B=oe,z=ae,N=Ae,x=te,U=ke;return w(),V("div",De,[e(x,{gutter:12,class:"p-4 flex justify-between"},{default:t(()=>[e(z,{span:8},{default:t(()=>[e(B,{value:n.value.filters.periodId,"onUpdate:value":[_[0]||(_[0]=P=>n.value.filters.periodId=P),o],placeholder:"Seleccionar Periodo Académico",filterable:"",options:h.value,loading:f.value,clearable:"",remote:"",size:"large","virtual-scroll":!1,onSearch:I(g)},null,8,["value","options","loading","onSearch"])]),_:1}),e(z,{span:12},{default:t(()=>[e(N,{size:"large",placeholder:"Buscar",value:n.value.search,"onUpdate:value":_[1]||(_[1]=P=>n.value.search=P),onInput:I(k),clearable:""},{suffix:t(()=>[e(fe,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(z,{span:24},{default:t(()=>[e(U,{key:"id",remote:"",size:"small","single-line":!1,columns:I(a),data:d.value,pagination:I(Le)(l),"pagination-show-size-picker":!0,loading:m.value,"onUpdate:page":E,"onUpdate:pageSize":y},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),ge(i.$slots,"extra",{reLoadDataTable:o})])}}}),it=D({__name:"EnrollmentGroupView",setup(u){const{hasPermission:s}=T(),f=c(!1),h=c([]),m=async n=>{f.value=!0,h.value=await K(n),f.value=!1},d=c([]);return(async()=>{await m(""),d.value=await ie()})(),(n,r)=>{const v=G,g=Z("AppNotAuthorization");return I(s)(["group-manager.send-email","group-manager.edit"])?(w(),V($,{key:0},[e(v,{segmented:{header:!0,content:!0}},{header:t(()=>r[0]||(r[0]=[b("h6",{class:"text-sm text-gray-400"},"Gestión de grupos",-1),S(" Grupos aperturados ")])),action:t(()=>r[1]||(r[1]=[])),_:1}),e(Te)],64)):(w(),L(g,{key:1}))}}});export{it as default};
