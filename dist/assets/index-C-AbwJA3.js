import{r as R}from"./icon.utils-DDsaHdGI.js";import{c as ee,_ as te}from"./selectables.services-B13-CzzX.js";import{ay as ae,d as $,e as A,r as c,j as W,a8 as F,a9 as z,aH as le,aa as a,ab as e,af as O,az as B,aA as J,aG as L,h as H,aI as oe,aF as K,_ as Q,aJ as ne,ae as M,ad as E,ac as ue}from"./index-C9c7JGRw.js";import{a as se,i as X}from"./DataTable.types-BEg5m_To.js";import{_ as re,a as ie}from"./FormItem-BhYV6jh0.js";import{_ as q,a as G}from"./Col-DDZ8Pssk.js";import{_ as Y}from"./Select-Bv507AmW.js";import{_ as de}from"./InputNumber-CEU98BpE.js";import{_ as pe}from"./Space-B7YONKnB.js";import{_ as ce}from"./Switch-gPDoD87R.js";import{u as me}from"./composables-BO6PXfsE.js";import{_ as _e}from"./Dropdown-CKOP4Jno.js";import{_ as fe}from"./Tag-CIenDrrK.js";import{d as ve}from"./debounce.utils-DqPPCsFD.js";import{d as N}from"./module.services-Bzm_Je4q.js";import{_ as ge}from"./Input-MpWbaTbN.js";import{_ as Ie}from"./DataTable-3NU7cn1U.js";import"./get-DMitJf1L.js";import"./Popover-U50KL7Ta.js";import"./use-merged-state-BO0aND_o.js";import"./Suffix-BAJCskMY.js";import"./get-slot-Bk_rJcZu.js";import"./Tooltip-BbKh1Nso.js";const j=()=>({id:null,curriculumId:null,moduleId:null,studentTypeId:null,price:0,isEnabled:!0}),ye=()=>({moduleId:[{required:!0,message:"Obligatório"}],studentTypeId:[{required:!0,message:"Obligatório"}],price:[{required:!0,message:"Obligatório"}]}),h=ae(),be=async u=>{try{return(await h.post("/module-price/load-data-table",u)).data.data}catch{return se()}},we=async u=>{try{return{status:!0,data:(await h.post("/module-price",u)).data.data}}catch(n){return n.response.status===422?{status:!1,data:n.response.data.errors}:{status:!1,data:null}}},Te=async u=>{try{return{status:!0,data:(await h.put("/module-price",u)).data.data}}catch(n){return n.response.status===422?{status:!1,data:n.response.data.errors}:{status:!1,data:null}}},ke=async u=>{try{return await h.delete("/module-price",{data:{id:u.id}}),!0}catch{return!1}},Z=$({__name:"ModulePriceForm",props:{item:{},modelValue:{type:Boolean},studentTypesItems:{},modulesItems:{},curriculumId:{}},emits:["update:modelValue","success"],setup(u,{emit:n}){const i=n,s=u,f=A({get:()=>s.modelValue,set:d=>i("update:modelValue",d)}),v=c(!1),r=c(null),o=c(j()),l=c(null),g=c({...ye()}),S=async()=>{if(l.value=null,r.value){const d=await r.value.validate();let t=null;d?(v.value=!0,o.value.id?t=await Te(o.value):(o.value.curriculumId=s.curriculumId,t=await we(o.value)),t.status?(i("success"),f.value=!1):l.value=t.data):console.log("Formulario inválido")}v.value=!1},C=()=>{console.log("Inicializando formulario"),o.value=s.item?{...s.item}:j()};return W(f,d=>{d&&C()}),(d,t)=>{const y=Y,b=ie,k=G,P=de,x=ce,T=pe,U=q,m=re,w=O,V=J,D=le;return z(),F(D,{show:f.value,"onUpdate:show":t[8]||(t[8]=p=>f.value=p)},{default:a(()=>[e(V,{style:{width:"600px"},title:d.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:a(()=>[e(T,{justify:"end"},{default:a(()=>[e(w,{tertiary:"",size:"large",onClick:t[7]||(t[7]=p=>f.value=!1),disabled:v.value},{default:a(()=>t[9]||(t[9]=[B(" Cancelar ")])),_:1},8,["disabled"]),e(w,{size:"large",type:"primary",onClick:S,loading:v.value},{default:a(()=>t[10]||(t[10]=[B("Guardar")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[e(m,{ref_key:"formRef",ref:r,model:o.value,rules:g.value,size:"large"},{default:a(()=>[e(U,{gutter:16},{default:a(()=>[e(k,{span:"24"},{default:a(()=>{var p;return[e(b,{path:"studentTypeId",label:"Tipo de estudiante",feedback:(p=l.value)==null?void 0:p.studentTypeId},{default:a(()=>{var I;return[e(y,{value:o.value.studentTypeId,"onUpdate:value":t[0]||(t[0]=_=>o.value.studentTypeId=_),options:d.studentTypesItems,status:((I=l.value)==null?void 0:I.studentTypeId)!=null?"error":"",filterable:"","virtual-scroll":!1,clearable:"","onUpdate:modelValue":t[1]||(t[1]=_=>l.value!=null?l.value.studentTypeId=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),e(k,{span:"24"},{default:a(()=>{var p;return[e(b,{path:"moduleId",label:"Módulo",feedback:(p=l.value)==null?void 0:p.moduleId},{default:a(()=>{var I;return[e(y,{value:o.value.moduleId,"onUpdate:value":t[2]||(t[2]=_=>o.value.moduleId=_),options:d.modulesItems,status:((I=l.value)==null?void 0:I.moduleId)!=null?"error":"",filterable:"","virtual-scroll":!1,clearable:"","onUpdate:modelValue":t[3]||(t[3]=_=>l.value!=null?l.value.moduleId=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),e(k,{span:"8"},{default:a(()=>{var p;return[e(b,{path:"enrollmentPrice",label:"Precio de matrícula",feedback:(p=l.value)==null?void 0:p.price},{default:a(()=>{var I;return[e(P,{value:o.value.price,"onUpdate:value":t[4]||(t[4]=_=>o.value.price=_),status:((I=l.value)==null?void 0:I.price)!=null?"error":"","onUpdate:modelValue":t[5]||(t[5]=_=>l.value!=null?l.value.price=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1}),e(k,{span:"24"},{default:a(()=>[e(T,{justify:"end"},{default:a(()=>[e(b,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:a(()=>[e(x,{value:o.value.isEnabled,"onUpdate:value":t[6]||(t[6]=p=>o.value.isEnabled=p)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),xe=$({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(u,{emit:n}){const i=me(),s=n,f=[{label:"Editar",key:"edit",icon:R("edit-2"),props:{onClick:()=>s("edit")}},{label:"Eliminar",key:"delete",icon:R("trash","red"),props:{style:{color:"red"},onClick:()=>{i.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{s("delete")}})}}}];return(v,r)=>{const o=O,l=_e;return z(),F(l,{options:f,placement:"bottom-start"},{default:a(()=>[e(o,null,{default:a(()=>[e(L,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})}}}),Ve=(u,n)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(i){const s=i;return H(xe,{onEdit:()=>{u(s)},onDelete:()=>{n(s)},item:s},{default:()=>"Editar"})}},{title:"Tipo de Estudiante",key:"studentType",minWidth:"200px"},{title:"Modulo",key:"module",minWidth:"200px"},{title:"Precio de Matricula",key:"price",minWidth:"150px"},{title:"Habilitado",key:"isEnabled",width:"150px",render:i=>H(fe,{type:i.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>i.isEnabled?"	Habilitado":"Deshabilitado"})}],ze=(u=X())=>({page:u.page,total:u.total,pageSize:u.pageSize,pageCount:u.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${u.total} registros`}}),Se={style:{"border-bottom":"1px solid #e9e9e9"}},Ce=$({__name:"DataTable",props:{curriculumId:{}},setup(u){const n=u,i=A(()=>({curriculumId:n.curriculumId})),s=c(!1),f=c([]),v=c(!1),r=c(null),o=oe({...X()}),l=c({search:null,page:o.page,pageSize:o.pageSize,filters:{...i.value}}),g=c({}),d=Ve(m=>{r.value=m,v.value=!0},async m=>{await ke(m),await t()}),t=async()=>{l.value.page=1,await y()},y=async()=>{s.value=!0,g.value=await be(l.value),f.value=g.value.data,o.total=g.value.total,o.pageSize=g.value.per_page,o.page=g.value.current_page,o.pageCount=g.value.last_page,s.value=!1},b=ve(()=>{t()},400),k=async m=>{l.value.page=m,await y()},P=async m=>{l.value.page=1,l.value.pageSize=m,await y()},x=c([]),T=c([]),U=async()=>{x.value=await ee(),T.value=await N({curriculumId:n.curriculumId}),await y()};return W(i,async(m,w)=>{console.log("Filtros alterados",m),l.value.filters=m,T.value=await N({curriculumId:l.value.filters.curriculumId}),await t()},{deep:!0}),U(),(m,w)=>{const V=G,D=ge,p=q,I=Ie;return z(),K(Q,null,[ne(m.$slots,"extra",{reLoadDataTable:t,studentTypesItems:x.value,modulesItems:T.value}),M("div",Se,[e(p,{gutter:12,style:{padding:"12px 16px"}},{default:a(()=>[e(V,{span:12}),e(V,{span:12},{default:a(()=>[e(D,{size:"large",placeholder:"Buscar",value:l.value.search,"onUpdate:value":w[0]||(w[0]=_=>l.value.search=_),onInput:E(b),clearable:""},{suffix:a(()=>[e(L,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),e(p,null,{default:a(()=>[e(V,{span:24},{default:a(()=>[e(I,{key:"id",remote:"","single-line":!1,columns:E(d),data:f.value,pagination:E(ze)(o),"pagination-show-size-picker":!0,loading:s.value,"onUpdate:page":k,"onUpdate:pageSize":P},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1})]),e(Z,{modelValue:v.value,"onUpdate:modelValue":w[1]||(w[1]=_=>v.value=_),item:r.value,onSuccess:t,studentTypesItems:x.value,modulesItems:T.value,curriculumId:n.curriculumId},null,8,["modelValue","item","studentTypesItems","modulesItems","curriculumId"])],64)}}}),Ye=$({__name:"index",setup(u){const n=c([]),i=c(!1),s=c({curriculumId:null});return(async()=>{n.value=await te()})(),(v,r)=>{const o=O,l=Y,g=G,S=q,C=J;return z(),K(Q,null,[e(C,{segmented:{header:!0,content:!0}},{header:a(()=>r[3]||(r[3]=[M("span",{class:"text-sm text-slate-500"}," Precios ",-1),M("h5",{class:"text-lg font-bold text-slate-800"},"Gestión de precios",-1)])),"header-extra":a(()=>[e(o,{"render-icon":E(R)("additem"),onClick:r[0]||(r[0]=d=>i.value=!0)},{default:a(()=>r[4]||(r[4]=[B(" Agregar ")])),_:1},8,["render-icon"])]),action:a(()=>[e(S,{gutter:"16",style:{display:"flex","justify-content":"center"}},{default:a(()=>[e(g,{span:"10"},{default:a(()=>[e(l,{value:s.value.curriculumId,"onUpdate:value":r[1]||(r[1]=d=>s.value.curriculumId=d),placeholder:"Seleccionar Plan de estudio",filterable:"",options:n.value,clearable:"","virtual-scroll":!1},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),s.value.curriculumId?(z(),F(Ce,{key:0,curriculumId:s.value.curriculumId},{extra:a(({reLoadDataTable:d,studentTypesItems:t,modulesItems:y})=>[e(Z,{modelValue:i.value,"onUpdate:modelValue":r[2]||(r[2]=b=>i.value=b),item:null,onSuccess:d,studentTypesItems:t,modulesItems:y,curriculumId:s.value.curriculumId},null,8,["modelValue","onSuccess","studentTypesItems","modulesItems","curriculumId"])]),_:1},8,["curriculumId"])):ue("",!0)],64)}}});export{Ye as default};
