import{r as B}from"./icon.utils-CIVznIo1.js";import{c as ae,_ as le}from"./selectables.services-Ze2tJ2rm.js";import{az as oe,d as $,e as W,r as p,j as J,a9 as C,aa as x,aI as ne,ab as l,ac as t,ag as F,aA as M,aB as K,a3 as L,ad as N,ae as z,aH as Q,h as G,aJ as se,aG as X,_ as Y,aK as ue,af as O,a8 as re}from"./index-Btr2J4-S.js";import{a as ie,i as Z}from"./DataTable.types-BEg5m_To.js";import{_ as de,a as pe}from"./FormItem-DTHTBGaO.js";import{_ as A,a as q}from"./Col-B4KSk3VN.js";import{_ as ee}from"./Select-Ds6ltPuv.js";import{_ as ce}from"./InputNumber-k80CDSeJ.js";import{_ as me}from"./Space-eOyktu_D.js";import{_ as _e}from"./Switch-pUYNdh3o.js";import{u as ve}from"./composables-BYfx2lS0.js";import{_ as fe}from"./Dropdown-BwqC77Es.js";import{N as ge}from"./Tag-BVTYUR8K.js";import{d as Ie}from"./debounce.utils-DqPPCsFD.js";import{d as H}from"./module.services-C3lzFTn1.js";import{_ as ye}from"./Input-CrNUAj63.js";import{_ as be}from"./DataTable-QxyRAXdu.js";import"./get-OrJI3Zgc.js";import"./Popover-CiGR5w5_.js";import"./use-merged-state-C6z3NJbs.js";import"./Suffix-Db-SG-ZY.js";import"./Tooltip-Qo-Jhg78.js";const j=()=>({id:null,curriculumId:null,moduleId:null,studentTypeId:null,price:0,isEnabled:!0}),we=()=>({moduleId:[{required:!0,message:"Obligatório"}],studentTypeId:[{required:!0,message:"Obligatório"}],price:[{required:!0,message:"Obligatório"}]}),U=oe(),Te=async s=>{try{return(await U.post("/module-price/load-data-table",s)).data.data}catch{return ie()}},ke=async s=>{try{return{status:!0,data:(await U.post("/module-price",s)).data.data}}catch(n){return n.response.status===422?{status:!1,data:n.response.data.errors}:{status:!1,data:null}}},xe=async s=>{try{return{status:!0,data:(await U.put("/module-price",s)).data.data}}catch(n){return n.response.status===422?{status:!1,data:n.response.data.errors}:{status:!1,data:null}}},ze=async s=>{try{return await U.delete("/module-price",{data:{id:s.id}}),!0}catch{return!1}},te=$({__name:"ModulePriceForm",props:{item:{},modelValue:{type:Boolean},studentTypesItems:{},modulesItems:{},curriculumId:{}},emits:["update:modelValue","success"],setup(s,{emit:n}){const r=n,u=s,i=W({get:()=>u.modelValue,set:m=>r("update:modelValue",m)}),g=p(!1),y=p(null),a=p(j()),o=p(null),_=p({...we()}),E=async()=>{if(o.value=null,y.value){const m=await y.value.validate();let e=null;m?(g.value=!0,a.value.id?e=await xe(a.value):(a.value.curriculumId=u.curriculumId,e=await ke(a.value)),e.status?(r("success"),i.value=!1):o.value=e.data):console.log("Formulario inválido")}g.value=!1},P=()=>{console.log("Inicializando formulario"),a.value=u.item?{...u.item}:j()};return J(i,m=>{m&&P()}),(m,e)=>{const v=ee,b=pe,w=q,V=ce,h=_e,k=me,D=A,c=de,T=F,S=K,R=ne;return x(),C(R,{show:i.value,"onUpdate:show":e[8]||(e[8]=d=>i.value=d)},{default:l(()=>[t(S,{style:{width:"600px"},title:m.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:l(()=>[t(k,{justify:"end"},{default:l(()=>[t(T,{tertiary:"",size:"large",onClick:e[7]||(e[7]=d=>i.value=!1),disabled:g.value},{default:l(()=>e[9]||(e[9]=[M(" Cancelar ")])),_:1},8,["disabled"]),t(T,{size:"large",type:"primary",onClick:E,loading:g.value},{default:l(()=>e[10]||(e[10]=[M("Guardar")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[t(c,{ref_key:"formRef",ref:y,model:a.value,rules:_.value,size:"large"},{default:l(()=>[t(D,{gutter:16},{default:l(()=>[t(w,{span:"24"},{default:l(()=>{var d;return[t(b,{path:"studentTypeId",label:"Tipo de estudiante",feedback:(d=o.value)==null?void 0:d.studentTypeId},{default:l(()=>{var I;return[t(v,{value:a.value.studentTypeId,"onUpdate:value":e[0]||(e[0]=f=>a.value.studentTypeId=f),options:m.studentTypesItems,status:((I=o.value)==null?void 0:I.studentTypeId)!=null?"error":"",filterable:"","virtual-scroll":!1,clearable:"","onUpdate:modelValue":e[1]||(e[1]=f=>o.value!=null?o.value.studentTypeId=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),t(w,{span:"24"},{default:l(()=>{var d;return[t(b,{path:"moduleId",label:"Módulo",feedback:(d=o.value)==null?void 0:d.moduleId},{default:l(()=>{var I;return[t(v,{value:a.value.moduleId,"onUpdate:value":e[2]||(e[2]=f=>a.value.moduleId=f),options:m.modulesItems,status:((I=o.value)==null?void 0:I.moduleId)!=null?"error":"",filterable:"","virtual-scroll":!1,clearable:"","onUpdate:modelValue":e[3]||(e[3]=f=>o.value!=null?o.value.moduleId=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),t(w,{span:"8"},{default:l(()=>{var d;return[t(b,{path:"enrollmentPrice",label:"Precio de matrícula",feedback:(d=o.value)==null?void 0:d.price},{default:l(()=>{var I;return[t(V,{value:a.value.price,"onUpdate:value":e[4]||(e[4]=f=>a.value.price=f),status:((I=o.value)==null?void 0:I.price)!=null?"error":"","onUpdate:modelValue":e[5]||(e[5]=f=>o.value!=null?o.value.price=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1}),t(w,{span:"24"},{default:l(()=>[t(k,{justify:"end"},{default:l(()=>[t(b,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:l(()=>[t(h,{value:a.value.isEnabled,"onUpdate:value":e[6]||(e[6]=d=>a.value.isEnabled=d)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ve=$({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(s,{emit:n}){const{hasPermission:r}=L(),u=ve(),i=n,g=[{label:"Editar",key:"edit",icon:B("edit-2"),show:r(["module-price.edit"]),props:{onClick:()=>i("edit")}},{label:"Eliminar",key:"delete",icon:B("trash","red"),show:r(["module-price.delete"]),props:{style:{color:"red"},onClick:()=>{u.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{i("delete")}})}}}];return(y,a)=>{const o=F,_=fe;return z(r)(["module-price.edit","module-price.delete"])?(x(),C(_,{key:0,options:g,placement:"bottom-start"},{default:l(()=>[t(o,null,{default:l(()=>[t(Q,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})):N("",!0)}}}),he=(s,n)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(r){const u=r;return G(Ve,{onEdit:()=>{s(u)},onDelete:()=>{n(u)},item:u},{default:()=>"Editar"})}},{title:"Tipo de Estudiante",key:"studentType",minWidth:"200px"},{title:"Modulo",key:"module",minWidth:"200px"},{title:"Precio de Matricula",key:"price",minWidth:"150px"},{title:"Habilitado",key:"isEnabled",width:"150px",render:r=>G(ge,{type:r.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>r.isEnabled?"	Habilitado":"Deshabilitado"})}],Se=(s=Z())=>({page:s.page,total:s.total,pageSize:s.pageSize,pageCount:s.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${s.total} registros`}}),Ce={style:{"border-bottom":"1px solid #e9e9e9"}},Ee=$({__name:"DataTable",props:{curriculumId:{}},setup(s){const n=s,r=W(()=>({curriculumId:n.curriculumId})),u=p(!1),i=p([]),g=p(!1),y=p(null),a=se({...Z()}),o=p({search:null,page:a.page,pageSize:a.pageSize,filters:{...r.value}}),_=p({}),m=he(c=>{y.value=c,g.value=!0},async c=>{await ze(c),await e()}),e=async()=>{o.value.page=1,await v()},v=async()=>{u.value=!0,_.value=await Te(o.value),i.value=_.value.data,a.total=_.value.total,a.pageSize=_.value.per_page,a.page=_.value.current_page,a.pageCount=_.value.last_page,u.value=!1},b=Ie(()=>{e()},400),w=async c=>{o.value.page=c,await v()},V=async c=>{o.value.page=1,o.value.pageSize=c,await v()},h=p([]),k=p([]),D=async()=>{h.value=await ae(),k.value=await H({curriculumId:n.curriculumId}),await v()};return J(r,async(c,T)=>{console.log("Filtros alterados",c),o.value.filters=c,k.value=await H({curriculumId:o.value.filters.curriculumId}),await e()},{deep:!0}),D(),(c,T)=>{const S=q,R=ye,d=A,I=be;return x(),X(Y,null,[ue(c.$slots,"extra",{reLoadDataTable:e,studentTypesItems:h.value,modulesItems:k.value}),O("div",Ce,[t(d,{gutter:12,style:{padding:"12px 16px"}},{default:l(()=>[t(S,{span:12}),t(S,{span:12},{default:l(()=>[t(R,{size:"large",placeholder:"Buscar",value:o.value.search,"onUpdate:value":T[0]||(T[0]=f=>o.value.search=f),onInput:z(b),clearable:""},{suffix:l(()=>[t(Q,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),t(d,null,{default:l(()=>[t(S,{span:24},{default:l(()=>[t(I,{key:"id",remote:"",size:"small","single-line":!1,columns:z(m),data:i.value,pagination:z(Se)(a),"pagination-show-size-picker":!0,loading:u.value,"onUpdate:page":w,"onUpdate:pageSize":V},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1})]),t(te,{modelValue:g.value,"onUpdate:modelValue":T[1]||(T[1]=f=>g.value=f),item:y.value,onSuccess:e,studentTypesItems:h.value,modulesItems:k.value,curriculumId:n.curriculumId},null,8,["modelValue","item","studentTypesItems","modulesItems","curriculumId"])],64)}}}),Ze=$({__name:"index",setup(s){const{hasPermission:n}=L(),r=p([]),u=p(!1),i=p({curriculumId:null});return(async()=>{r.value=await le()})(),(y,a)=>{const o=F,_=ee,E=q,P=A,m=K,e=re("AppNotAuthorization");return z(n)(["module-price.create","module-price.edit","module-price.delete","module-price.view"])?(x(),X(Y,{key:0},[t(m,{segmented:{header:!0,content:!0}},{header:l(()=>a[3]||(a[3]=[O("span",{class:"text-sm text-slate-500"}," Precios ",-1),O("h5",{class:"text-lg font-bold text-slate-800"},"Gestión de precios",-1)])),"header-extra":l(()=>[z(n)(["module-price.create"])?(x(),C(o,{key:0,type:"primary",size:"large","render-icon":z(B)("additem"),onClick:a[0]||(a[0]=v=>u.value=!0)},{default:l(()=>a[4]||(a[4]=[M(" Agregar ")])),_:1},8,["render-icon"])):N("",!0)]),action:l(()=>[t(P,{gutter:"16",style:{display:"flex","justify-content":"center"}},{default:l(()=>[t(E,{span:"10"},{default:l(()=>[t(_,{value:i.value.curriculumId,"onUpdate:value":a[1]||(a[1]=v=>i.value.curriculumId=v),placeholder:"Seleccionar Plan de estudio",filterable:"",options:r.value,clearable:"","virtual-scroll":!1},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),i.value.curriculumId?(x(),C(Ee,{key:0,curriculumId:i.value.curriculumId},{extra:l(({reLoadDataTable:v,studentTypesItems:b,modulesItems:w})=>[t(te,{modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=V=>u.value=V),item:null,onSuccess:v,studentTypesItems:b,modulesItems:w,curriculumId:i.value.curriculumId},null,8,["modelValue","onSuccess","studentTypesItems","modulesItems","curriculumId"])]),_:1},8,["curriculumId"])):N("",!0)],64)):(x(),C(e,{key:1}))}}});export{Ze as default};
