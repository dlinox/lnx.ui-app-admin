import{u as ae}from"./period.stores-BK74wwMV.js";import{a as oe,i as F}from"./DataTable.types-BEg5m_To.js";import{a as q,_ as ne}from"./selectables.services-qRu4Op-i.js";import{a as H,f as le,g as se,h as re}from"./group.services-BPJ7tV14.js";import{ay as ue,d as D,e as J,r as d,j as K,a8 as Q,a9 as S,aa as t,ab as e,aA as N,ae as y,aF as O,_ as P,aT as ie,ag as x,af as M,az as I,aH as X,ad as z,a7 as pe,ac as de,h as U,aI as ce,aJ as me,aG as _e}from"./index-Mm-w-23V.js";import{r as fe}from"./icon.utils-CJqgT2q4.js";import{_ as ge}from"./Table-D8_vIWlF.js";import{u as ve}from"./composables-Cniqsi4X.js";import{_ as ye,a as be}from"./FormItem-Ck8B0f5W.js";import{_ as Y,a as Z}from"./Col-DSV9bJWa.js";import{_ as ee}from"./Select-BgP3DZgt.js";import{_ as he}from"./Alert-rNjMcedN.js";import{_ as Ce}from"./Space-aSEcdxs0.js";import{_ as we}from"./ButtonGroup-Df2NGmyL.js";import{_ as W}from"./Tag-hxCWo2xn.js";import{d as j}from"./debounce.utils-DqPPCsFD.js";import{_ as Ie}from"./Input-Dcwlxepe.js";import{_ as Se}from"./DataTable-D0CufK-E.js";import"./get-CmkOQxkd.js";import"./Popover-DJdlSI1t.js";import"./use-merged-state-BlrC8VEx.js";import"./Suffix-CqsLXtUP.js";import"./Tooltip-EMVPpn5m.js";import"./Dropdown-DhS2jsXU.js";const G=ue(),Ee=async r=>{try{return(await G.post("/enrollment-groups/load-data-table",r)).data.data}catch{return oe()}},Ae=async r=>{try{return(await G.get("/enrollment-groups/get-students/"+r)).data.data}catch{return[]}},ke=async r=>{try{return await G.post("/enrollment-groups/send-massive-email/"+r),!0}catch{return!1}},xe=D({__name:"EnrolledStudents",props:{modelValue:{type:Boolean},groupId:{}},emits:["update:modelValue","success"],setup(r,{emit:o}){const g=o,_=r,i=J({get:()=>_.modelValue,set:n=>g("update:modelValue",n)}),p=d(!1),l=d([]),s=async()=>{const n=await Ae(_.groupId);l.value=n},c=async()=>{p.value=!0;try{await ke(_.groupId),g("success")}catch(n){console.error(n)}finally{p.value=!1}},f=async()=>{await s()};return K(i,async n=>{n&&await f()}),(n,m)=>{const b=ge,A=M,v=H,a=N,h=X;return S(),Q(h,{show:i.value,"onUpdate:show":m[1]||(m[1]=C=>i.value=C),class:"content-table"},{default:t(()=>[e(a,{style:{width:"600px"},title:"Estudiantes Matriculados",bordered:!1,size:"small",role:"dialog","aria-modal":"true",segmented:{content:!0,footer:!0}},{footer:t(()=>[e(v,{justify:"end"},{default:t(()=>[e(A,{onClick:m[0]||(m[0]=()=>i.value=!1)},{default:t(()=>m[3]||(m[3]=[I("Cerrar")])),_:1}),e(A,{type:"primary",loading:p.value,onClick:c},{default:t(()=>m[4]||(m[4]=[I(" Enviar correo de confirmación ")])),_:1},8,["loading"])]),_:1})]),default:t(()=>[e(b,{bordered:!1,"single-line":!1},{default:t(()=>[m[2]||(m[2]=y("thead",null,[y("tr",null,[y("th",null,"N°"),y("th",null,"Estudiante"),y("th",null,"Celular"),y("th",null,"Correo")])],-1)),y("tbody",null,[(S(!0),O(P,null,ie(l.value,(C,u)=>(S(),O("tr",{key:u},[y("td",null,x(u+1),1),y("td",null,x(C.student),1),y("td",null,x(C.phone),1),y("td",null,x(C.email),1)]))),128))])]),_:1})]),_:1})]),_:1},8,["show"])}}}),Oe=D({__name:"FormManagerGroup",props:{modelValue:{type:Boolean},item:{}},emits:["update:modelValue","success"],setup(r,{emit:o}){const g=ve(),_=o,i=d([]),p=d([]),l=r,s=J({get:()=>l.modelValue,set:v=>_("update:modelValue",v)}),c=d(!1),f=d(!1),n=d({id:null,teacherId:null,laboratoryId:null,status:"ABIERTO"}),m=async()=>{g.warning({title:"Confirmar",content:"¿Está seguro que desea CANCELAR este registro?, No podrá revertir esta acción.",positiveText:"Confirmar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{b()}})},b=async()=>{f.value=!0,n.value.id=l.item.id,await le(n.value)&&(_("success"),s.value=!1),f.value=!1},A=async()=>{console.log("Inicializando formulario"),n.value.teacherId=l.item.teacherId,n.value.laboratoryId=l.item.laboratoryId,n.value.status=l.item.status,i.value=await se();let v=await re();p.value=v.filter(a=>{const h=a.label.split("-")[0];return l.item.modality==="PRESENCIAL"?h==="LABORATORIO":l.item.modality==="VIRTUAL"?h==="VIRTUAL":!1}).map(a=>({value:a.value,label:a.label.split("-")[1].trim()}))};return K(s,async v=>{v&&await A()}),(v,a)=>{const h=ee,C=be,u=Z,w=he,$=Y,R=ye,V=M,T=Ce,B=H,L=N,te=X;return S(),O(P,null,[e(te,{show:s.value,"onUpdate:show":a[6]||(a[6]=k=>s.value=k)},{default:t(()=>{var k;return[e(L,{style:{width:"600px"},title:`${(k=v.item)==null?void 0:k.modality} - Gestionar grupo`,bordered:!1,size:"small",role:"dialog","aria-modal":"true",segmented:{content:!0,footer:!0}},{footer:t(()=>[e(B,{justify:"end"},{default:t(()=>[e(V,{onClick:a[4]||(a[4]=()=>s.value=!1)},{default:t(()=>a[9]||(a[9]=[I("Cancelar")])),_:1}),e(V,{type:"primary",onClick:a[5]||(a[5]=E=>n.value.status==="CANCELADO"?m():b()),loading:f.value},{default:t(()=>a[10]||(a[10]=[I(" Guardar ")])),_:1},8,["loading"])]),_:1})]),default:t(()=>[e(R,{ref:"formRef",model:n.value},{default:t(()=>[e($,{gutter:16},{default:t(()=>[e(u,{span:24},{default:t(()=>[e(C,{label:"Docente",path:"teacherId"},{default:t(()=>[e(h,{value:n.value.teacherId,"onUpdate:value":a[0]||(a[0]=E=>n.value.teacherId=E),placeholder:"Seleccionar Docente",filterable:"",options:i.value,clearable:"",remote:"","virtual-scroll":!1},null,8,["value","options"])]),_:1})]),_:1}),e(u,{span:24},{default:t(()=>[e(C,{label:"Laboratorio",path:"laboratoryId"},{default:t(()=>[e(h,{value:n.value.laboratoryId,"onUpdate:value":a[1]||(a[1]=E=>n.value.laboratoryId=E),placeholder:"Seleccionar Laboratorio",filterable:"",options:p.value,clearable:"",remote:"","virtual-scroll":!1},null,8,["value","options"])]),_:1})]),_:1}),e(u,{span:24},{default:t(()=>[e(C,{label:"Estado",path:"status"},{default:t(()=>[e(h,{value:n.value.status,"onUpdate:value":a[2]||(a[2]=E=>n.value.status=E),placeholder:"Seleccionar Estado",options:[{label:"ABIERTO",value:"ABIERTO"},{label:"CERRADO",value:"CERRADO"},{label:"CANCELADO",value:"CANCELADO"}],"virtual-scroll":!1},null,8,["value"])]),_:1})]),_:1}),e(u,{span:24},{default:t(()=>[e(w,{type:n.value.status==="CANCELADO"?"error":"info","show-icon":"",title:`GRUPO ${n.value.status}`,closable:!1},{default:t(()=>[I(x(n.value.status==="CERRADO"?"Las inscripciones virtuales para este grupo están cerradas, pero aún puede realizarse la matrícula de manera presencial.":n.value.status==="CANCELADO"?"Los estudiantes no podrán realizar la matrícula de manera presencial ni virtual, y los estudiantes que ya están matriculados serán desvinculados del grupo, sus inscripciones pasarán a un estado de 'CANCELADO'.":"Las inscripciones estan habilitada para todos los estudiantes, tanto virtual como presencialmente."),1)]),_:1},8,["type","title"])]),_:1})]),_:1})]),_:1},8,["model"]),e(T,{justify:"end",class:"p-3"},{default:t(()=>[e(V,{onClick:a[3]||(a[3]=E=>c.value=!0),loading:f.value,"render-icon":z(fe)("people")},{default:t(()=>a[8]||(a[8]=[I(" Estudiantes MATRICULADOS ")])),_:1},8,["loading","render-icon"])]),_:1})]),_:1},8,["title"])]}),_:1},8,["show"]),e(xe,{modelValue:c.value,"onUpdate:modelValue":a[7]||(a[7]=k=>c.value=k),groupId:l.item.id},null,8,["modelValue","groupId"])],64)}}}),Re=D({__name:"GroupStatus",props:{groupId:{},status:{},item:{}},emits:["success"],setup(r,{emit:o}){const g=o,_=d(!1);return(i,p)=>{const l=M,s=pe("LnxIcon"),c=we;return S(),O(P,null,[e(c,null,{default:t(()=>[e(l,{quaternary:""},{default:t(()=>[I(x(i.status),1)]),_:1}),i.status=="ABIERTO"||i.status=="CERRADO"?(S(),Q(l,{key:0,tertiary:"",onClick:p[0]||(p[0]=f=>_.value=!0)},{icon:t(()=>[e(s,{"icon-name":"edit"})]),_:1})):de("",!0)]),_:1}),e(Oe,{modelValue:_.value,"onUpdate:modelValue":p[1]||(p[1]=f=>_.value=f),item:i.item,onSuccess:p[2]||(p[2]=f=>g("success"))},null,8,["modelValue","item"])],64)}}}),Ve=r=>[{title:"Grupo",key:"group-group",children:[{title:"Codigo",key:"group",minWidth:"80px"},{title:"Módulo",key:"module",minWidth:"150px"},{title:"Curso",key:"course",minWidth:"150px"},{title:"Horario",key:"schedules",minWidth:"150px",render:o=>U(W,{},{default:()=>o.schedules})},{title:"Modalidad",key:"modality",minWidth:"120px"}]},{title:"Carga académica",key:"academic-load",children:[{title:"Docente",key:"teacher",minWidth:"120px"},{title:"Laboratorio",key:"laboratory",minWidth:"100px"}]},{title:"Matriculas",key:"enrollment",children:[{title:"Min. Est.",key:"minStudents",width:"60px"},{title:"Mat.",key:"studentEnrolled",width:"60px"},{title:"Res.",key:"studentReserved",width:"60px"},{title:"% Apertura",key:"percentageOpening",render:o=>U(W,{type:o.percentageOpening?o.percentageOpening<60?"error":o.percentageOpening<100?"warning":"success":"default",tertiary:!0,bordered:!1,strong:!0},{default:()=>`${o.percentageOpening}%`})},{title:"Estado",key:"status",width:"150px",fixed:"right",render:o=>U(Re,{item:o,status:o.status,groupId:o.id,onSuccess:r})}]}],Le=(r=F())=>({page:r.page,total:r.total,pageSize:r.pageSize,pageCount:r.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${r.total} registros`}}),ze={style:{"border-bottom":"1px solid #e9e9e9"}},De=D({__name:"EnrollmentGroupDataTable",setup(r){const o=ae(),g=d(!1),_=d([]),i=d(!1),p=d([]),l=ce({...F()}),s=d({search:null,page:l.page,pageSize:l.pageSize,filters:{periodId:null}}),c=d({}),f=async u=>{g.value=!0,_.value=await q(u),g.value=!1},n=j(u=>{f(u)},400),m=async()=>{s.value.page=1,await b()},b=async()=>{i.value=!0,c.value=await Ee(s.value),p.value=c.value.data,l.total=c.value.total,l.pageSize=c.value.per_page,l.page=c.value.current_page,l.pageCount=c.value.last_page,i.value=!1},A=j(()=>{m()},400),v=async u=>{s.value.page=u,await b()},a=async u=>{s.value.page=1,s.value.pageSize=u,await b()},h=Ve(b);return(async()=>{var w;await f("");const u=((w=o==null?void 0:o.enrollment)==null?void 0:w.periodId)||"";s.value.filters.periodId=u,await b()})(),(u,w)=>{const $=ee,R=Z,V=Ie,T=Y,B=Se;return S(),O("div",ze,[e(T,{gutter:12,class:"p-4 flex justify-between"},{default:t(()=>[e(R,{span:8},{default:t(()=>[e($,{value:s.value.filters.periodId,"onUpdate:value":[w[0]||(w[0]=L=>s.value.filters.periodId=L),m],placeholder:"Seleccionar Periodo Académico",filterable:"",options:_.value,loading:g.value,clearable:"",remote:"",size:"large","virtual-scroll":!1,onSearch:z(n)},null,8,["value","options","loading","onSearch"])]),_:1}),e(R,{span:12},{default:t(()=>[e(V,{size:"large",placeholder:"Buscar",value:s.value.search,"onUpdate:value":w[1]||(w[1]=L=>s.value.search=L),onInput:z(A),clearable:""},{suffix:t(()=>[e(_e,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),e(T,null,{default:t(()=>[e(R,{span:24},{default:t(()=>[e(B,{key:"id",remote:"","single-line":!1,columns:z(h),data:p.value,pagination:z(Le)(l),"pagination-show-size-picker":!0,loading:i.value,"onUpdate:page":v,"onUpdate:pageSize":a},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),me(u.$slots,"extra",{reLoadDataTable:m})])}}}),lt=D({__name:"EnrollmentGroupView",setup(r){const o=d(!1),g=d([]),_=async l=>{o.value=!0,g.value=await q(l),o.value=!1},i=d([]);return(async()=>{await _(""),i.value=await ne()})(),(l,s)=>{const c=N;return S(),O(P,null,[e(c,{segmented:{header:!0,content:!0}},{header:t(()=>s[0]||(s[0]=[y("h6",{class:"text-sm text-gray-400"},"Gestión de grupos",-1),I(" Grupos aperturados ")])),action:t(()=>s[1]||(s[1]=[])),_:1}),e(De)],64)}}});export{lt as default};
