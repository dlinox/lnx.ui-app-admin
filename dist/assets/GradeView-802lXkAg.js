import{u as J}from"./period.stores-C0ndm13s.js";import{a as K,i as L}from"./DataTable.types-BEg5m_To.js";import{az as Y,d as W,r as _,j as Q,aM as X,aG as m,aa as s,ac as l,ab as u,aA as U,ag as Z,aB as j,af as p,_ as C,aU as V,ah as D,a9 as M,aY as ee,w as ae,ae as N,aI as te,a3 as q,h as E,aJ as ne,aK as oe,aH as re,a8 as le}from"./index-DRRg_eBM.js";import{u as se}from"./composables-i7kb42iS.js";import{_ as ie}from"./Table-CmcYEevV.js";import{_ as ue}from"./InputNumber-CLbWbXu1.js";import{_ as de}from"./Space-BljgdQMa.js";import{N as O}from"./Tag-DLFVs5T4.js";import{a as H}from"./selectables.services-hf1ic-Kf.js";import{d as R}from"./debounce.utils-DqPPCsFD.js";import{_ as pe,a as ce}from"./Col-B7SFfu7K.js";import{_ as me}from"./Select-BARTLa82.js";import{_ as ge}from"./Input-BJ4gQKpn.js";import{_ as _e}from"./DataTable--fXJaN9P.js";import"./Suffix-ByhxVsOv.js";import"./use-merged-state-CaVxhrEA.js";import"./Popover-CJcKKGg6.js";import"./get-CpGV-8IY.js";import"./Tooltip-BnJ19Urq.js";import"./Dropdown-CweT_dMY.js";const F=Y(),fe=async a=>{try{return(await F.post("/enrollment-grade/groups/load-data-table",a)).data.data}catch{return K()}},ve=async a=>{try{return(await F.post(`/enrollment-grade/group/${a}/students`)).data.data}catch{return!1}},ye=async a=>{try{return await F.post("/enrollment-grade/students/save",a),!0}catch{return!1}},he={key:0},we={key:1},be={class:"border-s"},ke=W({__name:"GradeForm",props:{groupId:{}},setup(a){const d=a,k=se(),f=_(!1),c=_(!1),x=_([]),t=_({}),r=n=>{let e=x.value[n];if(t.value.gradingModel==1){let v=e.gradeUnits.filter(o=>o.order!==2),w=v.reduce((o,y)=>o+(parseFloat(y.grade)||0),0),S=v.length>0?w/v.length:0,G=e.gradeUnits.find(o=>o.order===2),T=G&&G.grade||0;e.finalGrade=Number(S*.9+T),e.finalGrade=Math.round(e.finalGrade)}else if(t.value.gradingModel==2){let v=e.gradeUnits.reduce((S,G)=>S+(Number(G.grade)||0),0),w=e.gradeUnits.length;e.finalGrade=w>0?Number(v/w):0,e.finalGrade=Math.round(e.finalGrade)}},h=()=>x.value.map(n=>({enrollmentGroupId:n.id,studentId:n.studentId,gradeId:n.gradeId,finalGrade:n.finalGrade,gradeUnits:n.gradeUnits.map(e=>({id:e.id,grade:e.grade,order:e.order}))})),P=async()=>{c.value=!0;const n=h();await ye({grades:n})&&(f.value=!1),c.value=!1},B=async()=>{c.value=!0;let n=await ve(d.groupId);if(!n){c.value=!1;return}x.value=n.grades,t.value=n.group,c.value=!1};return Q(f,n=>{n&&B()}),(n,e)=>{const v=Z,w=ue,S=ie,G=de,T=j,o=te,y=X("permission");return s(),m(C,null,[l(v,{onClick:e[0]||(e[0]=z=>f.value=!0)},{default:u(()=>e[4]||(e[4]=[U(" NOTAS ")])),_:1}),l(o,{show:f.value,"onUpdate:show":e[3]||(e[3]=z=>f.value=z)},{default:u(()=>{var z,I;return[l(T,{style:{width:"1200px"},title:`INGRESO DE NOTAS: ${(z=t.value)==null?void 0:z.course} - ${(I=t.value)==null?void 0:I.group}`,segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true",class:"no-padding"},{footer:u(()=>[l(G,{justify:"end"},{default:u(()=>[l(v,{tertiary:"",size:"large",onClick:e[1]||(e[1]=i=>f.value=!1),disabled:c.value},{default:u(()=>e[10]||(e[10]=[U(" Cancelar ")])),_:1},8,["disabled"]),ae((s(),M(v,{size:"large",type:"primary",onClick:e[2]||(e[2]=i=>{var b,g;N(k).warning({title:"Confirmar: "+((b=t.value)==null?void 0:b.course)+" - "+((g=t.value)==null?void 0:g.group),content:"¿Está seguro que desea guardar los cambios?",positiveText:"Guardar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"info"},onPositiveClick:()=>{P()}})}),loading:c.value},{default:u(()=>e[11]||(e[11]=[U(" Guardar ")])),_:1},8,["loading"])),[[y,["enrollment-grade.create"]]])]),_:1})]),default:u(()=>[l(S,{bordered:!1,"single-line":!0,size:"small"},{default:u(()=>[p("thead",null,[p("tr",null,[e[5]||(e[5]=p("th",null,"N°",-1)),e[6]||(e[6]=p("th",null,"Apellido Paterno",-1)),e[7]||(e[7]=p("th",null,"Apellido Materno",-1)),e[8]||(e[8]=p("th",null,"Nombre",-1)),(s(!0),m(C,null,V(t.value.units,i=>(s(),m("th",{style:{width:"120px"},key:i},[t.value.gradingModel==1?(s(),m("span",he,[i==1?(s(),m(C,{key:0},[U(" Prom. Cap. ")],64)):(s(),m(C,{key:1},[U(" Act. ")],64))])):(s(),m("span",we," Unidad "+D(i),1))]))),128)),e[9]||(e[9]=p("th",{style:{width:"120px"}},"Nota final",-1))])]),p("tbody",null,[(s(!0),m(C,null,V(x.value,(i,b)=>(s(),m("tr",{key:i.id},[p("td",null,D(b+1),1),p("td",null,D(i.lastNameFather),1),p("td",null,D(i.lastNameMother),1),p("td",null,D(i.name),1),(s(!0),m(C,null,V(i.gradeUnits,(g,$)=>(s(),m("td",{key:$},[t.value.gradingModel==1&&g.order==2?(s(),M(w,{key:0,value:g.grade,"onUpdate:value":[A=>g.grade=A,A=>r(b)],placeholder:"0.00",max:2,min:0},null,8,["value","onUpdate:value"])):(s(),M(w,{key:1,value:g.grade,"onUpdate:value":[A=>g.grade=A,A=>r(b)],placeholder:"0.00",precision:2,max:20,min:0},null,8,["value","onUpdate:value"]))]))),128)),p("td",be,[l(w,{value:i.finalGrade,"onUpdate:value":g=>i.finalGrade=g,placeholder:"0.00",class:ee(i.finalGrade<11?"text-red":""),precision:0,min:0,max:20,readonly:"","show-button":!1},null,8,["value","onUpdate:value","class"])])]))),128))])]),_:1})]),_:1},8,["title"])]}),_:1},8,["show"])],64)}}}),{hasPermission:xe}=q(),Ge=()=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(a){const d=a;return xe(["enrollment-grade.view","enrollment-grade.create"])?E(ke,{groupId:d.id}):null}},{title:"Grupo",key:"group-group",children:[{title:"Codigo",key:"group",minWidth:"80px"},{title:"Curso",key:"course",minWidth:"150px"},{title:"Horario",key:"schedules",minWidth:"150px",render:a=>E(O,{},{default:()=>a.schedules})},{title:"Modalidad",key:"modality",minWidth:"120px"}]},{title:"Carga académica",key:"academic-load",children:[{title:"Docente",key:"teacher",minWidth:"120px"},{title:"Laboratorio",key:"laboratory",minWidth:"100px"}]},{title:"Matriculas",key:"enrollment",children:[{title:"Estado",key:"status",width:"150px",fixed:"right",render:a=>E(O,{type:a.status==="CANCELADO"?"error":"info",round:!1},{default:()=>a.status})}]}],Se=(a=L())=>({page:a.page,total:a.total,pageSize:a.pageSize,pageCount:a.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`${a.total} registros`}}),ze={style:{"border-bottom":"1px solid #e9e9e9"}},Ce=W({__name:"GroupDataTable",setup(a){const d=J(),k=_(!1),f=_([]),c=_(!1),x=_([]),t=ne({...L()}),r=_({search:null,page:t.page,pageSize:t.pageSize,filters:{periodId:null}}),h=_({}),P=async o=>{k.value=!0,f.value=await H(o),k.value=!1},B=R(o=>{P(o)},400),n=async()=>{r.value.page=1,await e()},e=async()=>{c.value=!0,h.value=await fe(r.value),x.value=h.value.data,t.total=h.value.total,t.pageSize=h.value.per_page,t.page=h.value.current_page,t.pageCount=h.value.last_page,c.value=!1},v=R(()=>{n()},400),w=async o=>{r.value.page=o,await e()},S=async o=>{r.value.page=1,r.value.pageSize=o,await e()},G=Ge();return(async()=>{var y;await P("");const o=((y=d==null?void 0:d.enrollment)==null?void 0:y.periodId)||"";r.value.filters.periodId=o,await e()})(),(o,y)=>{const z=me,I=ce,i=ge,b=pe,g=_e;return s(),m("div",ze,[l(b,{gutter:12,class:"p-4 flex justify-between"},{default:u(()=>[l(I,{span:8},{default:u(()=>[l(z,{value:r.value.filters.periodId,"onUpdate:value":[y[0]||(y[0]=$=>r.value.filters.periodId=$),n],placeholder:"Seleccionar Periodo Académico",filterable:"",options:f.value,loading:k.value,clearable:"",remote:"",size:"large","virtual-scroll":!1,onSearch:N(B)},null,8,["value","options","loading","onSearch"])]),_:1}),l(I,{span:12},{default:u(()=>[l(i,{size:"large",placeholder:"Buscar",value:r.value.search,"onUpdate:value":y[1]||(y[1]=$=>r.value.search=$),onInput:N(v),clearable:""},{suffix:u(()=>[l(re,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),l(b,null,{default:u(()=>[l(I,{span:24},{default:u(()=>[l(g,{key:"id",remote:"",size:"small","single-line":!1,columns:N(G),data:x.value,pagination:N(Se)(t),"pagination-show-size-picker":!0,loading:c.value,"onUpdate:page":w,"onUpdate:pageSize":S},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),oe(o.$slots,"extra",{reLoadDataTable:n})])}}}),Je=W({__name:"GradeView",setup(a){const{hasPermission:d}=q(),k=_(!1),f=_([]),c=async t=>{k.value=!0,f.value=await H(t),k.value=!1};return(async()=>{await c("")})(),(t,r)=>{const h=j,P=le("AppNotAuthorization");return N(d)(["enrollment-grade.view","enrollment-grade.create"])?(s(),m(C,{key:0},[l(h,{segmented:{header:!0,content:!0}},{header:u(()=>r[0]||(r[0]=[p("h6",{class:"text-sm text-gray-400"},"Ingreso de notas",-1),U(" Notas ")])),action:u(()=>r[1]||(r[1]=[])),_:1}),l(Ce)],64)):(s(),M(P,{key:1}))}}});export{Je as default};
