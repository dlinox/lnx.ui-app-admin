import{r as A}from"./icon.utils-D7BmKQQ8.js";import{az as W,d as U,r as E,e as $,j as Y,a8 as Z,a9 as j,aa as C,aI as Q,ab as l,ac as t,aB as X,aA as I,b2 as ue,b3 as ie,af as c,ag as H,ae as D,aG as z,_ as L,aL as K,aY as de,aZ as pe,ah as f,ad as ce}from"./index-VnlbSWoD.js";import{_ as me}from"./Alert-hJa_Wfyo.js";import{_ as _e,a as ge}from"./FormItem-wbeg7Rmc.js";import{_ as ee,a as te}from"./Col-D62vBcWk.js";import{_ as ve}from"./Input-BjvMqLmR.js";import{_ as fe}from"./Select-Df7rPK9_.js";import{a as ye,_ as be}from"./ListItem-CMLNF079.js";import{_ as we}from"./Thing-DAg0qjqL.js";import{N as Ie}from"./Tag-D-Mvyznn.js";import{_ as Ee}from"./Switch-DcbwJYPH.js";import{a as he}from"./DataTable.types-BEg5m_To.js";import{u as Pe}from"./composables-bTB8ALIv.js";import{_ as xe}from"./Dropdown-FcmlDduf.js";const h=W(),dt=async r=>{try{return(await h.post("/enrollment/load-data-table",r)).data.data}catch{return he()}},pt=async r=>{try{return{status:!0,data:(await h.post("/enrollment/module-store",{...r})).data.data}}catch{return{status:!1,data:null}}},ke=async r=>{try{return{status:!0,data:(await h.post("/enrollment/group-store",{...r})).data.data}}catch{return{status:!1,data:null}}},Se=async r=>{try{return{status:!0,data:(await h.post("/enrollment/group-update",{...r})).data.data}}catch{return{status:!1,data:null}}},Ge=async r=>{try{return{status:!0,data:(await h.post("/enrollment/group-reserved",{...r})).data.data}}catch{return{status:!1,data:null}}},Ce=async r=>{try{return{status:!0,data:(await h.post("/enrollment/group-cancel",{...r})).data.data}}catch{return{status:!1,data:null}}},Ne=async r=>{try{return{status:!0,data:(await h.post("/enrollment/enabled-groups",r)).data.data}}catch{return{status:!1,data:null}}},ct=async(r,n,d)=>{try{return(await h.post("/enrollment/student-enrollment-avaliable",{studentId:r,curriculumId:n,periodId:d})).data.data}catch{return null}},mt=async(r,n)=>{try{return{status:!0,data:(await h.post(`/enrollment/${r}/student/${n}/curriculum`)).data.data}}catch{return{status:!1,data:[]}}},_t=async r=>{try{return(await h.post("/enrollment/download-enrollment-pdf",{...r},{responseType:"blob"})).data}catch{return null}},Ve=async r=>{try{return(await h.post("/enrollment/get-enrollment-group-payments",{...r})).data.data}catch{return[]}},gt=async(r,n,d)=>{try{return(await h.post("/enrollment/student-enrollment-avaliable-special",{studentId:r,curriculumId:n,periodId:d})).data.data}catch{return null}},J=()=>({id:null,studentId:null,groupId:null,payments:[],includeEnrollmentPrice:!1}),Fe=W(),Re=async r=>{try{const n={...r};return n.paymentFile&&(n.paymentFile=await new Promise((s,m)=>{const v=new FileReader;v.readAsDataURL(n.paymentFile),v.onload=()=>s(v.result),v.onerror=m})),(await Fe.post("/payment/validate",n)).data.data}catch{return{token:null}}},Te=()=>({studentId:null,amount:null,date:null,sequenceNumber:null,paymentTypeId:7,paymentFile:null}),ze=r=>({studentId:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],amount:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:"Debe ser un número",trigger:["blur","input"],validator:(n,d)=>{if(d){if(!/^\d*\.?\d*$/.test(d))return new Error("Debe ser un número")}else return new Error("Obligatorio");return!0}}],date:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],sequenceNumber:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:r===7?"Debe tener 7 digitos":"Debe tener 6 digitos",trigger:["blur","input"],validator:(n,d)=>{if(d)if(/^\d*$/.test(d)){if(r===7&&d.length!==7)return new Error("Debe tener 7 digitos");if(r===9&&d.length!==6)return new Error("Debe tener 6 digitos")}else return new Error("Debe ser un número");else return new Error("Obligatorio");return!0}}],paymentTypeId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),Ae=U({__name:"PaymentForm",props:{modelValue:{type:Boolean},studentId:{}},emits:["update:modelValue","success"],setup(r,{emit:n}){const d=n,s=r,m=E(!1),v=$({get:()=>s.modelValue,set:P=>d("update:modelValue",P)}),x=E(null),u=E({}),g=$(()=>ze(u.value.paymentTypeId)),_=E(null),y=P=>{const p=P.target;if(!p.files||p.files.length===0){u.value.paymentFile=null;return}const N=p.files[0];if(!["image/jpeg","image/gif","image/jpg","image/png","image/webp"].includes(N.type)){alert("El archivo debe ser una imagen válida (JPEG, PNG o WEBP)."),u.value.paymentFile=null,p.value="";return}if(N.size>5*1024*1024){alert("El archivo no debe superar los 5 MB."),u.value.paymentFile=null,p.value="";return}u.value.paymentFile=N},b=async()=>{if(x.value&&!await x.value.validate())return;u.value.studentId=s.studentId,m.value=!0;const P=await Re(u.value);P.token!==null&&(v.value=!1,d("success",{token:P.token,payment:u.value})),m.value=!1},o=()=>{console.log("Inicializando formulario"),u.value=Object.assign({},Te())};return Y(v,P=>{P&&o()}),(P,p)=>{const N=Z("LnxIcon"),O=ue,B=me,F=ve,V=ge,k=te,M=fe,e=H,a=ee,S=_e,G=X,R=Q;return C(),j(R,{show:v.value,"onUpdate:show":p[4]||(p[4]=w=>v.value=w)},{default:l(()=>[t(G,{style:{width:"500px"},title:"REGISTRAR PAGO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:l(()=>[t(B,{title:"¡Importante!",type:"default",class:"mb-4"},{icon:l(()=>[t(O,null,{default:l(()=>[t(N,{"icon-name":"information",size:"20"})]),_:1})]),default:l(()=>[p[5]||(p[5]=I(" Solo se validan pagos realizados, con un día de anticipación. "))]),_:1}),t(S,{ref_key:"formRef",ref:x,model:u.value,rules:g.value,size:"large",onKeydown:ie(b,["enter"])},{default:l(()=>[t(a,{gutter:[16,16]},{default:l(()=>[t(k,{span:"12"},{default:l(()=>[t(V,{path:"amount",label:"Monto"},{default:l(()=>[t(F,{value:u.value.amount,"onUpdate:value":p[0]||(p[0]=w=>u.value.amount=w)},null,8,["value"])]),_:1})]),_:1}),t(k,{span:"12"},{default:l(()=>[t(V,{path:"date",label:"Fecha de pago"},{default:l(()=>[t(F,{placeholder:"",type:"date",value:u.value.date,"onUpdate:value":p[1]||(p[1]=w=>u.value.date=w)},null,8,["value"])]),_:1})]),_:1}),t(k,{span:"12"},{default:l(()=>[t(V,{path:"sequenceNumber",label:"Secuencia"},{default:l(()=>[t(F,{value:u.value.sequenceNumber,"onUpdate:value":p[2]||(p[2]=w=>u.value.sequenceNumber=w)},null,8,["value"])]),_:1})]),_:1}),t(k,{span:"12"},{default:l(()=>[t(V,{path:"paymentTypeId",label:"Metodo de pago"},{default:l(()=>[t(M,{"virtual-scroll":!1,value:u.value.paymentTypeId,"onUpdate:value":p[3]||(p[3]=w=>u.value.paymentTypeId=w),placeholder:"Metodo de pago",options:[{label:"BN - VENTANILLA",value:7},{label:"BN - PAGALO.PE",value:9}]},null,8,["value"])]),_:1})]),_:1}),t(k,{span:"24"},{default:l(()=>[t(V,{path:"paymentFile",label:"Archivo de pago"},{default:l(()=>[c("input",{class:"border w-full p-2 rounded",ref_key:"fileInput",ref:_,onChange:y,"show-button":!1,accept:"image/*",type:"file",placeholder:""},null,544)]),_:1})]),_:1}),t(k,{span:"24"},{default:l(()=>[t(e,{loading:m.value,secondary:"",type:"primary",onClick:b,block:"","render-icon":D(A)("money-tick")},{default:l(()=>p[6]||(p[6]=[I(" Validar Pago ")])),_:1},8,["loading","render-icon"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"])}}}),$e={class:"wrapper-list-groups"},De={class:"table-auto w-full"},Oe={class:"px-4 py-2 flex items-center"},Be={class:"ms-2"},Me={class:"text-end px-4 py-2"},qe={class:"border-b-2 border-gray-500"},Le={class:"px-4 py-2 font-bold text-lg text-end"},Ue={class:"px-4 py-2 font-bold text-lg text-end"},je={key:0,class:"bg-gray-100"},He={class:"px-4 py-2"},Ke={class:"px-4 py-2 font-bold text-lg text-end"},Je={class:"text-red-500 text-sm text-end text-sm"},vt=U({__name:"EnrollmentGroupForm",props:{modelValue:{type:Boolean},isSpecial:{type:Boolean},studentId:{},curriculumId:{},courseId:{},enrollmetGroup:{}},emits:["update:modelValue","success"],setup(r,{emit:n}){const d=n,s=r,m=E(!1),v=$({get:()=>s.modelValue,set:e=>d("update:modelValue",e)}),x=E(!1),u=E([]),g=E([]),_=E(0),y=E(0),b=E(0),o=E(Object.assign({},{...J()})),P=e=>{e?_.value=Number(b.value)+Number(y.value):_.value=Number(b.value)},p=e=>{o.value.payments.push(e.token),g.value.push({token:e.token,amount:e.payment.amount,sequenceNumber:e.payment.sequenceNumber})},N=e=>{o.value.groupId&&o.value.groupId!=e.id?(o.value.groupId=e.id,y.value=e.enrollmentPrice,b.value=e.groupPrice,s.enrollmetGroup?s.enrollmetGroup.withEnrollment?(o.value.includeEnrollmentPrice=!0,_.value=e.groupPrice+e.enrollmentPrice):(o.value.includeEnrollmentPrice=!1,_.value=e.groupPrice):(o.value.includeEnrollmentPrice=e.requireEnrollmentPrice,_.value=e.price)):o.value.groupId==e.id?(o.value.groupId=null,_.value=0,y.value=0,b.value=0,o.value.includeEnrollmentPrice=!1):(o.value.groupId=e.id,y.value=e.enrollmentPrice,b.value=e.groupPrice,s.enrollmetGroup?s.enrollmetGroup.withEnrollment?(o.value.includeEnrollmentPrice=!0,_.value=e.groupPrice+e.enrollmentPrice):(o.value.includeEnrollmentPrice=!1,_.value=e.groupPrice):(o.value.includeEnrollmentPrice=e.requireEnrollmentPrice,_.value=e.price))},O=async()=>{const e=await Ne({studentId:s.studentId,curriculumId:s.curriculumId,courseId:s.courseId,isSpecial:s.isSpecial});u.value=e.data},B=e=>{let S=g.value[e].token;g.value.splice(e,1);let G=o.value.payments.find(w=>w===S);if(!G)return;let R=o.value.payments.indexOf(G);o.value.payments.splice(R,1)},F=()=>g.value.reduce((a,S)=>a+parseFloat(S.amount),0)>=_.value?null:"El monto pagado es menor al total",V=async()=>{var e;if(o.value.studentId=s.studentId,m.value=!0,(e=s.enrollmetGroup)!=null&&e.id){(await Se({...o.value,isSpecial:s.isSpecial})).status&&(d("success"),v.value=!1),m.value=!1;return}else(await ke({...o.value,isSpecial:s.isSpecial})).status&&(d("success"),v.value=!1),m.value=!1},k=async e=>{g.value=await Ve({id:e})},M=async()=>{if(g.value=[],o.value=J(),o.value.payments=[],o.value.groupId=null,_.value=0,await O(),s.enrollmetGroup){let e=u.value.find(a=>a.id==s.enrollmetGroup.groupId);e&&(o.value.groupId=e.id,_.value=e.price,y.value=e.enrollmentPrice,b.value=e.groupPrice,o.value.includeEnrollmentPrice=s.enrollmetGroup.withEnrollment,o.value.includeEnrollmentPrice||(_.value=Number(b.value))),o.value.id=s.enrollmetGroup.id,await k(s.enrollmetGroup.id),g.value.length>0&&g.value.forEach(a=>{o.value.payments.push(a.token)})}console.log("Inicializando formulario")};return Y(v,e=>{e&&M()}),(e,a)=>{const S=Ie,G=H,R=we,w=be,ne=ye,q=te,ae=Z("LnxIcon"),le=Ee,re=ee,oe=X,se=Q;return C(),z(L,null,[t(se,{show:v.value,"onUpdate:show":a[2]||(a[2]=i=>v.value=i)},{default:l(()=>[t(oe,{style:{width:"500px"},title:e.isSpecial?"Matricula Especial":"Matricula Regular",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:l(()=>[t(re,{gutter:[16,16]},{default:l(()=>[t(q,{span:"24"},{default:l(()=>[c("div",$e,[t(ne,{hoverable:"",clickable:""},{header:l(()=>{var i;return[I(" Grupos aperturados ("+f((i=u.value)!=null&&i.length?u.value.length:0)+") ",1)]}),default:l(()=>[(C(!0),z(L,null,K(u.value,i=>(C(),j(w,{key:i.id,class:de({"item-selected":o.value.groupId==i.id}),extra:i.price},{default:l(()=>[t(R,{onClick:T=>N(i)},pe({header:l(()=>[t(S,{bordered:!1,type:i.modality=="VIRTUAL"?"info":"success",size:"small"},{default:l(()=>[I(f(i.modality),1)]),_:2},1032,["type"]),I(" "+f(`${i.group} - S/. ${i.price}`),1)]),default:l(()=>[a[4]||(a[4]=I(" Min.: ")),c("b",null,f(i.minStudents),1),a[5]||(a[5]=I(" | Matriculados: ")),c("b",null,f(i.enrolledStudents),1),a[6]||(a[6]=I(" | Reservados: ")),c("b",null,f(i.reservedStudents),1),a[7]||(a[7]=c("br",null,null,-1)),t(S,{bordered:!1,type:"info",size:"small"},{default:l(()=>[c("strong",null,f(i.schedules.days)+" - "+f(i.schedules.startHour)+" a "+f(i.schedules.endHour),1)]),_:2},1024)]),_:2},[o.value.groupId==i.id?{name:"header-extra",fn:l(()=>[t(G,{circle:"",type:"warning","render-icon":D(A)("verify")},null,8,["render-icon"])]),key:"0"}:void 0]),1032,["onClick"])]),_:2},1032,["class","extra"]))),128))]),_:1})])]),_:1}),t(q,{span:"24"},{default:l(()=>[c("span",{role:"button",onClick:a[0]||(a[0]=i=>x.value=!0),class:"border border-dashed border-gray-300 p-4 rounded-sm flex items-center justify-center cursor-pointer text-gray-400 hover:bg-gray-50 font-bold hover:text-gray-500 mb-4"},[t(ae,{class:"me-3","icon-name":"money-add",size:"20"}),a[8]||(a[8]=I(" Agregar pago "))]),c("table",De,[c("tbody",null,[(C(!0),z(L,null,K(g.value,(i,T)=>(C(),z("tr",{key:T,class:"border-b border-gray-300 border-dashed px-4 py-2"},[c("td",Oe,[t(G,{type:"error",size:"small",secondary:"",onClick:We=>B(T),"render-icon":D(A)("trash")},null,8,["onClick","render-icon"]),c("i",Be,f(i.sequenceNumber),1)]),c("td",Me,"S/. "+f(i.amount),1)]))),128)),c("tr",qe,[a[9]||(a[9]=c("td",{class:"px-4 py-2"},"Total importe",-1)),c("td",Le," S/. "+f(g.value.reduce((i,T)=>i+parseFloat(T.amount),0)),1)]),c("tr",null,[a[10]||(a[10]=c("td",{class:"px-4 py-2"},"Total a pagar",-1)),c("td",Ue," S/. "+f(_.value),1)]),y.value>0?(C(),z("tr",je,[c("td",He,[a[11]||(a[11]=I(" ¿Incluye matrícula? ")),c("strong",null," S/. "+f(y.value),1)]),c("td",Ke,[t(le,{disabled:!o.value.groupId,value:o.value.includeEnrollmentPrice,"onUpdate:value":[a[1]||(a[1]=i=>o.value.includeEnrollmentPrice=i),P]},null,8,["disabled","value"])])])):ce("",!0)])]),c("div",Je,f(F()),1)]),_:1}),t(q,{span:"24"},{default:l(()=>[t(G,{size:"large",type:"primary",onClick:V,block:"",loading:m.value},{default:l(()=>a[12]||(a[12]=[I(" Realizar Matricula ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["show"]),t(Ae,{modelValue:x.value,"onUpdate:modelValue":a[3]||(a[3]=i=>x.value=i),studentId:s.studentId,onSuccess:p},null,8,["modelValue","studentId"])],64)}}}),ft=U({__name:"EditEnrollmentGroup",props:{item:{}},emits:["changeGroup","reserveEnrollment","cancelEnrollment","resetEnrollment"],setup(r,{emit:n}){const d=Pe(),s=n,m=r,v=async u=>{switch(u){case"change-group":s("changeGroup",m.item);break;case"reserve-enrollment":d.warning({title:"Confirmar",content:"¿Está seguro de realizar la reserva de la matrícula?",positiveText:"Reservar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"primary"},bordered:!0,onPositiveClick:async()=>{await Ge(m.item),s("reserveEnrollment",m.item)}});break;case"cancel-enrollment":d.warning({title:"Confirmar",content:"¿Está seguro de cancelar la matrícula?",positiveText:"Cancelar matrícula",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:async()=>{await Ce(m.item),s("cancelEnrollment",m.item)}});break;case"reset-enrollment":s("resetEnrollment",m.item);break}},x=$(()=>{var u,g,_,y,b;return[{label:"Cambiar grupo",key:"change-group",disabled:((u=m.item)==null?void 0:u.enrollmentStatus)!=="MATRICULADO"},{label:"Reservar matrícula",key:"reserve-enrollment",disabled:((g=m.item)==null?void 0:g.enrollmentStatus)!=="MATRICULADO"},{label:"Cancelar matrícula",key:"cancel-enrollment",disabled:((_=m.item)==null?void 0:_.enrollmentStatus)=="CANCELADO"},{label:"Reestablecer matrícula",key:"reset-enrollment",disabled:((y=m.item)==null?void 0:y.enrollmentStatus)!=="CANCELADO"&&((b=m.item)==null?void 0:b.enrollmentStatus)!=="RESERVADO"}]});return(u,g)=>{const _=H,y=xe;return C(),j(y,{trigger:"click",options:x.value,"show-arrow":!0,onSelect:v},{default:l(()=>[t(_,{"render-icon":D(A)("magicpen")},{default:l(()=>g[0]||(g[0]=[I(" Opt. ")])),_:1},8,["render-icon"])]),_:1},8,["options"])}}});export{Ae as _,Ne as a,pt as b,mt as c,ft as d,vt as e,_t as f,ct as g,gt as h,dt as i};
