import{r as q}from"./icon.utils-upfZx_ME.js";import{d as G}from"./debounce.utils-DqPPCsFD.js";import{j as ae}from"./student.services-BmoiBj5R.js";import{ay as oe,d as $,e as ne,r as u,j as le,a8 as W,a9 as k,aa as a,ab as e,aA as N,ad as R,af as B,az as U,aH as se,aG as j,h as re,a4 as ue,aI as ie,aF as A,_ as H,ae as F,aJ as ce}from"./index-C2oNslvg.js";import{a as de,i as J}from"./DataTable.types-BEg5m_To.js";import"./course.services-Bo_wy6B8.js";import{_ as pe,a as me}from"./FormItem-DXyfdPQq.js";import{_ as L,a as K}from"./Col-BtUCTmqt.js";import{_ as _e}from"./Select-DaUiqjpd.js";import{_ as ge}from"./Space-G3ZiPI5e.js";import{u as ve}from"./composables-CkauXcFl.js";import{_ as fe}from"./Dropdown-tA5u1ub_.js";import{_ as ye}from"./Input-BQ3poveX.js";import{_ as be}from"./DataTable-ByPH7O8r.js";import"./get-2__u8Ul3.js";import"./Popover-C-qVBvl0.js";import"./use-merged-state-CDxsXcm8.js";import"./Suffix-DF6h_xjA.js";import"./Tag-Dwx6Rgco.js";import"./Tooltip-DX3_NcDh.js";const x=oe(),S="recognition",Ie=async n=>{try{return(await x.post(`${S}/load-data-table`,n)).data.data}catch{return de()}},we=async n=>{try{return{status:!0,data:(await x.post(`${S}`,n)).data.data}}catch(l){return l.response.status===422?{status:!1,data:l.response.data.errors}:{status:!1,data:null}}},xe=async n=>{try{return await x.delete(`${S}`,{data:n}),!0}catch{return!1}},Se=async n=>{try{return(await x.get(`${S}/module-enrollments/items/for-select/${n}`)).data.data}catch{return[]}},he=async n=>{try{return(await x.post(`${S}/courses-by-module/items/for-select`,n)).data.data}catch{return[]}},Ce=async n=>{try{return(await x.get(`${S}/course-extracurriculars-by-student/items/for-select/${n}`)).data.data}catch{return[]}},P=()=>({id:null,moduleId:null,studentId:null,courseId:null,courseRecognitionId:null,observation:null}),Re=()=>({moduleId:[{type:"number",required:!0,message:"Obligatório"}],studentId:[{type:"number",required:!0,message:"Obligatório"}],courseId:[{type:"number",required:!0,message:"Obligatório"}],courseRecognitionId:[{type:"number",required:!0,message:"Obligatório"}],observation:[]}),Q=$({__name:"Form",props:{item:{},modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(n,{emit:l}){const d=l,b=n,s=ne({get:()=>b.modelValue,set:r=>d("update:modelValue",r)}),m=u(!1),c=u(null),t=u({...P()}),i=u(null),v=u({...Re()}),z=u([]),h=u([]),f=u([]),_=u([]),E=async r=>{if(console.log(r),r){const o=await ae({search:r});z.value=o}else z.value=[]},O=async r=>{f.value=await Ce(r)},T=async()=>{if(t.value.moduleId=null,t.value.courseRecognitionId=null,t.value.courseId=null,console.log("getModuleOptions"),!t.value.studentId){h.value=[],f.value=[],_.value=[];return}h.value=await Se(t.value.studentId),await O(t.value.studentId)},D=async()=>{if(!t.value.moduleId){_.value=[];return}_.value=await he({moduleId:t.value.moduleId,studentId:t.value.studentId})},g=G(r=>{E(r)},400),I=async()=>{if(i.value=null,c.value){const r=await c.value.validate();let o=null;r?(m.value=!0,o=await we(t.value),o.status?(d("success"),s.value=!1):i.value=o.data):console.log("Formulario inválido")}m.value=!1},C=async()=>{console.log("Inicializando formulario"),t.value={...P()}};return le(s,r=>{r&&C()}),(r,o)=>{const w=_e,y=me,V=K,X=L,Y=pe,M=B,Z=ge,ee=N,te=se;return k(),W(te,{show:s.value,"onUpdate:show":o[5]||(o[5]=p=>s.value=p)},{default:a(()=>[e(ee,{style:{width:"600px"},title:r.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:a(()=>[e(Z,{justify:"end"},{default:a(()=>[e(M,{tertiary:"",size:"large",onClick:o[4]||(o[4]=p=>s.value=!1),disabled:m.value},{default:a(()=>o[6]||(o[6]=[U(" Cancelar ")])),_:1},8,["disabled"]),e(M,{size:"large",type:"primary",onClick:I,loading:m.value},{default:a(()=>o[7]||(o[7]=[U("Guardar")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[e(Y,{ref_key:"formRef",ref:c,model:t.value,rules:v.value,size:"large"},{default:a(()=>[e(X,{gutter:16},{default:a(()=>[e(V,{span:"24"},{default:a(()=>[e(y,{path:"studentId",label:"Estudiante"},{default:a(()=>[e(w,{placeholder:"Seleccione un estudiante",value:t.value.studentId,"onUpdate:value":[o[0]||(o[0]=p=>t.value.studentId=p),T],options:z.value,"virtual-scroll":!1,onSearch:R(g),remote:"",filterable:"",clearable:""},null,8,["value","options","onSearch"])]),_:1})]),_:1}),e(V,{span:"24"},{default:a(()=>[e(y,{path:"moduleId",label:"Módulo"},{default:a(()=>[e(w,{placeholder:"Seleccione un módulo",value:t.value.moduleId,"onUpdate:value":[o[1]||(o[1]=p=>t.value.moduleId=p),D],options:h.value,"virtual-scroll":!1,clearable:"",filterable:""},null,8,["value","options"])]),_:1})]),_:1}),e(V,{span:"24"},{default:a(()=>[e(y,{path:"courseRecognitionId",label:"Curso origen"},{default:a(()=>[e(w,{placeholder:"Seleccione un curso",value:t.value.courseRecognitionId,"onUpdate:value":o[2]||(o[2]=p=>t.value.courseRecognitionId=p),options:_.value,"virtual-scroll":!1,clearable:"","onUpdate:modelValue":()=>{}},null,8,["value","options"])]),_:1})]),_:1}),e(V,{span:"24"},{default:a(()=>[e(y,{path:"courseId",label:"	Curso convalidado -  Especial / Extracurricular"},{default:a(()=>[e(w,{placeholder:"Seleccione un curso",value:t.value.courseId,"onUpdate:value":o[3]||(o[3]=p=>t.value.courseId=p),options:f.value,"virtual-scroll":!1,clearable:"","onUpdate:modelValue":()=>{}},null,8,["value","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ze=$({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(n,{emit:l}){const d=ve(),b=l,s=[{label:"Eliminar",key:"delete",icon:q("trash","red"),props:{style:{color:"red"},onClick:()=>{d.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{b("delete")}})}}}];return(m,c)=>{const t=B,i=fe;return k(),W(i,{options:s,placement:"bottom-start"},{default:a(()=>[e(t,null,{default:a(()=>[e(j,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})}}}),Ve=n=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(l){const d=l;return re(ze,{onDelete:()=>{n(d)},item:d},{default:()=>"Editar"})}},{title:"Estudiante",key:"student",minWidth:"200px"},{title:"Módulo",key:"module",minWidth:"200px"},{title:"Curso origen",key:"courseRecognition",minWidth:"200px"},{title:"Curso convalidado",key:"course",minWidth:"200px"},{title:"Observación",key:"observation",minWidth:"300px"}],$e=(n=J())=>({page:n.page,total:n.total,pageSize:n.pageSize,pageCount:n.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${n.total} registros`}}),ke={style:{"border-bottom":"1px solid #e9e9e9"}},Ee=$({__name:"DataTable",setup(n){const l=ue(),d=u(!1),b=u([]),s=u(!1),m=u(null),c=ie({...J()}),t=u(""),i=u({search:null,page:c.page,pageSize:c.pageSize}),v=u({}),h=Ve(async g=>{await xe(g),await f()}),f=async()=>{i.value.page=1,await _()},_=async()=>{d.value=!0,i.value.filters={curriculumId:t.value},v.value=await Ie(i.value),b.value=v.value.data,c.total=v.value.total,c.pageSize=v.value.per_page,c.page=v.value.current_page,c.pageCount=v.value.last_page,d.value=!1},E=G(()=>{f()},400),O=async g=>{i.value.page=g,await _()},T=async g=>{i.value.page=1,i.value.pageSize=g,await _()};return(async()=>{t.value=l.params.id??"",await _()})(),(g,I)=>{const C=K,r=ye,o=L,w=be;return k(),A(H,null,[F("div",ke,[e(o,{gutter:12,style:{padding:"12px 16px"}},{default:a(()=>[e(C,{span:12}),e(C,{span:12},{default:a(()=>[e(r,{size:"large",placeholder:"Buscar",value:i.value.search,"onUpdate:value":I[0]||(I[0]=y=>i.value.search=y),onInput:R(E),clearable:""},{suffix:a(()=>[e(j,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),e(o,null,{default:a(()=>[e(C,{span:24},{default:a(()=>[e(w,{key:"id",remote:"","single-line":!1,columns:R(h),data:b.value,pagination:R($e)(c),"pagination-show-size-picker":!0,loading:d.value,"onUpdate:page":O,"onUpdate:pageSize":T},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),ce(g.$slots,"extra",{reLoadDataTable:f})]),e(Q,{modelValue:s.value,"onUpdate:modelValue":I[1]||(I[1]=y=>s.value=y),item:m.value,onSuccess:f},null,8,["modelValue","item"])],64)}}}),Ye=$({__name:"RecognitionView",setup(n){const l=u(!1);return(async()=>{})(),(b,s)=>{const m=B,c=N;return k(),A(H,null,[e(c,{segmented:{header:!0,content:!0}},{header:a(()=>s[2]||(s[2]=[F("span",{class:"text-sm text-slate-500"},"Gestión de convalidaciones ",-1),F("h5",{class:"text-lg font-bold text-slate-800"},"Convalidaciones",-1)])),"header-extra":a(()=>[e(m,{"render-icon":R(q)("additem"),onClick:s[0]||(s[0]=t=>l.value=!0)},{default:a(()=>s[3]||(s[3]=[U(" Agregar ")])),_:1},8,["render-icon"])]),_:1}),e(Ee,null,{extra:a(({reLoadDataTable:t})=>[e(Q,{modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=i=>l.value=i),item:null,onSuccess:t},null,8,["modelValue","onSuccess"])]),_:1})],64)}}});export{Ye as default};
