import{i as ae,a as ve}from"./DataTable.types-BEg5m_To.js";import{d as H,a8 as C,a9 as z,aa as o,ab as t,af as K,aG as le,h as Z,ay as fe,e as P,r as v,j as te,aA as oe,ac as A,ad as T,az as G,aH as ne,aI as _e,aF as ge,_ as be,ae as we,aJ as ye}from"./index-DRqPu8js.js";import{r as ee}from"./icon.utils-6fJ-3dCS.js";import{u as Ie}from"./composables-CNUmupj0.js";import{_ as he}from"./Dropdown-hwViG8Gw.js";import{_ as ke}from"./Tag-DIW11yL8.js";import{d as F}from"./debounce.utils-DqPPCsFD.js";import{e as se,f as ue}from"./selectables.services-BQd8Oz6S.js";import{_ as re,a as ie}from"./FormItem-B0e_KJJq.js";import{_ as Q,a as X}from"./Col-CNgfr2Vq.js";import{_ as de}from"./Select-Bhk-Lp7D.js";import{_ as Y}from"./Input-PHuG5EIV.js";import{_ as pe}from"./Space-DpUkt9IF.js";import{_ as me}from"./Switch-C8iQr2Sc.js";import{f as Se}from"./role.services-Bnez8NDO.js";import{_ as Ee}from"./DataTable-B0gpVXZr.js";const Ue=H({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(r,{emit:d}){const _=Ie(),u=d,f=[{label:"Editar",key:"edit",icon:ee("edit-2"),props:{onClick:()=>u("edit")}},{label:"Eliminar",key:"delete",icon:ee("trash","red"),props:{style:{color:"red"},onClick:()=>{_.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{u("delete")}})}}}];return(b,y)=>{const l=K,n=he;return z(),C(n,{options:f,placement:"bottom-start"},{default:o(()=>[t(l,null,{default:o(()=>[t(le,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})}}}),ze=(r,d)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(_){const u=_;return Z(Ue,{onEdit:()=>{r(u)},onDelete:()=>{d(u)},item:u},{default:()=>"Editar"})}},{title:"Nombre",key:"name",minWidth:"180px"},{title:"Email",key:"email",minWidth:"150px"},{title:"Usuario",key:"username",minWidth:"100px"},{title:"Rol",key:"roleName",minWidth:"100px"},{title:"Habilitado",key:"isEnabled",width:"120px",render:_=>Z(ke,{type:_.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>_.isEnabled?"	Habilitado":"Deshabilitado"})}],Oe=(r=ae())=>({page:r.page,total:r.total,pageSize:r.pageSize,pageCount:r.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${r.total} registros`}}),M=r=>({id:null,name:null,username:null,email:null,role:null,password:null,level:r,isEnabled:!0,modelId:null}),ce=(r=null)=>({modelId:[{type:"number",required:!0,trigger:["blur","change"],message:"Obligatorio"}],name:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],username:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],email:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],role:[{type:"number",required:!0,trigger:["blur","change"],message:"Obligatorio"}],password:[{required:r===null,trigger:["blur","input"],message:"Obligatorio"},{min:6,message:"Mínimo 6 caracteres",trigger:["blur","input"]}]}),R=fe(),Ce=async r=>{try{return(await R.post("/user/load-data-table",r)).data.data}catch{return ve()}},Te=async r=>{try{return{status:!0,data:(await R.post("/user",r)).data.data}}catch(d){return d.response.status===422?{status:!1,data:d.response.data.errors}:{status:!1,data:null}}},Re=async r=>{try{return await R.post("/user/account",r),!0}catch{return!1}},Ve=async r=>{try{return await R.put("/user/account",r),!0}catch{return!1}},xe=async r=>{try{return{status:!0,data:(await R.put("/user",r)).data.data}}catch(d){return d.response.status===422?{status:!1,data:d.response.data.errors}:{status:!1,data:null}}},De=async r=>{try{return await R.delete("/user",{data:{id:r.id}}),!0}catch{return!1}},$e=H({__name:"UserForm",props:{item:{},level:{},modelValue:{type:Boolean},roleOptions:{}},emits:["update:modelValue","success"],setup(r,{emit:d}){const _=d,u=r,f=P({get:()=>u.modelValue,set:a=>_("update:modelValue",a)}),b=v(!1),y=v(null),l=v(M(u.level)),n=v(null),I=P(()=>({...ce(l.value.id)})),w=v([]),E=v([]),N=a=>{var c;n.value&&(n.value.modelId=null),l.value.modelId=a;let e=(c=w.value.find(p=>p.value===a))==null?void 0:c.label;e&&(l.value.name=e)},V=a=>{var c;n.value&&(n.value.modelId=null),l.value.modelId=a;let e=(c=E.value.find(p=>p.value===a))==null?void 0:c.label;e&&(l.value.name=e)},k=async()=>{if(y.value){const a=await y.value.validate();let e=null;a?(b.value=!0,l.value.id?e=await xe(l.value):e=await Te(l.value),e.status?(_("success"),f.value=!1):n.value=e.data):console.log("Formulario inválido")}b.value=!1},h=async({search:a=null,id:e=null})=>{w.value=await se({search:a,id:e})},O=async({search:a=null,id:e=null})=>{E.value=await ue({search:a,id:e})},x=F(async a=>{await h({search:a})},400),D=F(async a=>{await O({search:a})},400),q=()=>{if(console.log("Inicializando formulario"),l.value=u.item?{...u.item}:M(u.level),u.item&&u.level=="teacher"){const a=u.item.modelId;h({id:a})}if(u.item&&u.level=="student"){const a=u.item.modelId;O({id:a})}};return te(f,a=>{a&&(n.value=null,q())}),(a,e)=>{const c=de,p=ie,g=X,U=Y,S=me,$=pe,j=Q,W=re,B=K,J=oe,L=ne;return z(),C(L,{show:f.value,"onUpdate:show":e[14]||(e[14]=s=>f.value=s)},{default:o(()=>[t(J,{style:{width:"500px"},title:a.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",User:"dialog","aria-modal":"true"},{footer:o(()=>[t($,{justify:"end"},{default:o(()=>[t(B,{tertiary:"",size:"large",onClick:e[13]||(e[13]=s=>f.value=!1),disabled:b.value},{default:o(()=>e[15]||(e[15]=[G(" Cancelar ")])),_:1},8,["disabled"]),t(B,{size:"large",type:"primary",onClick:k,loading:b.value},{default:o(()=>e[16]||(e[16]=[G("Guardar")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[t(W,{ref_key:"formRef",ref:y,model:l.value,rules:I.value,size:"large"},{default:o(()=>[t(j,null,{default:o(()=>[a.level==="teacher"?(z(),C(g,{key:0,span:"24"},{default:o(()=>{var s;return[t(p,{label:"Docente",path:"modelId",feedback:(s=n.value)==null?void 0:s.modelId},{default:o(()=>{var i;return[t(c,{value:l.value.modelId,"onUpdate:value":[e[0]||(e[0]=m=>l.value.modelId=m),N],options:w.value,filterable:"",placeholder:"Buscar docente",clearable:"",remote:"","virtual-scroll":!1,onSearch:T(x),status:((i=n.value)==null?void 0:i.modelId)!=null?"error":""},null,8,["value","options","onSearch","status"])]}),_:1},8,["feedback"])]}),_:1})):A("",!0),a.level==="student"?(z(),C(g,{key:1,span:"24"},{default:o(()=>{var s;return[t(p,{label:"Estudiante",path:"modelId",feedback:(s=n.value)==null?void 0:s.modelId},{default:o(()=>{var i;return[t(c,{value:l.value.modelId,"onUpdate:value":[e[1]||(e[1]=m=>l.value.modelId=m),V],options:E.value,filterable:"",placeholder:"Buscar estudiante",clearable:"",remote:"","virtual-scroll":!1,onSearch:T(D),status:((i=n.value)==null?void 0:i.modelId)!=null?"error":""},null,8,["value","options","onSearch","status"])]}),_:1},8,["feedback"])]}),_:1})):A("",!0),t(g,{span:"24"},{default:o(()=>{var s;return[t(p,{path:"name",label:"Nombre",feedback:(s=n.value)==null?void 0:s.name},{default:o(()=>{var i;return[t(U,{status:((i=n.value)==null?void 0:i.name)!=null?"error":"",value:l.value.name,"onUpdate:value":e[2]||(e[2]=m=>l.value.name=m),onInput:e[3]||(e[3]=m=>n.value!=null?n.value.name=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),t(g,{span:"24"},{default:o(()=>{var s;return[t(p,{path:"username",label:"Usuario",feedback:(s=n.value)==null?void 0:s.username},{default:o(()=>{var i;return[t(U,{status:((i=n.value)==null?void 0:i.username)!=null?"error":"",value:l.value.username,"onUpdate:value":e[4]||(e[4]=m=>l.value.username=m),onInput:e[5]||(e[5]=m=>n.value!=null?n.value.username=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),t(g,{span:"24"},{default:o(()=>{var s;return[t(p,{path:"email",label:"Correo",feedback:(s=n.value)==null?void 0:s.email},{default:o(()=>{var i;return[t(U,{status:((i=n.value)==null?void 0:i.email)!=null?"error":"",value:l.value.email,"onUpdate:value":e[6]||(e[6]=m=>l.value.email=m),onInput:e[7]||(e[7]=m=>n.value!=null?n.value.email=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),t(g,{span:"24"},{default:o(()=>{var s;return[t(p,{path:"password",label:"Contraseña",feedback:(s=n.value)==null?void 0:s.password},{default:o(()=>{var i;return[t(U,{type:"password","show-password-on":"click",placeholder:"Contraseña",minlength:6,status:((i=n.value)==null?void 0:i.password)!=null?"error":"",value:l.value.password,"onUpdate:value":e[8]||(e[8]=m=>l.value.password=m),onInput:e[9]||(e[9]=()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),t(g,{span:"24"},{default:o(()=>{var s;return[t(p,{path:"role",label:"Rol",feedback:(s=n.value)==null?void 0:s.role},{default:o(()=>{var i;return[t(c,{status:((i=n.value)==null?void 0:i.role)!=null?"error":"",value:l.value.role,"onUpdate:value":[e[10]||(e[10]=m=>l.value.role=m),e[11]||(e[11]=m=>n.value!=null?n.value.role=null:()=>{})],placeholder:"Seleccione un rol",clearable:"",options:a.roleOptions},null,8,["status","value","options"])]}),_:1},8,["feedback"])]}),_:1}),t(g,{span:"24"},{default:o(()=>[t($,{justify:"end"},{default:o(()=>[t(p,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:o(()=>[t(S,{value:l.value.isEnabled,"onUpdate:value":e[12]||(e[12]=s=>l.value.isEnabled=s)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Be=H({__name:"AccountUserForm",props:{item:{},level:{},modelValue:{type:Boolean},roleOptions:{}},emits:["update:modelValue","success"],setup(r,{emit:d}){const _=d,u=r,f=P({get:()=>u.modelValue,set:a=>_("update:modelValue",a)}),b=v(!1),y=v(null),l=v(M(u.level)),n=v(null),I=P(()=>({...ce(l.value.id)})),w=v([]),E=v([]),N=a=>{var c;n.value&&(n.value.modelId=null),l.value.modelId=a;let e=(c=w.value.find(p=>p.value===a))==null?void 0:c.label;e&&(l.value.name=e)},V=a=>{var c;n.value&&(n.value.modelId=null),l.value.modelId=a;let e=(c=E.value.find(p=>p.value===a))==null?void 0:c.label;e&&(l.value.name=e)},k=async()=>{if(l.value.role=u.level=="teacher"?"docente":"estudiante",l.value.level=u.level,y.value){const a=await y.value.validate();let e=null;a?(b.value=!0,l.value.id?e=await Ve(l.value):e=await Re(l.value),e&&(_("success"),f.value=!1)):console.log("Formulario inválido")}b.value=!1},h=async({search:a=null,id:e=null})=>{w.value=await se({search:a,id:e})},O=async({search:a=null,id:e=null})=>{E.value=await ue({search:a,id:e})},x=F(async a=>{await h({search:a})},400),D=F(async a=>{await O({search:a})},400),q=()=>{if(console.log("Inicializando formulario"),l.value=u.item?{...u.item}:M(u.level),u.item&&u.level=="teacher"){const a=u.item.modelId;h({id:a})}if(u.item&&u.level=="student"){const a=u.item.modelId;O({id:a})}};return te(f,a=>{a&&(n.value=null,q())}),(a,e)=>{const c=de,p=ie,g=X,U=Y,S=me,$=pe,j=Q,W=re,B=K,J=oe,L=ne;return z(),C(L,{show:f.value,"onUpdate:show":e[5]||(e[5]=s=>f.value=s)},{default:o(()=>[t(J,{style:{width:"500px"},title:a.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",User:"dialog","aria-modal":"true"},{footer:o(()=>[t($,{justify:"end"},{default:o(()=>[t(B,{tertiary:"",size:"large",onClick:e[4]||(e[4]=s=>f.value=!1),disabled:b.value},{default:o(()=>e[6]||(e[6]=[G(" Cancelar ")])),_:1},8,["disabled"]),t(B,{size:"large",type:"primary",onClick:k,loading:b.value},{default:o(()=>e[7]||(e[7]=[G("Guardar")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[t(W,{ref_key:"formRef",ref:y,model:l.value,rules:I.value,size:"large"},{default:o(()=>[t(j,null,{default:o(()=>[a.level==="teacher"?(z(),C(g,{key:0,span:"24"},{default:o(()=>{var s;return[t(p,{label:"Docente",path:"modelId",feedback:(s=n.value)==null?void 0:s.modelId},{default:o(()=>{var i;return[t(c,{disabled:!!l.value.id,value:l.value.modelId,"onUpdate:value":[e[0]||(e[0]=m=>l.value.modelId=m),N],options:w.value,filterable:"",placeholder:"Buscar docente",clearable:"",remote:"","virtual-scroll":!1,onSearch:T(x),status:((i=n.value)==null?void 0:i.modelId)!=null?"error":""},null,8,["disabled","value","options","onSearch","status"])]}),_:1},8,["feedback"])]}),_:1})):A("",!0),a.level==="student"?(z(),C(g,{key:1,span:"24"},{default:o(()=>{var s;return[t(p,{label:"Estudiante",path:"modelId",feedback:(s=n.value)==null?void 0:s.modelId},{default:o(()=>{var i;return[t(c,{value:l.value.modelId,"onUpdate:value":[e[1]||(e[1]=m=>l.value.modelId=m),V],options:E.value,filterable:"",placeholder:"Buscar estudiante",clearable:"",remote:"","virtual-scroll":!1,onSearch:T(D),status:((i=n.value)==null?void 0:i.modelId)!=null?"error":""},null,8,["value","options","onSearch","status"])]}),_:1},8,["feedback"])]}),_:1})):A("",!0),t(g,{span:"24"},{default:o(()=>{var s;return[t(p,{path:"password",label:"Contraseña",feedback:(s=n.value)==null?void 0:s.password},{default:o(()=>{var i;return[t(U,{type:"password","show-password-on":"click",placeholder:"Contraseña",minlength:6,status:((i=n.value)==null?void 0:i.password)!=null?"error":"",value:l.value.password,"onUpdate:value":e[2]||(e[2]=m=>l.value.password=m)},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),t(g,{span:"24"},{default:o(()=>[t($,{justify:"end"},{default:o(()=>[t(p,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:o(()=>[t(S,{value:l.value.isEnabled,"onUpdate:value":e[3]||(e[3]=s=>l.value.isEnabled=s)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Fe={style:{"border-bottom":"1px solid #e9e9e9"}},ea=H({__name:"DataTable",props:{level:{}},setup(r){const d=r,_=v(!1),u=v([]),f=v(!1),b=v(!1),y=v(null),l=_e({...ae()}),n=v([]),I=v({search:null,page:l.page,pageSize:l.pageSize}),w=v({}),V=ze(a=>{y.value=a,d.level==="student"||d.level==="teacher"?f.value=!0:b.value=!0},async a=>{await De(a),await k()}),k=async()=>{I.value.page=1,await h()},h=async()=>{_.value=!0,w.value=await Ce(I.value),u.value=w.value.data,l.total=w.value.total,l.pageSize=w.value.per_page,l.page=w.value.current_page,l.pageCount=w.value.last_page,_.value=!1},O=F(()=>{k()},400),x=async a=>{I.value.page=a,await h()},D=async a=>{I.value.page=1,I.value.pageSize=a,await h()};return(async()=>{I.value.filters={level:d.level},n.value=await Se(d.level),await h()})(),(a,e)=>{const c=X,p=Y,g=Q,U=Ee;return z(),ge(be,null,[we("div",Fe,[t(g,{gutter:12,style:{padding:"12px 16px"}},{default:o(()=>[t(c,{span:12}),t(c,{span:12},{default:o(()=>[t(p,{size:"large",placeholder:"Buscar",value:I.value.search,"onUpdate:value":e[0]||(e[0]=S=>I.value.search=S),onInput:T(O),clearable:""},{suffix:o(()=>[t(le,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),t(g,null,{default:o(()=>[t(c,{span:24},{default:o(()=>[t(U,{key:"id",remote:"","single-line":!1,columns:T(V),data:u.value,pagination:T(Oe)(l),"pagination-show-size-picker":!0,loading:_.value,"onUpdate:page":x,"onUpdate:pageSize":D},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),ye(a.$slots,"extra",{reLoadDataTable:k,roleOptions:n.value})]),t($e,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=S=>b.value=S),item:y.value,level:d.level,roleOptions:n.value,onSuccess:k},null,8,["modelValue","item","level","roleOptions"]),t(Be,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=S=>f.value=S),item:y.value,level:d.level,roleOptions:n.value,onSuccess:k},null,8,["modelValue","item","level","roleOptions"])],64)}}});export{$e as _,ea as a,Be as b};
