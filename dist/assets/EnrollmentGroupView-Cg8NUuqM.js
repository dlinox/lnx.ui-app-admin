import{u as J}from"./period.stores-9Tu0xZQr.js";import{a as K,i as B}from"./DataTable.types-BEg5m_To.js";import{a as N,_ as Q}from"./selectables.services-BaLMt3qD.js";import{a as X,f as Y,g as Z,h as ee}from"./group.services-BjbFPfgW.js";import{d as E,r as u,e as ae,j as te,a8 as G,a9 as x,aa as a,ab as e,aA as U,az as S,ag as M,af as W,aH as oe,ay as ne,a7 as le,aF as T,ac as se,_ as q,h as P,aI as re,aJ as ie,ad as k,aG as ue,ae as pe}from"./index--Fiy2I4t.js";import{u as de}from"./composables-CN96FFP-.js";import{_ as ce,a as me}from"./FormItem-64Oo6hS7.js";import{_ as F,a as j}from"./Col-Bhohzmu6.js";import{_ as H}from"./Select-JHMV7BBf.js";import{_ as _e}from"./Alert-DGEqS-V6.js";import{_ as ge}from"./ButtonGroup-8Lpsb715.js";import{_ as $}from"./Tag-CmlrV2vM.js";import{d as V}from"./debounce.utils-DqPPCsFD.js";import{_ as fe}from"./Input-CfWAw0Qs.js";import{_ as ve}from"./DataTable-D69-Uvxy.js";import"./get-slot-Bk_rJcZu.js";import"./get-BxuUz3sF.js";import"./Popover-_nZkNipR.js";import"./use-merged-state-Hew3oQWq.js";import"./Suffix-Cejid3DV.js";import"./Tooltip-B09_9Vum.js";import"./Dropdown-B9vn1Rts.js";const ye=E({__name:"FormManagerGroup",props:{modelValue:{type:Boolean},item:{}},emits:["update:modelValue","success"],setup(r,{emit:o}){const g=de(),m=o,p=u([]),d=u([]),s=r,n=ae({get:()=>s.modelValue,set:_=>m("update:modelValue",_)}),i=u(!1),t=u({id:null,teacherId:null,laboratoryId:null,status:"ABIERTO"}),R=async()=>{g.warning({title:"Confirmar",content:"¿Está seguro que desea CANCELAR este registro?, No podrá revertir esta acción.",positiveText:"Confirmar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{h()}})},h=async()=>{i.value=!0,t.value.id=s.item.id,await Y(t.value)&&(m("success"),n.value=!1),i.value=!1},b=async()=>{console.log("Inicializando formulario"),t.value.teacherId=s.item.teacherId,t.value.laboratoryId=s.item.laboratoryId,t.value.status=s.item.status,p.value=await Z();let _=await ee();d.value=_.filter(l=>{const v=l.label.split("-")[0];return s.item.modality==="PRESENCIAL"?v==="LABORATORIO":s.item.modality==="VIRTUAL"?v==="VIRTUAL":!1}).map(l=>({value:l.value,label:l.label.split("-")[1].trim()}))};return te(n,async _=>{_&&await b()}),(_,l)=>{const v=H,w=me,A=j,c=_e,f=F,z=ce,C=W,D=X,O=U,L=oe;return x(),G(L,{show:n.value,"onUpdate:show":l[5]||(l[5]=y=>n.value=y)},{default:a(()=>{var y;return[e(O,{style:{width:"600px"},title:`${(y=_.item)==null?void 0:y.modality} - Gestionar grupo`,bordered:!1,size:"small",role:"dialog","aria-modal":"true",segmented:{content:!0,footer:!0}},{footer:a(()=>[e(D,{justify:"end"},{default:a(()=>[e(C,{onClick:l[3]||(l[3]=()=>n.value=!1)},{default:a(()=>l[6]||(l[6]=[S("Cancelar")])),_:1}),e(C,{type:"primary",onClick:l[4]||(l[4]=I=>t.value.status==="CANCELADO"?R():h()),loading:i.value},{default:a(()=>l[7]||(l[7]=[S(" Guardar ")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[e(z,{ref:"formRef",model:t.value},{default:a(()=>[e(f,{gutter:16},{default:a(()=>[e(A,{span:24},{default:a(()=>[e(w,{label:"Docente",path:"teacherId"},{default:a(()=>[e(v,{value:t.value.teacherId,"onUpdate:value":l[0]||(l[0]=I=>t.value.teacherId=I),placeholder:"Seleccionar Docente",filterable:"",options:p.value,clearable:"",remote:"","virtual-scroll":!1},null,8,["value","options"])]),_:1})]),_:1}),e(A,{span:24},{default:a(()=>[e(w,{label:"Laboratorio",path:"laboratoryId"},{default:a(()=>[e(v,{value:t.value.laboratoryId,"onUpdate:value":l[1]||(l[1]=I=>t.value.laboratoryId=I),placeholder:"Seleccionar Laboratorio",filterable:"",options:d.value,clearable:"",remote:"","virtual-scroll":!1},null,8,["value","options"])]),_:1})]),_:1}),e(A,{span:24},{default:a(()=>[e(w,{label:"Estado",path:"status"},{default:a(()=>[e(v,{value:t.value.status,"onUpdate:value":l[2]||(l[2]=I=>t.value.status=I),placeholder:"Seleccionar Estado",options:[{label:"ABIERTO",value:"ABIERTO"},{label:"CERRADO",value:"CERRADO"},{label:"CANCELADO",value:"CANCELADO"}],"virtual-scroll":!1},null,8,["value"])]),_:1})]),_:1}),e(A,{span:24},{default:a(()=>[e(c,{type:t.value.status==="CANCELADO"?"error":"info","show-icon":"",title:`GRUPO ${t.value.status}`,closable:!1},{default:a(()=>[S(M(t.value.status==="CERRADO"?"Las inscripciones virtuales para este grupo están cerradas, pero aún puede realizarse la matrícula de manera presencial.":t.value.status==="CANCELADO"?"Los estudiantes no podrán realizar la matrícula de manera presencial ni virtual, y los estudiantes que ya están matriculados serán desvinculados del grupo, sus inscripciones pasarán a un estado de 'CANCELADO'.":"Las inscripciones estan habilitada para todos los estudiantes, tanto virtual como presencialmente."),1)]),_:1},8,["type","title"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]}),_:1},8,["show"])}}}),be=ne(),he=async r=>{try{return(await be.post("/enrollment-groups/load-data-table",r)).data.data}catch{return K()}},Ce=E({__name:"GroupStatus",props:{groupId:{},status:{},item:{}},emits:["success"],setup(r,{emit:o}){const g=o,m=u(!1);return(p,d)=>{const s=W,n=le("LnxIcon"),i=ge;return x(),T(q,null,[e(i,null,{default:a(()=>[e(s,{quaternary:""},{default:a(()=>[S(M(p.status),1)]),_:1}),p.status=="ABIERTO"||p.status=="CERRADO"?(x(),G(s,{key:0,tertiary:"",onClick:d[0]||(d[0]=t=>m.value=!0)},{icon:a(()=>[e(n,{"icon-name":"edit"})]),_:1})):se("",!0)]),_:1}),e(ye,{modelValue:m.value,"onUpdate:modelValue":d[1]||(d[1]=t=>m.value=t),item:p.item,onSuccess:d[2]||(d[2]=t=>g("success"))},null,8,["modelValue","item"])],64)}}}),Ie=r=>[{title:"Grupo",key:"group-group",children:[{title:"Codigo",key:"group",minWidth:"80px"},{title:"Módulo",key:"module",minWidth:"150px"},{title:"Curso",key:"course",minWidth:"150px"},{title:"Horario",key:"schedules",minWidth:"150px",render:o=>P($,{},{default:()=>o.schedules})},{title:"Modalidad",key:"modality",minWidth:"120px"}]},{title:"Carga académica",key:"academic-load",children:[{title:"Docente",key:"teacher",minWidth:"120px"},{title:"Laboratorio",key:"laboratory",minWidth:"100px"}]},{title:"Matriculas",key:"enrollment",children:[{title:"Min. Est.",key:"minStudents",width:"60px"},{title:"Mat.",key:"studentEnrolled",width:"60px"},{title:"Res.",key:"studentReserved",width:"60px"},{title:"% Apertura",key:"percentageOpening",render:o=>P($,{type:o.percentageOpening?o.percentageOpening<60?"error":o.percentageOpening<100?"warning":"success":"default",tertiary:!0,bordered:!1,strong:!0},{default:()=>`${o.percentageOpening}%`})},{title:"Estado",key:"status",width:"150px",fixed:"right",render:o=>P(Ce,{item:o,status:o.status,groupId:o.id,onSuccess:r})}]}],we=(r=B())=>({page:r.page,total:r.total,pageSize:r.pageSize,pageCount:r.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${r.total} registros`}}),Ae={style:{"border-bottom":"1px solid #e9e9e9"}},Se=E({__name:"EnrollmentGroupDataTable",setup(r){const o=J(),g=u(!1),m=u([]),p=u(!1),d=u([]),s=re({...B()}),n=u({search:null,page:s.page,pageSize:s.pageSize,filters:{periodId:null}}),i=u({}),t=async c=>{g.value=!0,m.value=await N(c),g.value=!1},R=V(c=>{t(c)},400),h=async()=>{n.value.page=1,await b()},b=async()=>{p.value=!0,i.value=await he(n.value),d.value=i.value.data,s.total=i.value.total,s.pageSize=i.value.per_page,s.page=i.value.current_page,s.pageCount=i.value.last_page,p.value=!1},_=V(()=>{h()},400),l=async c=>{n.value.page=c,await b()},v=async c=>{n.value.page=1,n.value.pageSize=c,await b()},w=Ie(b);return(async()=>{var f;await t("");const c=((f=o==null?void 0:o.enrollment)==null?void 0:f.periodId)||"";n.value.filters.periodId=c,await b()})(),(c,f)=>{const z=H,C=j,D=fe,O=F,L=ve;return x(),T("div",Ae,[e(O,{gutter:12,class:"p-4 flex justify-between"},{default:a(()=>[e(C,{span:8},{default:a(()=>[e(z,{value:n.value.filters.periodId,"onUpdate:value":[f[0]||(f[0]=y=>n.value.filters.periodId=y),h],placeholder:"Seleccionar Periodo Académico",filterable:"",options:m.value,loading:g.value,clearable:"",remote:"",size:"large","virtual-scroll":!1,onSearch:k(R)},null,8,["value","options","loading","onSearch"])]),_:1}),e(C,{span:12},{default:a(()=>[e(D,{size:"large",placeholder:"Buscar",value:n.value.search,"onUpdate:value":f[1]||(f[1]=y=>n.value.search=y),onInput:k(_),clearable:""},{suffix:a(()=>[e(ue,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),e(O,null,{default:a(()=>[e(C,{span:24},{default:a(()=>[e(L,{key:"id",remote:"","single-line":!1,columns:k(w),data:d.value,pagination:k(we)(s),"pagination-show-size-picker":!0,loading:p.value,"onUpdate:page":l,"onUpdate:pageSize":v},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),ie(c.$slots,"extra",{reLoadDataTable:h})])}}}),Je=E({__name:"EnrollmentGroupView",setup(r){const o=u(!1),g=u([]),m=async s=>{o.value=!0,g.value=await N(s),o.value=!1},p=u([]);return(async()=>{await m(""),p.value=await Q()})(),(s,n)=>{const i=U;return x(),T(q,null,[e(i,{segmented:{header:!0,content:!0}},{header:a(()=>n[0]||(n[0]=[pe("h6",{class:"text-sm text-gray-400"},"Gestión de grupos aperturados",-1),S(" Grupos aperturados ")])),action:a(()=>n[1]||(n[1]=[])),_:1}),e(Se)],64)}}});export{Je as default};
