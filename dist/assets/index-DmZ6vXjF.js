import{r as M,_ as K}from"./icon.utils-Co33Gfj7.js";import{d as S,a7 as T,a3 as A,a4 as t,a8 as e,ac as P,h as $,al as C,e as Q,r as _,g as X,ah as ee,ab as R,a9 as k,ai as N,aj as ae,ad as F,af as G,ak as te,Z as q}from"./index-q5WTydet.js";import{u as ne,i as H,N as le,f as oe,_ as j,g as se,a as re,b as ue,c as L,d as ie,e as de}from"./debounce.utils-CNomnN_y.js";import{_ as pe}from"./InputNumber-CBBO-FqA.js";import{a as ce,b as _e,_ as me}from"./FormItem-CfLS_ziG.js";import{_ as J}from"./LnxIcon.vue_vue_type_script_setup_true_lang-BrDmhFYV.js";import"./get-C77LKGbM.js";import"./format-length-B-p6aW7q.js";import"./Remove-8GogKFWM.js";const ge=S({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(s,{emit:l}){const r=ne(),a=l,d=[{label:"Editar",key:"edit",icon:M("edit-2"),props:{onClick:()=>a("edit")}},{label:"Eliminar",key:"delete",icon:M("trash","red"),props:{style:{color:"red"},onClick:()=>{r.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{a("delete")}})}}}];return(u,i)=>{const o=P,p=K;return T(),A(p,{options:d,placement:"bottom-start"},{default:t(()=>[e(o,null,{default:t(()=>[e(J,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})}}}),W=[{value:1,label:"ENERO"},{value:2,label:"FEBRERO"},{value:3,label:"MARZO"},{value:4,label:"ABRIL"},{value:5,label:"MAYO"},{value:6,label:"JUNIO"},{value:7,label:"JULIO"},{value:8,label:"AGOSTO"},{value:9,label:"SEPTIEMBRE"},{value:10,label:"OCTUBRE"},{value:11,label:"NOVIEMBRE"},{value:12,label:"DICIEMBRE"}],fe=(s,l)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(r){const a=r;return $(ge,{onEdit:()=>{s(a)},onDelete:()=>{l(a)},item:a},{default:()=>"Editar"})}},{title:"Año",key:"year",minWidth:"150px"},{title:"Mes",key:"month",minWidth:"150px",render:r=>{const a=W.find(d=>d.value===r.month);return $("span",a==null?void 0:a.label)}},{title:"Habilitado",key:"isEnabled",width:"150px",render:r=>$(le,{type:r.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>r.isEnabled?"	Habilitado":"Deshabilitado"})}],ve=(s=H())=>({page:s.page,total:s.total,pageSize:s.pageSize,pageCount:s.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${s.total} registros`}}),U=()=>({id:null,year:new Date().getFullYear(),month:null,isEnabled:!1}),be=()=>({year:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}],month:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),ye=async s=>{try{return(await C().post("/period/load-data-table",s)).data.data}catch{return oe()}},we=async s=>{try{return{status:!0,data:(await C().post("/period",s)).data.data}}catch(l){return l.response.status===422?{status:!1,data:l.response.data.errors}:{status:!1,data:null}}},Ee=async s=>{try{return{status:!0,data:(await C().put("/period",s)).data.data}}catch(l){return l.response.status===422?{status:!1,data:l.response.data.errors}:{status:!1,data:null}}},he=async s=>{try{return await C().delete("/period",{data:{id:s.id}}),!0}catch{return!1}},Y=S({__name:"PeriodForm",props:{item:{},modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(s,{emit:l}){const r=l,a=s,d=Q({get:()=>a.modelValue,set:c=>r("update:modelValue",c)}),u=_(!1),i=_(null),o=_(U()),p=_(null),D=_({...be()}),O=async()=>{if(i.value){const c=await i.value.validate();let n=null;c?(u.value=!0,o.value.id?n=await Ee(o.value):n=await we(o.value),n.status?(r("success"),d.value=!1):p.value=n.data):console.log("Formulario inválido")}u.value=!1},f=()=>{console.log("Inicializando formulario"),o.value=a.item?{...a.item}:U()};return X(d,c=>{c&&f()}),(c,n)=>{const V=pe,y=ce,x=j,m=se,v=re,b=ue,B=L,I=_e,z=P,w=N,Z=ee;return T(),A(Z,{show:d.value,"onUpdate:show":n[6]||(n[6]=g=>d.value=g)},{default:t(()=>[e(w,{style:{width:"500px"},title:c.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:t(()=>[e(b,{justify:"end"},{default:t(()=>[e(z,{tertiary:"",size:"large",onClick:n[5]||(n[5]=g=>d.value=!1),disabled:u.value},{default:t(()=>n[7]||(n[7]=[R(" Cancelar ")])),_:1},8,["disabled"]),e(z,{size:"large",type:"primary",onClick:O,loading:u.value},{default:t(()=>n[8]||(n[8]=[R("Guardar")])),_:1},8,["loading"])]),_:1})]),default:t(()=>[e(I,{ref_key:"formRef",ref:i,model:o.value,rules:D.value,size:"large"},{default:t(()=>[e(B,{gutter:16},{default:t(()=>[e(x,{span:"12"},{default:t(()=>{var g;return[e(y,{path:"year",label:"Año",feedback:(g=p.value)==null?void 0:g.year},{default:t(()=>{var E;return[e(V,{clearable:"",maxlength:"4",status:((E=p.value)==null?void 0:E.year)!=null?"error":"",value:o.value.year,"onUpdate:value":n[0]||(n[0]=h=>o.value.year=h),valueModifiers:{number:!0},onInput:n[1]||(n[1]=h=>p.value!=null?p.value.year=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),e(x,{span:"12"},{default:t(()=>{var g;return[e(y,{path:"month",label:"Mes",feedback:(g=p.value)==null?void 0:g.month},{default:t(()=>{var E;return[e(m,{clearable:"",value:o.value.month,"onUpdate:value":n[2]||(n[2]=h=>o.value.month=h),options:k(W),"virtual-scroll":!1,status:((E=p.value)==null?void 0:E.month)!=null?"error":"",onInput:n[3]||(n[3]=h=>p.value!=null?p.value.month=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),e(x,{span:"24"},{default:t(()=>[e(b,{justify:"end"},{default:t(()=>[e(y,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:t(()=>[e(v,{value:o.value.isEnabled,"onUpdate:value":n[4]||(n[4]=g=>o.value.isEnabled=g)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ke={style:{"border-bottom":"1px solid #e9e9e9"}},xe=S({__name:"DataTable",setup(s){const l=_(!1),r=_([]),a=_(!1),d=_(null),u=ae({...H()}),i=_({search:null,page:u.page,pageSize:u.pageSize}),o=_({}),O=fe(m=>{d.value=m,a.value=!0},async m=>{await he(m),await f()}),f=async()=>{i.value.page=1,await c()},c=async()=>{l.value=!0,o.value=await ye(i.value),r.value=o.value.data,u.total=o.value.total,u.pageSize=o.value.per_page,u.page=o.value.current_page,u.pageCount=o.value.last_page,l.value=!1},n=ie(()=>{f()},400),V=async m=>{i.value.page=m,await c()},y=async m=>{i.value.page=1,i.value.pageSize=m,await c()};return(async()=>{await c()})(),(m,v)=>{const b=j,B=me,I=L,z=de;return T(),F(q,null,[G("div",ke,[e(I,{gutter:12,style:{padding:"12px 16px"}},{default:t(()=>[e(b,{span:12}),e(b,{span:12},{default:t(()=>[e(B,{size:"large",placeholder:"Buscar",value:i.value.search,"onUpdate:value":v[0]||(v[0]=w=>i.value.search=w),onInput:k(n),clearable:""},{suffix:t(()=>[e(J,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(b,{span:24},{default:t(()=>[e(z,{key:"id",remote:"","single-line":!1,columns:k(O),data:r.value,pagination:k(ve)(u),"pagination-show-size-picker":!0,loading:l.value,"onUpdate:page":V,"onUpdate:pageSize":y},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),te(m.$slots,"extra",{reLoadDataTable:f})]),e(Y,{modelValue:a.value,"onUpdate:modelValue":v[1]||(v[1]=w=>a.value=w),item:d.value,onSuccess:f},null,8,["modelValue","item"])],64)}}}),$e=S({__name:"index",setup(s){const l=_(!1);return(r,a)=>{const d=P,u=N;return T(),F(q,null,[e(u,{segmented:{header:!0,content:!0}},{header:t(()=>a[2]||(a[2]=[G("h6",{style:{color:"#999",margin:"0"}},"Gestión Periodos Académicos",-1),R(" Periodos Académicos ")])),"header-extra":t(()=>[e(d,{"render-icon":k(M)("additem"),onClick:a[0]||(a[0]=i=>l.value=!0)},{default:t(()=>a[3]||(a[3]=[R(" Agregar ")])),_:1},8,["render-icon"])]),_:1}),e(xe,null,{extra:t(({reLoadDataTable:i})=>[e(Y,{modelValue:l.value,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value=o),item:null,onSuccess:i},null,8,["modelValue","onSuccess"])]),_:1})],64)}}});export{$e as default};
