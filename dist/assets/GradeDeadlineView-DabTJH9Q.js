import{r as ne}from"./icon.utils-D7AUVIU9.js";import{f as O}from"./dateFormatter.utils-4gMrAa0F.js";import{i as G,a as oe}from"./DataTable.types-BEg5m_To.js";import{a3 as M,h as C,ag as B,az as le,d as T,e as R,r as m,j as se,a9 as $,aa as z,ab as t,ac as a,aB as j,ae as y,aA as A,aI as re,aJ as ie,aG as q,_ as E,af as U,aK as ue,aH as de,a8 as pe,ad as ce}from"./index-Dga6ANj1.js";import{d as W}from"./debounce.utils-DqPPCsFD.js";import{a as me}from"./selectables.services-DrN-Q4RR.js";import{_ as _e,a as ve}from"./FormItem-DNGP1HoV.js";import{_ as H,a as J}from"./Col-CQISFbwN.js";import{_ as ge}from"./Select-zCQZwiWb.js";import{_ as K}from"./Input-Cdqf_kvO.js";import{_ as fe}from"./Space-j9I4BA4b.js";import{_ as be}from"./DataTable-DRXC1w3I.js";import"./get-CRgnu-Rv.js";import"./Popover-WKcDoR5R.js";import"./use-merged-state-BuNcl0OG.js";import"./Suffix-NjKowPKN.js";import"./Tag-B6LobqAE.js";import"./Tooltip-Dl9y0IfD.js";import"./Dropdown-D-rd6urP.js";const{hasPermission:ye}=M(),De=r=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(o){const l=o;return ye(["grade-deadline.extencion"])?C(B,{disabled:l.type==="AMPLIACION",onClick:()=>{r(l)},item:l},{default:()=>"Ampliación"}):null}},{title:"Periodo",key:"period",minWidth:"120px"},{title:"Fecha de Inicio",key:"startDate",minWidth:"140px",render(o){const l=o;return C("span",{},{default:()=>O(l.startDate)})}},{title:"Fecha de Fin",key:"endDate",minWidth:"140px",render(o){const l=o;return C("span",{},{default:()=>O(l.endDate)})}},{title:"Tipo",key:"type",width:"120px"},{title:"Observaciones",key:"observations",minWidth:"200px"}],he=(r=G())=>({page:r.page,total:r.total,pageSize:r.pageSize,pageCount:r.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${r.total} registros`}}),L=()=>({id:null,startDate:null,endDate:null,observations:"",periodId:null}),we=r=>({startDate:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:"La fecha de inicio debe ser menor",trigger:"blur",validator:(o,l)=>r.endDate&&l>r.endDate?Promise.reject("La fecha de inicio debe ser menor"):Promise.resolve()}],endDate:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:"La fecha de fin debe ser mayor",trigger:"blur",validator:(o,l)=>r.startDate&&l<r.startDate?Promise.reject("La fecha de fin debe ser mayor"):Promise.resolve()}],periodId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),Q=le(),X="/grade-deadlines",xe=async r=>{try{return(await Q.post(`${X}/load-data-table`,r)).data.data}catch{return oe()}},ke=async r=>{try{return{status:!0,data:(await Q.post(`${X}/save`,r)).data.data}}catch(o){return o.response.status===422?{status:!1,data:o.response.data.errors}:{status:!1,data:null}}},Y=T({__name:"Form",props:{item:{},modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(r,{emit:o}){const l=o,_=r,u=R({get:()=>_.modelValue,set:i=>l("update:modelValue",i)}),d=m(!1),c=m(null),n=m(L()),s=m(null),h=R(()=>({...we(n.value)})),g=m(!1),f=m([]),I=async i=>{g.value=!0,f.value=await me(i),g.value=!1},P=W(i=>{I(i)},400),V=async()=>{if(c.value){const i=await c.value.validate();let e=null;i&&(d.value=!0,e=await ke(n.value),e.status?(l("success"),u.value=!1):s.value=e.data)}d.value=!1},F=()=>{n.value=_.item?{..._.item,startDate:_.item.lastDate?_.item.lastDate.slice(0,10):null,endDate:null,observations:null}:L()};return se(u,i=>{i&&(s.value=null,I(""),F())}),(i,e)=>{const w=ge,D=ve,b=J,x=K,k=H,Z=_e,N=B,ee=fe,ae=j,te=re;return z(),$(te,{show:u.value,"onUpdate:show":e[9]||(e[9]=p=>u.value=p)},{default:t(()=>[a(ae,{style:{width:"500px"},title:i.item?"Editar registro":"Nuevo registro",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:t(()=>[a(ee,{justify:"end"},{default:t(()=>[a(N,{tertiary:"",size:"large",onClick:e[8]||(e[8]=p=>u.value=!1),disabled:d.value},{default:t(()=>e[10]||(e[10]=[A(" Cancelar ")])),_:1},8,["disabled"]),a(N,{size:"large",type:"primary",onClick:V,loading:d.value},{default:t(()=>e[11]||(e[11]=[A("Guardar")])),_:1},8,["loading"])]),_:1})]),default:t(()=>[a(Z,{ref_key:"formRef",ref:c,model:n.value,rules:h.value,size:"large"},{default:t(()=>[a(k,{gutter:16},{default:t(()=>[a(b,{span:"24"},{default:t(()=>{var p;return[a(D,{path:"periodId",label:"Periodo",feedback:(p=s.value)==null?void 0:p.periodId},{default:t(()=>[a(w,{value:n.value.periodId,"onUpdate:value":[e[0]||(e[0]=v=>n.value.periodId=v),e[1]||(e[1]=()=>s.value!=null?s.value.periodId=null:()=>{})],placeholder:"Seleccionar Periodo Académico",filterable:"",options:f.value,loading:g.value,clearable:"",remote:"",disabled:n.value.id!=null,"virtual-scroll":!1,onSearch:y(P)},null,8,["value","options","loading","disabled","onSearch"])]),_:1},8,["feedback"])]}),_:1}),a(b,{span:"12"},{default:t(()=>{var p;return[a(D,{path:"startDate",label:"Fecha de inicio",feedback:(p=s.value)==null?void 0:p.startDate},{default:t(()=>{var v;return[a(x,{type:"date",disabled:n.value.id!=null,value:n.value.startDate,"onUpdate:value":[e[2]||(e[2]=S=>n.value.startDate=S),e[3]||(e[3]=()=>s.value!=null?s.value.startDate=null:()=>{})],status:((v=s.value)==null?void 0:v.startDate)!=null?"error":"",clearable:"",placeholder:""},null,8,["disabled","value","status"])]}),_:1},8,["feedback"])]}),_:1}),a(b,{span:"12"},{default:t(()=>{var p;return[a(D,{path:"endDate",label:"Fecha de fin",feedback:(p=s.value)==null?void 0:p.endDate},{default:t(()=>{var v;return[a(x,{type:"date",placeholder:"",value:n.value.endDate,"onUpdate:value":[e[4]||(e[4]=S=>n.value.endDate=S),e[5]||(e[5]=()=>s.value!=null?s.value.endDate=null:()=>{})],status:((v=s.value)==null?void 0:v.endDate)!=null?"error":"",clearable:""},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1}),a(b,{span:"24"},{default:t(()=>{var p;return[a(D,{path:"observations",label:"Observaciones",feedback:(p=s.value)==null?void 0:p.observations},{default:t(()=>{var v;return[a(x,{type:"textarea",value:n.value.observations,"onUpdate:value":[e[6]||(e[6]=S=>n.value.observations=S),e[7]||(e[7]=()=>s.value!=null?s.value.observations=null:()=>{})],status:((v=s.value)==null?void 0:v.observations)!=null?"error":"",clearable:"",placeholder:"Ingrese observaciones"},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Se={style:{"border-bottom":"1px solid #e9e9e9"}},ze=T({__name:"DataTable",setup(r){const o=m(!1),l=m([]),_=m(!1),u=m(null),d=ie({...G()}),c=m({search:null,page:d.page,pageSize:d.pageSize}),n=m({}),h=De(i=>{u.value=i,_.value=!0}),g=async()=>{c.value.page=1,await f()},f=async()=>{o.value=!0,n.value=await xe(c.value),l.value=n.value.data,d.total=n.value.total,d.pageSize=n.value.per_page,d.page=n.value.current_page,d.pageCount=n.value.last_page,o.value=!1},I=W(()=>{g()},400),P=async i=>{c.value.page=i,await f()},V=async i=>{c.value.page=1,c.value.pageSize=i,await f()};return(async()=>{await f()})(),(i,e)=>{const w=J,D=K,b=H,x=be;return z(),q(E,null,[U("div",Se,[a(b,{gutter:12,style:{padding:"12px 16px"}},{default:t(()=>[a(w,{span:12}),a(w,{span:12},{default:t(()=>[a(D,{size:"large",placeholder:"Buscar",value:c.value.search,"onUpdate:value":e[0]||(e[0]=k=>c.value.search=k),onInput:y(I),clearable:""},{suffix:t(()=>[a(de,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),a(b,null,{default:t(()=>[a(w,{span:24},{default:t(()=>[a(x,{key:"id",remote:"",size:"small","single-line":!1,columns:y(h),data:l.value,pagination:y(he)(d),"pagination-show-size-picker":!0,loading:o.value,"onUpdate:page":P,"onUpdate:pageSize":V},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),ue(i.$slots,"extra",{reLoadDataTable:g})]),a(Y,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=k=>_.value=k),item:u.value,onSuccess:g},null,8,["modelValue","item"])],64)}}}),We=T({__name:"GradeDeadlineView",setup(r){const{hasPermission:o}=M(),l=m(!1);return(_,u)=>{const d=B,c=j,n=pe("AppNotAuthorization");return y(o)(["grade-deadline.create","grade-deadline.extencion"])?(z(),q(E,{key:0},[a(c,{segmented:{header:!0,content:!0}},{header:t(()=>u[2]||(u[2]=[U("span",{class:"text-sm text-slate-500"}," Gestion de periodo de ingresos de notas ",-1),U("h5",{class:"text-lg font-bold text-slate-800"}," Habilitar ingreso de notas ",-1)])),"header-extra":t(()=>[y(o)(["grade-deadline.create"])?(z(),$(d,{key:0,"render-icon":y(ne)("additem"),onClick:u[0]||(u[0]=s=>l.value=!0)},{default:t(()=>u[3]||(u[3]=[A(" Agregar ")])),_:1},8,["render-icon"])):ce("",!0)]),_:1}),a(ze,null,{extra:t(({reLoadDataTable:s})=>[a(Y,{modelValue:l.value,"onUpdate:modelValue":u[1]||(u[1]=h=>l.value=h),item:null,onSuccess:s},null,8,["modelValue","onSuccess"])]),_:1})],64)):(z(),$(n,{key:1}))}}});export{We as default};
