import{G as x}from"./genders.constans-BK559Fh_.js";import{u as H}from"./useBreakpoints-BHeBkXFa.js";import{d as h,e as J,f as K,g as Q,h as W,i as X}from"./student.services-BS-DM_Hz.js";import{d as Y,e as Z,r as I,j as ee,aN as ae,a9 as B,aa as N,ab as s,ac as a,ad as le,ae as i,w as k,af as T,aA as S,aG as C,_ as te,aL as se,ag as oe,aI as ne,ah as R}from"./index-C2RAjY4S.js";import{_ as ue}from"./Select-CIfpunuo.js";import{_ as re}from"./Alert-5ipw5VW6.js";import{u as ie}from"./composables-DbeQn7Bu.js";import{_ as de,a as me}from"./FormItem-8N6y2FM0.js";import{_ as pe,a as ve}from"./Col-C7IEyeD2.js";import{_ as fe}from"./Input-BZPRw-RC.js";import{_ as ce}from"./Space-BaG8M23m.js";import{_ as _e}from"./Switch-O_omZ9GJ.js";const ge={class:"list-disc pl-5 mt-2"},Be=Y({__name:"StudentForm",props:{item:{},associatedItems:{},modelValue:{type:Boolean},selectables:{}},emits:["update:modelValue","success"],setup(V,{emit:$}){const y=$,D=ie(),f=V,{screenSize:p}=H(),c=Z({get:()=>f.modelValue,set:n=>y("update:modelValue",n)}),_=I(!1),g=I(null),t=I(h()),o=I(null),z=I({...J()}),G=async()=>{if(g.value)if(await g.value.validate()&&f.associatedItems&&f.associatedItems.length>0){_.value=!0;const e=await K({...t.value,associatedItems:f.associatedItems.map(b=>b.id)});e.status?(console.log("Registros asociados correctamente:",e.data),y("success",t.value),c.value=!1):(o.value=e.data,console.error("Error al asociar los registros:",e.data)),_.value=!1}else console.warn("No hay registros asociados para procesar.")},E=async()=>{if(g.value){const n=await g.value.validate();let e=null;n?(_.value=!0,t.value.id?e=await Q(t.value):e=await W(t.value),e.status?(y("success",t.value),c.value=!1):o.value=e.data):console.log("Formulario inválido")}_.value=!1},M=async()=>{var n;return(n=f.item)!=null&&n.id?t.value=await X(f.item.id):t.value=h(),t.value},A=async()=>{console.log("Inicializando formulario"),o.value=null,await M()};return ee(c,n=>{n&&A()}),(n,e)=>{const b=ue,d=me,m=ve,v=fe,O=_e,F=ce,P=pe,j=de,L=re,U=oe,q=ne,w=ae("upper-case");return N(),B(q,{show:c.value,"onUpdate:show":e[18]||(e[18]=l=>c.value=l),draggable:"",title:n.item?"EDITAR REGISTRO":"NUEVO REGISTRO",preset:"card",style:{width:"1024px"},segmented:{content:!0,footer:!0},size:"small","aria-modal":"true"},{footer:s(()=>[a(F,{justify:"end"},{default:s(()=>[a(U,{tertiary:"",size:"large",onClick:e[16]||(e[16]=l=>c.value=!1),disabled:_.value},{default:s(()=>e[20]||(e[20]=[S(" Cancelar ")])),_:1},8,["disabled"]),a(U,{size:"large",type:"primary",onClick:e[17]||(e[17]=l=>n.associatedItems&&n.associatedItems.length>0?i(D).warning({title:"Confirmar",content:"¿Está seguro que desea eliminar los registros asociados?",positiveText:"Guardar y Asociar",negativeText:"Cancelar",closable:!1,showIcon:!0,negativeButtonProps:{size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:G}):E()),loading:_.value},{default:s(()=>e[21]||(e[21]=[S("Guardar")])),_:1},8,["loading"])]),_:1})]),default:s(()=>[a(j,{ref_key:"formRef",ref:g,model:t.value,rules:z.value,size:"large",onSubmit:E},{default:s(()=>[a(P,{gutter:16},{default:s(()=>[a(m,{span:i(p)==="sm"?12:8},{default:s(()=>[a(d,{path:"studentTypeId",label:"Tipo de Estudiante"},{default:s(()=>[a(b,{value:t.value.studentTypeId,"onUpdate:value":e[0]||(e[0]=l=>t.value.studentTypeId=l),clearable:"",placeholder:"Seleccione","virtual-scroll":!1,options:n.selectables.studentTypesItems},null,8,["value","options"])]),_:1})]),_:1},8,["span"]),a(m,{span:i(p)==="sm"?12:8},{default:s(()=>[a(d,{path:"documentTypeId",label:"Tipo de Documento"},{default:s(()=>[a(b,{value:t.value.documentTypeId,"onUpdate:value":e[1]||(e[1]=l=>t.value.documentTypeId=l),clearable:"","virtual-scroll":!1,placeholder:"Seleccione",options:n.selectables.documentTypesItems},null,8,["value","options"])]),_:1})]),_:1},8,["span"]),a(m,{span:i(p)==="sm"?12:8},{default:s(()=>{var l;return[a(d,{path:"documentNumber",label:"Número de Documento",feedback:(l=o.value)==null?void 0:l.documentNumber},{default:s(()=>{var u;return[a(v,{value:t.value.documentNumber,"onUpdate:value":e[2]||(e[2]=r=>t.value.documentNumber=r),status:((u=o.value)==null?void 0:u.documentNumber)!=null?"error":"",onInput:e[3]||(e[3]=r=>o.value!=null?o.value.documentNumber=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),a(m,{span:i(p)==="sm"?24:8},{default:s(()=>{var l;return[a(d,{path:"name",label:"Nombre",feedback:(l=o.value)==null?void 0:l.name},{default:s(()=>{var u;return[k(a(v,{status:((u=o.value)==null?void 0:u.name)!=null?"error":"",value:t.value.name,"onUpdate:value":e[4]||(e[4]=r=>t.value.name=r),onInput:e[5]||(e[5]=r=>o.value!=null?o.value.name=null:()=>{})},null,8,["status","value"]),[[w]])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),a(m,{span:i(p)==="sm"?12:8},{default:s(()=>{var l;return[a(d,{path:"lastNameFather",label:"Apellido Paterno",feedback:(l=o.value)==null?void 0:l.lastNameFather},{default:s(()=>{var u;return[k(a(v,{status:((u=o.value)==null?void 0:u.lastNameFather)!=null?"error":"",value:t.value.lastNameFather,"onUpdate:value":e[6]||(e[6]=r=>t.value.lastNameFather=r),onInput:e[7]||(e[7]=r=>o.value!=null?o.value.lastNameFather=null:()=>{})},null,8,["status","value"]),[[w]])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),a(m,{span:i(p)==="sm"?12:8},{default:s(()=>{var l;return[a(d,{path:"lastNameMother",label:"Apellido Materno",feedback:(l=o.value)==null?void 0:l.lastNameMother},{default:s(()=>{var u;return[k(a(v,{status:((u=o.value)==null?void 0:u.lastNameMother)!=null?"error":"",value:t.value.lastNameMother,"onUpdate:value":e[8]||(e[8]=r=>t.value.lastNameMother=r),onInput:e[9]||(e[9]=r=>o.value!=null?o.value.lastNameMother=null:()=>{})},null,8,["status","value"]),[[w]])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),a(m,{span:i(p)==="sm"?12:6},{default:s(()=>[a(d,{path:"gender",label:"Genero"},{default:s(()=>[a(b,{value:t.value.gender,"onUpdate:value":e[10]||(e[10]=l=>t.value.gender=l),clearable:"",placeholder:"Seleccione","virtual-scroll":!1,options:i(x)},null,8,["value","options"])]),_:1})]),_:1},8,["span"]),a(m,{span:i(p)==="sm"?12:6},{default:s(()=>[a(d,{path:"birthDate",label:"Fecha de Nacimiento"},{default:s(()=>[a(v,{value:t.value.dateOfBirth,"onUpdate:value":e[11]||(e[11]=l=>t.value.dateOfBirth=l),type:"date",clearable:"",placeholder:""},null,8,["value"])]),_:1})]),_:1},8,["span"]),a(m,{span:i(p)==="sm"?12:6},{default:s(()=>{var l;return[a(d,{path:"email",feedback:(l=o.value)==null?void 0:l.email,label:"Correo Electrónico"},{default:s(()=>{var u;return[a(v,{status:((u=o.value)==null?void 0:u.email)!=null?"error":"",onInput:e[12]||(e[12]=r=>o.value!=null?o.value.email=null:()=>{}),value:t.value.email,"onUpdate:value":e[13]||(e[13]=r=>t.value.email=r)},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1},8,["span"]),a(m,{span:i(p)==="sm"?12:6},{default:s(()=>[a(d,{path:"phone",label:"Teléfono"},{default:s(()=>[a(v,{value:t.value.phone,"onUpdate:value":e[14]||(e[14]=l=>t.value.phone=l)},null,8,["value"])]),_:1})]),_:1},8,["span"]),a(m,{span:"24"},{default:s(()=>[a(F,{justify:"end"},{default:s(()=>[a(d,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:s(()=>[a(O,{value:t.value.isEnabled,"onUpdate:value":e[15]||(e[15]=l=>t.value.isEnabled=l)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"]),n.associatedItems?(N(),B(L,{key:0,"show-icon":!1,class:"mt-4",type:"error"},{default:s(()=>[e[19]||(e[19]=T("span",{class:"text-red-500"},[T("strong",null,"Atención:"),S(" Si guarda este registro, los siguientes registros serán eliminados y sus datos serán asociados a este registro. ")],-1)),T("ul",ge,[(N(!0),C(te,null,se(n.associatedItems,l=>(N(),C("li",{key:l.id},R(l.code)+" - "+R(l.name),1))),128))])]),_:1})):le("",!0)]),_:1},8,["show","title"])}}});export{Be as _};
