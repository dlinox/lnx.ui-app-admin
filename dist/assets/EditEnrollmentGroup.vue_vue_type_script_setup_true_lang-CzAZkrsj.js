import{r as R}from"./icon.utils-BZ_5fGn6.js";import{az as K,d as L,r as x,e as N,j as J,a8 as Q,a9 as U,aa as C,aI as W,ab as a,ac as e,aB as X,aA as I,b7 as re,b8 as le,ag as F,ae as O,aG as $,_ as q,af as c,aU as j,b2 as se,b3 as ue,ah as v}from"./index-BOyx2DGO.js";import{_ as de}from"./Alert-DWB3U6zN.js";import{_ as ie,a as pe}from"./FormItem-BNNBpqpK.js";import{_ as Y,a as Z}from"./Col-Ddh-mtwO.js";import{_ as ce}from"./Input-CA42N3nM.js";import{_ as me}from"./Select-CP6PIrTl.js";import{a as _e,_ as ge}from"./ListItem-Dxt3JRC8.js";import{_ as fe}from"./Thing-BxYJ11Ic.js";import{_ as ve}from"./Tag-DM5krFKW.js";import{_ as ye}from"./Space-Bq9hZ6L8.js";import{a as be}from"./DataTable.types-BEg5m_To.js";import{u as we}from"./composables-C-nEvORv.js";import{_ as Ie}from"./Dropdown-DquLRH-c.js";const b=K(),at=async t=>{try{return(await b.post("/enrollment/load-data-table",t)).data.data}catch{return be()}},ot=async t=>{try{return{status:!0,data:(await b.post("/enrollment/module-store",{...t})).data.data}}catch{return{status:!1,data:null}}},he=async t=>{try{return{status:!0,data:(await b.post("/enrollment/group-store",{...t})).data.data}}catch{return{status:!1,data:null}}},ke=async t=>{try{return{status:!0,data:(await b.post("/enrollment/group-update",{...t})).data.data}}catch{return{status:!1,data:null}}},xe=async t=>{try{return{status:!0,data:(await b.post("/enrollment/group-reserved",{...t})).data.data}}catch{return{status:!1,data:null}}},Ee=async t=>{try{return{status:!0,data:(await b.post("/enrollment/group-cancel",{...t})).data.data}}catch{return{status:!1,data:null}}},Se=async t=>{try{return{status:!0,data:(await b.post("/enrollment/enabled-groups",t)).data.data}}catch{return{status:!1,data:null}}},rt=async(t,o,i)=>{try{return(await b.post("/enrollment/student-enrollment-avaliable",{studentId:t,curriculumId:o,periodId:i})).data.data}catch{return null}},lt=async(t,o)=>{try{return{status:!0,data:(await b.post(`/enrollment/${t}/student/${o}/curriculum`)).data.data}}catch{return{status:!1,data:[]}}},st=async t=>{try{return(await b.post("/enrollment/download-enrollment-pdf",{...t},{responseType:"blob"})).data}catch{return null}},Ce=async t=>{try{return(await b.post("/enrollment/get-enrollment-group-payments",{...t})).data.data}catch{return[]}},ut=async(t,o,i)=>{try{return(await b.post("/enrollment/student-enrollment-avaliable-special",{studentId:t,curriculumId:o,periodId:i})).data.data}catch{return null}},H=()=>({id:null,studentId:null,groupId:null,payments:[]}),Ve=K(),Ge=async t=>{try{return(await Ve.post("/payment/validate",t)).data.data}catch{return{token:null}}},Pe=()=>({studentId:null,amount:null,date:null,sequenceNumber:null,paymentTypeId:7}),ze=t=>({studentId:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],amount:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:"Debe ser un número",trigger:["blur","input"],validator:(o,i)=>{if(i){if(!/^\d*\.?\d*$/.test(i))return new Error("Debe ser un número")}else return new Error("Obligatorio");return!0}}],date:[{required:!0,trigger:["blur","input"],message:"Obligatorio"}],sequenceNumber:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:t===7?"Debe tener 7 digitos":"Debe tener 6 digitos",trigger:["blur","input"],validator:(o,i)=>{if(i)if(/^\d*$/.test(i)){if(t===7&&i.length!==7)return new Error("Debe tener 7 digitos");if(t===9&&i.length!==6)return new Error("Debe tener 6 digitos")}else return new Error("Debe ser un número");else return new Error("Obligatorio");return!0}}],paymentTypeId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),Te=L({__name:"PaymentForm",props:{modelValue:{type:Boolean},studentId:{}},emits:["update:modelValue","success"],setup(t,{emit:o}){const i=o,u=t,p=x(!1),y=N({get:()=>u.modelValue,set:f=>i("update:modelValue",f)}),h=x(null),d=x({}),m=N(()=>ze(d.value.paymentTypeId)),g=async()=>{if(h.value&&!await h.value.validate())return;d.value.studentId=u.studentId,p.value=!0;const f=await Ge(d.value);f.token!==null&&(y.value=!1,i("success",{token:f.token,payment:d.value})),p.value=!1,console.log("Validando pago",f)},l=()=>{console.log("Inicializando formulario"),d.value=Object.assign({},Pe())};return J(y,f=>{f&&l()}),(f,_)=>{const A=Q("LnxIcon"),D=re,B=de,G=ce,V=pe,E=Z,n=me,r=F,k=Y,S=ie,P=X,z=W;return C(),U(z,{show:y.value,"onUpdate:show":_[4]||(_[4]=w=>y.value=w)},{default:a(()=>[e(P,{style:{width:"500px"},title:"REGISTRAR PAGO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:a(()=>[e(B,{title:"¡Importante!",type:"default",class:"mb-4"},{icon:a(()=>[e(D,null,{default:a(()=>[e(A,{"icon-name":"information",size:"20"})]),_:1})]),default:a(()=>[_[5]||(_[5]=I(" Solo se validan pagos realizados, con un día de anticipación. "))]),_:1}),e(S,{ref_key:"formRef",ref:h,model:d.value,rules:m.value,size:"large",onKeydown:le(g,["enter"])},{default:a(()=>[e(k,{gutter:[16,16]},{default:a(()=>[e(E,{span:"12"},{default:a(()=>[e(V,{path:"amount",label:"Monto"},{default:a(()=>[e(G,{value:d.value.amount,"onUpdate:value":_[0]||(_[0]=w=>d.value.amount=w)},null,8,["value"])]),_:1})]),_:1}),e(E,{span:"12"},{default:a(()=>[e(V,{path:"date",label:"Fecha de pago"},{default:a(()=>[e(G,{placeholder:"",type:"date",value:d.value.date,"onUpdate:value":_[1]||(_[1]=w=>d.value.date=w)},null,8,["value"])]),_:1})]),_:1}),e(E,{span:"12"},{default:a(()=>[e(V,{path:"sequenceNumber",label:"Secuencia"},{default:a(()=>[e(G,{value:d.value.sequenceNumber,"onUpdate:value":_[2]||(_[2]=w=>d.value.sequenceNumber=w)},null,8,["value"])]),_:1})]),_:1}),e(E,{span:"12"},{default:a(()=>[e(V,{path:"paymentTypeId",label:"Metodo de pago"},{default:a(()=>[e(n,{"virtual-scroll":!1,value:d.value.paymentTypeId,"onUpdate:value":_[3]||(_[3]=w=>d.value.paymentTypeId=w),placeholder:"Metodo de pago",options:[{label:"BN - VENTANILLA",value:7},{label:"BN - PAGALO.PE",value:9}]},null,8,["value"])]),_:1})]),_:1}),e(E,{span:"24"},{default:a(()=>[e(r,{loading:p.value,secondary:"",type:"primary",onClick:g,block:"","render-icon":O(R)("money-tick")},{default:a(()=>_[6]||(_[6]=[I(" Validar Pago ")])),_:1},8,["loading","render-icon"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"])}}}),$e={class:"wrapper-list-groups"},Re={class:"table-auto w-full"},Ne={class:"px-4 py-2 flex items-center"},Oe={class:"ms-2"},Ae={class:"text-end px-4 py-2"},De={class:"border-b-2 border-gray-500"},Be={class:"px-4 py-2 font-bold text-lg text-end"},Me={class:"px-4 py-2 font-bold text-lg text-end"},qe={class:"text-red-500 text-sm text-end text-sm"},dt=L({__name:"EnrollmentGroupForm",props:{modelValue:{type:Boolean},isSpecial:{type:Boolean},studentId:{},curriculumId:{},courseId:{},enrollmetGroup:{}},emits:["update:modelValue","success"],setup(t,{emit:o}){const i=o,u=t,p=x(!1),y=N({get:()=>u.modelValue,set:n=>i("update:modelValue",n)}),h=x(!1),d=x([]),m=x([]),g=x(0),l=x(Object.assign({},{...H()})),f=n=>{console.log("Pago validado",n),l.value.payments.push(n.token),m.value.push({token:n.token,amount:n.payment.amount,sequenceNumber:n.payment.sequenceNumber})},_=n=>{l.value.groupId&&l.value.groupId!=n.id?(l.value.groupId=n.id,g.value=n.price):l.value.groupId==n.id?(l.value.groupId=null,g.value=0):(l.value.groupId=n.id,g.value=n.price)},A=async()=>{const n=await Se({studentId:u.studentId,curriculumId:u.curriculumId,courseId:u.courseId,isSpecial:u.isSpecial});d.value=n.data},D=n=>{let k=m.value[n].token;m.value.splice(n,1);let S=l.value.payments.find(z=>z===k);if(!S)return;let P=l.value.payments.indexOf(S);l.value.payments.splice(P,1)},B=()=>m.value.reduce((r,k)=>r+parseInt(k.amount),0)>=g.value?null:"El monto pagado es menor al total",G=async()=>{var n;if(l.value.studentId=u.studentId,p.value=!0,(n=u.enrollmetGroup)!=null&&n.id){(await ke({...l.value,isSpecial:u.isSpecial})).status&&(i("success"),y.value=!1),p.value=!1;return}else(await he({...l.value,isSpecial:u.isSpecial})).status&&(i("success"),y.value=!1),p.value=!1},V=async n=>{m.value=await Ce({id:n})},E=async()=>{if(m.value=[],l.value=H(),l.value.payments=[],l.value.groupId=null,g.value=0,await A(),u.enrollmetGroup){let n=d.value.find(r=>r.id==u.enrollmetGroup.groupId);n&&(l.value.groupId=n.id,g.value=n.price),l.value.id=u.enrollmetGroup.id,await V(u.enrollmetGroup.id),m.value.length>0&&m.value.forEach(r=>{l.value.payments.push(r.token)})}console.log("Inicializando formulario")};return J(y,n=>{n&&E()}),(n,r)=>{const k=F,S=ve,P=ye,z=fe,w=ge,ee=_e,M=Z,te=Q("LnxIcon"),ne=Y,ae=X,oe=W;return C(),$(q,null,[e(oe,{show:y.value,"onUpdate:show":r[1]||(r[1]=s=>y.value=s)},{default:a(()=>[e(ae,{style:{width:"500px"},title:n.isSpecial?"Matricula Especial":"Matricula Regular",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:a(()=>[e(ne,{gutter:[16,16]},{default:a(()=>[e(M,{span:"24"},{default:a(()=>[c("div",$e,[e(ee,{hoverable:"",clickable:""},{header:a(()=>{var s;return[I(" Grupos aperturados ("+v((s=d.value)!=null&&s.length?d.value.length:0)+") ",1)]}),default:a(()=>[(C(!0),$(q,null,j(d.value,s=>(C(),U(w,{key:s.id,class:se({"item-selected":l.value.groupId==s.id}),extra:s.price},{default:a(()=>[e(z,{title:`${s.group} - S/. ${s.price}`,onClick:T=>_(s)},ue({description:a(()=>[e(P,{size:"small"},{default:a(()=>[e(S,{bordered:!1,type:"info",size:"small"},{default:a(()=>[I(v(s.modality),1)]),_:2},1024)]),_:2},1024)]),default:a(()=>[r[3]||(r[3]=I(" Min.: ")),c("b",null,v(s.minStudents),1),r[4]||(r[4]=I(" | Matriculados: ")),c("b",null,v(s.enrolledStudents),1),r[5]||(r[5]=I(" | Reservados: ")),c("b",null,v(s.reservedStudents),1),r[6]||(r[6]=c("br",null,null,-1)),e(S,{bordered:!1,type:"info",size:"small"},{default:a(()=>[c("strong",null,v(s.schedules.days)+" - "+v(s.schedules.startHour)+" a "+v(s.schedules.endHour),1)]),_:2},1024)]),_:2},[l.value.groupId==s.id?{name:"header-extra",fn:a(()=>[e(k,{circle:"",type:"warning","render-icon":O(R)("verify")},null,8,["render-icon"])]),key:"0"}:void 0]),1032,["title","onClick"])]),_:2},1032,["class","extra"]))),128))]),_:1})])]),_:1}),e(M,{span:"24"},{default:a(()=>[c("span",{role:"button",onClick:r[0]||(r[0]=s=>h.value=!0),class:"border border-dashed border-gray-300 p-4 rounded-sm flex items-center justify-center cursor-pointer text-gray-400 hover:bg-gray-50 font-bold hover:text-gray-500 mb-4"},[e(te,{class:"me-3","icon-name":"money-add",size:"20"}),r[7]||(r[7]=I(" Agregar pago "))]),c("table",Re,[c("tbody",null,[(C(!0),$(q,null,j(m.value,(s,T)=>(C(),$("tr",{key:T,class:"border-b border-gray-300 border-dashed px-4 py-2"},[c("td",Ne,[e(k,{type:"error",size:"small",secondary:"",onClick:Le=>D(T),"render-icon":O(R)("trash")},null,8,["onClick","render-icon"]),c("i",Oe,v(s.sequenceNumber),1)]),c("td",Ae,"S/. "+v(s.amount),1)]))),128)),c("tr",De,[r[8]||(r[8]=c("td",{class:"px-4 py-2"},"Total pagado",-1)),c("td",Be," S/. "+v(m.value.reduce((s,T)=>s+parseInt(T.amount),0)),1)]),c("tr",null,[r[9]||(r[9]=c("td",{class:"px-4 py-2"},"Total a pagar",-1)),c("td",Me," S/. "+v(g.value),1)])])]),c("div",qe,v(B()),1)]),_:1}),e(M,{span:"24"},{default:a(()=>[e(k,{size:"large",type:"primary",onClick:G,block:"",loading:p.value},{default:a(()=>r[10]||(r[10]=[I(" Realizar Matricula ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["show"]),e(Te,{modelValue:h.value,"onUpdate:modelValue":r[2]||(r[2]=s=>h.value=s),studentId:u.studentId,onSuccess:f},null,8,["modelValue","studentId"])],64)}}}),it=L({__name:"EditEnrollmentGroup",props:{item:{}},emits:["changeGroup","reserveEnrollment","cancelEnrollment","resetEnrollment"],setup(t,{emit:o}){const i=we(),u=o,p=t,y=async d=>{switch(d){case"change-group":u("changeGroup",p.item);break;case"reserve-enrollment":i.warning({title:"Confirmar",content:"¿Está seguro de realizar la reserva de la matrícula?",positiveText:"Reservar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"primary"},bordered:!0,onPositiveClick:async()=>{await xe(p.item),u("reserveEnrollment",p.item)}});break;case"cancel-enrollment":i.warning({title:"Confirmar",content:"¿Está seguro de cancelar la matrícula?",positiveText:"Cancelar matrícula",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:async()=>{await Ee(p.item),u("cancelEnrollment",p.item)}});break;case"reset-enrollment":u("resetEnrollment",p.item);break}},h=N(()=>{var d,m,g,l,f;return[{label:"Cambiar grupo",key:"change-group",disabled:((d=p.item)==null?void 0:d.enrollmentStatus)!=="MATRICULADO"},{label:"Reservar matrícula",key:"reserve-enrollment",disabled:((m=p.item)==null?void 0:m.enrollmentStatus)!=="MATRICULADO"},{label:"Cancelar matrícula",key:"cancel-enrollment",disabled:((g=p.item)==null?void 0:g.enrollmentStatus)=="CANCELADO"},{label:"Reestablecer matrícula",key:"reset-enrollment",disabled:((l=p.item)==null?void 0:l.enrollmentStatus)!=="CANCELADO"&&((f=p.item)==null?void 0:f.enrollmentStatus)!=="RESERVADO"}]});return(d,m)=>{const g=F,l=Ie;return C(),U(l,{trigger:"click",options:h.value,"show-arrow":!0,onSelect:y},{default:a(()=>[e(g,{"render-icon":O(R)("magicpen")},{default:a(()=>m[0]||(m[0]=[I(" Opt. ")])),_:1},8,["render-icon"])]),_:1},8,["options"])}}});export{Te as _,Se as a,ot as b,lt as c,it as d,dt as e,st as f,rt as g,ut as h,at as i};
