import{r as ae}from"./icon.utils-6fJ-3dCS.js";import{h as V,af as U,ay as te,d as F,e as R,r as c,j as ne,a8 as oe,a9 as T,aa as t,ab as a,aA as G,ad as k,az as C,aH as le,aI as se,aF as M,_ as N,ae as $,aJ as re,aG as ue}from"./index-DRqPu8js.js";import{i as j,a as ie}from"./DataTable.types-BEg5m_To.js";import{d as q}from"./debounce.utils-DqPPCsFD.js";import{a as de}from"./selectables.services-BQd8Oz6S.js";import{_ as pe,a as me}from"./FormItem-B0e_KJJq.js";import{_ as E,a as W}from"./Col-CNgfr2Vq.js";import{_ as ce}from"./Select-Bhk-Lp7D.js";import{_ as H}from"./Input-PHuG5EIV.js";import{_ as _e}from"./Space-DpUkt9IF.js";import{f as A}from"./dateFormatter.utils-4gMrAa0F.js";import{_ as ve}from"./DataTable-B0gpVXZr.js";import"./get-CdE2f0gc.js";import"./Popover-DfaujfXt.js";import"./use-merged-state-dfDog2av.js";import"./Suffix-DbP13eKO.js";import"./Tag-DIW11yL8.js";import"./Tooltip-lejxWDdy.js";import"./Dropdown-hwViG8Gw.js";const fe=l=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(n){const r=n;return V(U,{disabled:r.type==="AMPLIACION",onClick:()=>{l(r)},item:r},{default:()=>"Ampliación"})}},{title:"Periodo",key:"period",minWidth:"120px"},{title:"Fecha de Inicio",key:"startDate",minWidth:"140px",render(n){const r=n;return V("span",{},{default:()=>A(r.startDate)})}},{title:"Fecha de Fin",key:"endDate",minWidth:"140px",render(n){const r=n;return V("span",{},{default:()=>A(r.endDate)})}},{title:"Tipo",key:"type",width:"120px"},{title:"Observaciones",key:"observations",minWidth:"200px"}],ge=(l=j())=>({page:l.page,total:l.total,pageSize:l.pageSize,pageCount:l.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${l.total} registros`}}),L=()=>({id:null,startDate:null,endDate:null,observations:"",periodId:null}),be=l=>({startDate:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:"La fecha de inicio debe ser menor",trigger:"blur",validator:(n,r)=>l.endDate&&r>l.endDate?Promise.reject("La fecha de inicio debe ser menor"):Promise.resolve()}],endDate:[{required:!0,trigger:["blur","input"],message:"Obligatorio"},{message:"La fecha de fin debe ser mayor",trigger:"blur",validator:(n,r)=>l.startDate&&r<l.startDate?Promise.reject("La fecha de fin debe ser mayor"):Promise.resolve()}],periodId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),J=te(),K="/grade-deadlines",De=async l=>{try{return(await J.post(`${K}/load-data-table`,l)).data.data}catch{return ie()}},ye=async l=>{try{return{status:!0,data:(await J.post(`${K}/save`,l)).data.data}}catch(n){return n.response.status===422?{status:!1,data:n.response.data.errors}:{status:!1,data:null}}},Q=F({__name:"Form",props:{item:{},modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(l,{emit:n}){const r=n,u=l,_=R({get:()=>u.modelValue,set:s=>r("update:modelValue",s)}),d=c(!1),p=c(null),o=c(L()),i=c(null),I=R(()=>({...be(o.value)})),f=c(!1),g=c([]),S=async s=>{f.value=!0,g.value=await de(s),f.value=!1},z=q(s=>{S(s)},400),P=async()=>{if(p.value){const s=await p.value.validate();let e=null;s&&(d.value=!0,e=await ye(o.value),e.status?(r("success"),_.value=!1):i.value=e.data)}d.value=!1},B=()=>{o.value=u.item?{...u.item,startDate:u.item.lastDate?u.item.lastDate.slice(0,10):null,endDate:null,observations:null}:L()};return ne(_,s=>{s&&(i.value=null,S(""),B())}),(s,e)=>{const y=ce,D=me,b=W,w=H,x=E,X=pe,O=U,Y=_e,Z=G,ee=le;return T(),oe(ee,{show:_.value,"onUpdate:show":e[9]||(e[9]=m=>_.value=m)},{default:t(()=>[a(Z,{style:{width:"500px"},title:s.item?"Editar registro":"Nuevo registro",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:t(()=>[a(Y,{justify:"end"},{default:t(()=>[a(O,{tertiary:"",size:"large",onClick:e[8]||(e[8]=m=>_.value=!1),disabled:d.value},{default:t(()=>e[10]||(e[10]=[C(" Cancelar ")])),_:1},8,["disabled"]),a(O,{size:"large",type:"primary",onClick:P,loading:d.value},{default:t(()=>e[11]||(e[11]=[C("Guardar")])),_:1},8,["loading"])]),_:1})]),default:t(()=>[a(X,{ref_key:"formRef",ref:p,model:o.value,rules:I.value,size:"large"},{default:t(()=>[a(x,{gutter:16},{default:t(()=>[a(b,{span:"24"},{default:t(()=>{var m;return[a(D,{path:"periodId",label:"Periodo",feedback:(m=i.value)==null?void 0:m.periodId},{default:t(()=>[a(y,{value:o.value.periodId,"onUpdate:value":[e[0]||(e[0]=v=>o.value.periodId=v),e[1]||(e[1]=()=>i.value!=null?i.value.periodId=null:()=>{})],placeholder:"Seleccionar Periodo Académico",filterable:"",options:g.value,loading:f.value,clearable:"",remote:"",disabled:o.value.id!=null,"virtual-scroll":!1,onSearch:k(z)},null,8,["value","options","loading","disabled","onSearch"])]),_:1},8,["feedback"])]}),_:1}),a(b,{span:"12"},{default:t(()=>{var m;return[a(D,{path:"startDate",label:"Fecha de inicio",feedback:(m=i.value)==null?void 0:m.startDate},{default:t(()=>{var v;return[a(w,{type:"date",disabled:o.value.id!=null,value:o.value.startDate,"onUpdate:value":[e[2]||(e[2]=h=>o.value.startDate=h),e[3]||(e[3]=()=>i.value!=null?i.value.startDate=null:()=>{})],status:((v=i.value)==null?void 0:v.startDate)!=null?"error":"",clearable:"",placeholder:""},null,8,["disabled","value","status"])]}),_:1},8,["feedback"])]}),_:1}),a(b,{span:"12"},{default:t(()=>{var m;return[a(D,{path:"endDate",label:"Fecha de fin",feedback:(m=i.value)==null?void 0:m.endDate},{default:t(()=>{var v;return[a(w,{type:"date",placeholder:"",value:o.value.endDate,"onUpdate:value":[e[4]||(e[4]=h=>o.value.endDate=h),e[5]||(e[5]=()=>i.value!=null?i.value.endDate=null:()=>{})],status:((v=i.value)==null?void 0:v.endDate)!=null?"error":"",clearable:""},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1}),a(b,{span:"24"},{default:t(()=>{var m;return[a(D,{path:"observations",label:"Observaciones",feedback:(m=i.value)==null?void 0:m.observations},{default:t(()=>{var v;return[a(w,{type:"textarea",value:o.value.observations,"onUpdate:value":[e[6]||(e[6]=h=>o.value.observations=h),e[7]||(e[7]=()=>i.value!=null?i.value.observations=null:()=>{})],status:((v=i.value)==null?void 0:v.observations)!=null?"error":"",clearable:"",placeholder:"Ingrese observaciones"},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),we={style:{"border-bottom":"1px solid #e9e9e9"}},xe=F({__name:"DataTable",setup(l){const n=c(!1),r=c([]),u=c(!1),_=c(null),d=se({...j()}),p=c({search:null,page:d.page,pageSize:d.pageSize}),o=c({}),I=fe(s=>{_.value=s,u.value=!0}),f=async()=>{p.value.page=1,await g()},g=async()=>{n.value=!0,o.value=await De(p.value),r.value=o.value.data,d.total=o.value.total,d.pageSize=o.value.per_page,d.page=o.value.current_page,d.pageCount=o.value.last_page,n.value=!1},S=q(()=>{f()},400),z=async s=>{p.value.page=s,await g()},P=async s=>{p.value.page=1,p.value.pageSize=s,await g()};return(async()=>{await g()})(),(s,e)=>{const y=W,D=H,b=E,w=ve;return T(),M(N,null,[$("div",we,[a(b,{gutter:12,style:{padding:"12px 16px"}},{default:t(()=>[a(y,{span:12}),a(y,{span:12},{default:t(()=>[a(D,{size:"large",placeholder:"Buscar",value:p.value.search,"onUpdate:value":e[0]||(e[0]=x=>p.value.search=x),onInput:k(S),clearable:""},{suffix:t(()=>[a(ue,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),a(b,null,{default:t(()=>[a(y,{span:24},{default:t(()=>[a(w,{key:"id",remote:"","single-line":!1,columns:k(I),data:r.value,pagination:k(ge)(d),"pagination-show-size-picker":!0,loading:n.value,"onUpdate:page":z,"onUpdate:pageSize":P},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),re(s.$slots,"extra",{reLoadDataTable:f})]),a(Q,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=x=>u.value=x),item:_.value,onSuccess:f},null,8,["modelValue","item"])],64)}}}),Ne=F({__name:"GradeDeadlineView",setup(l){const n=c(!1);return(r,u)=>{const _=U,d=G;return T(),M(N,null,[a(d,{segmented:{header:!0,content:!0}},{header:t(()=>u[2]||(u[2]=[$("span",{class:"text-sm text-slate-500"}," Gestion de periodo de ingresos de notas ",-1),$("h5",{class:"text-lg font-bold text-slate-800"}," Habilitar ingreso de notas ",-1)])),"header-extra":t(()=>[a(_,{"render-icon":k(ae)("additem"),onClick:u[0]||(u[0]=p=>n.value=!0)},{default:t(()=>u[3]||(u[3]=[C(" Agregar ")])),_:1},8,["render-icon"])]),_:1}),a(xe,null,{extra:t(({reLoadDataTable:p})=>[a(Q,{modelValue:n.value,"onUpdate:modelValue":u[1]||(u[1]=o=>n.value=o),item:null,onSuccess:p},null,8,["modelValue","onSuccess"])]),_:1})],64)}}});export{Ne as default};
