import{r as U,i as H}from"./DataTable.types-BjrSoKaL.js";import{_ as te,a as ae,b as ne,c as oe,d as le,e as re}from"./period.services-BAslYbEo.js";import{d as B,a9 as R,a4 as M,a6 as a,aa as e,ah as J,ag as D,h as A,e as se,r as u,g as ie,ae as O,ab as S,ai as L,aj as ue,ak as de,al as W,am as ce,ac as V,_ as Y}from"./index-DvYzMf2M.js";import{_ as pe}from"./InputNumber-DyB4W_ZG.js";import{_ as Z,a as me}from"./FormItem-YPSbYUsQ.js";import{N as G,_ as N,c as K,b as F,a as _e}from"./Col-CIH6lTu0.js";import{u as Q,_ as ve}from"./composables-DRgl5ljF.js";import{_ as ge}from"./Dropdown-DsRfH9bj.js";import{d as $}from"./debounce.utils-DqPPCsFD.js";import{_ as fe}from"./Input-BCz2VVQV.js";import{_ as q}from"./selectables.services-TaI5_eLI.js";import{u as be}from"./period.stores-DwlCazgL.js";import"./get-uXzlwZRV.js";import"./Remove-DOA3W0PK.js";import"./Add-BwvylLgU.js";import"./Forward-B-RFULzP.js";import"./use-keyboard-CQ_fFCxs.js";const ye=B({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(_,{emit:p}){const r=Q(),t=p,d=[{label:"Editar",key:"edit",icon:U("edit-2"),props:{onClick:()=>t("edit")}},{label:"Eliminar",key:"delete",icon:U("trash","red"),props:{style:{color:"red"},onClick:()=>{r.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{secondary:!0,type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{t("delete")}})}}}];return(i,s)=>{const o=D,c=ge;return R(),M(c,{options:d,placement:"bottom-start"},{default:a(()=>[e(o,null,{default:a(()=>[e(J,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})}}}),X=[{value:1,label:"ENERO"},{value:2,label:"FEBRERO"},{value:3,label:"MARZO"},{value:4,label:"ABRIL"},{value:5,label:"MAYO"},{value:6,label:"JUNIO"},{value:7,label:"JULIO"},{value:8,label:"AGOSTO"},{value:9,label:"SEPTIEMBRE"},{value:10,label:"OCTUBRE"},{value:11,label:"NOVIEMBRE"},{value:12,label:"DICIEMBRE"}],he=(_,p)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(r){const t=r;return A(ye,{onEdit:()=>{_(t)},onDelete:()=>{p(t)},item:t},{default:()=>"Editar"})}},{title:"Año",key:"year",minWidth:"150px"},{title:"Mes",key:"month",minWidth:"150px",render:r=>{const t=X.find(d=>d.value===r.month);return A("span",t==null?void 0:t.label)}},{title:"Matrícula",key:"enrollmentEnabled",width:"150px",render:r=>A(G,{type:r.enrollmentEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>r.enrollmentEnabled?"	Habilitada":"-"})},{title:"Activo",key:"isEnabled",width:"150px",render:r=>A(G,{type:r.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>r.isEnabled?"	Activo":"Deshabilitado"})}],Pe=(_=H())=>({page:_.page,total:_.total,pageSize:_.pageSize,pageCount:_.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${_.total} registros`}}),j=()=>({id:null,year:new Date().getFullYear(),month:null}),we=()=>({year:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}],month:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),ee=B({__name:"PeriodForm",props:{item:{},modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(_,{emit:p}){const r=p,t=_,d=se({get:()=>t.modelValue,set:m=>r("update:modelValue",m)}),i=u(!1),s=u(null),o=u(j()),c=u(null),C=u({...we()}),h=async()=>{if(s.value){const m=await s.value.validate();let n=null;m?(i.value=!0,o.value.id?n=await te(o.value):n=await ae(o.value),n.status?(r("success"),d.value=!1):c.value=n.data):console.log("Formulario inválido")}i.value=!1},b=()=>{console.log("Inicializando formulario"),o.value=t.item?{...t.item}:j()};return ie(d,m=>{m&&b()}),(m,n)=>{const z=pe,x=Z,T=N,v=K,P=F,I=me,l=D,g=_e,k=L,w=ue;return R(),M(w,{show:d.value,"onUpdate:show":n[5]||(n[5]=f=>d.value=f)},{default:a(()=>[e(k,{style:{width:"500px"},title:m.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:a(()=>[e(g,{justify:"end"},{default:a(()=>[e(l,{tertiary:"",size:"large",onClick:n[4]||(n[4]=f=>d.value=!1),disabled:i.value},{default:a(()=>n[6]||(n[6]=[O(" Cancelar ")])),_:1},8,["disabled"]),e(l,{size:"large",type:"primary",onClick:h,loading:i.value},{default:a(()=>n[7]||(n[7]=[O("Guardar")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[e(I,{ref_key:"formRef",ref:s,model:o.value,rules:C.value,size:"large"},{default:a(()=>[e(P,{gutter:16},{default:a(()=>[e(T,{span:"12"},{default:a(()=>{var f;return[e(x,{path:"year",label:"Año",feedback:(f=c.value)==null?void 0:f.year},{default:a(()=>{var E;return[e(z,{clearable:"",maxlength:"4",status:((E=c.value)==null?void 0:E.year)!=null?"error":"",value:o.value.year,"onUpdate:value":n[0]||(n[0]=y=>o.value.year=y),valueModifiers:{number:!0},onInput:n[1]||(n[1]=y=>c.value!=null?c.value.year=null:()=>{})},null,8,["status","value"])]}),_:1},8,["feedback"])]}),_:1}),e(T,{span:"12"},{default:a(()=>{var f;return[e(x,{path:"month",label:"Mes",feedback:(f=c.value)==null?void 0:f.month},{default:a(()=>{var E;return[e(v,{clearable:"",value:o.value.month,"onUpdate:value":n[2]||(n[2]=y=>o.value.month=y),options:S(X),"virtual-scroll":!1,status:((E=c.value)==null?void 0:E.month)!=null?"error":"",onInput:n[3]||(n[3]=y=>c.value!=null?c.value.month=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ce={style:{"border-bottom":"1px solid #e9e9e9"}},Ee=B({__name:"DataTable",setup(_){const p=u(!1),r=u([]),t=u(!1),d=u(null),i=de({...H()}),s=u({search:null,page:i.page,pageSize:i.pageSize}),o=u({}),h=he(v=>{d.value=v,t.value=!0},async v=>{await oe(v),await b()}),b=async()=>{s.value.page=1,await m()},m=async()=>{p.value=!0,o.value=await ne(s.value),r.value=o.value.data,i.total=o.value.total,i.pageSize=o.value.per_page,i.page=o.value.current_page,i.pageCount=o.value.last_page,p.value=!1},n=$(()=>{b()},400),z=async v=>{s.value.page=v,await m()},x=async v=>{s.value.page=1,s.value.pageSize=v,await m()};return(async()=>{await m()})(),(v,P)=>{const I=N,l=fe,g=F,k=ve;return R(),W(Y,null,[ce(v.$slots,"extra",{reLoadDataTable:b}),V("div",Ce,[e(g,{gutter:12,style:{padding:"12px 16px"}},{default:a(()=>[e(I,{span:12}),e(I,{span:12},{default:a(()=>[e(l,{size:"large",placeholder:"Buscar",value:s.value.search,"onUpdate:value":P[0]||(P[0]=w=>s.value.search=w),onInput:S(n),clearable:""},{suffix:a(()=>[e(J,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(I,{span:24},{default:a(()=>[e(k,{key:"id",remote:"","single-line":!1,columns:S(h),data:r.value,pagination:S(Pe)(i),"pagination-show-size-picker":!0,loading:p.value,"onUpdate:page":z,"onUpdate:pageSize":x},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1})]),e(ee,{modelValue:t.value,"onUpdate:modelValue":P[1]||(P[1]=w=>t.value=w),item:d.value,onSuccess:b},null,8,["modelValue","item"])],64)}}}),Se=B({__name:"UpdateCurrentAndEnrollmentPeriod",emits:["updated"],setup(_,{emit:p}){const r=p,t=be(),d=Q(),i=u([]),s=u([]),o=u(!1),c=u(!1),C=u(null),h=u(null),b=async l=>{o.value=!0,i.value=await q(l),o.value=!1},m=async l=>{c.value=!0,s.value=await q(l),c.value=!1},n=$(l=>{b(l)},400),z=$(l=>{m(l)},400),x=async()=>{d.warning({title:"Confirmar",content:"¿Está seguro de cambiar el periodo académico actual?",positiveText:"Aceptar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{v()}})},T=async()=>{d.warning({title:"Confirmar",content:"¿Está seguro de cambiar el periodo de matrícula?",positiveText:"Aceptar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{P()}})},v=async()=>{let l=C.value;l=l??0,await le(l),r("updated"),t.getCurrent()},P=async()=>{let l=h.value;l=l??0,await re(l),r("updated"),t.getEnrollment()};return(async()=>{var l,g;await b(""),await m(""),C.value=((l=t.current)==null?void 0:l.id)??null,h.value=((g=t.enrollment)==null?void 0:g.id)??null})(),(l,g)=>{const k=K,w=Z,f=N,E=F;return R(),M(E,{gutter:16},{default:a(()=>[e(f,{span:"12"},{default:a(()=>[e(w,{label:"Periodo Académico actual"},{default:a(()=>[e(k,{value:C.value,"onUpdate:value":[g[0]||(g[0]=y=>C.value=y),x],placeholder:"Seleccionar Periodo Académico","virtual-scroll":!1,options:i.value,loading:o.value,onSearch:S(n),filterable:"",clearable:"",remote:""},null,8,["value","options","loading","onSearch"])]),_:1})]),_:1}),e(f,{span:"12"},{default:a(()=>[e(w,{label:"Periodo de matrícula"},{default:a(()=>[e(k,{value:h.value,"onUpdate:value":[g[1]||(g[1]=y=>h.value=y),T],placeholder:"Seleccionar Periodo Académico",filterable:"",options:s.value,loading:c.value,clearable:"",remote:"","virtual-scroll":!1,onSearch:S(z)},null,8,["value","options","loading","onSearch"])]),_:1})]),_:1})]),_:1})}}}),xe={class:"px-4 pt-4 pb-1 w-full bg-gray-100"},je=B({__name:"index",setup(_){const p=u(!1);return(r,t)=>{const d=D,i=L;return R(),W(Y,null,[e(i,{segmented:{header:!0,content:!0,footer:!0}},{header:a(()=>t[2]||(t[2]=[V("h6",{style:{"font-size":"14px",color:"#999",margin:"0"}}," Gestión Periodos Académicos ",-1),O(" Periodos Académicos ")])),"header-extra":a(()=>[e(d,{"render-icon":S(U)("additem"),onClick:t[0]||(t[0]=s=>p.value=!0)},{default:a(()=>t[3]||(t[3]=[O(" Agregar ")])),_:1},8,["render-icon"])]),_:1}),e(Ee,null,{extra:a(({reLoadDataTable:s})=>[V("div",xe,[e(Se,{onUpdated:s},null,8,["onUpdated"])]),e(ee,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=o=>p.value=o),item:null,onSuccess:s},null,8,["modelValue","onSuccess"])]),_:1})],64)}}});export{je as default};
