import{r as D}from"./icon.utils-BZ_5fGn6.js";import{c as ae,_ as le}from"./selectables.services-C_NjbCfl.js";import{az as ne,d as $,e as W,r as d,j as J,a9 as S,aa as T,aI as oe,ab as l,ac as t,ag as M,aA as F,aB as K,a3 as L,ad as O,ae as x,aH as Q,h as H,aJ as se,aG as X,_ as Y,af as A,aK as ue,a8 as re}from"./index-BOyx2DGO.js";import{a as ie,i as Z}from"./DataTable.types-BEg5m_To.js";import{_ as ce,a as de}from"./FormItem-BNNBpqpK.js";import{_ as N,a as G}from"./Col-Ddh-mtwO.js";import{_ as ee}from"./Select-CP6PIrTl.js";import{_ as pe}from"./InputNumber-BLT06Q5l.js";import{_ as me}from"./Space-Bq9hZ6L8.js";import{_ as _e}from"./Switch-BLmH_3Zr.js";import{u as ve}from"./composables-C-nEvORv.js";import{_ as fe}from"./Dropdown-DquLRH-c.js";import{_ as ge}from"./Tag-DM5krFKW.js";import{d as Ie}from"./debounce.utils-DqPPCsFD.js";import{d as j}from"./course.services-BxHg0hIi.js";import{_ as ye}from"./Input-CA42N3nM.js";import{_ as be}from"./DataTable-CHe9vRd_.js";import"./get-BgSbcy5X.js";import"./Popover-C3xoDLDW.js";import"./use-merged-state-PebSr71T.js";import"./Suffix-3kzIsxrs.js";import"./Tooltip-C1e_98yG.js";const q=()=>({id:null,curriculumId:null,courseId:null,studentTypeId:null,presentialPrice:0,virtualPrice:0,isEnabled:!0}),we=()=>({moduleId:[{required:!0,message:"Obligatório"}],studentTypeId:[{required:!0,message:"Obligatório"}],presentialPrice:[],virtualPrice:[]}),U=ne(),Pe=async s=>{try{return(await U.post("/course-price/load-data-table",s)).data.data}catch{return ie()}},ke=async s=>{try{return{status:!0,data:(await U.post("/course-price",s)).data.data}}catch(o){return o.response.status===422?{status:!1,data:o.response.data.errors}:{status:!1,data:null}}},Te=async s=>{try{return{status:!0,data:(await U.put("/course-price",s)).data.data}}catch(o){return o.response.status===422?{status:!1,data:o.response.data.errors}:{status:!1,data:null}}},xe=async s=>{try{return await U.delete("/course-price",{data:{id:s.id}}),!0}catch{return!1}},te=$({__name:"CoursePriceForm",props:{item:{},modelValue:{type:Boolean},studentTypesItems:{},coursesItems:{},curriculumId:{}},emits:["update:modelValue","success"],setup(s,{emit:o}){const i=o,r=s,c=W({get:()=>r.modelValue,set:m=>i("update:modelValue",m)}),I=d(!1),w=d(null),a=d(q()),n=d(null),f=d({...we()}),h=async()=>{if(n.value=null,w.value){const m=await w.value.validate();let e=null;m?(I.value=!0,a.value.id?e=await Te(a.value):(a.value.curriculumId=r.curriculumId,e=await ke(a.value)),e.status?(i("success"),c.value=!1):n.value=e.data):console.log("Formulario inválido")}I.value=!1},E=()=>{console.log("Inicializando formulario"),a.value=r.item?{...r.item}:q()};return J(c,m=>{m&&E()}),(m,e)=>{const g=ee,y=de,b=G,z=pe,V=_e,k=me,R=N,_=ce,P=M,C=K,B=oe;return T(),S(B,{show:c.value,"onUpdate:show":e[10]||(e[10]=u=>c.value=u)},{default:l(()=>[t(C,{style:{width:"600px"},title:m.item?"EDITAR REGISTRO":"NUEVO REGISTRO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{footer:l(()=>[t(k,{justify:"end"},{default:l(()=>[t(P,{tertiary:"",size:"large",onClick:e[9]||(e[9]=u=>c.value=!1),disabled:I.value},{default:l(()=>e[11]||(e[11]=[F(" Cancelar ")])),_:1},8,["disabled"]),t(P,{size:"large",type:"primary",onClick:h,loading:I.value},{default:l(()=>e[12]||(e[12]=[F("Guardar")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[t(_,{ref_key:"formRef",ref:w,model:a.value,rules:f.value,size:"large"},{default:l(()=>[t(R,{gutter:16},{default:l(()=>[t(b,{span:"24"},{default:l(()=>{var u;return[t(y,{path:"studentTypeId",label:"Tipo de estudiante",feedback:(u=n.value)==null?void 0:u.studentTypeId},{default:l(()=>{var v;return[t(g,{value:a.value.studentTypeId,"onUpdate:value":e[0]||(e[0]=p=>a.value.studentTypeId=p),options:m.studentTypesItems,status:((v=n.value)==null?void 0:v.studentTypeId)!=null?"error":"",filterable:"","virtual-scroll":!1,clearable:"","onUpdate:modelValue":e[1]||(e[1]=p=>n.value!=null?n.value.studentTypeId=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),t(b,{span:"24"},{default:l(()=>{var u;return[t(y,{path:"courseId",label:"Curso",feedback:(u=n.value)==null?void 0:u.courseId},{default:l(()=>{var v;return[t(g,{value:a.value.courseId,"onUpdate:value":e[2]||(e[2]=p=>a.value.courseId=p),options:m.coursesItems,status:((v=n.value)==null?void 0:v.courseId)!=null?"error":"",filterable:"","virtual-scroll":!1,clearable:"","onUpdate:modelValue":e[3]||(e[3]=p=>n.value!=null?n.value.courseId=null:()=>{})},null,8,["value","options","status"])]}),_:1},8,["feedback"])]}),_:1}),t(b,{span:"8"},{default:l(()=>{var u;return[t(y,{path:"presentialPrice",label:"Precio presencial",feedback:(u=n.value)==null?void 0:u.presentialPrice},{default:l(()=>{var v;return[t(z,{value:a.value.presentialPrice,"onUpdate:value":e[4]||(e[4]=p=>a.value.presentialPrice=p),status:((v=n.value)==null?void 0:v.presentialPrice)!=null?"error":"","onUpdate:modelValue":e[5]||(e[5]=p=>n.value!=null?n.value.presentialPrice=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1}),t(b,{span:"8"},{default:l(()=>{var u;return[t(y,{path:"virtualPrice",label:"Precio virtual",feedback:(u=n.value)==null?void 0:u.virtualPrice},{default:l(()=>{var v;return[t(z,{value:a.value.virtualPrice,"onUpdate:value":e[6]||(e[6]=p=>a.value.virtualPrice=p),status:((v=n.value)==null?void 0:v.virtualPrice)!=null?"error":"","onUpdate:modelValue":e[7]||(e[7]=p=>n.value!=null?n.value.virtualPrice=null:()=>{})},null,8,["value","status"])]}),_:1},8,["feedback"])]}),_:1}),t(b,{span:"24"},{default:l(()=>[t(k,{justify:"end"},{default:l(()=>[t(y,{"label-placement":"left",label:"¿Habilitado?",path:"isEnabled","show-feedback":!1},{default:l(()=>[t(V,{value:a.value.isEnabled,"onUpdate:value":e[8]||(e[8]=u=>a.value.isEnabled=u)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),ze=$({__name:"DataTableOp",props:{item:{}},emits:["edit","delete"],setup(s,{emit:o}){const{hasPermission:i}=L(),r=ve(),c=o,I=[{label:"Editar",key:"edit",icon:D("edit-2"),show:i(["course-price.edit"]),props:{onClick:()=>c("edit")}},{label:"Eliminar",key:"delete",icon:D("trash","red"),show:i(["course-price.delete"]),props:{style:{color:"red"},onClick:()=>{r.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!1,negativeButtonProps:{type:"tertiary",size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{c("delete")}})}}}];return(w,a)=>{const n=M,f=fe;return x(i)(["course-price.edit","course-price.delete"])?(T(),S(f,{key:0,options:I,placement:"bottom-start"},{default:l(()=>[t(n,null,{default:l(()=>[t(Q,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1})):O("",!0)}}}),Ve=(s,o)=>[{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(i){const r=i;return H(ze,{onEdit:()=>{s(r)},onDelete:()=>{o(r)},item:r},{default:()=>"Editar"})}},{title:"Tipo de Estudiante",key:"studentType",minWidth:"200px"},{title:"Modulo",key:"course",minWidth:"200px"},{title:"Precio Presencial",key:"presentialPrice",minWidth:"150px"},{title:"Precio Virtual",key:"virtualPrice",minWidth:"150px"},{title:"Habilitado",key:"isEnabled",width:"150px",render:i=>H(ge,{type:i.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>i.isEnabled?"	Habilitado":"Deshabilitado"})}],Ce=(s=Z())=>({page:s.page,total:s.total,pageSize:s.pageSize,pageCount:s.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${s.total} registros`}}),Se={style:{"border-bottom":"1px solid #e9e9e9"}},he=$({__name:"DataTable",props:{curriculumId:{}},setup(s){const o=s,i=W(()=>({curriculumId:o.curriculumId})),r=d(!1),c=d([]),I=d(!1),w=d(null),a=se({...Z()}),n=d({search:null,page:a.page,pageSize:a.pageSize,filters:{...i.value}}),f=d({}),m=Ve(_=>{w.value=_,I.value=!0},async _=>{await xe(_),await e()}),e=async()=>{n.value.page=1,await g()},g=async()=>{r.value=!0,f.value=await Pe(n.value),c.value=f.value.data,a.total=f.value.total,a.pageSize=f.value.per_page,a.page=f.value.current_page,a.pageCount=f.value.last_page,r.value=!1},y=Ie(()=>{e()},400),b=async _=>{n.value.page=_,await g()},z=async _=>{n.value.page=1,n.value.pageSize=_,await g()},V=d([]),k=d([]),R=async()=>{V.value=await ae(),k.value=await j({curriculumId:o.curriculumId}),await g()};return J(i,async(_,P)=>{n.value.filters=_,k.value=await j({curriculumId:n.value.filters.curriculumId}),await e()},{deep:!0}),R(),(_,P)=>{const C=G,B=ye,u=N,v=be;return T(),X(Y,null,[A("div",Se,[t(u,{gutter:12,style:{padding:"12px 16px"}},{default:l(()=>[t(C,{span:12}),t(C,{span:12},{default:l(()=>[t(B,{size:"large",placeholder:"Buscar",value:n.value.search,"onUpdate:value":P[0]||(P[0]=p=>n.value.search=p),onInput:x(y),clearable:""},{suffix:l(()=>[t(Q,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),t(u,null,{default:l(()=>[t(C,{span:24},{default:l(()=>[t(v,{key:"id",remote:"",size:"small","single-line":!1,columns:x(m),data:c.value,pagination:x(Ce)(a),"pagination-show-size-picker":!0,loading:r.value,"onUpdate:page":b,"onUpdate:pageSize":z},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),ue(_.$slots,"extra",{reLoadDataTable:e,studentTypesItems:V.value,coursesItems:k.value})]),t(te,{modelValue:I.value,"onUpdate:modelValue":P[1]||(P[1]=p=>I.value=p),item:w.value,onSuccess:e,studentTypesItems:V.value,coursesItems:k.value,curriculumId:o.curriculumId},null,8,["modelValue","item","studentTypesItems","coursesItems","curriculumId"])],64)}}}),Ze=$({__name:"index",setup(s){const{hasPermission:o}=L(),i=d([]),r=d(!1),c=d({curriculumId:null});return(async()=>{i.value=await le()})(),(w,a)=>{const n=M,f=ee,h=G,E=N,m=K,e=re("AppNotAuthorization");return x(o)(["course-price.create","course-price.edit","course-price.delete"])?(T(),X(Y,{key:0},[t(m,{segmented:{header:!0,content:!0}},{header:l(()=>a[3]||(a[3]=[A("span",{class:"text-sm text-slate-500"}," Gestión de precios ",-1),A("h5",{class:"text-lg font-bold text-slate-800"},"Mensualidades",-1)])),"header-extra":l(()=>[x(o)(["course-price.create"])?(T(),S(n,{key:0,type:"primary",size:"large","render-icon":x(D)("additem"),onClick:a[0]||(a[0]=g=>r.value=!0)},{default:l(()=>a[4]||(a[4]=[F(" Agregar ")])),_:1},8,["render-icon"])):O("",!0)]),action:l(()=>[t(E,{gutter:"16",style:{display:"flex","justify-content":"center"}},{default:l(()=>[t(h,{span:"10"},{default:l(()=>[t(f,{value:c.value.curriculumId,"onUpdate:value":a[1]||(a[1]=g=>c.value.curriculumId=g),placeholder:"Seleccionar Plan de estudio",filterable:"",options:i.value,clearable:"","virtual-scroll":!1},null,8,["value","options"])]),_:1})]),_:1})]),_:1}),c.value.curriculumId?(T(),S(he,{key:0,curriculumId:c.value.curriculumId},{extra:l(({reLoadDataTable:g,studentTypesItems:y,coursesItems:b})=>[t(te,{modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=z=>r.value=z),item:null,onSuccess:g,studentTypesItems:y,coursesItems:b,curriculumId:c.value.curriculumId},null,8,["modelValue","onSuccess","studentTypesItems","coursesItems","curriculumId"])]),_:1},8,["curriculumId"])):O("",!0)],64)):(T(),S(e,{key:1}))}}});export{Ze as default};
