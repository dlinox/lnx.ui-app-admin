import{d as de,e as ae,r as c,j as Ie,a8 as ie,aG as w,aa as p,_ as O,ac as n,ab as e,aB as ce,af as t,aU as H,a9 as k,aY as Z,aZ as xe,aA as v,ah as s,ag as pe,ae as f,aI as he,a3 as ke,a5 as we,aD as Se,ad as j}from"./index-DRRg_eBM.js";import{r as ue}from"./icon.utils-BkZ-Dn8n.js";import{u as Ee}from"./useBreakpoints-BNPff5Lt.js";import{_ as Ce,a as Me,b as Ne,c as $e,d as Ve,e as ze,f as Pe,g as Re}from"./EditEnrollmentGroup.vue_vue_type_script_setup_true_lang-qUBl6wuK.js";import"./studentType.services-qFZjJDlz.js";import{i as Ae}from"./student.services-xrSQ_Sb9.js";import"./documentType.services-lOLtMmx1.js";import{_ as Be}from"./selectables.services-hf1ic-Kf.js";import{u as Fe}from"./period.stores-C0ndm13s.js";import{i as Ue}from"./course.services-Ce1FfeTx.js";import{_ as Oe,a as Te}from"./FormItem-BmvuZJcR.js";import{_ as me,a as _e}from"./Col-B7SFfu7K.js";import{_ as ve}from"./Select-BARTLa82.js";import{a as fe,_ as ge}from"./ListItem-D4M5d6vI.js";import{_ as ye}from"./Thing-gx5HDPvI.js";import{N as be}from"./Tag-DLFVs5T4.js";import{_ as De}from"./Statistic-CJkG59wF.js";import{_ as Le,a as qe}from"./CollapseItem-D3ibu-mw.js";import{_ as Ge}from"./Spin-CtCAKn7w.js";import{_ as je}from"./Space-BljgdQMa.js";import{_ as He}from"./Table-CmcYEevV.js";import"./Alert-Bez7UgkS.js";import"./Input-BJ4gQKpn.js";import"./Suffix-ByhxVsOv.js";import"./use-merged-state-CaVxhrEA.js";import"./Switch-DHyvHpJK.js";import"./DataTable.types-BEg5m_To.js";import"./composables-i7kb42iS.js";import"./Dropdown-CweT_dMY.js";import"./Popover-CJcKKGg6.js";import"./get-CpGV-8IY.js";const re=()=>({studentId:null,curriculumId:null,moduleId:null,courseId:null,groupId:null,payments:[]}),We=()=>({studentId:[],curriculumId:[],moduleId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}],courseId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}],groupId:[{type:"number",required:!0,trigger:["blur","input"],message:"Obligatorio"}]}),Ye={class:"wrapper-list-groups"},Ze={class:"table-auto w-full"},Je={class:"px-4 py-2 flex items-center"},Ke={class:"ms-2"},Qe={class:"text-end px-4 py-2"},Xe={class:"border-b-2 border-gray-500"},et={class:"px-4 py-2 font-bold text-lg text-end"},tt={class:"px-4 py-2 font-bold text-lg text-end"},lt={class:"text-red-500 text-sm text-end text-sm"},nt=de({__name:"EnrollmentModuleForm",props:{modelValue:{type:Boolean},studentId:{},curriculumId:{}},emits:["update:modelValue","success"],setup(se,{emit:J}){const D=J,g=se,y=ae({get:()=>g.modelValue,set:a=>D("update:modelValue",a)}),z=c(!1),P=c(!1),b=c([]),T=c([]),x=c([]),R=c(null),m=ae(()=>We()),d=c(re()),S=c([]),L=c(0),A=c(0),M=c(0),K=a=>{d.value.payments.push(a.token),S.value.push({token:a.token,amount:a.payment.amount,sequenceNumber:a.payment.sequenceNumber})},N=a=>{const o=S.value.splice(a,1)[0],E=o==null?void 0:o.token;if(!E)return;const C=d.value.payments.indexOf(E);C!==-1&&d.value.payments.splice(C,1)},q=async a=>{d.value.payments=[],d.value.courseId=null,d.value.groupId=null,T.value=[],x.value=[],T.value=await Ue(a),b.value.forEach(o=>{o.value==a&&(L.value=parseFloat(o.price))})},Q=async a=>{d.value.courseId=a,await u(a)},h=a=>{console.log("Grupo seleccionado",a),A.value=parseFloat(a.price),d.value.groupId&&d.value.groupId!=a.id?(d.value.groupId=a.id,M.value=A.value):d.value.groupId==a.id?(d.value.groupId=null,M.value=0):(d.value.groupId=a.id,M.value=A.value)},u=async a=>{const o=await Me({studentId:g.studentId,curriculumId:g.curriculumId,courseId:a});x.value=o.data},$=async()=>{const a=await $e(g.studentId,g.curriculumId);b.value=a.data},B=ae(()=>S.value.reduce((a,o)=>a+Number(o.amount),0)>=M.value),I=async()=>{if(d.value.studentId=g.studentId,d.value.curriculumId=g.curriculumId,R.value){if(!await R.value.validate())return;z.value=!0,(await Ne(d.value)).status&&(D("success"),y.value=!1),z.value=!1}},F=()=>{$(),console.log("Inicializando formulario")};return Ie(y,a=>{a&&(d.value=Object.assign({},{...re()}),S.value=[],b.value=[],T.value=[],x.value=[],L.value=0,A.value=0,M.value=0,F())}),(a,o)=>{const E=ve,C=Te,U=_e,W=be,G=pe,X=ye,ee=ge,te=fe,le=ie("LnxIcon"),ne=me,r=Oe,_=ce,i=he;return p(),w(O,null,[n(i,{show:y.value,"onUpdate:show":o[3]||(o[3]=l=>y.value=l)},{default:e(()=>[n(_,{style:{width:"600px"},title:"MATRICULA EN MODULO",segmented:{content:!0,footer:!0},size:"small",role:"dialog","aria-modal":"true"},{default:e(()=>[n(r,{ref_key:"formRef",ref:R,model:d.value,rules:m.value,size:"large"},{default:e(()=>[n(ne,{gutter:[16,16]},{default:e(()=>[n(U,{span:"24"},{default:e(()=>[n(C,{path:"moduleId",label:"Modulo"},{default:e(()=>[n(E,{value:d.value.moduleId,"onUpdate:value":[o[0]||(o[0]=l=>d.value.moduleId=l),q],placeholder:"Seleccionar modulo",options:b.value,"virtual-scroll":!1,clearable:"",filterable:""},null,8,["value","options"])]),_:1})]),_:1}),n(U,{span:"24"},{default:e(()=>[n(C,{path:"courseId",label:"Curso"},{default:e(()=>[n(E,{value:d.value.courseId,"onUpdate:value":[o[1]||(o[1]=l=>d.value.courseId=l),Q],placeholder:"Seeleccione un curso",options:T.value,"virtual-scroll":!1,clearable:"",filterable:""},null,8,["value","options"])]),_:1})]),_:1}),n(U,{span:"24"},{default:e(()=>[t("div",Ye,[n(te,{hoverable:"",clickable:""},{header:e(()=>{var l;return[v(" Grupos aperturados ("+s((l=x.value)!=null&&l.length?x.value.length:0)+") ",1)]}),default:e(()=>[(p(!0),w(O,null,H(x.value,l=>(p(),k(ee,{key:l.id,class:Z({"item-selected":d.value.groupId==l.id}),extra:l.price},{default:e(()=>[n(X,{onClick:V=>h(l)},xe({header:e(()=>[n(W,{bordered:!1,type:"info",size:"small"},{default:e(()=>[v(s(l.modality),1)]),_:2},1024),v(" "+s(`${l.group} - S/. ${l.price}`),1)]),default:e(()=>[o[5]||(o[5]=v(" Min.: ")),t("b",null,s(l.minStudents),1),o[6]||(o[6]=v(" | Matriculados: ")),t("b",null,s(l.enrolledStudents),1),o[7]||(o[7]=v(" | Reservados: ")),t("b",null,s(l.reservedStudents),1),o[8]||(o[8]=t("br",null,null,-1)),n(W,{bordered:!1,type:"info",size:"small"},{default:e(()=>[t("strong",null,s(l.schedules.days)+" - "+s(l.schedules.startHour)+" a "+s(l.schedules.endHour),1)]),_:2},1024)]),_:2},[d.value.groupId==l.id?{name:"header-extra",fn:e(()=>[n(G,{circle:"",type:"warning","render-icon":f(ue)("verify")},null,8,["render-icon"])]),key:"0"}:void 0]),1032,["onClick"])]),_:2},1032,["class","extra"]))),128))]),_:1})])]),_:1}),n(U,{span:"24"},{default:e(()=>[t("span",{role:"button",onClick:o[2]||(o[2]=l=>P.value=!0),class:"border border-dashed border-gray-300 p-4 rounded-sm flex items-center justify-center cursor-pointer text-gray-400 hover:bg-gray-50 font-bold hover:text-gray-500 mb-4"},[n(le,{class:"me-3","icon-name":"money-add",size:"20"}),o[9]||(o[9]=v(" Agregar pago "))]),t("table",Ze,[t("tbody",null,[(p(!0),w(O,null,H(S.value,(l,V)=>(p(),w("tr",{key:V,class:"border-b border-gray-300 border-dashed px-4 py-2"},[t("td",Je,[n(G,{type:"error",size:"small",secondary:"",onClick:oe=>N(V),"render-icon":f(ue)("trash")},null,8,["onClick","render-icon"]),t("i",Ke,s(l.sequenceNumber),1)]),t("td",Qe,"S/. "+s(l.amount),1)]))),128)),t("tr",Xe,[o[10]||(o[10]=t("td",{class:"px-4 py-2"},"Total pagado",-1)),t("td",et," S/. "+s(S.value.reduce((l,V)=>l+parseInt(V.amount),0)),1)]),t("tr",null,[o[11]||(o[11]=t("td",{class:"px-4 py-2"},"Total a pagar",-1)),t("td",tt," S/. "+s(M.value),1)])])]),t("div",lt,s(B.value?"":"El monto pagado no cubre el total requerido."),1)]),_:1}),n(U,{span:"24"},{default:e(()=>[n(G,{size:"large",type:"primary",onClick:I,block:"",loading:z.value},{default:e(()=>o[12]||(o[12]=[v(" Realizar matricula ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"]),n(Ce,{modelValue:P.value,"onUpdate:modelValue":o[4]||(o[4]=l=>P.value=l),studentId:g.studentId,onSuccess:K},null,8,["modelValue","studentId"])],64)}}}),ot={class:"p-4"},at={class:"flex justify-end bg-gray-100 p-4 -mx-6 -mt-6 mb-4"},ut={class:"text-lg font-semibold w-full text-blue-800 p-2"},st={key:1},Ot=de({__name:"EnrollmentStudentView",setup(se){const{hasPermission:J}=ke(),{screenSize:D}=Ee(),g=we(),y=Fe(),z=c(!1),P=c(!1),b=c(null),T=c(null),x=c([]),R=c(!0),m=c({}),d=c(!0),S=c(null),L=c(null),A=c(null),M=async h=>{let u=await Pe({id:h}),$=new Blob([u],{type:"application/pdf"}),B=window.URL.createObjectURL($),I=document.getElementById("printFrame");I.src=B,I.onload=function(){var F;(F=I.contentWindow)==null||F.print()}},K=async()=>{const h=g.params.id;R.value=!0,m.value=await Ae(h),R.value=!1},N=async()=>{var $;const h=g.params.id,u=($=T.value)==null?void 0:$.id;d.value=!0,S.value=await Re(h,b.value,u),d.value=!1},q=(h,u=null)=>{L.value=h,A.value=u,P.value=!0},Q=async()=>{x.value=await Be(),b.value=x.value[0].value,K(),N()};return Se(()=>{Q()}),(h,u)=>{const $=ve,B=ce,I=De,F=je,a=Ge,o=_e,E=be,C=pe,U=He,W=ye,G=ge,X=fe,ee=qe,te=Le,le=me,ne=ie("AppNotAuthorization");return f(J)(["enrollment.create"])?(p(),w(O,{key:0},[n(B,{segmented:{header:!0,footer:!0,content:!0}},{header:e(()=>u[4]||(u[4]=[t("h6",{class:"text-sm text-gray-500"},"Matricular estudiante",-1),v(" Matricula regular ")])),"header-extra":e(()=>[n($,{value:b.value,"onUpdate:value":[u[0]||(u[0]=r=>b.value=r),N],placeholder:"Seleccionar Plan de estudio",filterable:"",options:x.value,"virtual-scroll":!1,"default-value":1},null,8,["value","options"])]),action:e(()=>u[5]||(u[5]=[])),_:1}),t("div",ot,[n(le,{gutter:16},{default:e(()=>[n(o,{span:f(D)=="lg"?6:24},{default:e(()=>[n(B,{segmented:{header:!0,content:!0},title:"InformaciÃ³n Personal",subtitle:"Datos del estudiante"},{default:e(()=>[n(a,{show:R.value},{default:e(()=>[n(F,{vertical:""},{default:e(()=>[n(I,{class:"small",label:"Tipo de estudiante"},{default:e(()=>{var r;return[v(s((r=m.value)==null?void 0:r.studentType),1)]}),_:1}),n(I,{class:"small",label:"Documento"},{default:e(()=>{var r,_,i;return[t("span",{class:Z((r=m.value)!=null&&r.documentNumber?"":"text-stone-400")},s((_=m.value)!=null&&_.documentNumber?(i=m.value)==null?void 0:i.documentNumber:"No registra"),3)]}),_:1}),n(I,{class:"small",label:"Nombres"},{default:e(()=>{var r;return[v(s((r=m.value)==null?void 0:r.fullName),1)]}),_:1}),n(I,{class:"small",label:"Correo electronico"},{default:e(()=>{var r,_,i;return[t("span",{class:Z((r=m.value)!=null&&r.email?"":"text-stone-400")},s((_=m.value)!=null&&_.email?(i=m.value)==null?void 0:i.email:"No registra"),3)]}),_:1}),n(I,{class:"small",label:"Telefono"},{default:e(()=>{var r,_,i;return[t("span",{class:Z((r=m.value)!=null&&r.phone?"":"text-stone-400")},s((_=m.value)!=null&&_.phone?(i=m.value)==null?void 0:i.phone:"No registra"),3)]}),_:1})]),_:1})]),_:1},8,["show"])]),_:1})]),_:1},8,["span"]),n(o,{span:f(D)=="lg"?18:24},{default:e(()=>[n(B,{segmented:{header:!0,content:!0},title:"Matricula"},{"header-extra":e(()=>[n(E,{bordered:!1,type:f(y).enrollment?"info":"error"},{default:e(()=>{var r;return[t("strong",null,s(f(y).enrollment?(r=f(y).enrollment)==null?void 0:r.period:"No habilitado"),1)]}),_:1},8,["type"])]),default:e(()=>[t("div",at,[n(C,{type:"primary",onClick:u[1]||(u[1]=r=>z.value=!0),disabled:!f(y).enrollment},{default:e(()=>u[6]||(u[6]=[v(" Nuevo Modulo ")])),_:1},8,["disabled"])]),n(te,null,{default:e(()=>{var r;return[(p(!0),w(O,null,H((r=S.value)==null?void 0:r.enrollments,_=>(p(),k(ee,{key:_.moduleId,name:_.moduleId},{header:e(()=>[t("h2",ut,s(_.moduleName)+" "+s(_.isExtracurricular?"(Extracurricular)":""),1)]),default:e(()=>[n(X,{hoverable:"",clickable:""},{default:e(()=>[(p(!0),w(O,null,H(_.courses,i=>(p(),k(G,{key:i.id},{default:e(()=>[n(W,{title:`${i.code} - ${i.name}`},{"header-extra":e(()=>[i.enrollmentGroups.length==0||i.enrollmentGroups.filter(l=>l.groupStatus=="ABIERTO").length==0?(p(),k(C,{key:0,type:"primary",onClick:l=>q(i.id)},{default:e(()=>u[7]||(u[7]=[v(" Matricular ")])),_:2},1032,["onClick"])):j("",!0)]),description:e(()=>[n(F,{size:"small"},{default:e(()=>[n(E,{bordered:!1,size:"small"},{default:e(()=>[v(" Area: "+s(i.area),1)]),_:2},1024)]),_:2},1024)]),default:e(()=>[i.enrollmentGroups.length>0?(p(),k(U,{key:0,"single-line":!1},{default:e(()=>[u[9]||(u[9]=t("thead",null,[t("tr",null,[t("th",{colspan:"2"},"Matricula"),t("th",{colspan:"3"},"Grupo"),t("th",{colspan:"2"})]),t("tr",null,[t("th",null,"Periodo"),t("th",null,"Estado"),t("th",null,"Grupo"),t("th",null,"Modalidad"),t("th",null,"Estado"),t("th",{rowspan:"2"},"Nota"),t("th",null,"Acciones")])],-1)),t("tbody",null,[(p(!0),w(O,null,H(i.enrollmentGroups,l=>{var V,oe;return p(),w("tr",null,[t("td",null,[((V=f(y).enrollment)==null?void 0:V.period)==l.period?(p(),k(E,{key:0,type:"info"},{default:e(()=>[v(s(l.period),1)]),_:2},1024)):(p(),w("span",st,s(l.period),1))]),t("td",null,s(l.enrollmentStatus),1),t("td",null,s(l.groupName),1),t("td",null,s(l.groupModality),1),t("td",null,s(l.groupStatus),1),t("td",null,s(l.grade),1),t("td",null,[((oe=f(y).enrollment)==null?void 0:oe.period)==l.period?(p(),k(Ve,{key:0,item:l,onResetEnrollment:Y=>q(i.id,Y),onChangeGroup:Y=>q(i.id,Y),onReserveEnrollment:N,onCancelEnrollment:N},null,8,["item","onResetEnrollment","onChangeGroup"])):j("",!0),l.enrollmentStatus==="MATRICULADO"?(p(),k(C,{key:1,"render-icon":f(ue)("printer"),onClick:Y=>M(l.id)},{default:e(()=>u[8]||(u[8]=[v(" Ficha ")])),_:2},1032,["render-icon","onClick"])):j("",!0)])])}),256))])]),_:2},1024)):j("",!0)]),_:2},1032,["title"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["name"]))),128))]}),_:1})]),_:1})]),_:1},8,["span"])]),_:1})]),u[10]||(u[10]=t("iframe",{id:"printFrame",style:{display:"none"}},null,-1)),m.value?(p(),k(nt,{key:0,modelValue:z.value,"onUpdate:modelValue":u[2]||(u[2]=r=>z.value=r),studentId:m.value.id,curriculumId:b.value,onSuccess:N},null,8,["modelValue","studentId","curriculumId"])):j("",!0),n(ze,{modelValue:P.value,"onUpdate:modelValue":u[3]||(u[3]=r=>P.value=r),studentId:m.value.id,curriculumId:b.value,courseId:L.value,enrollmetGroup:A.value,isSpecial:!1,onSuccess:N},null,8,["modelValue","studentId","curriculumId","courseId","enrollmetGroup"])],64)):(p(),k(ne,{key:1}))}}});export{Ot as default};
