import{u as N}from"./period.stores-Dm45MkGp.js";import{a as G,i as P}from"./DataTable.types-BfyqQUqo.js";import{h as z}from"./index-E0H31oqx.js";import{d as k,e as M,r as l,a9 as U,aa as h,a5 as w,a8 as s,ab as n,ah as R,ao as L,ae as q,af as j,h as C,ak as F,al as T,ac as v,ag as H,am as J,ad as K,_ as Q,ai as X}from"./index-DErOr0AP.js";import{_ as Y}from"./Dropdown-D0l2jCAn.js";import{_ as Z}from"./ButtonGroup-soyJJAkX.js";import{N as ee,_ as ae}from"./Select-Cy4RUJ2X.js";import{b as E,_ as te}from"./selectables.services-D0F7zURb.js";import{d as I}from"./debounce.utils-DqPPCsFD.js";import{_ as ne,a as oe}from"./Col-_50WYJb9.js";import{_ as se}from"./Input-j5r0X2o1.js";import{_ as re}from"./DataTable-D03hb7st.js";import"./get-C_Ul0xsd.js";import"./Tooltip-BqTXu7HV.js";const le=async t=>{try{return(await z().post("/enrollment-groups/load-data-table",t)).data.data}catch{return G()}},ie=async t=>{try{return{status:!0,data:(await z().post("/enrollment-groups/change-status-group",{...t})).data.data}}catch{return{status:!1,data:null}}},ue=k({__name:"GroupStatus",props:{groupId:{},status:{}},emits:["success"],setup(t,{emit:a}){const p=a,u=t,c=M(()=>[{label:"Cerrar",key:"CERRADO",disabled:u.status=="CERRADO"},{label:"Reabrir",key:"ABIERTO",disabled:u.status=="ABIERTO"}]),d=l(!1),o=async e=>{d.value=!0,await ie({id:u.groupId,status:e}),p("success"),d.value=!1};return(e,i)=>{const g=j,y=U("LnxIcon"),f=Y,_=Z;return h(),w(_,null,{default:s(()=>[n(g,{quaternary:""},{default:s(()=>[R(L(e.status),1)]),_:1}),e.status=="ABIERTO"||e.status=="CERRADO"?(h(),w(f,{key:0,trigger:"click",options:c.value,onSelect:o},{default:s(()=>[n(g,{tertiary:"",loading:d.value},{icon:s(()=>[n(y,{"icon-name":"edit"})]),_:1},8,["loading"])]),_:1},8,["options"])):q("",!0)]),_:1})}}}),pe=t=>[{title:"Grupo",key:"group",minWidth:"80px"},{title:"Curso",key:"course",minWidth:"200px"},{title:"Módulo",key:"module",minWidth:"200px"},{title:"Area",key:"area",minWidth:"200px"},{title:"Modalidad",key:"modality",minWidth:"120px"},{title:"Min. Est.",key:"minStudents",minWidth:"80px"},{title:"Matriculados",key:"studentEnrolled",minWidth:"110px"},{title:"Con reservados",key:"studentReserved",minWidth:"80px"},{title:"% Apertura",key:"percentageOpening",render:a=>C(ee,{type:a.percentageOpening?a.percentageOpening<60?"error":a.percentageOpening<100?"warning":"success":"default",tertiary:!0,bordered:!1,strong:!0},{default:()=>`${a.percentageOpening}%`})},{title:"Estado",key:"status",width:"150px",fixed:"right",render:a=>C(ue,{status:a.status,groupId:a.id,onSuccess:t})}],ce=(t=P())=>({page:t.page,total:t.total,pageSize:t.pageSize,pageCount:t.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${t.total} registros`}}),de={style:{"border-bottom":"1px solid #e9e9e9"}},_e=k({__name:"EnrollmentGroupDataTable",setup(t){const a=N(),p=l(!1),u=l([]),c=l(!1),d=l([]),o=F({...P()}),e=l({search:null,page:o.page,pageSize:o.pageSize,filters:{periodId:null}}),i=l({}),g=async r=>{p.value=!0,u.value=await E(r),p.value=!1},y=I(r=>{g(r)},400),f=async()=>{e.value.page=1,await _()},_=async()=>{c.value=!0,i.value=await le(e.value),d.value=i.value.data,o.total=i.value.total,o.pageSize=i.value.per_page,o.page=i.value.current_page,o.pageCount=i.value.last_page,c.value=!1},A=I(()=>{f()},400),O=async r=>{e.value.page=r,await _()},B=async r=>{e.value.page=1,e.value.pageSize=r,await _()},D=pe(_);return(async()=>{var m;await g("");const r=((m=a==null?void 0:a.enrollment)==null?void 0:m.periodId)||"";e.value.filters.periodId=r,await _()})(),(r,m)=>{const $=ae,b=ne,V=se,x=oe,W=re;return h(),T("div",de,[n(x,{gutter:12,class:"p-4 flex justify-between"},{default:s(()=>[n(b,{span:8},{default:s(()=>[n($,{value:e.value.filters.periodId,"onUpdate:value":[m[0]||(m[0]=S=>e.value.filters.periodId=S),f],placeholder:"Seleccionar Periodo Académico",filterable:"",options:u.value,loading:p.value,clearable:"",remote:"",size:"large","virtual-scroll":!1,onSearch:v(y)},null,8,["value","options","loading","onSearch"])]),_:1}),n(b,{span:12},{default:s(()=>[n(V,{size:"large",placeholder:"Buscar",value:e.value.search,"onUpdate:value":m[1]||(m[1]=S=>e.value.search=S),onInput:v(A),clearable:""},{suffix:s(()=>[n(H,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1})]),_:1}),n(x,null,{default:s(()=>[n(b,{span:24},{default:s(()=>[n(W,{key:"id",remote:"","single-line":!1,columns:v(D),data:d.value,pagination:v(ce)(o),"pagination-show-size-picker":!0,loading:c.value,"onUpdate:page":O,"onUpdate:pageSize":B},null,8,["columns","data","pagination","loading"])]),_:1})]),_:1}),J(r.$slots,"extra",{reLoadDataTable:f})])}}}),Re=k({__name:"EnrollmentGroupView",setup(t){const a=l(!1),p=l([]),u=async o=>{a.value=!0,p.value=await E(o),a.value=!1},c=l([]);return(async()=>{await u(""),c.value=await te()})(),(o,e)=>{const i=X;return h(),T(Q,null,[n(i,{segmented:{header:!0,content:!0}},{header:s(()=>e[0]||(e[0]=[K("h6",{style:{color:"#999",margin:"0"}},"Carga Académica",-1),R(" Apertura de grupos ")])),action:s(()=>e[1]||(e[1]=[])),_:1}),n(_e)],64)}}});export{Re as default};
