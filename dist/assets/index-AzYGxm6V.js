import{r as C}from"./icon.utils-_VQD1LzU.js";import{d as P,a3 as B,e as U,a9 as w,aa as f,ab as a,ac as t,ag as $,aH as W,h as I,r as d,aJ as Z,aG as E,_ as D,af as k,aK as ee,ad as F,ae as x,aA as S,aL as te,ah as ae,aB as oe,aM as ne}from"./index-B4HM4eEq.js";import{_ as M}from"./StudentForm.vue_vue_type_script_setup_true_lang-DbVOhz_5.js";import{d as se}from"./debounce.utils-DqPPCsFD.js";import{i as A}from"./DataTable.types-BEg5m_To.js";import{u as le}from"./composables-CnPINYM7.js";import{_ as ie}from"./Dropdown-CtyOND1F.js";import{N as V}from"./Tag-C7q16pA0.js";import{_ as re,a as ue,b as de}from"./student.services-K4dUhqj1.js";import{c as pe}from"./studentType.services-WXtKtk_7.js";import{c as ce}from"./documentType.services-etavtVqQ.js";import{_ as me,a as _e}from"./Col-CBFn7CGp.js";import{_ as ge}from"./Input-Blyfr7bU.js";import{_ as fe}from"./Alert-C2YmU2PH.js";import{_ as ve}from"./Space-DsuPZ34i.js";import{_ as ye}from"./DataTable-DxdGd7cD.js";import"./genders.constans-BK559Fh_.js";import"./useBreakpoints-ElCxPKgB.js";import"./Select-lU1ug5AA.js";import"./Popover-V6QhFDvP.js";import"./get-ClpdtJHT.js";import"./use-merged-state-D3q23DVU.js";import"./Suffix-CO3cYY28.js";import"./FormItem-cRsh-SHk.js";import"./Switch-BouS8iVV.js";import"./Tooltip-BuNmYRWT.js";const be=P({__name:"DataTableOp",props:{item:{}},emits:["edit","delete","create-user"],setup(i,{emit:r}){const s=r,l=le(),{hasPermission:e}=B(),_=i,u=U(()=>[{show:_.item.userId==null&&e(["student.create-account"]),label:"Crear cuenta de usuario",id:"create-user",key:"create-user",icon:C("security-user"),props:{onClick:()=>s("create-user")}},{show:e(["student.edit"]),label:"Editar",key:"edit",icon:C("edit-2"),props:{onClick:()=>s("edit")}},{show:e(["student.delete"]),label:"Eliminar",key:"delete",icon:C("trash","red"),props:{style:{color:"red"},onClick:()=>{l.warning({title:"Confirmar",content:"¿Está seguro que desea eliminar este registro?",positiveText:"Eliminar",negativeText:"Cancelar",closable:!1,showIcon:!0,negativeButtonProps:{size:"large"},positiveButtonProps:{size:"large",type:"error"},onPositiveClick:()=>{s("delete")}})}}}]);return(p,c)=>{const g=$,v=ie;return f(),w(v,{options:u.value,placement:"bottom-start"},{default:a(()=>[t(g,null,{default:a(()=>[t(W,{"icon-name":"setting-5",size:"20"})]),_:1})]),_:1},8,["options"])}}}),ke=(i,r,s)=>[{type:"selection",fixed:"left"},{title:"Ops.",key:"ops",width:"80px",fixed:"left",render(l){const e=l;return I(be,{onEdit:()=>{i(e)},onDelete:()=>{r(e)},onCreateUser:()=>{s(e)},item:e},{default:()=>"Editar"})}},{title:"Codigo",key:"code",minWidth:"100px"},{title:"Nro. Documento",key:"documentNumber",minWidth:"90px"},{title:"Nombre",key:"name",minWidth:"120px"},{title:"Apellido Paterno",key:"lastNameFather",minWidth:"100px"},{title:"Apellido Materno",key:"lastNameMother",minWidth:"100px"},{title:"Género",key:"gender",width:"75px"},{title:"Email",key:"email",minWidth:"130px"},{title:"Celular",key:"phone",minWidth:"100px"},{title:"Tipo de estudiante",key:"studentType",minWidth:"150px",render:l=>I(V,{tertiary:!0,bordered:!1,strong:!0},{default:()=>l.studentType})},{title:"Habilitado",key:"isEnabled",width:"150px",render:l=>I(V,{type:l.isEnabled?"success":"error",tertiary:!0,bordered:!1,strong:!0},{default:()=>l.isEnabled?"	Habilitado":"Deshabilitado"})}],xe=(i=A())=>({page:i.page,total:i.total,pageSize:i.pageSize,pageCount:i.pageCount,showSizePicker:!0,pageSizes:[10,50,100,500,1e3,5e3],style:{paddingRight:"16px",paddingBottom:"12px"},prefix(){return`Total ${i.total} registros`}}),we={style:{"border-bottom":"1px solid #e9e9e9"}},he=P({__name:"DataTable",setup(i){const r=d([]),s=d(!1),l=d([]),e=d(!1),_=d(null),u=Z({...A()}),p=d({search:null,page:u.page,pageSize:u.pageSize}),c=d({}),g=d({}),v=d([]),T=U(()=>l.value.filter(o=>r.value.includes(o.id))),z=d(null),b=async()=>{r.value=[],p.value.page=1,console.log("reloading data table"),await h()},h=async()=>{s.value=!0,c.value=await re(p.value),l.value=c.value.data,u.total=c.value.total,u.pageSize=c.value.per_page,u.page=c.value.current_page,u.pageCount=c.value.last_page,s.value=!1},R=se(()=>{b()},400),G=async o=>{p.value.page=o,await h()},H=async o=>{p.value.page=1,p.value.pageSize=o,await h()},K=(o,n)=>{_.value=o,z.value=n.filter(y=>y.id!==o.id),e.value=!0},L=o=>{_.value=o,z.value=null,e.value=!0},q=async o=>{await ue(o),await b()},O=async o=>{await de(o)&&await b()};return(async()=>{v.value=ke(L,q,O),await h(),g.value.studentTypesItems=await pe(),g.value.documentTypesItems=await ce()})(),(o,n)=>{const y=_e,J=ge,j=$,Q=ve,X=fe,N=me,Y=ye;return f(),E(D,null,[k("div",we,[t(N,{gutter:12,style:{padding:"12px 16px"}},{default:a(()=>[t(y,{span:12}),t(y,{span:12},{default:a(()=>[t(J,{size:"large",placeholder:"Buscar",value:p.value.search,"onUpdate:value":n[0]||(n[0]=m=>p.value.search=m),onInput:x(R),clearable:""},{suffix:a(()=>[t(W,{"icon-name":"search-normal-1",size:"20"})]),_:1},8,["value","onInput"])]),_:1}),T.value.length?(f(),w(y,{key:0,span:24,class:"mt-2"},{default:a(()=>[t(X,{"show-icon":!1},{default:a(()=>[n[3]||(n[3]=S(" Seleccione uno, el cual permanecerá en la lista de estudiantes, los demás serán eliminados de la lista y sus datos relacionados serán asociados al estudiante seleccionado. ")),n[4]||(n[4]=k("br",null,null,-1)),n[5]||(n[5]=k("strong",{class:"text-red-500"},"* Esta acción es irreversible.",-1)),t(Q,{class:"mt-2"},{default:a(()=>[(f(!0),E(D,null,te(T.value,m=>(f(),w(j,{strong:"",secondary:"",key:m.id,onClick:Se=>K(m,T.value)},{default:a(()=>[S(ae(m.code),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1}),t(N,null,{default:a(()=>[t(y,{span:24},{default:a(()=>[t(Y,{key:"id",remote:"",size:"small","single-line":!1,columns:v.value,data:l.value,pagination:x(xe)(u),"pagination-show-size-picker":!0,loading:s.value,"onUpdate:page":G,"onUpdate:pageSize":H,"checked-row-keys":r.value,"onUpdate:checkedRowKeys":n[1]||(n[1]=m=>r.value=m)},null,8,["columns","data","pagination","loading","checked-row-keys"])]),_:1})]),_:1}),ee(o.$slots,"extra",{reLoadDataTable:b,selectables:g.value})]),t(M,{modelValue:e.value,"onUpdate:modelValue":n[2]||(n[2]=m=>e.value=m),item:_.value,associatedItems:z.value,onSuccess:b,selectables:g.value},null,8,["modelValue","item","associatedItems","selectables"])],64)}}}),Ye=P({__name:"index",setup(i){const{hasPermission:r}=B(),s=d(!1);return(l,e)=>{const _=$,u=oe,p=ne;return x(r)(["student.create"])?(f(),E(D,{key:0},[t(u,{segmented:{header:!0,content:!0}},{header:a(()=>e[2]||(e[2]=[k("span",{class:"text-sm text-slate-500"}," Gestión de Estudiantes ",-1),k("h5",{class:"text-lg font-bold text-slate-800"},"Estudiantes",-1)])),"header-extra":a(()=>[x(r)(["student.create"])?(f(),w(_,{key:0,size:"large",type:"primary","render-icon":x(C)("additem"),onClick:e[0]||(e[0]=c=>s.value=!0)},{default:a(()=>e[3]||(e[3]=[S(" Agregar ")])),_:1},8,["render-icon"])):F("",!0)]),_:1}),t(he,null,{extra:a(({reLoadDataTable:c,selectables:g})=>[t(M,{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=v=>s.value=v),item:null,onSuccess:c,selectables:g},null,8,["modelValue","onSuccess","selectables"])]),_:1})],64)):(f(),w(p,{key:1,status:"403",title:"403 Forbidden",description:"Some of the doors are always close to you."},{footer:a(()=>[t(_,null,{default:a(()=>e[4]||(e[4]=[S("Take It Easy")])),_:1})]),_:1}))}}});export{Ye as default};
